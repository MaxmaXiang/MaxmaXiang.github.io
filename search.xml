<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>hexo使用教程</title>
    <url>/2024/02/03/hexo%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B/hexo%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B/</url>
    <content><![CDATA[<p>1.Hexo 最常用的几个命令</p>
<p><a href="https://www.jianshu.com/p/a2d298e26dcd">Hexo 最常用的几个命令 - 简书 (jianshu.com)</a></p>
<p>2.Hexo搭建Butterfly主题并快速美化</p>
<p><a href="https://blog.csdn.net/mjh1667002013/article/details/129290903?spm=1001.2101.3001.6650.2&amp;utm_medium=distribute.pc_relevant.none-task-blog-2~default~YuanLiJiHua~Position-2-129290903-blog-108306164.235^v32^pc_relevant_default_base3&amp;depth_1-utm_source=distribute.pc_relevant.none-task-blog-2~default~YuanLiJiHua~Position-2-129290903-blog-108306164.235^v32^pc_relevant_default_base3&amp;utm_relevant_index=5">【Hexo】Hexo搭建Butterfly主题并快速美化_hexo主题butterfly配置-CSDN博客</a></p>
<p>3.聚合图床</p>
<p><a href="https://www.superbed.cn/timeline">聚合图床 - 免费无限图片上传 (superbed.cn)</a></p>
<p>可能的报错：</p>
<p> OpenSSL SSL_connect: Connection was reset in connection to github.com:443</p>
<p>这个问题是vpn代理和git的代理不一致导致的，需要使用如下命令,端口号从vpn软件中查看</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">git config --global --unset http.proxy</span><br><span class="line">git config --global --unset https.proxy</span><br><span class="line">git config --global http.proxy 127.0.0.1:19180</span><br><span class="line">git config --global https.proxy 127.0.0.1:19181</span><br></pre></td></tr></table></figure>
<p>2 stream 1 was not closed cleanly before end of the underlying stream</p>
<p>这个问题是git默认使用的通信协议出现了问题，可以通过将默认通信协议修改为http/1.1来解决该问题</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">git config --global http.version HTTP/1.1</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>计算机</category>
      </categories>
      <tags>
        <tag>hexo使用教程</tag>
      </tags>
  </entry>
  <entry>
    <title>机器学习</title>
    <url>/2024/11/29/ai/%E5%90%B4%E6%81%A9%E8%BE%BE%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/</url>
    <content><![CDATA[<h1 id="机器学习"><a href="#机器学习" class="headerlink" title="机器学习"></a>机器学习</h1><h2 id="机器学习的应用："><a href="#机器学习的应用：" class="headerlink" title="机器学习的应用："></a>机器学习的应用：</h2><p>语音识别，计算机视觉，增强现实，自动驾驶，大规模农业，医疗保健</p>
<h2 id="机器学习的分类："><a href="#机器学习的分类：" class="headerlink" title="机器学习的分类："></a>机器学习的分类：</h2><ul>
<li>有监督学习：回归，分类</li>
</ul>
<ul>
<li>无监督学习：聚类</li>
</ul>
<h2 id="监督学习"><a href="#监督学习" class="headerlink" title="监督学习"></a>监督学习</h2><p>从x到y的预测,函数的复杂版</p>
<ul>
<li>电子邮件-&gt;垃圾邮件?(0/1)    垃圾邮件过滤</li>
<li>音频-&gt;文本转录    语音识别</li>
<li><p>英语-&gt;西班牙语    机器翻译</p>
</li>
<li><p>广告-&gt;用户信息 点击?(0/1)    在线广告</p>
</li>
<li><p>图像，雷达信息-&gt;其他车的位置    自动驾驶汽车</p>
</li>
</ul>
<h3 id="回归"><a href="#回归" class="headerlink" title="回归"></a>回归</h3><p>最简单的回归是用一元一次线性函数预测，根据已有的点来拟合出一个一元一次线性函数，然后用线性函数预测其他点。也可以将目标函数从y=ax+b替换成更复杂的其他函数，比如二次函数等。</p>
<h3 id="分类"><a href="#分类" class="headerlink" title="分类"></a>分类</h3><p>分类只输出一小部分的可能或2元类别（是否/对错）。即值域是不连续的，取值范围是有限多个值。常用的简单的函数模型有$\frac{1}{1+e^{x} }  $。</p>
<h2 id="无监督学习"><a href="#无监督学习" class="headerlink" title="无监督学习"></a>无监督学习</h2><p>无监督学习不需要从x到y的映射。输入为有一系列特征的数据集，如：(年龄,肿瘤大小)：（23，3）、（35，6）、（60，10）.无监督学习的目标是从数据集中寻找数据的结构和模式。</p>
<p>使用聚类算法对dna进行分类，将不同的人分成不同类别。</p>
<h3 id="聚类"><a href="#聚类" class="headerlink" title="聚类"></a>聚类</h3><p>异常检测：检测系统中的异常数据，比如金融系统的欺诈操作流水。</p>
<p>降维：将大数据压缩成小得多的数据集并尽可能少丢失信息。</p>
<h2 id="Jupyter-Notebook"><a href="#Jupyter-Notebook" class="headerlink" title="Jupyter Notebook"></a>Jupyter Notebook</h2><p><a href="https://blog.csdn.net/qq_62327883/article/details/135672680">从零开始！Jupyter Notebook的安装教程（附带pip和Python的安装教程）_jupyter notebook安装教程-CSDN博客</a></p>
<h2 id="线性回归模型"><a href="#线性回归模型" class="headerlink" title="线性回归模型"></a>线性回归模型</h2><p>线性回归是最简单的监督学习模型。我们假设只有一个影响因素，即特征的维度是1.所以模型函数如下：</p>
<p>f(w,b)(x)=wx+b</p>
<p>给定一组关于（x,y）的坐标，显然两点确定一条直线，当坐标的数量大于2时，不止一条直线可以选择。此时如何确定w和b？</p>
<p>使用损失函数（loss）（代价函数）（cost function）：</p>
<p>常见的损失函数有：平方误差成本函数</p>
<script type="math/tex; mode=display">
\frac{1}{2m} \sum_{i=1}^{m} (\hat{y}^{i}-y^{i} )^{2}</script><p>然后，我们的目标就是最小化损失函数。当我们把所有点代入损失函数后，实际上得到了一个关于w和b的二次函数。</p>
<p>我们假设这组坐标是(x1,y1),(x2,y2)….(xm,ym)，一共m个点。那原式=</p>
<script type="math/tex; mode=display">
\frac{1}{2m} \sum_{i=1}^{m} (y_i-(wx_i+b) )^{2}=\frac{1}{2m} \sum_{i=1}^{m} (-y_i^2+(w^2x_i^2+b^2+2x_iwb) -2wx_iy_i-2by_i)</script><p>如果我们先把b当做常数，求使得loss函数最小的w值，那这就是关于w的一个开口向上的二次函数，对称轴是-b/2a，即</p>
<script type="math/tex; mode=display">
\frac{1}{2m} \sum_{i=1}^{m} ((w^2x_i^2+2x_iwb) -2wx_iy_i)=\frac{1}{2m} \sum_{i=1}^{m} (x_i^2)*w^2+\frac{1}{2m} \sum_{i=1}^{m} (2x_ib -2x_iy_i)*w</script><script type="math/tex; mode=display">
a=\frac{1}{2m} \sum_{i=1}^{m} (x_i^2) \\
b=\frac{1}{2m} \sum_{i=1}^{m} (2x_ib -2x_iy_i)\\
\frac{-b}{2a}=\frac{\sum_{i=1}^{m} ( x_iy_i-x_ib)}{\sum_{i=1}^{m} (x_i^2)}</script><p>对于(1,1),(2,2),(3,3).我们假设b=0.那么关于w的二次函数的对称轴：</p>
<script type="math/tex; mode=display">
\frac{-b}{2a}=\frac{\sum_{i=1}^{m} ( x_iy_i)}{\sum_{i=1}^{m} (x_i^2)}=\frac{1*1+2*2+3*3}{1^2+2^2+3^2}=\frac{14}{14}=1</script><p>很明显，对于(1,1),(2,2),(3,3)的原函数是y=x,即w=1,b=0，刚好对应上。</p>
<p>如果考虑到b，即推广到三维。</p>
<p>我们将原式化简，我们得到：</p>
<script type="math/tex; mode=display">
f(w, b) = \frac{1}{2m} \left( \sum_{i=1}^{m} (w x_i - y_i)^2 + \sum_{i=1}^{m} (b - y_i)^2 \right) + C</script><p>现在，我们分析函数 f(w,b) 的图像。函数 f(w,b) 是两个平方项的和，每个平方项都是关于 w 和 b的二次函数。因此，f(w,b)是一个二次函数，其图像在三维空间中是一个抛物面。</p>
<p>具体来说，由于两个平方项都是非负的，函数 f(w,b)有一个最小值，当且仅当两个平方项都为零时取得。</p>
<script type="math/tex; mode=display">
这些值可以通过代入 ( f(w, b) ) 来计算最小值。最小值是：

[ f\left( \frac{\sum_{i=1}^{m} x_i y_i}{\sum_{i=1}^{m} x_i^2}, \frac{\sum_{i=1}^{m} y_i}{m} \right) ]\\

其中，

[ w = \frac{\sum_{i=1}^{m} x_i y_i}{\sum_{i=1}^{m} x_i^2}, \quad b = \frac{\sum_{i=1}^{m} y_i}{m} ]</script><h2 id="梯度下降"><a href="#梯度下降" class="headerlink" title="梯度下降"></a>梯度下降</h2><h4 id="梯度下降的基本流程"><a href="#梯度下降的基本流程" class="headerlink" title="梯度下降的基本流程"></a>梯度下降的基本流程</h4><p>初始化参数：<br>选择一个初始点 $ \theta<em>0 $ 作为参数向量的起始值。通常可以随机初始化或设置为零向量。<br>选择一个合适的学习率 $ \alpha $，它决定了每次迭代时参数更新的步长。学习率的选择非常重要，过大可能导致算法不收敛，过小则可能导致收敛速度过慢。<br>计算损失函数的梯度：<br>对于给定的参数 $ \theta $，计算损失函数 $ J(\theta) $ 关于每个参数的偏导数，即梯度 $ \nabla</em>\theta J(\theta) $。梯度指出了损失函数在当前参数点处增长最快的方向。<br>更新参数：<br>根据梯度的负方向更新参数，因为梯度指向的是损失函数增加最快的方向，所以我们需要沿相反方向移动以减小损失函数。更新公式为： $ \theta := \theta - \alpha \nabla<em>\theta J(\theta) $<br>这里的 $ \alpha $ 是学习率，控制每次更新的步长；$ \nabla</em>\theta J(\theta) $ 是损失函数关于参数的梯度。<br>重复迭代：<br>重复上述步骤，直到满足某个停止条件。常见的停止条件包括：<br>损失函数的变化非常小，即 $ |J(\theta^{(t+1)}) - J(\theta^{(t)})| &lt; \epsilon $，其中 $ \epsilon $ 是一个小的阈值。<br>参数的变化非常小，即 $ |\theta^{(t+1)} - \theta^{(t)}| &lt; \epsilon $.<br>达到预设的最大迭代次数。<br>输出最优参数：<br>当满足停止条件时，输出最终的参数 $ \theta $，这些参数使得损失函数达到最小值或接近最小值。</p>
<h4 id="梯度下降的不同变体"><a href="#梯度下降的不同变体" class="headerlink" title="梯度下降的不同变体"></a>梯度下降的不同变体</h4><p>根据每次更新时使用的样本数量，梯度下降有以下几种常见变体：</p>
<ol>
<li>批量梯度下降（Batch Gradient Descent, BGD）<br>特点：每次迭代使用所有训练样本计算梯度，并更新参数。<br>优点：每次更新都基于全局信息，理论上可以找到全局最优解（对于凸函数）。<br>缺点：计算复杂度高，尤其是当数据集较大时，每次迭代都需要遍历整个数据集，计算时间较长。</li>
<li>随机梯度下降（Stochastic Gradient Descent, SGD）<br>特点：每次迭代只使用一个随机样本计算梯度，并更新参数。<br>优点：每次迭代的计算量小，适合处理大规模数据集；由于引入了随机性，可以在某些情况下更快地跳出局部极小值。<br>缺点：更新过程较为波动，可能会导致收敛速度较慢，且容易在接近最优解时来回振荡。</li>
<li><p>小批量梯度下降（Mini-batch Gradient Descent, MBGD）<br>特点：每次迭代使用一小批（mini-batch）样本计算梯度，并更新参数。批大小通常介于1和整个数据集之间。<br>优点：结合了批量梯度下降和随机梯度下降的优点，既能减少计算量，又能保持一定的稳定性，适合大多数实际应用。<br>缺点：需要选择合适的批大小，批大小过小可能导致波动，过大则可能增加计算时间。<br>梯度下降的改进方法<br>为了提高梯度下降的性能，研究人员提出了一些改进方法：</p>
</li>
<li><p>动量（Momentum）<br>原理：引入动量项，使得参数更新不仅依赖于当前梯度，还考虑了之前几次迭代的梯度方向。这可以帮助算法更快地穿越平坦区域，并减少振荡。<br>更新公式： $ v := \beta v - \alpha \nabla_\theta J(\theta) $ $ \theta := \theta + v $ 其中，$ v $ 是动量项，$ \beta $ 是动量系数（通常取0.9左右）。</p>
</li>
<li>Nesterov加速梯度（Nesterov Accelerated Gradient, NAG）<br>原理：NAG是对动量方法的改进，它在计算梯度时提前考虑了动量的影响，从而更准确地预测下一步的位置。<br>更新公式： $ v := \beta v - \alpha \nabla_\theta J(\theta + \beta v) $ $ \theta := \theta + v $</li>
<li>自适应学习率方法<br>Adagrad：根据每个参数的历史梯度调整学习率，使得频繁更新的参数具有较小的学习率，而较少更新的参数具有较大的学习率。<br>Adadelta：改进了Adagrad的累积梯度问题，使用滑动窗口来计算历史梯度的平方和。<br>RMSprop：类似于Adadelta，但使用指数加权平均来平滑历史梯度的平方和。<br>Adam（Adaptive Moment Estimation）：结合了动量和RMSprop的优点，使用一阶矩估计（动量）和二阶矩估计（梯度平方的平滑）来动态调整学习率。</li>
</ol>
<h3 id="正规方程"><a href="#正规方程" class="headerlink" title="正规方程"></a>正规方程</h3><p>当参数只有2个时，可以使用数学方法直接计算函数的最小值。但当参数越来越多，函数就会越来越复杂。假设原式是$y=w_1 x_1+w_2 x_2+…+w_n x_n+b$</p>
<p>。那如何求解损失函数的最小值来获得w1到wn呢？</p>
<p>给定的原式是线性回归模型： $ y = w_1 x_1 + w_2 x_2 + \cdots + w_n x_n + b $ </p>
<p>其中，$ y $ 是目标变量，$ x_1, x_2, \ldots, x_n $ 是特征变量，$ w_1, w_2, \ldots, w_n $ 是权重，$ b $ 是偏置项。 </p>
<p>使用的损失函数是平方误差成本函数： $ J(w<em>1, w_2, \ldots, w_n, b) = \frac{1}{2m} \sum</em>{i=1}^{m} (\hat{y}^{(i)} - y^{(i)})^2 $ </p>
<p>其中，$ \hat{y}^{(i)} $ 是模型预测的值，$ y^{(i)} $ 是实际值，$ m $ 是样本数量。 </p>
<p> 关于 $ w_1, w_2, \ldots, w_n $ 的函数 对于每个权重 $ w_j $（其中 $ j = 1, 2, \ldots, n $），损失函数 $ J $ 是关于 $ w_j $ 的二次函数。</p>
<p>具体来说，对于 $ w<em>j $ 的偏导数为： $ \frac{\partial J}{\partial w_j} = \frac{1}{m} \sum</em>{i=1}^{m} (\hat{y}^{(i)} - y^{(i)}) x_j^{(i)} $ </p>
<p>找到最低点 为了找到损失函数 $ J $ 的最低点，我们需要求解所有偏导数并将其设为零，即： $ \frac{\partial J}{\partial w_j} = 0 \quad \text{for all} \quad j = 1, 2, \ldots, n $ $ \frac{\partial J}{\partial b} = 0 $ 这将给出一组线性方程，称为正规方程（Normal Equations）。</p>
<p>求解这组方程可以得到 $ w_1, w_2, \ldots, w_n $ 和 $ b $ 的最优值。 </p>
<p>最小值的存在性 由于损失函数 $ J $ 是关于 $ w_1, w_2, \ldots, w_n $ 和 $ b $ 的二次函数，且二次项系数为正，因此函数是凸的。凸函数的性质之一是它们有且只有一个最小值点。因此，通过求解偏导数并将其设为零，我们可以找到损失函数 $ J $ 的全局最小值点。 </p>
<p>总结 </p>
<p>关于 $ w_1, w_2, \ldots, w_n $ 的函数是二次函数，可以通过求解偏导数并将其设为零来找到最低点。由于损失函数是凸的，所以存在且只有一个最小值点。</p>
<h3 id="梯度下降与解析解"><a href="#梯度下降与解析解" class="headerlink" title="梯度下降与解析解"></a>梯度下降与解析解</h3><p>梯度下降（Gradient Descent）在处理大规模数据集时，通常比解析解（如正规方程）表现更好，主要原因在于计算效率、内存占用和可扩展性等方面的优势。以下是详细的解释：</p>
<h4 id="1-计算复杂度"><a href="#1-计算复杂度" class="headerlink" title="1. 计算复杂度"></a>1. <strong>计算复杂度</strong></h4><ul>
<li><p><strong>正规方程</strong>：正规方程的计算复杂度为 ( O(n^3) )，其中 ( n ) 是特征的数量。这是因为需要计算 ( X^T X ) 的逆矩阵，而求逆矩阵的复杂度是立方级别的。对于高维数据集（即特征数量较多的情况），这个复杂度会变得非常大，导致计算时间过长。</p>
</li>
<li><p><strong>梯度下降</strong>：梯度下降的计算复杂度为 ( O(mn) )，其中 ( m ) 是样本数量，( n ) 是特征数量。每次迭代中，梯度下降只需要计算代价函数的梯度，并更新参数。虽然需要多次迭代才能收敛到最优解，但每次迭代的计算量相对较小，尤其是当使用随机梯度下降（SGD）或小批量梯度下降（Mini-batch Gradient Descent）时，计算量可以进一步减少。</p>
</li>
</ul>
<h4 id="2-内存占用"><a href="#2-内存占用" class="headerlink" title="2. 内存占用"></a>2. <strong>内存占用</strong></h4><ul>
<li><p><strong>正规方程</strong>：正规方程需要存储设计矩阵 ( X ) 和其转置 ( X^T )，并且还需要存储 ( X^T X ) 这个 ( n \times n ) 的方阵。对于大规模数据集，尤其是当特征数量 ( n ) 较大时，这些矩阵的存储需求会非常大，可能超出计算机的内存限制。</p>
</li>
<li><p><strong>梯度下降</strong>：梯度下降只需要存储设计矩阵 ( X ) 和输出向量 ( y )，并且每次迭代只涉及少量的矩阵运算。因此，梯度下降的内存占用相对较小，尤其适用于处理大规模数据集。</p>
</li>
</ul>
<h4 id="3-可扩展性"><a href="#3-可扩展性" class="headerlink" title="3. 可扩展性"></a>3. <strong>可扩展性</strong></h4><ul>
<li><p><strong>正规方程</strong>：由于正规方程的计算复杂度和内存占用都随着特征数量 ( n ) 的增加而急剧增长，它在处理高维数据集时的可扩展性较差。当特征数量达到数千甚至数万时，正规方程的计算几乎不可行。</p>
</li>
<li><p><strong>梯度下降</strong>：梯度下降具有良好的可扩展性，尤其是在使用随机梯度下降（SGD）或小批量梯度下降（Mini-batch Gradient Descent）时。这两种方法每次只使用一个或少量样本进行更新，因此可以有效地处理大规模数据集，甚至是流式数据。此外，梯度下降还可以通过分布式计算框架（如Spark、Hadoop等）进行并行化，进一步提高处理大规模数据的能力。</p>
</li>
</ul>
<h4 id="4-处理多重共线性"><a href="#4-处理多重共线性" class="headerlink" title="4. 处理多重共线性"></a>4. <strong>处理多重共线性</strong></h4><ul>
<li><p><strong>正规方程</strong>：如果特征之间存在高度相关性（即多重共线性），( X^T X ) 可能会变得接近奇异矩阵，导致逆矩阵不稳定或不存在。此时，正规方程可能无法正常工作，或者得到的结果不准确。</p>
</li>
<li><p><strong>梯度下降</strong>：梯度下降对多重共线性的敏感性较低。即使特征之间存在相关性，梯度下降仍然可以通过迭代逐步逼近最优解。此外，梯度下降可以通过引入正则化项（如L2正则化或L1正则化）来缓解多重共线性问题，从而提高模型的稳定性和泛化能力。</p>
</li>
</ul>
<h4 id="5-实时更新与增量学习"><a href="#5-实时更新与增量学习" class="headerlink" title="5. 实时更新与增量学习"></a>5. <strong>实时更新与增量学习</strong></h4><ul>
<li><p><strong>正规方程</strong>：正规方程是一次性求解最优参数的方法，无法方便地进行实时更新。如果数据集发生变化（例如新增了样本或特征），必须重新计算整个模型，这在实际应用中往往是不现实的。</p>
</li>
<li><p><strong>梯度下降</strong>：梯度下降可以轻松实现增量学习，即在新数据到来时，只需基于现有模型进行少量的参数更新即可。这对于在线学习和实时系统非常重要。随机梯度下降（SGD）特别适合处理流式数据，因为它每次只使用一个样本进行更新，能够快速适应新的数据变化。</p>
</li>
</ul>
<h4 id="6-非线性模型的支持"><a href="#6-非线性模型的支持" class="headerlink" title="6. 非线性模型的支持"></a>6. <strong>非线性模型的支持</strong></h4><ul>
<li><p><strong>正规方程</strong>：正规方程主要用于线性回归模型，对于非线性模型（如神经网络、支持向量机等），无法直接应用。虽然可以通过引入多项式特征等方式将非线性问题转化为线性问题，但这会大大增加特征数量，进而增加计算复杂度和内存占用。</p>
</li>
<li><p><strong>梯度下降</strong>：梯度下降不仅可以用于线性模型，还可以广泛应用于各种非线性模型，如神经网络、逻辑回归等。对于这些复杂的模型，梯度下降仍然是最常用的优化算法之一。通过反向传播算法，梯度下降可以有效地训练深度神经网络，处理高维非线性数据。</p>
</li>
</ul>
<h4 id="7-总结"><a href="#7-总结" class="headerlink" title="7. 总结"></a>7. <strong>总结</strong></h4><p>综上所述，梯度下降在处理大规模数据集时表现出色，主要归功于其较低的计算复杂度、较小的内存占用、良好的可扩展性以及对多重共线性和非线性模型的支持。相比之下，正规方程虽然具有理论上的精确性，但在处理大规模数据集时，计算成本过高且内存占用过大，因此在实际应用中往往不如梯度下降实用。</p>
<p>在选择优化算法时，应该根据具体的应用场景和数据规模来决定。对于小规模数据集或低维特征空间，正规方程可能是更好的选择；而对于大规模数据集或高维特征空间，梯度下降及其变体（如SGD、Mini-batch GD）通常是更优的选择。</p>
<h3 id="常见凸与非凸损失函数"><a href="#常见凸与非凸损失函数" class="headerlink" title="常见凸与非凸损失函数"></a>常见凸与非凸损失函数</h3><p>常见的凸损失函数：</p>
<p>平方误差损失（Mean Squared Error, MSE）：<br>$ J(w) = \frac{1}{2m} \sum<em>{i=1}^{m} (\hat{y}^{(i)} - y^{(i)})^2 $<br>这是一个典型的凸函数。它的二阶导数（Hessian矩阵）是正定的，因此它是严格凸的。平方误差损失广泛用于线性回归、最小二乘法等问题中。<br>对数损失（Log Loss / Cross-Entropy Loss）：<br>$ J(w) = -\frac{1}{m} \sum</em>{i=1}^{m} \left[ y^{(i)} \log(\hat{y}^{(i)}) + (1 - y^{(i)}) \log(1 - \hat{y}^{(i)}) \right] $<br>适用于逻辑回归和分类问题。对数损失也是凸函数，确保了优化过程中可以找到全局最优解。<br>Huber损失：<br>Huber损失结合了平方误差损失和绝对误差损失的优点，既保持了平方误差损失在小误差时的平滑性，又避免了大误差时的敏感性。它在一定范围内是二次的，超出该范围后变为线性，因此也是凸函数。<br>L2正则化项：<br>$ R(w) = \frac{\lambda}{2} | w |^2 $<br>L2正则化项是凸的，因为它是一个二次函数。它可以与上述损失函数结合使用，形成带正则化的凸损失函数。<br>非凸损失函数的例子：</p>
<p>非线性激活函数的组合：<br>在神经网络中，如果使用非线性激活函数（如ReLU、Sigmoid等），并且网络结构较为复杂（例如深度较深），那么整体的损失函数可能是非凸的。这种情况下，损失函数可能有多个局部极小值，优化过程可能会陷入局部最优解。<br>高阶多项式损失：<br>如果损失函数包含高阶多项式项（如四次或更高次项），那么它可能是非凸的。高阶多项式可能会导致函数图像出现多个波峰和波谷，从而使得优化过程难以找到全局最优解。<br>交叉熵损失与非线性模型结合：<br>虽然交叉熵损失本身是凸的，但如果与复杂的非线性模型（如深度神经网络）结合，整体的损失函数可能会变得非凸</p>
<h3 id="批量梯度下降实现"><a href="#批量梯度下降实现" class="headerlink" title="批量梯度下降实现"></a>批量梯度下降实现</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xjcares.extensionservice.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BatchGradientDescent</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">double</span> learningRate;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> epochs;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">BatchGradientDescent</span><span class="params">(<span class="type">double</span> learningRate, <span class="type">int</span> epochs)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.learningRate = learningRate;</span><br><span class="line">        <span class="built_in">this</span>.epochs = epochs;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">double</span>[] train(<span class="type">double</span>[] X, <span class="type">double</span>[] y) &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> X.length;</span><br><span class="line">        <span class="type">double</span> <span class="variable">w</span> <span class="operator">=</span> <span class="number">0.0</span>;</span><br><span class="line">        <span class="type">double</span> <span class="variable">b</span> <span class="operator">=</span> <span class="number">0.0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">epoch</span> <span class="operator">=</span> <span class="number">0</span>; epoch &lt; epochs; epoch++) &#123;</span><br><span class="line">            <span class="type">double</span> <span class="variable">dw</span> <span class="operator">=</span> <span class="number">0.0</span>;</span><br><span class="line">            <span class="type">double</span> <span class="variable">db</span> <span class="operator">=</span> <span class="number">0.0</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">                <span class="type">double</span> <span class="variable">prediction</span> <span class="operator">=</span> w * X[i] + b;</span><br><span class="line">                <span class="type">double</span> <span class="variable">error</span> <span class="operator">=</span> prediction - y[i];</span><br><span class="line">                dw += error * X[i];</span><br><span class="line">                db += error;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            w -= learningRate * (dw / n);</span><br><span class="line">            b -= learningRate * (db / n);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Optional: Print the loss for every 100 epochs</span></span><br><span class="line">            <span class="keyword">if</span> (epoch % <span class="number">100</span> == <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="type">double</span> <span class="variable">loss</span> <span class="operator">=</span> calculateLoss(X, y, w, b);</span><br><span class="line">                System.out.println(<span class="string">&quot;Epoch &quot;</span> + epoch + <span class="string">&quot;: Loss = &quot;</span> + loss);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">double</span>[]&#123;w, b&#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">double</span> <span class="title function_">calculateLoss</span><span class="params">(<span class="type">double</span>[] X, <span class="type">double</span>[] y, <span class="type">double</span> w, <span class="type">double</span> b)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> X.length;</span><br><span class="line">        <span class="type">double</span> <span class="variable">loss</span> <span class="operator">=</span> <span class="number">0.0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">            <span class="type">double</span> <span class="variable">prediction</span> <span class="operator">=</span> w * X[i] + b;</span><br><span class="line">            <span class="type">double</span> <span class="variable">error</span> <span class="operator">=</span> prediction - y[i];</span><br><span class="line">            loss += error * error;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> loss / (<span class="number">2</span> * n);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">double</span>[] X = &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>&#125;;</span><br><span class="line">        <span class="type">double</span>[] y = &#123;<span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">8</span>, <span class="number">10</span>&#125;;</span><br><span class="line"></span><br><span class="line">        <span class="type">BatchGradientDescent</span> <span class="variable">bgd</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BatchGradientDescent</span>(<span class="number">0.00001</span>, <span class="number">1000000000</span>);</span><br><span class="line">        <span class="type">double</span>[] parameters = bgd.train(X, y);</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;Optimal weight (w): &quot;</span> + parameters[<span class="number">0</span>]);</span><br><span class="line">        System.out.println(<span class="string">&quot;Optimal bias (b): &quot;</span> + parameters[<span class="number">1</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>计算机</category>
      </categories>
  </entry>
  <entry>
    <title>二把手人格</title>
    <url>/2025/08/29/%E5%88%9B%E4%B8%9A/%E4%BA%8C%E6%8A%8A%E6%89%8B%E4%BA%BA%E6%A0%BC/</url>
    <content><![CDATA[<p>你是完美二把手人格么？</p>
<p>读到这个标题你想到了谁？</p>
<p> 一 </p>
<p>推动事物发展的两股重要力量分别是拉升力(动力）以及摩擦力（阻力），拉升力对企业来说是使命愿景价值观，对个人是向上昂扬的生命能量，磅礴汹涌，势不可挡。摩擦力是现实世界，是既定的利益格局，人性的趋利避害。带着理想出发的创始人往往都看到了第一种力的价值，并且也大多擅长于拉升力的运用和激发，这也正是他们吸引众人魅力所在。</p>
<p>拉升力是平地起高楼的显而易见，但是摩擦力却能见度低，不怎么显。但光看到拉升力看不到摩擦力，结局就是不接地气，落不了地，最后理想主义在现实中被撞的鼻青脸肿。</p>
<p> 二 </p>
<p>长征前的毛泽东就处在这个阶段，1929年6月，红四军第七次代表大会前，毛泽东、朱德、陈毅等商量军队领导办法，毛泽东提出党对军队有绝对领导权，同时军队要负责根据地建设，朱德等军人不同意，军队职责是打仗，搞根据地建设是什么鬼？党对军队也不合适管太多。</p>
<p>毛泽东脾气倔口气硬，说话不留情面，杠不过军人团体，直接辞掉前委职务。新当选的前委陈毅上来后好意协调两边，被倔脾气的毛泽东扣上“陈毅主义”的帽子。那年毛泽东已经三十六岁，但仍旧跟愣头青一样只论对错，事后看他那些年的异见是如此的正确和前瞻，但瑞金时期的毛泽东四处碰壁，反复上演硬刚-请辞-做冷板凳三部曲。</p>
<p> 三 </p>
<p>低摩擦性人格具备三大特征，分别是系统观，低风险偏好，把握现实能力强。</p>
<p>低摩擦性人格第一大特征首先是完整的系统观，他们没有视角盲区，能同时把握拉升力和摩擦力两者的存在，如果一个决定同时高拉升低摩擦，毫无疑问是他们的首选。但是拉升和摩擦很多时候在空间上会冲突，时间上有先后。</p>
<p>这个时候低摩擦性人格的第二大特征-低风险偏好开始发挥作用，如果拉升和摩擦皆有，此时他们的取舍是先追求低摩擦选项。他们的思考是动力可能衰竭，阻力必然存在。低摩擦选项高确定性，高拉升选项可能赔率大但是风险也大。低风险偏好意味着求稳，求稳的解法就是不得贪胜。</p>
<p>低摩擦性人格同时是把握现实能力很强的高手，理想主义者从未来倒回到现在，现实主义者从现在通向未来。梦想破产往往不是死在缺乏宏大架构上，而是没做到精巧得排掉现实的暗礁。低摩擦性人格对摩擦力洞若观火明察秋毫，他们最擅长的就是设计出低摩擦路径。</p>
<p>完整系统观，低风险偏好，把握现实能力强，这三者加起来不就是完美的二把手人格么？</p>
<p> 四 </p>
<p>周恩来在南开是张伯苓的学生，1921年旅法期间创建党支部，1927年八一南昌起义他是现场最高指挥。瑞金期间，前三次反围剿的总指挥是毛泽东，留苏派让李德指挥的第五次反围剿失败，中央红军才不得不开启两万五千里的长征。很多人不知道，第四次反围剿的总指挥是周恩来，前四次都赢了。</p>
<p>第五次反围剿李德主张“正规军”打“阵地战”，用红军的“多路分兵”对付敌人的“多路进击”，周恩来主张集中兵力。据伍修权回忆，周恩来跟李德有多次争论，“有时候周恩来直接用英语对李德讲”。李德拒不接受周的正确建议，周不得不服从并组织实施。</p>
<p>周恩来具备完整系统观，当时共产国际对国内发展有决定性影响，党内指挥权被留苏派把持，力排众议是改变不了局面的，反映意见不成后遵守组织纪律，保持指挥系统顺畅是大局。</p>
<p>另一边，周恩来一直在观察毛泽东，这个没留过洋的师范生频出惊人之论，“农村包围城市”，”游击战”等等，原则性强，见解独特，性格执拗。中央红军离开江西起一路败退，周恩来越加感受到毛泽东磅礴旺盛的拉升力对中国革命不可或缺的价值。</p>
<p>行军至贵州，遵义会议上，周恩来做报告，指出第五次反围剿失利主要原因是军事领导的战略战术错误，并主动承担责任，做了自我批评，并且全力推举由毛泽东来领导红军的今后行动。1935年遵义会议起，毛泽东正式确立军事指挥权，而后开启了两人接下来41年的合伙生涯。</p>
<p>从瑞金到长征期间的五年，尤其在做冷板凳的后几年，毛泽东补上了摩擦力的维度，他知道了有时候正确抵不过共识，开发了“团队大多数”的工作方法，如果去看遵义会议上毛泽东的发言，你会发现完全已经变了一个人，毛不再不留情面的怼人，反而替大家解围：留苏同志和国内同志都是好的，以前的革命方法也没错，我们的重大失败只是军事指挥造成的，有问题改一下就好了。</p>
<p> 五 </p>
<p>低摩擦性无疑在“组织”这件事情上是天赋，这类人格在个人发展的每个阶段往往都是令人感受到如沐春风，人缘极佳。如果背后没有理念的支撑，低摩擦性人格极容易被理解成犬儒主义，世故以及无所作为。</p>
<p>十年浩劫，周恩来保护了大量的干部，维持着国内基本的经济秩序，虽然都是以被砸烂后修修补补的方式，但是为何他没有更早的去发起结束这个错误呢？虽然历史不容假设，但以他在党政军的元老地位和威望，以这场浩劫普天上下的不得人心，他做发起，可能历史会是另一种走向。</p>
<p>多年来我困惑于此，周无子嗣，少年立志，明哲保身爱惜羽毛说不通。直到我这两年，我生成了新的一种猜测：周是典型低摩擦性人格，他不是没想过发起结束，但发起结束必然引起核心集体撕裂，全国局面甚至有进一步崩坏的极大风险，他的低风险偏好让他一定要避掉崩掉的可能，并且，发起结束还可能未成，这片土地上的百姓经不起二次伤害的折腾。于是，选择自不意外。</p>
<p> 六 </p>
<p>谁是你心目中完美的二把手？</p>
<p>在我心目中只想到一人，中国几千年历史上唯二能担得起“鞠躬尽瘁死而后已”八字的周恩来。</p>
]]></content>
      <categories>
        <category>随记</category>
      </categories>
  </entry>
  <entry>
    <title>如何获得加速回报</title>
    <url>/2025/09/08/%E5%88%9B%E4%B8%9A/%E5%A6%82%E4%BD%95%E8%8E%B7%E5%BE%97%E5%8A%A0%E9%80%9F%E5%9B%9E%E6%8A%A5/</url>
    <content><![CDATA[<p>一般来说，我们都会特别关注投入和回报的关系。<br>同样是工作一天，为什么我领的薪水没有别人高？<br>开通了一个公众号，写了几篇文章，为什么只有这么几个人关注我？<br>花了一周的时间读一本书，为什么感觉没有什么用处？<br>我们生活在一个“稀缺”的社会里。我们每天根据投入和回报的关系，分配着我们稀缺的时间、金钱和注意力。投入和回报成为了我们生活中大部分决策的评判标准。<br>然而，值得注意的是，我们很多人对于投入和回报的理解可能是单一的，或片面的。今天想介绍的思维模型，就是关于一种经常被我们忽视的投入回报关系。<br>为了理解这个思维模型，让我们先来看一个简单的化学问题：冰是如何变成水的。<br>请看一下下面这张图，并且聚焦在A到B，和B到C这两段。</p>
<p>在A这个点上，温度是-25摄氏度，冰是固态的。<br>我们慢慢的把温度从-25度升高到-1度，在这个过程中，没有什么事情发生。冰仍然是固态的。<br>那么从-25度到-1度过程中，加热的能量去了哪里呢？<br>分子间力（Intermolecular forces）是存在于分子间的一种弱的吸引力。分子间力决定了一个物质的形态：固态、液态还是气态。<br>在从A到B的过程，我们加热的能量用来改变冰的温度，从-25度到0度。虽然表面上冰的形态没有任何变化。<br>而从B到C的过程中，我们加热的能量用来克服分子间力，固态的冰开始出现形态的变化，慢慢转变为液态。<br>如果我们把加热的能量看成是“投入”的话，那么从-25度的A，到B点，如此大的投入，我们其实是看不到任何回报的。而只有在我们到达B这个点时，一点的能量投入，产生了原来想像不到的回报：冰的形态开始变化，开始融化水。<br>这其实是一种反直觉的投入回报关系。<br>一般来说，我们都会很在乎即时的、短期的回报，但很难看到投入的长期价值。当冰从-25度加热到-20度时，很多人看到冰没有什么变化，就已经放弃了。<br>这种对于即时回报的追求，很多时候已经内化在我们的潜意识里，导致我们很难和时间做朋友，取得远超出投入的回报。就像是下图中的曲线A和曲线B。</p>
<p>我叫像曲线B这类的投入回报关系为加速回报模型。这不是一个很新的概念，但当我们真正学会利用这个思维模型，就会发现它可以给我们很多有益的启发。<br>回报是投入的结果，而不是目的<br>第一个问题是，如何才能够摆脱对短期利益的追逐，获得曲线B呢？要知道，在取得指数式的收益之前，是漫长的等待。<br>答案很简单，不要关注回报，而是关注投入本身。在曲线B中，回报不再是目的，而是专注投入的结果。<br>举个例子，一个作家，可以投入时间提高自己作品的质量，也可以关注如何提高自己的稿酬。但后者只会让他越来越失败，而只有专注前者，他才有可能成为伟大的作家。<br>同样的，一个公司，如果只是关注利润，很可能会偷工减料生产劣质产品。而如果这个公司不断思考怎样的投入才能为用户提供更大的价值，这家公司就更有可能成功。<br>百姓网的CEO王建硕曾经在2009年，写过一篇让人很受启迪的文章：<br>如果一件事情是为了回报，这件事情很难持久。这和一个人的毅力无关。<br>当一个人还没有真正意识到自己做这件事情的意义的时候，常常会为了显而易见的回报来坚持做一些事情。但很少有事情可以让你立刻看到回报，于是会选择放弃。放弃，多半不是因为无法坚持而放弃，而是因为感觉到自己做这件事失去了意义，所以放弃。<br>写blog就是这样。如果只是很希望别人来看，来评论，就会一天访问十次自己的blog，看一看有没有人回复。不久就会精疲力尽，而且会发现，自己的努力并不会直接换来多少人回复（像我每天一篇写了第四个年头了，也不会有多少回复的）。这时，就会怀疑自己做这件事情的意义，于是就不写了。不用埋怨自己的毅力，这件事本来和毅力毫无关系。<br>而凡是能坚持的blogger，要么是把blog写给自己的，意识到每天的记录是帮助自己来整理思路，为了自己生活得更好，要么是为了兴趣，写BLOG仅仅是为了帮助别人，只关心分享，而不关心评论或者浏览量的。无论什么样的动机，只要能看到自己的努力是为了贡献，而不是回报，就会坚持。<br>只有对贡献有激情，不在乎回报的时候，你才能坚持做一件事情，就像伟大的公司因为有一个贡献的理念，才可以持久的保持激情，在取得巨大的成功以后，接着日复一日的寻找更大的贡献。<br>很多时候，只有我们坚持的投入，不计较回报，而专注于贡献，才能享受到加速的回报。<br>正如王建硕老师所说：<br>回报是我们所贡献价值的影子。当一个人奔向太阳的时候，影子会跟着你。<br>当他追随影子的时候，他将远离太阳，远离光明，最终失去影子。<br>长期思考（Think Long Term）<br>加速回报模型给我们的第二个启示，是要学会长期思考。<br>亚马逊创始人和CEO杰夫·贝佐斯(Jeff Bezos)一直是长期思考的倡导者。他甚至和一个非营利组织一起，在德克萨斯州西部一块土地上建造了一台可以工作一万年的大钟，以提醒人们要更长远地思考。</p>
<p>他在一次访谈里，曾经提到：<br>如果我们可以思考的更长远，我们能够完成很多我们认为无法完成的事情。<br>比如，今天我和你说：我想让你3年内解决世界的饥饿问题。你会很自然的拒绝这件事，因为你不认为自己可以做到。<br>但是，如果我和你说：我想让你在30年内解决世界的饥饿问题。这就会完全不一样了，你会开始考虑在什么情况下，这种改变可以发生。<br>所以，你看我们没有改变任何事，只是改变了时间长度，你会产生完全不一样的反应。<br>很少人在考虑问题时，会意识到背后的时间长度假设。但事实上，时间长度这个维度非常重要。<br>比如前一段时间，我换工作时，找一位很厉害的前辈咨询职业规划上的问题。他听完我自己的想法后，给我的第一个建议：“我建议你在考虑自己的职业生涯时，要放在10年的维度来思考，而不是两三年。在这样的时间维度上，再考虑你想要成为什么样的人，现在还需要什么样的经历。”<br>比尔·盖茨曾经说过一句话，深有共鸣：<br>Most people overestimate what they can do in one year and underestimate what they can do in ten years.<br>大部分人都高估了自己在一年里可以做到的事情，同时又低估了自己可以在10年里完成的事情。<br>我们生活最大的杠杆是形成有益的习惯<br>几月前，我读到一篇Coursera董事长Andrew Ng教授的访谈。这个访谈里，有一段话很好的诠释了加速回报思维模型给我们的启示。<br>我们生活中最大的杠杆就是我们形成有益习惯的能力。<br>当我和研究人员交流，和想创业的人交流时，我会告诉他们如果你能够不断的阅读研究论文，一周很认真的读6篇，并且连续读两年。在两年后，你会发现自己受益匪浅。<br>这是对自己长期发展的一项非常棒的投资。<br>但是这种类型的投入，如果你花费整个周六学习而不是看电视，没有人会拍拍你的肩膀，赞赏你做得好。<br>很可能，你花费整个周六学到的东西都不会对下周一工作有什么明显的帮助。这种类型的事情，有非常少，甚至没有短期的回报。但它是一项非常棒的长期投资。<br>这就是你想变成伟大的研究人员的必经之路。你必须大量的阅读。<br>人们总是依赖“意志力”来做这种类型的事情，但这几乎不可能成功，因为意志力会很快消退。<br>但是，我认为那些形成了这种习惯的人。那些习惯每周学习，勤奋钻研的人。他们更有可能会有所成就。<br>加速回报模型是我在过去几年里看到的最有普适性的模型之一。把这个模型装入工具箱，我们对于投入与回报的理解也会变得更加全面，从而最大程度上避开短视的陷阱，做更好的决策。<br>最后，我想以巴菲特的一句话结束这篇文章：<br>Games are won by players who focus on the field, not the ones looking at the scoreboard.<br>要想取得比赛的胜利，就应该关注赛场，而不是时刻盯着记分牌。</p>
]]></content>
      <categories>
        <category>随记</category>
      </categories>
  </entry>
  <entry>
    <title>基于长板做业务，基于短板做组织</title>
    <url>/2025/08/28/%E5%88%9B%E4%B8%9A/%E5%9F%BA%E4%BA%8E%E9%95%BF%E6%9D%BF%E5%81%9A%E4%B8%9A%E5%8A%A1%EF%BC%8C%E5%9F%BA%E4%BA%8E%E7%9F%AD%E6%9D%BF%E5%81%9A%E7%BB%84%E7%BB%87/</url>
    <content><![CDATA[<p>1</p>
<p>上学那会看各种商业杂志，提到“中国创始人强于经营，弱于管理”，觉得非常不解甚至不屑：管理多容易，都是技术化的东西，经营都会了，为什么中国创始人就偏偏弱于管理呢？</p>
<p>等自己进入商业世界，尤其经历创业后发现，强于经营短于管理，几乎是必然。我自己总结了三个原因：</p>
<p>1）杠杆大小。经营是发现机会，捕捉机会，做大增量，杠杆大。管理是什么？精耕细作，降本提效，杠杆低，能有大杠杆的时候肯定不碰低杠杆的事情啊；</p>
<p>2）见效快慢。经营见效快，管理见效慢。经营是一日千里，摸到矿脉了就有势头把你托着往上走，想下来都不容易，管理是日拱一卒，一个团队一个组织的面貌是要在每次的one on one，绩效辅导，周例会，团建，述职中去磨出来的，一点力气都不能省，搭建起来不容易但破功可在一瞬间；</p>
<p>3）自我需要。创始人都是有英雄主义情结的人，经营是创始人英雄之旅的故事背景，而管理更多是留给职业经理人的，相比较经营的点石成金，创始人多厌弃管理的枯燥沉闷。</p>
<p>理性层面经营杠杆大，见效快，感性层面有自我叙事的精神需求，中国创始人投主要精力在经营显然没毛病。</p>
<p>2</p>
<p>经营管理这4个字一般连着说，但管理的概念太小，如果说经营更多是偏战略/方向层面，其实跟经营并列的应该是“组织”，组织对应人才/流程/文化。这两年风向变了，创业者提战略已经不高级了，时髦是“创始人都是首席组织官”。</p>
<p>那么：组织的价值到底是什么？如果组织只有创始人个人审美上的人文价值；固然这种个人审美趣味也值得尊重，但显然不值当大而广之的被作为大事要事去推。</p>
<p>我的理解是，经营是生产力，组织是生产关系，生产关系匹配生产力，这种强一致性就会让企业发展如臂使指不可阻挡，生产关系落后于生产力，那经营被组织拖累，杠杆的价值就会收窄，生产关系一旦超前于生产力，生产力甚至可能发生倒退。</p>
<p>生产关系落后于生产力，典型就是创业公司过了探索期到成长期或成熟期后，还是机会导向运作灵活性为主，规范化流程/管理/人才跟不上；生产关系超前于生产力，容易发生的是探索期阶段的创业公司名门正派正规打法，看似完备架构实则是成本高低效耽误事。</p>
<p>生产力决定生产关系，经营决定组织，生产关系服务于生产力，组织服务于经营。生产关系有先进性和落后性，生产关系落后于生产力就是落后性，但绝不存在真空意义上的先进生产关系，先进性体现在匹配生产力阶段，匹配等于先进，不存在不匹配经营阶段的“最佳组织”。</p>
<p>3</p>
<p>继而下一个问题：决定一个组织的天花板是什么？</p>
<p>去年我的答案是：一个组织的天花板是由创始人的性格缺陷和局限性决定的。起因是我观察到太多企业的组织问题根儿就在创始人身上，比如高管跟公司同床异梦，原因是创始人不通人性分钱不到位，比如公司危机重重却显现“太平盛世”，原因是创始人皇帝新衣，只想听到他想听的，或者是团队静若寒蝉不敢创新，原因是创始人太过强势刚愎自用。</p>
<p>这个基于经验的观察几乎解释了我能看到的所有实际案例，但我总感觉不对劲，却又说不上来。第一反应是这个结论因为显得太过“宿命论”因此很不“实用”，跟我个人的人生观也极不符合，每个人都有性格缺陷和短板，如果组织天花板由这些决定，难道就只能束手无措举手投降了？</p>
<p>直到我发现这个结论产生于归纳法，从逻辑上来讲，归纳法产生的结论再用演绎法正推如果不能推而广之，或者列举只是一个反例，两者有一这一结论即可推翻。意识到这层后，反例一个个冒出来，比如任正非的暴躁没同理心强势出了名，但是华为的组织能力却公认的强，该做如何解释？</p>
<p>业内研究华为的专家田涛给出的看法是：任正非的同理心很强，原因是华为慷慨的股权机制，权力机制，任正非把99%的股权稀释给9万多员工，大量20多岁、30多岁人掌握着很大权力。华为的独特机制设计是华为组织能力强的核心原因，但不能因此不承认任正非的性格局限性，田老师此处偷换了概念。通人性和没同理心可以在一个人身上同时存在。</p>
<p>华为的例子该做如何解释？我的看法是任正非想做超级大事并且也是人性大师，因此用机制设计分权分钱激发了团队的战斗力，这个机制包含的内容同时对冲掉了创始人个体的性格缺陷产生的组织负向性。</p>
<p>4</p>
<p>“扬长避短”，简简单单4个字，应用在企业运营上却是一个庞杂的体系。你会发现长板有极大的杠杆效应，短板有极大的黑洞效应。但在哪个领域是长板爆炸的杠杆，哪个领域是短板吞噬的黑洞。直到今年，我才明白。</p>
<p>再有人问我：决定一个组织的天花板是什么？</p>
<p>我的答案是：组织的下限由创始人的短板（性格缺陷和局限性）决定，组织的上限由创始人认识到短板后，基于自身局限性如何做组织设计决定。</p>
<p>对创始人们来说，“能不能”是一个技术问题，如何基于自身局限性做组织设计这个题目已然很有挑战，大量人甚至没意识到会是这个切入点。</p>
<p>但另一个更加究竟也根本的问题是“愿不愿”，很多创始人创立企业，说穿了组织生涯设计是服务于他的个人生涯设计的大玩具，于是强大的ego就变成了创始人没有动机去解决技术问题的根本障碍。从小缺乏肯定的创始人没跟自己和解前，组织里弥漫的浓厚揣摩上意报喜不报忧的氛围，可能正是创始人需要的心理自我慰藉。把组织氛围正本清源了，那他自身的安全感如何着落？</p>
<p>所以再往下拆，最后真正限制企业组织天花板的是创始人的远大梦想是否坚若磐石经得起考验。技术性的问题可克服，但对抗人性的还得是创始人身上那点最特别的远大梦想，没这个东西，就极容易滑下follow my heart的组织下限了。</p>
]]></content>
      <categories>
        <category>随记</category>
      </categories>
  </entry>
  <entry>
    <title>最优投资策略与年龄的关系</title>
    <url>/2025/09/08/%E5%88%9B%E4%B8%9A/%E6%9C%80%E4%BC%98%E6%8A%95%E8%B5%84%E7%AD%96%E7%95%A5%E4%B8%8E%E5%B9%B4%E9%BE%84%E7%9A%84%E5%85%B3%E7%B3%BB/</url>
    <content><![CDATA[<p>马尔基尔在《漫步华尔街》中提出的“最优投资策略与年龄有关”，其核心思想是：一个人的投资组合（即持有的股票、债券、现金等资产的比例）应根据其生命周期的不同阶段进行动态调整，以匹配其随时间变化的“风险承受能力”和“财务目标”。</p>
<p>这绝不是一句空话，而是基于两个至关重要的基本原理：</p>
<p>风险承受能力与投资期限（Time Horizon）密切相关：年轻人拥有更长的投资期限（距离退休还有几十年），这意味着他们有足够的时间来从市场的短期波动和暴跌中恢复过来。因此，他们可以承受更高的风险（即投资组合中股票占比更高），以追求更高的长期回报。而年长者投资期限短，无法承受巨大的短期损失，因为可能没有足够的时间在本金大幅缩水后恢复过来。</p>
<p>人力资本（Human Capital）的转化：年轻时，你的主要资产是你未来工作收入的现值，即“人力资本”。这份收入相对稳定（像债券一样提供持续现金流）。因此，你可以将你的金融资本（即你的储蓄和投资）更多地配置于高风险高回报的资产（如股票）来平衡。随着年龄增长，你的人力资本逐渐被“消耗”并转化为金融资本。当你退休时，人力资本降为零，你的生活完全依赖于金融资本。此时，金融资本本身必须变得像你年轻时的工资一样可靠，因此需要降低其风险。</p>
<p>下面，我们分阶段详细说明这个策略是如何与年龄挂钩的：</p>
<p>不同年龄阶段的最优投资策略<br>马尔基尔在书中给出了一个经典的、简单易行的资产配置指南，即 “100/120减去你的年龄”法则。</p>
<p>公式：投资于股票的比例 = (100或120) - 你的年龄</p>
<p>剩余部分：投资于债券和现金等更安全的资产。</p>
<p>这个公式有两个版本，反映了个人风险偏好的细微差别（你是“激进”还是“保守”）：</p>
<p>激进版（120法则）：股票占比 = 120 - 年龄</p>
<p>保守版（100法则）：股票占比 = 100 - 年龄</p>
<p>我们以“100法则”为例，来看一个具体的生命周期规划：</p>
<ol>
<li>积累阶段（20-30多岁：青年期）<br>年龄：25岁</li>
</ol>
<p>股票配置建议 (100-25=75%)：70% - 85%</p>
<p>债券/现金配置：15% - 30%</p>
<p>解读：</p>
<p>目标：资本快速增值（成长性）。核心目标是利用复利的魔力，为未来的重大支出（买房、子女教育、退休）积累财富。</p>
<p>风险承受能力：极高。距离退休还有40年左右，可以完全无视市场的周期性下跌。市场下跌时，反而可以用更低的成本买入更多资产。</p>
<p>策略：应广泛投资于国内外股票指数基金（如美国标普500指数基金、全球股票指数基金），少量配置债券基金以保持平衡并在市场大跌时提供买入机会。</p>
<ol>
<li>巩固阶段（40-50多岁：中年期）<br>年龄：50岁</li>
</ol>
<p>股票配置建议 (100-50=50%)：45% - 60%</p>
<p>债券/现金配置：40% - 55%</p>
<p>解读：</p>
<p>目标：从资本增值向资本保值过渡。你已经积累了大量资产，现在需要保护它们，防止在临近退休时遭遇重大亏损。</p>
<p>风险承受能力：中等。距离退休可能还有10-15年，虽然仍有时间恢复，但一次像2008年那样的大熊市可能会严重破坏你的退休计划。</p>
<p>策略：开始系统地降低股票仓位，增加债券和高股息股票的配置。这个阶段是“锁定收益”和“风险管理”的关键期。</p>
<ol>
<li>支出阶段（60岁及以上：退休期）<br>年龄：70岁</li>
</ol>
<p>股票配置建议 (100-70=30%)：20% - 40%</p>
<p>债券/现金配置：60% - 80%</p>
<p>解读：</p>
<p>目标：资本保值和产生稳定收入。投资组合产生的利息和股息将成为退休生活的重要收入来源。</p>
<p>风险承受能力：极低。你已经没有工资收入，且投资期限很短。一次50%的市场下跌意味着你的退休生活质量将直接下降50%，而且你可能没有时间等待市场回升。</p>
<p>策略：投资组合应以高质量的债券、大额存单、货币市场基金和高股息蓝筹股为主。保留一部分股票（如20-30%）是为了对抗通货膨胀，确保你的购买力在未来20-30年的退休生活中不会萎缩。</p>
<p>总结与关键要点<br>动态调整（Rebalancing）：这不是一个“设定后就忘记”的策略。你需要每年或每几年检查一次你的资产配置比例。如果因为股市大涨导致股票占比远超目标，就卖出部分股票买入债券，使比例重回目标值。这本质上是“高卖低买”的纪律性操作。</p>
<p>个人化：这只是一个通用指南。具体的比例还需根据你的个人风险偏好、健康状况、家庭负担、具体财务目标等因素进行微调。一个极其厌恶风险的25岁年轻人，可能也会选择更保守的配置。</p>
<p>核心工具是指数基金：马尔基尔是有效市场假说的支持者，他坚信大多数投资者无法持续战胜市场。因此，他强烈推荐使用低成本的宽基市场指数基金作为执行这一策略的工具，这样可以最大限度地分散风险并节省费用。</p>
<p>总而言之，“最优投资策略与投资者的年龄有关”这句话的精髓在于： 它为你提供了一个清晰、纪律化的框架，让你在漫长的人生中，既能利用年轻时的高风险承受能力去博取高回报，又能在年老时保护好来之不易的财富，平滑地完成从“进攻”到“防守”的战略转变，最终实现一生的财务目标。这是一种兼顾了智慧与理性的生命周期投资法。</p>
]]></content>
      <categories>
        <category>随记</category>
      </categories>
  </entry>
  <entry>
    <title>经营与管理</title>
    <url>/2025/08/28/%E5%88%9B%E4%B8%9A/%E7%BB%8F%E8%90%A5%E4%B8%8E%E7%AE%A1%E7%90%86/</url>
    <content><![CDATA[<p>1</p>
<p>上学那会看各种商业杂志，提到“中国创始人强于经营，弱于管理”，觉得非常不解甚至不屑：管理多容易，都是技术化的东西，经营都会了，为什么中国创始人就偏偏弱于管理呢？</p>
<p>等自己进入商业世界，尤其经历创业后发现，强于经营短于管理，几乎是必然。我自己总结了三个原因：</p>
<p>1）杠杆大小。经营是发现机会，捕捉机会，做大增量，杠杆大。管理是什么？精耕细作，降本提效，杠杆低，能有大杠杆的时候肯定不碰低杠杆的事情啊；</p>
<p>2）见效快慢。经营见效快，管理见效慢。经营是一日千里，摸到矿脉了就有势头把你托着往上走，想下来都不容易，管理是日拱一卒，一个团队一个组织的面貌是要在每次的one on one，绩效辅导，周例会，团建，述职中去磨出来的，一点力气都不能省，搭建起来不容易但破功可在一瞬间；</p>
<p>3）自我需要。创始人都是有英雄主义情结的人，经营是创始人英雄之旅的故事背景，而管理更多是留给职业经理人的，相比较经营的点石成金，创始人多厌弃管理的枯燥沉闷。</p>
<p>理性层面经营杠杆大，见效快，感性层面有自我叙事的精神需求，中国创始人投主要精力在经营显然没毛病。</p>
<p>2</p>
<p>经营管理这4个字一般连着说，但管理的概念太小，如果说经营更多是偏战略/方向层面，其实跟经营并列的应该是“组织”，组织对应人才/流程/文化。这两年风向变了，创业者提战略已经不高级了，时髦是“创始人都是首席组织官”。</p>
<p>那么：组织的价值到底是什么？如果组织只有创始人个人审美上的人文价值；固然这种个人审美趣味也值得尊重，但显然不值当大而广之的被作为大事要事去推。</p>
<p>我的理解是，经营是生产力，组织是生产关系，生产关系匹配生产力，这种强一致性就会让企业发展如臂使指不可阻挡，生产关系落后于生产力，那经营被组织拖累，杠杆的价值就会收窄，生产关系一旦超前于生产力，生产力甚至可能发生倒退。</p>
<p>生产关系落后于生产力，典型就是创业公司过了探索期到成长期或成熟期后，还是机会导向运作灵活性为主，规范化流程/管理/人才跟不上；生产关系超前于生产力，容易发生的是探索期阶段的创业公司名门正派正规打法，看似完备架构实则是成本高低效耽误事。</p>
<p>生产力决定生产关系，经营决定组织，生产关系服务于生产力，组织服务于经营。生产关系有先进性和落后性，生产关系落后于生产力就是落后性，但绝不存在真空意义上的先进生产关系，先进性体现在匹配生产力阶段，匹配等于先进，不存在不匹配经营阶段的“最佳组织”。</p>
<p>3</p>
<p>继而下一个问题：决定一个组织的天花板是什么？</p>
<p>去年我的答案是：一个组织的天花板是由创始人的性格缺陷和局限性决定的。起因是我观察到太多企业的组织问题根儿就在创始人身上，比如高管跟公司同床异梦，原因是创始人不通人性分钱不到位，比如公司危机重重却显现“太平盛世”，原因是创始人皇帝新衣，只想听到他想听的，或者是团队静若寒蝉不敢创新，原因是创始人太过强势刚愎自用。</p>
<p>这个基于经验的观察几乎解释了我能看到的所有实际案例，但我总感觉不对劲，却又说不上来。第一反应是这个结论因为显得太过“宿命论”因此很不“实用”，跟我个人的人生观也极不符合，每个人都有性格缺陷和短板，如果组织天花板由这些决定，难道就只能束手无措举手投降了？</p>
<p>直到我发现这个结论产生于归纳法，从逻辑上来讲，归纳法产生的结论再用演绎法正推如果不能推而广之，或者列举只是一个反例，两者有一这一结论即可推翻。意识到这层后，反例一个个冒出来，比如任正非的暴躁没同理心强势出了名，但是华为的组织能力却公认的强，该做如何解释？</p>
<p>业内研究华为的专家田涛给出的看法是：任正非的同理心很强，原因是华为慷慨的股权机制，权力机制，任正非把99%的股权稀释给9万多员工，大量20多岁、30多岁人掌握着很大权力。华为的独特机制设计是华为组织能力强的核心原因，但不能因此不承认任正非的性格局限性，田老师此处偷换了概念。通人性和没同理心可以在一个人身上同时存在。</p>
<p>华为的例子该做如何解释？我的看法是任正非想做超级大事并且也是人性大师，因此用机制设计分权分钱激发了团队的战斗力，这个机制包含的内容同时对冲掉了创始人个体的性格缺陷产生的组织负向性。</p>
<p>4</p>
<p>“扬长避短”，简简单单4个字，应用在企业运营上却是一个庞杂的体系。你会发现长板有极大的杠杆效应，短板有极大的黑洞效应。但在哪个领域是长板爆炸的杠杆，哪个领域是短板吞噬的黑洞。直到今年，我才明白。</p>
<p>再有人问我：决定一个组织的天花板是什么？</p>
<p>我的答案是：组织的下限由创始人的短板（性格缺陷和局限性）决定，组织的上限由创始人认识到短板后，基于自身局限性如何做组织设计决定。</p>
<p>对创始人们来说，“能不能”是一个技术问题，如何基于自身局限性做组织设计这个题目已然很有挑战，大量人甚至没意识到会是这个切入点。</p>
<p>但另一个更加究竟也根本的问题是“愿不愿”，很多创始人创立企业，说穿了组织生涯设计是服务于他的个人生涯设计的大玩具，于是强大的ego就变成了创始人没有动机去解决技术问题的根本障碍。从小缺乏肯定的创始人没跟自己和解前，组织里弥漫的浓厚揣摩上意报喜不报忧的氛围，可能正是创始人需要的心理自我慰藉。把组织氛围正本清源了，那他自身的安全感如何着落？</p>
<p>所以再往下拆，最后真正限制企业组织天花板的是创始人的远大梦想是否坚若磐石经得起考验。技术性的问题可克服，但对抗人性的还得是创始人身上那点最特别的远大梦想，没这个东西，就极容易滑下follow my heart的组织下限了。</p>
]]></content>
      <categories>
        <category>随记</category>
      </categories>
  </entry>
  <entry>
    <title>用人做事，用事做人</title>
    <url>/2025/08/28/%E5%88%9B%E4%B8%9A/%E7%94%A8%E4%BA%BA%E5%81%9A%E4%BA%8B%EF%BC%8C%E7%94%A8%E4%BA%8B%E5%81%9A%E4%BA%BA/</url>
    <content><![CDATA[<p>1、大公司创新业务/投资人孵化项目适合用人做事，因为事不容易想明白，需要反复试错后徐徐展开，更多要依赖人的可能性（参考《创新玩的是战略么？其实是组织》），创业者自己开干适合做事用人，自己开撸（第二点展开好处）</p>
<p>2、业务规模不大或者增速不快做事用人效率最高，效果最好。正面的原因是创始人直接盯死，下沉带业务，方向策略上有优势，执行效率也高，反面的原因是这个阶段估计没那么多钱可以吸纳到足够高质量的人才，这个阶段的人还不合适扛起那种担子。‍‍‍‍‍‍‍‍‍‍‍‍‍‍‍‍‍‍‍‍‍‍‍‍‍‍‍‍‍‍‍‍‍‍‍‍‍‍‍‍‍‍‍‍‍‍‍‍‍‍‍‍‍‍</p>
<p>3、做事用人，你可以把事情切得很碎，找到的人在局部有战术执行力，再盯死即可；用人做事，你找的人对于业务，排兵布阵的理解需要很深，而且还需要有心力或者探索欲，以及对组织或者对你个人的极强信任才能发挥出效果。‍‍‍‍‍‍‍‍‍‍‍‍‍‍‍再回答明晶教练的问题：很多管理者不会用人做事，是因为用人做事和做事用人背后的理念，管理行为完全不一样，他们没被触发不得不”用人做事“就必须突破的业务情境，局面通过“做事用人”就可以攻克（因此学习必要性不够强烈），反之“用人做事”有习得成本，有很高的应用条件，所以大部分管理没能学会“用人做事”。</p>
]]></content>
      <categories>
        <category>随记</category>
      </categories>
  </entry>
  <entry>
    <title>这辈子冒的最大风险就是代理人风险</title>
    <url>/2025/08/29/%E5%88%9B%E4%B8%9A/%E8%BF%99%E8%BE%88%E5%AD%90%E5%86%92%E7%9A%84%E6%9C%80%E5%A4%A7%E9%A3%8E%E9%99%A9%E5%B0%B1%E6%98%AF%E4%BB%A3%E7%90%86%E4%BA%BA%E9%A3%8E%E9%99%A9/</url>
    <content><![CDATA[<p>年纪小的时候我非常羡慕那些咨询顾问，思维缜密见识高卓，仿佛指点江山一败落公司就立马起死回生，后面当然发现这大半是出于自己的想象。尤其有给几家公司做顾问之类的经历，非但没有预期的美好感受，整个过程更是诚惶诚恐惴惴不安。</p>
<p>华与华方法的华杉讲战略咨询是天底下最好的买卖，案子若是成了便永远成为咨询公司的招牌项目，创始人走到哪都会把这家公司的成功与他们的咨询贴上强因果联系，更重要的是做挂的公司永远不会出来发声，中国人好面子，花了冤枉钱的犯傻经历从来不值得那出来炫耀，短命的创业公司更是没机会从坟墓里出来发声。</p>
<p>虽然不知道华与华方法是否有这类黑历史，但华杉却指出了做战略咨询最大一个“好处”：风险收益的非对称性。收了甲方一大笔咨询费，给出战略建议后却不用真正为执行决策的风险买单，客户成功了下次咨询费便可以大提价，做挂了抹掉这个案子，江湖上也传不出啥坏名声。</p>
<p>天底下还有比这更好的事情?</p>
<p>观察到有这么美妙的商业模式后，我却是后背脊发凉。甲方落实咨询方案后，无非两种情况，<br>第一种，不灵。<br>第二种，奏效。</p>
<p>第一种不提，即便是第二种，可以很肯定最后落地的内容必然不是咨询顾问出的原版方案，中间必然经过数次调优迭代。这由实践的客观性规律决定而跟咨询顾问经验多丰富无关。现实情况的各个要素在变，因此战略必须是动态的且越贴合实际越可能发挥作用。最重要不是战略本身而是风险承担的不对称，甲方为战略落地风险买单，乙方的声誉和收益并没有跟这个风险挂钩。</p>
<p>不用承担风险而坐拥收益，这不比不劳而获更害人么？不劳而获最多是养成了懒汉心理，有点羞耻心的至少不会以此为傲；做智力输出这事多高级多有快感，不灵情况下埋尸不提，奏效情况下客户真正买单了风险，而你却可以无风险的坐收客户闯赢鬼门关后的成功案例。长此以往那种智力满足感下建立的虚妄自信，多半丧失掉对现实复杂性的敬畏和实操难度的估量，眼越看越高（关键还是斜眼）手却越来越生，这不是自废武功是什么！</p>
<p>后来我知道我发现的这个东西塔勒布早就发现，为此他还单独写了一本书《非对称风险》论述，这种扭曲现象他称之为“代理人风险”。</p>
<p>后来我又发现满世界都存在着这种代理人风险，大到次贷危机中金融衍生品的过度创新，国企全民所有制下的缺乏竞争力，所有权和经营权分离下职业经理人的过度冒险行为，小到企业内部员工的“出工不出力”。</p>
<p>最后这条尤其有意思，雇主和员工在合作框架上本质是博弈关系，雇主出钱买员工的时间，员工希望及格线以上程度交付而非被榨干到极限。有意思的是信息时代专业工作者的产出并不像工业时代流水线上的记价劳作一样清晰可界定，因此“出工不出力”便成为了最隐蔽的代理人风险。</p>
<p>但道理是一样的：看上去占了便宜的最后只有坏处。</p>
<p>把自己放在风险环境里，承担最直接的风险而后胆战心惊拼尽全力，这是我经历过关于成长最高效的方式。</p>
]]></content>
      <categories>
        <category>随记</category>
      </categories>
  </entry>
  <entry>
    <title>《笛卡尔》5-7章杂谈</title>
    <url>/2023/06/03/%E5%93%B2%E5%AD%A6/%E3%80%8A%E7%AC%9B%E5%8D%A1%E5%B0%94%E3%80%8B5-7%E7%AB%A0/</url>
    <content><![CDATA[<p><em>笛卡尔在德国见到异象后的9年间“除了在世界游荡……什么也没做”。在此期间，他主要是在法国之外游历，接触异国风情和信仰或许可以帮助他远离年轻时沾染的偏见和谬误，他也可积累经验，成熟自己的心智，为“最重要的任务”-发现哲学的可靠原则-做必要的准备。</em></p>
<p>笛卡尔（1596-1650）在年轻时（1619-1628）游历各个国家，参加各种当时的“学术会议”，结交了一大批最前沿的哲学家，数学家，物理学家。他自己并不发表太多观点，起码不会花时间系统性的整理自己的观点，更不会写论文、写书。而是致力于尽可能多了解一些他人的观点（用现在的方式来折算来说，他在23-32岁间一直在参加会议，认识朋友，自我修正，但一篇论文都没发过，一本书都没写过）。</p>
<p>他在这个过程中不断的拆除旧有的观念，同时在旅行中积极地参与生活。用他的话说，他采用的手段是摒弃自己学过的东西中任何有疑问的任何内容。同时，他也继续信奉天主教的教义，他把宗教比作拆毁和重建房屋过程中的临时住所。（ps：根据现代的科学理论，这个不断拆毁和重建房屋的过程或许一直存在，那反而这个临时住所才是永久的家了）</p>
<p>1629年，他开始写一部巨著，希望勾勒出一种能解释所以自然现象的统一学说。第一部分名为《世界、论光》，第二部分名为《论人》。1633年当书终于准备印付时，笛卡尔却听到伽利略因为宣扬地动说而被宗教裁判所判刑的消息。《世界》中包括日心说的内容，因此笛卡尔在1634年放弃出版了。（直到1664年，笛卡尔死后14年《世界》才出版）</p>
<p>在《世界》中，笛卡尔认为上帝创造了某种无以名状的物质，填满了空间的每个角落，物质占满了所有的空间，它的各个部分都处于持续的运动中，物质会以圆形的轨迹运动，就像鱼在水中游动时，鱼鳍划动会排开周围部分的水，而不是整个池子里的水，排开的水又会把鱼不断腾出的空间填满。物质的行为必须遵守的三条法则：1.除非与另一部分相撞，每一部分物质将保持其最初的形状、大小以及运动或静止的状态。2.任一部分物质通过碰撞所获得的动能与碰撞的另一方所失去的动能相等。3.任何运动物体都倾向于保持直线运动，尽管他们实际上做的是圆周或曲线运动。牛顿的《原理》是1687年出版的，看来牛顿是看的笛卡尔的《世界》写的三定律，包括把笛卡尔对于宗教的思考也接受了。</p>
]]></content>
      <categories>
        <category>哲学</category>
      </categories>
      <tags>
        <tag>笛卡尔</tag>
      </tags>
  </entry>
  <entry>
    <title>名人名言</title>
    <url>/2099/02/03/%E5%90%8D%E4%BA%BA%E5%90%8D%E8%A8%80/%E5%90%8D%E4%BA%BA%E5%90%8D%E8%A8%80/</url>
    <content><![CDATA[<p>细节决定成败，习惯成就未来，性格决定命运。</p>
<p>完成比完美重要一万倍。</p>
<p>意志与命运往往背道而驰，决心到最后全部推倒。</p>
<p>像在临死前回顾自己的一生一样在睡前回顾自己的一天是如何度过的，像在生命的最后一天里一样在起床后决定一天要做的事。 </p>
<p>science is organized knowledge，and wisdom is organized life。</p>
<p>man must be disciplined for he is by nature raw and wild</p>
<p>每个人都有自己的人生节奏。</p>
<p>组织你的生活，贯彻你的计划，在日常生活中遵循普遍性原则，安排时间来发展你的技能，为小事留出时间，为职责留出时间。</p>
<p>先完成困难的工作，再完成简单的工作，一天就是一生。</p>
<p>知行合一。</p>
<p>日拱一卒。</p>
<p>我们暂不自行思索而拿书来读时会觉得很轻鬆，然而在读书时我们的头脑实际上成为别人思想的运动场了。所以，读书愈多或整天沉浸读书的人虽然可藉以休养精神但他的思维能力必将渐次丧失此犹如时常骑马的人步行能力必定较差道理相同。</p>
<p>炫耀自己的才华，卖弄自己的精明只不过旁敲侧击地嘲笑别人愚钝和无能。</p>
<p>你以为自己在爱情中总是运气不好，但其实你无意识中一直重复着相同的模式。你觉得自己在事业上总是受阻，但你内心深处可能害怕真正的成功。以为自己是这个世界的受害者，但实际上你一直被那些未曾直面的创伤操控着。</p>
<p>从小我们便被教导要按“生活的剧本”去活，更没人问我们问题：你为什么而活？这种意义的缺失并非偶然，而是被特意设计的结果。我们被灌输：身份来自于外在，薪水，头衔，我们获得的认可。这是一种社会对于人的规训，因为不愿意被规训的人对社会来说是危险的，他们不在意社会给予他们的头衔和意义，社会无法控制他们。</p>
<p>大人虎变，其文炳也；君子豹变，其文蔚也；小人革面，顺以从君。</p>
<p>倒退你的生活，从终点开始规划你的一生。</p>
<p>我已经按照我的生活方式写好了我的讣告。</p>
<p>首要原则是你不能欺骗自己，而你是最容易被欺骗的人。</p>
<p>如果你像其他每个人那样走相同的方向,你前头就有一大群人。</p>
<p>我是宇宙的一粒原子，也是原子构成的宇宙。</p>
<p>若欲精通某事，便需将其教给他人。</p>
<p>尽管我母亲对科学一无所知，她对我影响也很大，特别的说，她有一种奇妙的幽默感，我从她那里明白：最高形式的理解，是笑，是人类的同情。</p>
<p>你总在心里对自己说：我本来可以去做那个，但我没去做。这其实只是另一种说你做不到的方式。</p>
<p>在我还小的时候，我发现圣诞老人不是真的，我不觉得扫兴。我倒是如释重负：全世界那么多孩子，在同一个晚上都得到礼物，要解释这个现象，如今就简单多了啊。</p>
<p>在你年轻的时候，找到你爱干的事儿，那事足够大，能占住你全部成年岁月的兴趣，那是很妙的。因为，无论那是什么，如果你做的足够好（如果你真喜欢，你会干好），大家横竖会要为你想干的事付钱给你。</p>
<p>我有一种哲学，就是不为过去所作的事情后悔。只是设法记住你当时为什么做出那样的决定。</p>
<p>你没有义务始终保持和一年前，一个月前，甚至昨日相同的状态。你来到这个世界是为了不断地创造自己。</p>
<p>你没有责任去完成别人认为你应该成就的事情。我没有责任变成他们期望的样子，这是他们的错误，而不是我的失败。</p>
<p>努力工作，找到某种让你心醉神迷的东西。一旦你找到了，你就知道你一辈子的事业了。</p>
<p>不要想你想成为什么东西，只想你想干什么事情。</p>
<p>当然，你只有一次生命，你会犯下所有错误，并学会不再重复，这就是人生。</p>
<p>学生不需要一个完美的老师，他们需要一个快乐的老师，能让他们兴奋地来到学校，培养他们对学习的热爱。</p>
<p>永远不要将教育与智慧混为一谈，你可以拥有博士学位，却仍然是个傻瓜。</p>
<p>理解，而不是死记硬背；学习原理，而不是公式。</p>
<p>我无法理解任何人如何能从这种自我复制型的体系中受到教育，在这种体系中人们通过考试，然后教导其他热通过考试，但没有人真正懂得任何东西。</p>
<p>不要只教导你的孩子如何取得成功，还要教导他们在不成功时如何应对，教会他们如何处理失败并从错误中吸取教训。</p>
<p>我足够聪明，所以知道自己有时是愚蠢的。</p>
<p>苦行和极简将会让人更加敏锐。匮乏即是富足，自律产生喜悦。</p>
<p>当你的教育限制了你的想象力，这就被称为灌输。那些无法独立思考的人，就像是迷了路。教育应该是一种奖赏性的体验，让你能思考、想象、质疑、怀疑、和解决问题。</p>
<p>我相信课本对于一个好老师而言，只是帮助教学的工具，而不是照本宣科的材料。</p>
<p>我曾经是一个努力学习的普通人。没有天才，事实是他们对某件事感兴趣，然后倾其所能地学习它，但他们只是普通人。</p>
<p>我认为我们应该教给人们一些奇思妙想，求知的目的是变得更加能够欣赏奇思妙想的事物。</p>
<p>不了解数学就无法了解世界。</p>
<p>以最不受约束、不虔敬和原创性的方式，努力学习你最感兴趣的东西。</p>
<p>问题不在于人们未受教育，而在于人们受过的教育仅足够使他们相信所学的东西，但不足以让他们对所学的内容进行质疑。</p>
<p>你可以知道一种鸟在世界上不同的语言里的名字,但即便如此，你对这种鸟其实一无所知，所以让我们看看这只鸟，看它在做什么—那才是最重要的。我很早就明白了知道某物的名字和真正了解某物之间的区别。</p>
<p>科学家是探索者，哲学家是旅行家。</p>
<p>对于我无法创造的东西，我也无法理解它。</p>
<p>事实证明真理总是比你想象得更简单。</p>
<p>科学并不是专家的事业，是每个人都可以做的。</p>
<p>科学思维的一个原则，是彻底的诚实。</p>
<p>数学是一种语言，外加推理；它像一种语言，外加逻辑。数学是一种工具，用来推理。</p>
<p>一切特立独行的人格都意味着强大。</p>
<p>没有对生活绝望就不会爱生活。</p>
<p>重要的不是治愈，而是带着病痛活下去。</p>
<p>当对幸福的憧憬过于急切，那痛苦就在人的心灵深处升起。</p>
<p>谈论你所爱的事物，最好的方法是轻轻说起它。</p>
<p>自由不是想做什么，就做什么，而是教会你不想做什么，就可以不做什么。</p>
<p>决定我们是否富有的不是我们拥有的东西而是我们没有也行的东西。</p>
<p>自由即自律。</p>
<p>一个人没有信心，第二天都不想起床。</p>
<p>既然我已经踏上这条道路，那么任何东西都不应该妨碍我沿着这条路走下去。</p>
<p>女人越是拒绝，越是否认其性欲，男人对她的估价便越来越高了。</p>
<p>小事相信头脑，大事相信心灵。</p>
<p>当一个人得不到他想要的东西时，他必须珍惜他所拥有的。</p>
<p>思考是行动的彩排。</p>
<p>人类有可能是享乐主义动物与理性人类二者的交替表现。</p>
<p>遭遇偶尔的失败，并从失败中反思自己的生活方式，生活方向是有益的。</p>
<p>真正的闲暇并不是说什么也不做，而是能够自由地做自己感兴趣的事情。</p>
<p>命是弱者的接口，运是强者的谦词。</p>
<p>生活总是让我们遍体鳞伤，但到后来，那些受伤的地方一定会变成我们最强壮的地方。</p>
<p>我们花了两年学会说话，却要花上六十年来学会闭嘴。</p>
<p>大多数时候，我们说得越多，彼此的距离却越远，矛盾也越多。</p>
<p>优于别人，并不高贵，真正的高贵应该是优于过去的自己。</p>
<p>当你为错过太阳而哭泣的时候，你也要再错过群星了。</p>
<p>只有经历过地狱般的磨砺，才能练就创造天堂的力量；只有流过血的手指，才能弹出世间的绝响。</p>
<p>纵然伤心，也不要愁眉不展，因为你不知是谁会爱上你的笑容。</p>
<p>一切伟大的行动和思想，都有一个微不足道的开始</p>
<p>生命中真正重要的不是你遭遇了什么，而是你记住了哪些事，又是如何铭记的。</p>
<p>我们趋行在人生这个亘古的旅途，在坎坷中奔跑，在挫折中涅槃，忧愁缠满全身，痛苦飘洒一地。我们累，却无从止歇，我们苦，却无法回避。</p>
<p>人生十分孤独，没有一个人能读懂另一个人，每一个人都很孤独。</p>
<p>我除了要依照我内心自然发生的愿望去生活，别无他求。</p>
<p>命是弱者的借口，运是强者的谦词。</p>
<p>我们生而破碎，用活着来修修补补。</p>
<p>幸福就是一双鞋合不合适，只有自己一个人知道。</p>
<p>如果你把谎言撕碎，那些碎片就是真理。</p>
<p>假如传统或世代相传的意义仅仅是盲目地或一丝不苟地因循前人的风格，那么传统就一无可取。</p>
<p>生命是一团欲望，欲望不能满足便痛苦，满足便无聊，人生就在痛苦和无聊之间摇摆。</p>
<p>人性一个最特别的弱点就是在意别人如何看待自己。</p>
<p>平庸的人关心咋样耗费时间，有才能的人竭力利用时间。</p>
<p>事物本身是不变的，变的只是人的感觉。</p>
<p>人就像寒冬里的刺猬，相互靠的太近，会觉得刺痛；彼此离得太远，却又会觉得寒冷，人是必须保持适当的距离过活。</p>
<p>心性不高的人，幸福和快乐的唯一源泉是他的感官嗜好，充其量过一种舒适的家庭生活。</p>
<p>财富就像海水，饮得越多，渴得越厉害。</p>
<p>平庸的人喜好与人交往，喜欢迁就别人。这是因为他们忍受别人要比忍受他们自己来得更加容易。</p>
<p>人们最终所真正能够理解和欣赏的事物只不过是一些在本质上和他自身相同的事物罢了。</p>
<p>人最大的愚蠢就是牺牲健康，无论是为了诸如金钱、晋职，还是为了学问，声名。</p>
<p>一个人的认识，愈明晰，智慧愈增，他的痛苦也愈多，身为天才的人，他便有最多的苦恼。</p>
<p>这个世界沉浸在罪恶之中，野蛮人互相吞食对方，文明人互相欺骗对方。</p>
<p>美是高级的善，创造美是最高级的乐趣。</p>
<p>结婚就意味着平分个人权益，承担双份义务。</p>
<p>第一个忠告是生活先于书籍，第二个忠告是正文先于注解，即经验先于思考和认识。</p>
<p>谁失去了希望，谁也就没有了恐惧，这就是铤而走险这个词的意义。</p>
<p>那种由于痛苦而流露感情的地方，就会吸引那些虚无主义的人。</p>
<p>越是内心里有欠缺，他越是希望在别人眼里被看作幸运儿。</p>
<p>社交的起因在于人们生活的单调和空虚，社交的需要驱使他们来到一起，但各自具有的许多令人厌憎的品相又驱使他们分开，终于，他们找到了能彼此容忍的适当距离，那就是礼貌。</p>
<p>如果我们怀疑一个人说谎，我们就应该假装相信他，因为他会变得越来越神勇而有自信，并更大胆的说谎，最后会自己揭开自己的面具。</p>
<p>从根本上说，只有我们独立自主的思索，才真正具有真理和生命。因为，惟有他们才是我们反复领悟的东西。他人的思想就像别人餐桌上的残羹，就像陌生客人挪下的衣裳。</p>
<p>小人常为伟人的缺点或过失得意。</p>
<p>我们无论要做或者不做什么事情，我们首要考虑的几乎就是别人的看法，只要我们仔细观察就可以看出我们所经历的担忧和害怕半数以上来自这方面的忧虑。它是我们那容易受伤的自尊心。因为他有着病态般的敏感和所有虚荣、自负、炫耀、排场的基础。</p>
<p>所有的真理都要经过三个阶段。首先受到嘲笑。然后遭到激烈的反对。最后被理所应当地接受。</p>
<p>如果我们举止有礼，言谈友善；我们就能粗暴的对待许多人而安然无恙。</p>
<p>没有深厚经验衬托的广博思想和知识，就像是一本每页仅有两行正文却有四十行注释的教科书。</p>
<p>人类彻头彻尾是欲望的化身。</p>
<p>所谓辉煌的人生，不过是欲望的囚徒。</p>
<p>没有人生活在过去，也没有人生活在未来，现在是生命确实占有的唯一形态。</p>
<p>伟大的心灵在这个世界更喜欢独白，自己与自己说话。</p>
<p>在这样一个充满缺陷的世界里，如若能遇到真挚的朋友，就好好珍惜吧，有时候我们连对自己真诚都做不到。所以，无需苛责别人，人性本就复杂奇怪。</p>
<p>遗忘比绝望更强有力。</p>
<p>一个人只要可能，就应该像伟大的天才那样思考，而像普通人那样说话。</p>
<p>针对别人的行为动怒，就像跟一块我们前进路上的石头大发脾气同等的愚蠢。对于许多人，我们最聪明的想法就是：我不准备改变他们，我要利用他们。</p>
<p>幸福不过是欲望的暂时停止。</p>
<p>你的时间有限，所以不要浪费时间为别人而活，不要被教条所限，不要活在别人的观念里。</p>
<p>不要让别人的意见左右自己内心的声音，最重要的是勇敢的去追随自己的心灵和直觉。</p>
<p>我曾在17岁时读过这么一句名言：“如果你把每一天当做自己人生的最后一天来过，你才能够明白人生的真谛。”这句话令我印象深刻。</p>
<p>重要的不是终点，而是你在旅途中完成了多少有趣的事。</p>
<p>领袖的追随者之间的区别，就是创新。</p>
<p>记住该记住的，忘记该忘记的。改变能改变的，接受不能改变的。</p>
<p>没有对生活绝望，就不会爱生活。</p>
<p>重要的不是治愈，而是带着病痛活下去。</p>
<p>当对幸福的憧憬过于急切，那痛苦就在人的心灵深处升起。</p>
<p>习惯于绝望的处境，比绝望的处境本身还要糟。</p>
<p>未曾清贫难成人，不经打击老天真。</p>
<p>自古英雄出炼狱，从来富贵入凡尘。</p>
<p>为了让事物变得可能，我们必须一次又一次尝试不可能的事情。</p>
<p>无论是动物还是人，只要他全力以赴，将他的全部意志专注于一件事上，他就能实现目标。</p>
<p>无法自爱就无法爱人，憎恨自己就一定会憎恨他人。</p>
<p>生活是一条河，没有过去，没有未来，一切都是本质和当下。</p>
<p>命运和性格是同一个概念的两个名字。</p>
<p>意志与命运往往背道而驰，决心到最后全部推倒。</p>
<p>你所浪费的今天，是昨日殒身之人所奢望的明天。</p>
<p>优于别人，并不高贵，真正的高贵应该是优于过去的自己。</p>
<p>一切伟大的行动和思想，都有一个微不足道的开始。</p>
<p>命是弱者的借口，运是强者的谦词。</p>
<p>在孤独中，孤独者将自己吃的一干二净，而在群体中，他被众人吃掉。</p>
<p>老去已忘天下事，梦中犹见牡丹花。</p>
<p>我们的财产，一件件的被流逝的岁月抢走。</p>
<p>人们通常的见解是，在人生的旅途上走得越长久，得到的财富也越多；实际上岁月抢走了我们一件件财产，最后是两手空空。</p>
<p>当人们无法选择未来时，就会珍惜选择过去的权利。</p>
<p>人人都想上天堂，却没有人想死。</p>
<p>失败会激励胜利者，击垮失败者。</p>
<p>我志在将每一次灾难转化成机会</p>
<p>愤世者永远不会成功。未经证实的怀疑和恐惧会使人们成为愤世嫉俗者。愤世者抱怨现实，而成功者分析现实。</p>
<p>他正坐在回忆的马车里，他的生活重新开始了。</p>
<p>世事一场大梦，人生几度悲凉。</p>
<p>不要为自己持独特看法而感到害怕，因为我们现在所接受的常识，都曾是独特看法。</p>
<p>那些不能杀死我的，都使我更坚强。</p>
<p>你相信自己是什么样的人最后就会变成这样。</p>
<p>不能听命于自己的人，就要听命于他人。</p>
<p>人无夜草不富，马无夜草不肥。</p>
<p>夜草不肥劳病马，横财不富苦命人。</p>
<p>那些听不见音乐的人，认为那些跳舞的人疯了。</p>
<p>信仰就是不想知道真相是什么。</p>
<p>婚姻不幸福，不是因为缺乏爱，而是缺乏友谊。</p>
<p>谁终将声震人间，必长久深自缄默。</p>
<p>谁终将点燃闪电，必长久如云漂泊。</p>
<p>要破坏一件事，最刁钻的办法是，故意用歪理为这件事辩护。</p>
<p>一个伟大的人往往受到排挤，压抑，甚至被人斥为哗众取宠，而陷于孤独中。</p>
<p>假使有神，我怎能忍受我不是神，所以没有神。</p>
<p>走得最慢的人，只要他不丧失目标，也比漫无目的的徘徊的人走得快。</p>
<p>只要还有明天，今天就永远是起跑线。</p>
<p>命运负责洗牌，但玩牌的是我们自己。</p>
<p>迟到的青春是持久的青春。</p>
<p>人最终喜爱的，是自己的欲望，不是自己想要的东西。</p>
<p>君子慎独。</p>
<p>折磨你的从来都不是任何人的情绪，而是你心存幻想的期待，不要对一些事做过多的期待，也不要高估任何一段关系。</p>
<p>过错是暂时的遗憾，而错过则是永远的遗憾。</p>
<p>我们年轻的时候总是把创作的冲动误以为是创作的才华，总是把对孤独的恐惧误以为是对爱情的向往。</p>
<p>结婚无需太伟大的爱情，彼此不讨厌已够结婚的资本了。</p>
<p>借钱等于失去朋友，借书等于恋爱的开始。</p>
<p>我从来没有让我的学校影响我的教育。</p>
<p>一个人最危险的敌人是他自己的口舌。</p>
<p>喜剧，就是悲剧加上时间。</p>
<p>真诚的朋友，良好的书本和沉睡的良心，这就是理想的生活。</p>
<p>永远不要对不值得的人说实话。</p>
<p>好的婚姻是由两名宽恕者结合在一起。</p>
<p>首先，你要掌握事实，然后你才能随心所欲的误解它。</p>
<p>人生在世，必须善处境，万不可浪费时间，作无益的烦恼。</p>
<p>人一生可以做很多事，人一生只能做一件事。</p>
<p>不要为往事懊恼，而是要从往事中学习，听起来多么美好，要做到又何其难。</p>
]]></content>
      <categories>
        <category>名人名言</category>
      </categories>
      <tags>
        <tag>名人名言</tag>
      </tags>
  </entry>
  <entry>
    <title>你的第一本哲学书-自由意志</title>
    <url>/2023/09/30/%E5%93%B2%E5%AD%A6/%E4%BD%A0%E7%9A%84%E7%AC%AC%E4%B8%80%E6%9C%AC%E5%93%B2%E5%AD%A6%E4%B9%A6-%E8%87%AA%E7%94%B1%E6%84%8F%E5%BF%97/</url>
    <content><![CDATA[<p>自由意志到底是否存在？如果采纳决定论，我们就不能责备干坏事的人和夸奖做好事的人；如果不采纳决定论，问题出现了，如果说你的行为并未被你的欲望，信念和人格及其他东西所事先决定，它看起来就是某件自己发生的事情，没法给出什么解释。在这种情况下，你如何能够做它？</p>
<p>最终，无论我们的行为是不是被决定的，我们都不必为此负责。</p>
]]></content>
      <categories>
        <category>哲学</category>
      </categories>
  </entry>
  <entry>
    <title>高等代数</title>
    <url>/2023/04/30/%E6%95%B0%E5%AD%A6/%E9%AB%98%E7%AD%89%E4%BB%A3%E6%95%B0/</url>
    <content><![CDATA[<h1 id="高等代数研究对象"><a href="#高等代数研究对象" class="headerlink" title="高等代数研究对象"></a>高等代数研究对象</h1><p>高等代数是用来解方程的，最开始我们学习的是一元一次方程，然后自然的延伸到一元高次方程，这也就是经典代数学研究的对象，就是用一个未知量到高次数的一个方向发展。</p>
<p>另一个方向便是多元一次方程。n元一次方程组的求解过程可以简化为对一个矩阵进行初等行变换的过程。</p>
<p>对于一个三元一次方程组</p>
<script type="math/tex; mode=display">
\begin{cases}
x_{1} + 3x_{2} + x_{3}=2 \\
3x_{1} + 4x_{2} + 2x_{3}=9 \\
-x_{1} - 5x_{2} + 4x_{3}=10 \\
2x_{1} + 7x_{2} + x_{3}=1
\end{cases}</script><p>如果我们固定它的未知量的位置，实际上我们只在对未知量的系数和常数项进行运算，我们便可简写为矩阵的形式：s×n个数排成的s行n列的一张表就叫做一个s×n矩阵。</p>
<script type="math/tex; mode=display">
\begin{pmatrix}  
  1 & 3 & 1 & 2\\  
  3 & 4 & 2 & 9\\  
  -1 & -5 & 4 & 10 \\
  2 & 7 & 1  & 1
\end{pmatrix}</script><p>矩阵通常用大写字母表示，比如A。如果矩阵只包含方程组的系数，则矩阵A就称为n元线性方程组的系数矩阵，如果还包括常数项，则称为n元线性方程组的增广矩阵。</p>
<p>知识图谱：</p>
<p>在如今，由于计算机的发展，使得n元线性方程组变得可解，所以使得n元线性方程组变得很重要，因此高等代数研究对象的出发点就是<strong>n元线性方程组</strong>。之后我们要研究他的解法，因此我们需要用到<strong>矩阵</strong>的概念。</p>
<p>但在面对一个比较大，比较复杂的方程组时，我们最好先知道方程组解的情况，是有唯一解，无穷多解，还是无解，否则对于比较复杂的方程要算完才知道有没有解就太麻烦了，所以对于解的情况的判别很重要。对于一个一个2元或3元的方程组，我们可以自然的想到用方程组在平面或空间对应的线或面的相交，重合，平行的情况来对应方程组的唯一解，无穷多解，还是无解。对于n&gt;4的线性方程组，没有相对的物理空间来对应，但可以使用<strong>n维向量空间</strong>来研究n元线性方程组解的情况的判别。</p>
<p>在n维向量空间中，同样也有向量的加减乘除等操作和对应的计算性质和规律，对于n维向量空间的共同性质，可以再抽象出一般的<strong>线性空间</strong>的概念。</p>
<p>在线性空间中，<strong>线性映射</strong>是非常重要的一部分，而线性映射可以用来研究矩阵，矩阵同样也可以用来研究线性映射。</p>
<p>而对线性空间中的向量要进行度量，则要讨论<strong>双线性函数</strong>和<strong>具有度量的线性空间</strong>。其中在实数域上的有度量的线性空间叫欧几里得空间，在复数域上的有度量的线性空间叫酉空间。</p>
<p>空间到自身的线性映射叫线性变换。在欧几里得空间中与度量有关的线性变换叫正交变换，对称变换，在酉空间中与度量有关的线性变换叫酉变换，Hermite变换等。</p>
<p>这张图主要是描述的是高等代数的线性代数的部分，线性代数的主线是：研究线性空间和线性映射。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">graph TD;</span><br><span class="line">    n元线性方程组--&gt;n维向量空间;</span><br><span class="line">    n元线性方程组--&gt;矩阵;</span><br><span class="line">    n维向量空间--&gt;线性空间;</span><br><span class="line">    线性空间--&gt;线性映射;</span><br><span class="line">    线性空间--&gt;双线性函数;</span><br><span class="line">    线性空间--&gt;具有度量的线性空间;</span><br><span class="line">    双线性函数--&gt;具有度量的线性空间;</span><br><span class="line">    线性映射--&gt;矩阵;</span><br><span class="line">    矩阵--&gt;线性映射;</span><br><span class="line">    线性映射--&gt;具有度量的线性变换;</span><br></pre></td></tr></table></figure>
<p>​        高等代数的其他的发展方向还有<strong>一元高次方程的求根</strong>。</p>
<script type="math/tex; mode=display">
a_{n}x^{n} + a_{n-1}x^{n-1}\cdots+a_{1}x + a_{0}=0</script><p>​        要研究一元多项式的配方，就要研究<strong>一元多项式环</strong>的结构。</p>
<p>​        其中伽罗瓦在研究高次方程组是否有解时提出了<strong>域</strong>和<strong>群</strong>的概念。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">graph TD;</span><br><span class="line">    一元高次方程的求根--&gt;一元多项式环;</span><br><span class="line">    一元高次方程的求根--&gt;域的概念;</span><br><span class="line">    一元高次方程的求根--&gt;群的概念;</span><br><span class="line">    一元多项式环--&gt;环的概念;</span><br><span class="line">    环的概念--&gt;域的概念;</span><br><span class="line">    域的概念--&gt;群的概念;</span><br></pre></td></tr></table></figure>
<h1 id="线性方程组的矩阵消元法"><a href="#线性方程组的矩阵消元法" class="headerlink" title="线性方程组的矩阵消元法"></a>线性方程组的矩阵消元法</h1><p>如何让计算机可以对任意的n元一次方程组进行求解？下面要说的通用的n元线性方程组的求解方法：将n元线性方程组的增广矩阵化为简化阶梯形矩阵的过程，便是答案。</p>
<p>我们用一个例子来展示可以让计算机对任意的n元一次方程组进行求解的解法的过程。</p>
<p>例1 解线性方程组</p>
<script type="math/tex; mode=display">
\begin{cases}
x_{1} + 3x_{2} + x_{3}=2 \\
3x_{1} + 4x_{2} + 2x_{3}=9 \\
-x_{1} - 5x_{2} + 4x_{3}=10 \\
2x_{1} + 7x_{2} + x_{3}=1
\end{cases}</script><p>我们首先把除第一个方程外的其他方程的第一个未知量的系数化为0（如果第一个方程的$x_1$的系数为0，则将除第一个方程外第一个$x_1$的系数非0的方程移到第一个）：</p>
<script type="math/tex; mode=display">
\begin{cases}
x_{1} + 3x_{2} + x_{3}=2 \\
-5x_{2} -x_{3}=3 \\
-2x_{2} + 5x_{3}=12 \\
 x_{2} - x_{3}=-3
\end{cases}</script><p>为了计算方便，我们把第二个方程和第四个方程位置调换</p>
<script type="math/tex; mode=display">
\begin{cases}
x_{1} + 3x_{2} + x_{3}=2 \\
 x_{2} - x_{3}=-3\\
-2x_{2} + 5x_{3}=12 \\
-5x_{2} -x_{3}=3
\end{cases}</script><p>同样的，把第二个方程下的方程的$x_2$的系数化为0：</p>
<script type="math/tex; mode=display">
\begin{cases}
x_{1} + 3x_{2} + x_{3}=2 \\
 x_{2} - x_{3}=-3\\
3x_{3}=6 \\
-6x_{3}=-12
\end{cases}</script><p>同样的，把第三个方程下的方程的$x_3$的系数化为0：</p>
<script type="math/tex; mode=display">
\begin{cases}
x_{1} + 3x_{2} + x_{3}=2 \\
 x_{2} - x_{3}=-3\\
3x_{3}=6 \\
0=0
\end{cases}</script><p>方程组对应的增广矩阵的变化如下： </p>
<script type="math/tex; mode=display">
\begin{pmatrix}  
  1 & 3 & 1 & 2\\  
  3 & 4 & 2 & 9\\  
  -1 & -5 & 4 & 10 \\
  2 & 7 & 1  & 1
\end{pmatrix}\longrightarrow \begin{pmatrix}  
  1 & 3 & 1 & 2\\  
  0 & -5 & -1 & 3\\  
  0 & -2 & 5 & 12 \\
  0 & 1 & -1  & -3
\end{pmatrix}\longrightarrow \begin{pmatrix}  
   1 & 3 & 1 & 2\\  
    0 & 1 & -1  & -3\\
  0 & -2 & 5 & 12 \\
  0 & -5 & -1 & 3\\ 
\end{pmatrix}\\\longrightarrow \begin{pmatrix}  
  1 & 3 & 1 & 2\\  
  0 & 1 & -1  & -3\\
  0 & 0 & 3 & 6 \\
  0 & 0 & -6  & -12
\end{pmatrix}\longrightarrow \begin{pmatrix}  
  1 & 3 & 1 & 2\\  
  0 & 1 & -1  & -3\\  
  0 & 0 & 3 & 6 \\
  0 & 0 & 0  & 0
\end{pmatrix}</script><p>由此，我们得到了阶梯行方程组和阶梯型矩阵。</p>
<p>阶梯型矩阵的定义如下：</p>
<ul>
<li>0行在下方</li>
<li>主元（首非0元）的列指标随着行指标的增加而严格增大</li>
</ul>
<p>如果再把主元都化为1，主元所在的列的其他数都化为0，就变成了简化型阶梯型矩阵。</p>
<script type="math/tex; mode=display">
\begin{pmatrix}  
  1 & 3 & 1 & 2\\  
  0 & 1 & -1  & -3\\  
  0 & 0 & 3 & 6 \\
  0 & 0 & 0  & 0
\end{pmatrix}\longrightarrow \begin{pmatrix}  
  1 & 3 & 1 & 2\\  
  0 & 1 & -1  & -3\\  
  0 & 0 & 1 & 2 \\
  0 & 0 & 0  & 0
\end{pmatrix}\longrightarrow \begin{pmatrix}  
  1 & 3 & 1 & 2\\  
  0 & 1 & 0  & -1\\  
  0 & 0 & 1 & 2 \\
  0 & 0 & 0  & 0
\end{pmatrix}\\\longrightarrow \begin{pmatrix}  
  1 & 3 & 0 & 0\\  
  0 & 1 & 0  & -1\\  
  0 & 0 & 1 & 2 \\
  0 & 0 & 0  & 0
\end{pmatrix}\longrightarrow \begin{pmatrix}  
  1 & 0 & 0 & 3\\  
  0 & 1 & 0  & -1\\  
  0 & 0 & 1 & 2 \\
  0 & 0 & 0  & 0
\end{pmatrix}</script><p>简化型阶梯型矩阵对应的方程组如下：</p>
<p>$\begin{cases}<br>x<em>{1} =3 \<br> x</em>{2} =-1\<br>x_{3}=2<br>\end{cases}$</p>
<p>我们观察到，在变换增广矩阵时，我们的操作有如下三种</p>
<ol>
<li>把一行的倍数加到另一行</li>
<li>两行互换</li>
<li>一行乘以一个非零数</li>
</ol>
<p>这三种操作叫矩阵的初等行变换。</p>
<p>显然，经过初等方程组变换后的方程组和原方程组同解。因此，原方程组有唯一解(3,-1,2)。</p>
<p>下面我们再看另外一个例子：</p>
<p>例2 解线性方程组</p>
<script type="math/tex; mode=display">
\begin{cases}
x_{1} - x_{2} + x_{3}=1 \\
x_{1} - x_{2} - x_{3}=3 \\
2x_{1} - 2x_{2} - x_{3}=3
\end{cases}</script><p>解</p>
<script type="math/tex; mode=display">
\begin{pmatrix}  
  1 & -1 & 1 & 1\\  
  1 & -1 & -1  & 3\\  
  2 & -2 & -1 & 3 
\end{pmatrix}\longrightarrow \begin{pmatrix}  
   1 & -1 & 1 & 1\\  
  0 & 0 & -2  & 2\\  
  0 & 0 & -3 & 1 
\end{pmatrix}\longrightarrow \begin{pmatrix}  
   1 & -1 & 1 & 1\\  
  0 & 0 & 1  & -1\\  
  0 & 0 & -3 & 1 
\end{pmatrix}\\\longrightarrow \begin{pmatrix}  
  1 & -1 & 1 & 1\\  
  0 & 0 & 1  & -1\\  
  0 & 0 & 0 & -2 
\end{pmatrix}</script><p>相应的阶梯型方程组为：</p>
<script type="math/tex; mode=display">
\begin{cases}
x_{1} - x_{2} + x_{3}=1 \\
x_{3}=-1 \\
0=-2
\end{cases}</script><p>显然原方程组无解。</p>
<p>作为对比，我们再看一个线性方程组：</p>
<script type="math/tex; mode=display">
\begin{cases}
x_{1} - x_{2} + x_{3}=1 \\
x_{1} - x_{2} - x_{3}=3 \\
2x_{1} - 2x_{2} - x_{3}=5
\end{cases}</script><p>解</p>
<script type="math/tex; mode=display">
\begin{pmatrix}  
  1 & -1 & 1 & 1\\  
  1 & -1 & -1  & 3\\  
  2 & -2 & -1 & 5 
\end{pmatrix}\longrightarrow \begin{pmatrix}  
   1 & -1 & 1 & 1\\  
  0 & 0 & -2  & 2\\  
  0 & 0 & -3 & 3 
\end{pmatrix}\longrightarrow \begin{pmatrix}  
   1 & -1 & 1 & 1\\  
  0 & 0 & 1  & -1\\  
  0 & 0 & -3 & 3 
\end{pmatrix}\\\longrightarrow \begin{pmatrix}  
  1 & -1 & 1 & 1\\  
  0 & 0 & 1  & -1\\  
  0 & 0 & 0 & 0  
\end{pmatrix}\longrightarrow \begin{pmatrix}  
  1 & -1 & 0 & 2\\  
  0 & 0 & 1  & -1\\  
  0 & 0 & 0 & 0  
\end{pmatrix}</script><p>相应的阶梯型方程组为：</p>
<script type="math/tex; mode=display">
\begin{cases}
x_{1} - x_{2} = 2 \\
x_{3}=-1 \\
0=0
\end{cases}</script><p>显然原方程组有无穷多解，其解集为：</p>
<p>$\begin{cases}<br>x<em>{1}  =  x</em>{2}+2 \<br>x_{3}=-1<br>\end{cases}$,其中$x_2$是自由未知量，$x_1$,$x_3$是主变量。</p>
<p> 总结：</p>
<p>在有理数集（或实数集，或复数集）内，n元线性方程组的解的情况有三种情况：无解，有唯一解，有无穷多个解；那么是否有且只有这三种解的情况呢？</p>
<p>把线性方程组的增广矩阵经过初等行变换化为阶梯型矩阵对应的阶梯型方程组如果出现”0=d(其中d是非零数)”，那么原方程组无解；否则原方程组有解。</p>
<p>当有解时，若阶梯型矩阵的非零行的数目r=n（未知数目），则原方程组有唯一解，若阶梯型矩阵的非零行的数目r&lt;n（未知数目），则原方程组有无穷多解。</p>
<h1 id="线性方程组解的情况及其判别公式"><a href="#线性方程组解的情况及其判别公式" class="headerlink" title="线性方程组解的情况及其判别公式"></a>线性方程组解的情况及其判别公式</h1><p>下面证明上一节提出的问题：在有理数集（或实数集，或复数集）内，n元线性方程组的解的情况是否有且只有三种情况：无解，有唯一解，有无穷多个解？</p>
<p>证：n元线性方程组的增广矩阵经过初等行变换化成阶梯型矩阵A</p>
<p>设A有r个非零行，显然A有n+1列。</p>
<p>情形1.A出现“0=d(d是非零数)”，则原方程组无解</p>
<p>情形2.A不出现“0=d(d是非零数)”，则A的第r个主元$b_{rt}$所在列的$r\le n$,又有$t\ge r$，所以$n\ge r$。</p>
<p>情形2.1 r=n,此时A有n个主元，则第几行的主元就在第几列。</p>
<p>此时有</p>
<script type="math/tex; mode=display">
A=\begin{pmatrix}  
  1 & 0 & ... & c_1\\  
  0 & 1 & ...  & c_2\\ 
  ... & ... & ...  & ...\\ 
  0 & 0 & 1 & c_n  \\
   0 & 0 & 0  & 0
\end{pmatrix}</script><p>$c_n$所在行下有若干行0行，$(c_1,c_2,…c_n)$为原方程组的唯一解。</p>
<p>情形2.2 r&lt;n</p>
<script type="math/tex; mode=display">
A=\begin{pmatrix}  
  1 &0 & 0 & 0 \\  
  0...0 & 1 & 0  & 0 \\ 
  0...0 & 0...0 & 1  & 0 \\ 
  ... & ... & ...  & ...\\ 
  0 & 0 & 1 & ...  \\
   0 & 0 & 0  & 0
\end{pmatrix}</script><p>r&lt;n时，首先把x1的系数非零的行移到第一行，其他的依次按顺序排列，x2的系数非零的行在第二行，系数非零的x2所在列设为$J_2$,剩下的依次类推。</p>
<p>然后把方程的除$x<em>1,x</em>{j<em>2}…x</em>{j_r}$外的项移到右边，则有</p>
<script type="math/tex; mode=display">
x_1=b_{11}x_{i_1}+b_{12}x_{i_2}+...+b_{1,n-r}x_{i_{n-r}}+d_1,\\
x_{j_2}=b_{21}x_{i_1}+b_{22}x_{i_2}+...+b_{2,n-r}x_{i_{n-r}}+d_2,\\
...\\
x_{j_r}=b_{r1}x_{i_1}+b_{r2}x_{i_2}+...+b_{r,n-r}x_{r_{n-r}}+d_r</script><p>因为r&lt;n，所以右边有至少一个自由未知量，则原方程组有无穷多个解。</p>
<h1 id="齐次线性方程组"><a href="#齐次线性方程组" class="headerlink" title="齐次线性方程组"></a>齐次线性方程组</h1><p>对于齐次线性方程组：</p>
<script type="math/tex; mode=display">
\begin{cases}
a_{11}x_1+a{12}x_2+...+a_{1n}x_n=0,\\
a_{21}x_1+a{22}x_2+...+a_{2n}x_n=0,\\
a_{s1}x_1+a{s2}x_2+...+a_{sn}x_n=0
\end{cases}</script><p>(0,0,…,0)是方程组的一个解，称为0解，其余的解（如果有）称为非零解。</p>
<p>因为线性方程组只有无解，唯一解，和无穷多解；齐次线性方程组已经有了0解，所以齐次线性方程组的解的情况只有唯一解，和无穷多解两种可能。</p>
<p>推论-1：n元齐次线性方程组有非零解的充要条件$\Leftrightarrow $</p>
<p>系数矩阵经过初等行变换的阶梯型矩阵的非零行数目r&lt;n</p>
<p>推论-2：n元齐次线性方程组有非零解的充分条件$\Rightarrow $</p>
<p>若方程个数S&lt;n,则原方程有非零解。</p>
<p>但以上定理和推论要求在实数集或有理数集内，如果是整数集 内，则会不满足，比如2x=1在整数集内是无解的，即整数集不满足加减乘除的封闭。</p>
<p>定义1：复数集的一个非零子集K如果满足</p>
<p>(1).0,1$\in$K;</p>
<p>(2).$a,b\in K \Rightarrow a\pm b,ab\in K,\a,b\in K且b\ne 0 \Rightarrow \frac{a}{b}\in K $</p>
<p>那么称K是一个数域。</p>
<p>有理数域：Q,实数域：R,复数域：C</p>
<p>其中有理数域是最小的数域，复数域是最大的数域。</p>
<p>在讨论完使用非零行数目判断线性方程组的解的情况的判别后，我们发现这种判断解的情况的方法太过笨重，需要在几乎完成了矩阵的初等行变换后才得到，下面讨论在进行初等行变换前就先判断解的情况的方法。</p>
<p>例1：判断线性方程组的解的情况</p>
<script type="math/tex; mode=display">
\begin{cases}
a_{11}x_1+a_{12}x_2=b_1,\\
a_{21}x_2+a_{22}x_2=b_2
\end{cases}</script><p>$其中a<em>{11},a</em>{21}不全为0，不妨设a_{11}\ne0$</p>
<p>方程组对应的增广矩阵的变化如下：</p>
<script type="math/tex; mode=display">
\begin{pmatrix}
a_{11}&a_{12}&b_1\\
a_{21}&a_{22}&b_2\\
\end{pmatrix}\longrightarrow \begin{pmatrix}
a_{11}&a_{12}&b_1\\
0&a_{22}-\frac{a_{21}}{a_{11}}a{12}&b_2-\frac{a_{21}}{a_{11}}b_1\\
\end{pmatrix}</script><p>情形1.$a<em>{11}a</em>{22}-a<em>{21}a</em>{12} \ne0有唯一解$</p>
<p>情形2.$a<em>{11}a</em>{22}-a<em>{21}a</em>{12} =0$,无解或有无穷多个解</p>
<p>我们发现，有唯一解的条件不太好记，我们用一个行列式来表示：</p>
<script type="math/tex; mode=display">
\left|
\begin{array}{cccc} 
 a_{11} & a_{22}\\
a_{21} & a_{12}
\end{array}
\right|=a_{11}a_{22}-a_{21}a_{12}</script><h1 id="n阶行列式"><a href="#n阶行列式" class="headerlink" title="n阶行列式"></a>n阶行列式</h1><p>上节谈到，为了方便表示和记住解的判断条件，我们用行列式来表示条件：</p>
<script type="math/tex; mode=display">
\left|
\begin{array}{cccc} 
 a_{11} & a_{22}\\
a_{21} & a_{12}
\end{array}
\right|=a_{11}a_{22}-a_{21}a_{12}</script><p>此时，我们称这个行列式为2阶行列式，也称为矩阵A的行列式，记作|A|或detA。</p>
<p>数域K上系数矩阵为A的二元一次方程组有唯一解的条件充要条件是|A|$\ne0$。</p>
<p>n阶行列式的定义</p>
<p>我们通过观察2阶行列式的形式来推测n阶行列式的定义：2阶行列式中，每一项是不同行，不同列的2个元素的乘积。在观察2阶及3阶行列式的规律后发现每一项按行指标或列指标顺序排列，且各项系数为2!，3！的各项，还有各项的正负和各项数字的顺序有关比如11为正，21就为负。因此我们发现要讨论n阶行列式的一般性的公式前我们先要讨论一下n元排列和排列的相关性质。</p>
<h2 id="n元排列"><a href="#n元排列" class="headerlink" title="n元排列"></a>n元排列</h2><p>1，2，…n的一个全排列称为一个n元排列（或n个不同的正整数），n元排列有n！个。例如3！有123，132，213，231，312，321，6个 </p>
<p>排列的逆序数：</p>
<p>例如对于4元排列：2431，从左到右，顺序（从小到大）的数对有：24，23；逆序（从大到小）的数对有：21，43，41，31.逆序的数对数目称为排列的逆序数。逆序数为奇数的排列称为奇排列，逆序数为偶数的排列称为偶排列。</p>
<p>对换：</p>
<p>交换一个排列中的两个数的位置叫对换。比如交换2431中的24变为4231，2431为偶函数，4231为奇函数。我们发现对换改变排列的奇偶性，下面给出证明。</p>
<p>证：</p>
<p>1.先看对换的两个数相邻的情形：</p>
<p>$p…ij…q\to p…ji…q$</p>
<p>对于ij前的任意一个数p，交换 ij的位置对pi,pj数对的顺序或逆序的性质不变，同样的对于ij后的任意一个数q，交换 ij的位置对qi,qj数对的顺序或逆序的性质不变.因此只有一个数对ij变成ji后顺序逆序的性质相反，所以整体排列的奇偶性改变。</p>
<p>2.再看对换的两个数不相邻的情形：</p>
<p>$p…ik_1…k_nj…q\to p…jk_1…k_ni…q$</p>
<p>我们将这个情形拆成若干个相邻数交换的步骤：</p>
<script type="math/tex; mode=display">
先将i和k_1交换，再将i和k_2交换...再将i和k_n交换，再将i和j交换；然后将j和k_{n}交换,然后将j和k_{n-1}交换\\...最后将j和k_1交换，至此就 完成了i和j的交换。</script><p>任一n元排列$j1j2…jn$与123…n经过一系列的对换的次数与$j1j2…jn$有相同的奇偶性。</p>
<p>定理2：任意一个排列经过对换变成自然序列的次数和它的逆序数的奇偶性相同。</p>
<h2 id="n阶行列式的定义"><a href="#n阶行列式的定义" class="headerlink" title="n阶行列式的定义"></a>n阶行列式的定义</h2><p>定义1 n阶行列式</p>
<script type="math/tex; mode=display">
\begin{vmatrix}
 a_{11} & a_{12} & ... & a_{1n}\\
  a_{21} & a_{22} & ... & a_{2n} \\
  ... \\
  a_{n1} & a_{n2} & ... & a_{nn}
\end{vmatrix}</script><p>是n!项的代数和，其中每一项是不同行，不同列的n个元素的乘积。 </p>
<p>每一项按行指标成自然排序排好位置，当列指标形成的排列为偶排列，该项带正号，当列指标形成的排列为奇排列，该项带负号。</p>
<p>A的行列式：|A|或detA</p>
]]></content>
      <categories>
        <category>数学</category>
      </categories>
      <tags>
        <tag>高等代数</tag>
      </tags>
  </entry>
  <entry>
    <title>高等代数</title>
    <url>/2023/04/30/%E6%95%B0%E5%AD%A6/%E9%AB%98%E7%AD%89%E4%BB%A3%E6%95%B0_%E5%86%B2%E7%AA%81%E6%96%87%E4%BB%B6_Mx_20250331134250/</url>
    <content><![CDATA[<h1 id="高等代数研究对象"><a href="#高等代数研究对象" class="headerlink" title="高等代数研究对象"></a>高等代数研究对象</h1><p>高等代数是用来解方程的，最开始我们学习的是一元一次方程，然后自然的延伸到一元高次方程，这也就是经典代数学研究的对象，就是用一个未知量到高次数的一个方向发展。</p>
<p>另一个方向便是多元一次方程。n元一次方程组的求解过程可以简化为对一个矩阵进行初等行变换的过程。</p>
<p>对于一个三元一次方程组</p>
<script type="math/tex; mode=display">
\begin{cases}
x_{1} + 3x_{2} + x_{3}=2 \\
3x_{1} + 4x_{2} + 2x_{3}=9 \\
-x_{1} - 5x_{2} + 4x_{3}=10 \\
2x_{1} + 7x_{2} + x_{3}=1
\end{cases}</script><p>如果我们固定它的未知量的位置，实际上我们只在对未知量的系数和常数项进行运算，我们便可简写为矩阵的形式：s×n个数排成的s行n列的一张表就叫做一个s×n矩阵。</p>
<script type="math/tex; mode=display">
\begin{pmatrix}  
  1 & 3 & 1 & 2\\  
  3 & 4 & 2 & 9\\  
  -1 & -5 & 4 & 10 \\
  2 & 7 & 1  & 1
\end{pmatrix}</script><p>矩阵通常用大写字母表示，比如A。如果矩阵只包含方程组的系数，则矩阵A就称为n元线性方程组的系数矩阵，如果还包括常数项，则称为n元线性方程组的增广矩阵。</p>
<p>知识图谱：</p>
<p>在如今，由于计算机的发展，使得n元线性方程组变得可解，所以使得n元线性方程组变得很重要，因此高等代数研究对象的出发点就是<strong>n元线性方程组</strong>。之后我们要研究他的解法，因此我们需要用到<strong>矩阵</strong>的概念。</p>
<p>但在面对一个比较大，比较复杂的方程组时，我们最好先知道方程组解的情况，是有唯一解，无穷多解，还是无解，否则对于比较复杂的方程要算完才知道有没有解就太麻烦了，所以对于解的情况的判别很重要。对于一个一个2元或3元的方程组，我们可以自然的想到用方程组在平面或空间对应的线或面的相交，重合，平行的情况来对应方程组的唯一解，无穷多解，还是无解。对于n&gt;4的线性方程组，没有相对的物理空间来对应，但可以使用<strong>n维向量空间</strong>来研究n元线性方程组解的情况的判别。</p>
<p>在n维向量空间中，同样也有向量的加减乘除等操作和对应的计算性质和规律，对于n维向量空间的共同性质，可以再抽象出一般的<strong>线性空间</strong>的概念。</p>
<p>在线性空间中，<strong>线性映射</strong>是非常重要的一部分，而线性映射可以用来研究矩阵，矩阵同样也可以用来研究线性映射。</p>
<p>而对线性空间中的向量要进行度量，则要讨论<strong>双线性函数</strong>和<strong>具有度量的线性空间</strong>。其中在实数域上的有度量的线性空间叫欧几里得空间，在复数域上的有度量的线性空间叫酉空间。</p>
<p>空间到自身的线性映射叫线性变换。在欧几里得空间中与度量有关的线性变换叫正交变换，对称变换，在酉空间中与度量有关的线性变换叫酉变换，Hermite变换等。</p>
<p>这张图主要是描述的是高等代数的线性代数的部分，线性代数的主线是：研究线性空间和线性映射。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">graph TD;</span><br><span class="line">    n元线性方程组--&gt;n维向量空间;</span><br><span class="line">    n元线性方程组--&gt;矩阵;</span><br><span class="line">    n维向量空间--&gt;线性空间;</span><br><span class="line">    线性空间--&gt;线性映射;</span><br><span class="line">    线性空间--&gt;双线性函数;</span><br><span class="line">    线性空间--&gt;具有度量的线性空间;</span><br><span class="line">    双线性函数--&gt;具有度量的线性空间;</span><br><span class="line">    线性映射--&gt;矩阵;</span><br><span class="line">    矩阵--&gt;线性映射;</span><br><span class="line">    线性映射--&gt;具有度量的线性变换;</span><br></pre></td></tr></table></figure>
<p>​        高等代数的其他的发展方向还有<strong>一元高次方程的求根</strong>。</p>
<script type="math/tex; mode=display">
a_{n}x^{n} + a_{n-1}x^{n-1}\cdots+a_{1}x + a_{0}=0</script><p>​        要研究一元多项式的配方，就要研究<strong>一元多项式环</strong>的结构。</p>
<p>​        其中伽罗瓦在研究高次方程组是否有解时提出了<strong>域</strong>和<strong>群</strong>的概念。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">graph TD;</span><br><span class="line">    一元高次方程的求根--&gt;一元多项式环;</span><br><span class="line">    一元高次方程的求根--&gt;域的概念;</span><br><span class="line">    一元高次方程的求根--&gt;群的概念;</span><br><span class="line">    一元多项式环--&gt;环的概念;</span><br><span class="line">    环的概念--&gt;域的概念;</span><br><span class="line">    域的概念--&gt;群的概念;</span><br></pre></td></tr></table></figure>
<h1 id="线性方程组的矩阵消元法"><a href="#线性方程组的矩阵消元法" class="headerlink" title="线性方程组的矩阵消元法"></a>线性方程组的矩阵消元法</h1><p>如何让计算机可以对任意的n元一次方程组进行求解？下面要说的通用的n元线性方程组的求解方法：将n元线性方程组的增广矩阵化为简化阶梯形矩阵的过程，便是答案。</p>
<p>我们用一个例子来展示可以让计算机对任意的n元一次方程组进行求解的解法的过程。</p>
<p>例1 解线性方程组</p>
<script type="math/tex; mode=display">
\begin{cases}
x_{1} + 3x_{2} + x_{3}=2 \\
3x_{1} + 4x_{2} + 2x_{3}=9 \\
-x_{1} - 5x_{2} + 4x_{3}=10 \\
2x_{1} + 7x_{2} + x_{3}=1
\end{cases}</script><p>我们首先把除第一个方程外的其他方程的第一个未知量的系数化为0（如果第一个方程的$x_1$的系数为0，则将除第一个方程外第一个$x_1$的系数非0的方程移到第一个）：</p>
<script type="math/tex; mode=display">
\begin{cases}
x_{1} + 3x_{2} + x_{3}=2 \\
-5x_{2} -x_{3}=3 \\
-2x_{2} + 5x_{3}=12 \\
 x_{2} - x_{3}=-3
\end{cases}</script><p>为了计算方便，我们把第二个方程和第四个方程位置调换</p>
<script type="math/tex; mode=display">
\begin{cases}
x_{1} + 3x_{2} + x_{3}=2 \\
 x_{2} - x_{3}=-3\\
-2x_{2} + 5x_{3}=12 \\
-5x_{2} -x_{3}=3
\end{cases}</script><p>同样的，把第二个方程下的方程的$x_2$的系数化为0：</p>
<script type="math/tex; mode=display">
\begin{cases}
x_{1} + 3x_{2} + x_{3}=2 \\
 x_{2} - x_{3}=-3\\
3x_{3}=6 \\
-6x_{3}=-12
\end{cases}</script><p>同样的，把第三个方程下的方程的$x_3$的系数化为0：</p>
<script type="math/tex; mode=display">
\begin{cases}
x_{1} + 3x_{2} + x_{3}=2 \\
 x_{2} - x_{3}=-3\\
3x_{3}=6 \\
0=0
\end{cases}</script><p>方程组对应的增广矩阵的变化如下： </p>
<script type="math/tex; mode=display">
\begin{pmatrix}  
  1 & 3 & 1 & 2\\  
  3 & 4 & 2 & 9\\  
  -1 & -5 & 4 & 10 \\
  2 & 7 & 1  & 1
\end{pmatrix}\longrightarrow \begin{pmatrix}  
  1 & 3 & 1 & 2\\  
  0 & -5 & -1 & 3\\  
  0 & -2 & 5 & 12 \\
  0 & 1 & -1  & -3
\end{pmatrix}\longrightarrow \begin{pmatrix}  
   1 & 3 & 1 & 2\\  
    0 & 1 & -1  & -3\\
  0 & -2 & 5 & 12 \\
  0 & -5 & -1 & 3\\ 
\end{pmatrix}\\\longrightarrow \begin{pmatrix}  
  1 & 3 & 1 & 2\\  
  0 & 1 & -1  & -3\\
  0 & 0 & 3 & 6 \\
  0 & 0 & -6  & -12
\end{pmatrix}\longrightarrow \begin{pmatrix}  
  1 & 3 & 1 & 2\\  
  0 & 1 & -1  & -3\\  
  0 & 0 & 3 & 6 \\
  0 & 0 & 0  & 0
\end{pmatrix}</script><p>由此，我们得到了阶梯行方程组和阶梯型矩阵。</p>
<p>阶梯型矩阵的定义如下：</p>
<ul>
<li>0行在下方</li>
<li>主元（首非0元）的列指标随着行指标的增加而严格增大</li>
</ul>
<p>如果再把主元都化为1，主元所在的列的其他数都化为0，就变成了简化型阶梯型矩阵。</p>
<script type="math/tex; mode=display">
\begin{pmatrix}  
  1 & 3 & 1 & 2\\  
  0 & 1 & -1  & -3\\  
  0 & 0 & 3 & 6 \\
  0 & 0 & 0  & 0
\end{pmatrix}\longrightarrow \begin{pmatrix}  
  1 & 3 & 1 & 2\\  
  0 & 1 & -1  & -3\\  
  0 & 0 & 1 & 2 \\
  0 & 0 & 0  & 0
\end{pmatrix}\longrightarrow \begin{pmatrix}  
  1 & 3 & 1 & 2\\  
  0 & 1 & 0  & -1\\  
  0 & 0 & 1 & 2 \\
  0 & 0 & 0  & 0
\end{pmatrix}\\\longrightarrow \begin{pmatrix}  
  1 & 3 & 0 & 0\\  
  0 & 1 & 0  & -1\\  
  0 & 0 & 1 & 2 \\
  0 & 0 & 0  & 0
\end{pmatrix}\longrightarrow \begin{pmatrix}  
  1 & 0 & 0 & 3\\  
  0 & 1 & 0  & -1\\  
  0 & 0 & 1 & 2 \\
  0 & 0 & 0  & 0
\end{pmatrix}</script><p>简化型阶梯型矩阵对应的方程组如下：</p>
<p>$\begin{cases}<br>x<em>{1} =3 \<br> x</em>{2} =-1\<br>x_{3}=2<br>\end{cases}$</p>
<p>我们观察到，在变换增广矩阵时，我们的操作有如下三种</p>
<ol>
<li>把一行的倍数加到另一行</li>
<li>两行互换</li>
<li>一行乘以一个非零数</li>
</ol>
<p>这三种操作叫矩阵的初等行变换。</p>
<p>显然，经过初等方程组变换后的方程组和原方程组同解。因此，原方程组有唯一解(3,-1,2)。</p>
<p>下面我们再看另外一个例子：</p>
<p>例2 解线性方程组</p>
<script type="math/tex; mode=display">
\begin{cases}
x_{1} - x_{2} + x_{3}=1 \\
x_{1} - x_{2} - x_{3}=3 \\
2x_{1} - 2x_{2} - x_{3}=3
\end{cases}</script><p>解</p>
<script type="math/tex; mode=display">
\begin{pmatrix}  
  1 & -1 & 1 & 1\\  
  1 & -1 & -1  & 3\\  
  2 & -2 & -1 & 3 
\end{pmatrix}\longrightarrow \begin{pmatrix}  
   1 & -1 & 1 & 1\\  
  0 & 0 & -2  & 2\\  
  0 & 0 & -3 & 1 
\end{pmatrix}\longrightarrow \begin{pmatrix}  
   1 & -1 & 1 & 1\\  
  0 & 0 & 1  & -1\\  
  0 & 0 & -3 & 1 
\end{pmatrix}\\\longrightarrow \begin{pmatrix}  
  1 & -1 & 1 & 1\\  
  0 & 0 & 1  & -1\\  
  0 & 0 & 0 & -2 
\end{pmatrix}</script><p>相应的阶梯型方程组为：</p>
<script type="math/tex; mode=display">
\begin{cases}
x_{1} - x_{2} + x_{3}=1 \\
x_{3}=-1 \\
0=-2
\end{cases}</script><p>显然原方程组无解。</p>
<p>作为对比，我们再看一个线性方程组：</p>
<script type="math/tex; mode=display">
\begin{cases}
x_{1} - x_{2} + x_{3}=1 \\
x_{1} - x_{2} - x_{3}=3 \\
2x_{1} - 2x_{2} - x_{3}=5
\end{cases}</script><p>解</p>
<script type="math/tex; mode=display">
\begin{pmatrix}  
  1 & -1 & 1 & 1\\  
  1 & -1 & -1  & 3\\  
  2 & -2 & -1 & 5 
\end{pmatrix}\longrightarrow \begin{pmatrix}  
   1 & -1 & 1 & 1\\  
  0 & 0 & -2  & 2\\  
  0 & 0 & -3 & 3 
\end{pmatrix}\longrightarrow \begin{pmatrix}  
   1 & -1 & 1 & 1\\  
  0 & 0 & 1  & -1\\  
  0 & 0 & -3 & 3 
\end{pmatrix}\\\longrightarrow \begin{pmatrix}  
  1 & -1 & 1 & 1\\  
  0 & 0 & 1  & -1\\  
  0 & 0 & 0 & 0  
\end{pmatrix}\longrightarrow \begin{pmatrix}  
  1 & -1 & 0 & 2\\  
  0 & 0 & 1  & -1\\  
  0 & 0 & 0 & 0  
\end{pmatrix}</script><p>相应的阶梯型方程组为：</p>
<script type="math/tex; mode=display">
\begin{cases}
x_{1} - x_{2} = 2 \\
x_{3}=-1 \\
0=0
\end{cases}</script><p>显然原方程组有无穷多解，其解集为：</p>
<p>$\begin{cases}<br>x<em>{1}  =  x</em>{2}+2 \<br>x_{3}=-1<br>\end{cases}$,其中$x_2$是自由未知量，$x_1$,$x_3$是主变量。</p>
<p> 总结：</p>
<p>在有理数集（或实数集，或复数集）内，n元线性方程组的解的情况有三种情况：无解，有唯一解，有无穷多个解；那么是否有且只有这三种解的情况呢？</p>
<p>把线性方程组的增广矩阵经过初等行变换化为阶梯型矩阵对应的阶梯型方程组如果出现”0=d(其中d是非零数)”，那么原方程组无解；否则原方程组有解。</p>
<p>当有解时，若阶梯型矩阵的非零行的数目r=n（未知数目），则原方程组有唯一解，若阶梯型矩阵的非零行的数目r&lt;n（未知数目），则原方程组有无穷多解。</p>
<h1 id="线性方程组解的情况及其判别公式"><a href="#线性方程组解的情况及其判别公式" class="headerlink" title="线性方程组解的情况及其判别公式"></a>线性方程组解的情况及其判别公式</h1><p>下面证明上一节提出的问题：在有理数集（或实数集，或复数集）内，n元线性方程组的解的情况是否有且只有三种情况：无解，有唯一解，有无穷多个解？</p>
<p>证：n元线性方程组的增广矩阵经过初等行变换化成阶梯型矩阵A</p>
<p>设A有r个非零行，显然A有n+1列。</p>
<p>情形1.A出现“0=d(d是非零数)”，则原方程组无解</p>
<p>情形2.A不出现“0=d(d是非零数)”，则A的第r个主元$b_{rt}$所在列的$r\le n$,又有$t\ge r$，所以$n\ge r$。</p>
<p>情形2.1 r=n,此时A有n个主元，则第几行的主元就在第几列。</p>
<p>此时有</p>
<script type="math/tex; mode=display">
A=\begin{pmatrix}  
  1 & 0 & ... & c_1\\  
  0 & 1 & ...  & c_2\\ 
  ... & ... & ...  & ...\\ 
  0 & 0 & 1 & c_n  \\
   0 & 0 & 0  & 0
\end{pmatrix}</script><p>$c_n$所在行下有若干行0行，$(c_1,c_2,…c_n)$为原方程组的唯一解。</p>
<p>情形2.2 r&lt;n</p>
<script type="math/tex; mode=display">
A=\begin{pmatrix}  
  1 &0 & 0 & 0 \\  
  0...0 & 1 & 0  & 0 \\ 
  0...0 & 0...0 & 1  & 0 \\ 
  ... & ... & ...  & ...\\ 
  0 & 0 & 1 & ...  \\
   0 & 0 & 0  & 0
\end{pmatrix}</script><p>r&lt;n时，首先把x1的系数非零的行移到第一行，其他的依次按顺序排列，x2的系数非零的行在第二行，系数非零的x2所在列设为$J_2$,剩下的依次类推。</p>
<p>然后把方程的除$x<em>1,x</em>{j<em>2}…x</em>{j_r}$外的项移到右边，则有</p>
<script type="math/tex; mode=display">
x_1=b_{11}x_{i_1}+b_{12}x_{i_2}+...+b_{1,n-r}x_{i_{n-r}}+d_1,\\
x_{j_2}=b_{21}x_{i_1}+b_{22}x_{i_2}+...+b_{2,n-r}x_{i_{n-r}}+d_2,\\
...\\
x_{j_r}=b_{r1}x_{i_1}+b_{r2}x_{i_2}+...+b_{r,n-r}x_{r_{n-r}}+d_r</script><p>因为r&lt;n，所以右边有至少一个自由未知量，则原方程组有无穷多个解。</p>
<h1 id="齐次线性方程组"><a href="#齐次线性方程组" class="headerlink" title="齐次线性方程组"></a>齐次线性方程组</h1><p>对于齐次线性方程组：</p>
<script type="math/tex; mode=display">
\begin{cases}
a_{11}x_1+a{12}x_2+...+a_{1n}x_n=0,\\
a_{21}x_1+a{22}x_2+...+a_{2n}x_n=0,\\
a_{s1}x_1+a{s2}x_2+...+a_{sn}x_n=0
\end{cases}</script><p>(0,0,…,0)是方程组的一个解，称为0解，其余的解（如果有）称为非零解。</p>
<p>因为线性方程组只有无解，唯一解，和无穷多解；齐次线性方程组已经有了0解，所以齐次线性方程组的解的情况只有唯一解，和无穷多解两种可能。</p>
<p>推论-1：n元齐次线性方程组有非零解的充要条件$\Leftrightarrow $</p>
<p>系数矩阵经过初等行变换的阶梯型矩阵的非零行数目r&lt;n</p>
<p>推论-2：n元齐次线性方程组有非零解的充分条件$\Rightarrow $</p>
<p>若方程个数S&lt;n,则原方程有非零解。</p>
<p>但以上定理和推论要求在实数集或有理数集内，如果是整数集 内，则会不满足，比如2x=1在整数集内是无解的，即整数集不满足加减乘除的封闭。</p>
<p>定义1：复数集的一个非零子集K如果满足</p>
<p>(1).0,1$\in$K;</p>
<p>(2).$a,b\in K \Rightarrow a\pm b,ab\in K,\a,b\in K且b\ne 0 \Rightarrow \frac{a}{b}\in K $</p>
<p>那么称K是一个数域。</p>
<p>有理数域：Q,实数域：R,复数域：C</p>
<p>其中有理数域是最小的数域，复数域是最大的数域。</p>
<p>在讨论完使用非零行数目判断线性方程组的解的情况的判别后，我们发现这种判断解的情况的方法太过笨重，需要在几乎完成了矩阵的初等行变换后才得到，下面讨论在进行初等行变换前就先判断解的情况的方法。</p>
<p>例1：判断线性方程组的解的情况</p>
<script type="math/tex; mode=display">
\begin{cases}
a_{11}x_1+a_{12}x_2=b_1,\\
a_{21}x_2+a_{22}x_2=b_2
\end{cases}</script><p>$其中a<em>{11},a</em>{21}不全为0，不妨设a_{11}\ne0$</p>
<p>方程组对应的增广矩阵的变化如下：</p>
<script type="math/tex; mode=display">
\begin{pmatrix}
a_{11}&a_{12}&b_1\\
a_{21}&a_{22}&b_2\\
\end{pmatrix}\longrightarrow \begin{pmatrix}
a_{11}&a_{12}&b_1\\
0&a_{22}-\frac{a_{21}}{a_{11}}a{12}&b_2-\frac{a_{21}}{a_{11}}b_1\\
\end{pmatrix}</script><p>情形1.$a<em>{11}a</em>{22}-a<em>{21}a</em>{12} \ne0有唯一解$</p>
<p>情形2.$a<em>{11}a</em>{22}-a<em>{21}a</em>{12} =0$,无解或有无穷多个解</p>
<p>我们发现，有唯一解的条件不太好记，我们用一个行列式来表示：</p>
<script type="math/tex; mode=display">
\left|
\begin{array}{cccc} 
 a_{11} & a_{22}\\
a_{21} & a_{12}
\end{array}
\right|=a_{11}a_{22}-a_{21}a_{12}</script><h1 id="n阶行列式"><a href="#n阶行列式" class="headerlink" title="n阶行列式"></a>n阶行列式</h1><p>上节谈到，为了方便表示和记住解的判断条件，我们用行列式来表示条件：</p>
<script type="math/tex; mode=display">
\left|
\begin{array}{cccc} 
 a_{11} & a_{22}\\
a_{21} & a_{12}
\end{array}
\right|=a_{11}a_{22}-a_{21}a_{12}</script><p>此时，我们称这个行列式为2阶行列式，也称为矩阵A的行列式，记作|A|或detA。</p>
<p>数域K上系数矩阵为A的二元一次方程组有唯一解的条件充要条件是|A|$\ne0$。</p>
<p>n阶行列式的定义</p>
<p>我们通过观察2阶行列式的形式来推测n阶行列式的定义：2阶行列式中，每一项是不同行，不同列的2个元素的乘积。在观察2阶及3阶行列式的规律后发现每一项按行指标或列指标顺序排列，且各项系数为2!，3！的各项，还有各项的正负和各项数字的顺序有关比如11为正，21就为负。因此我们发现要讨论n阶行列式的一般性的公式前我们先要讨论一下n元排列和排列的相关性质。</p>
<h2 id="n元排列"><a href="#n元排列" class="headerlink" title="n元排列"></a>n元排列</h2><p>1，2，…n的一个全排列称为一个n元排列（或n个不同的正整数），n元排列有n！个。例如3！有123，132，213，231，312，321，6个 </p>
<p>排列的逆序数：</p>
<p>例如对于4元排列：2431，从左到右，顺序（从小到大）的数对有：24，23；逆序（从大到小）的数对有：21，43，41，31.逆序的数对数目称为排列的逆序数。逆序数为奇数的排列称为奇排列，逆序数为偶数的排列称为偶排列。</p>
<p>对换：</p>
<p>交换一个排列中的两个数的位置叫对换。比如交换2431中的24变为4231，2431为偶函数，4231为奇函数。我们发现对换改变排列的奇偶性，下面给出证明。</p>
<p>证：</p>
<p>1.先看对换的两个数相邻的情形：</p>
<p>$p…ij…q\to p…ji…q$</p>
<p>对于ij前的任意一个数p，交换 ij的位置对pi,pj数对的顺序或逆序的性质不变，同样的对于ij后的任意一个数q，交换 ij的位置对qi,qj数对的顺序或逆序的性质不变.因此只有一个数对ij变成ji后顺序逆序的性质相反，所以整体排列的奇偶性改变。</p>
<p>2.再看对换的两个数不相邻的情形：</p>
<p>$p…ik_1…k_nj…q\to p…jk_1…k_ni…q$</p>
<p>我们将这个情形拆成若干个相邻数交换的步骤：</p>
<script type="math/tex; mode=display">
先将i和k_1交换，再将i和k_2交换...再将i和k_n交换，再将i和j交换；然后将j和k_{n}交换,然后将j和k_{n-1}交换\\...最后将j和k_1交换，至此就 完成了i和j的交换。</script><p>任一n元排列$j1j2…jn$与123…n经过一系列的对换的次数与$j1j2…jn$有相同的奇偶性。</p>
<p>定理2：任意一个排列经过对换变成自然序列的次数和它的逆序数的奇偶性相同。</p>
<h2 id="n阶行列式的定义"><a href="#n阶行列式的定义" class="headerlink" title="n阶行列式的定义"></a>n阶行列式的定义</h2><p>定义1 n阶行列式</p>
<script type="math/tex; mode=display">
\begin{vmatrix}
 a_{11} & a_{12} & ... & a_{1n}\\
  a_{21} & a_{22} & ... & a_{2n} \\
  ... \\
  a_{n1} & a_{n2} & ... & a_{nn}
\end{vmatrix}</script><p>是n!项的代数和，其中每一项是不同行，不同列的n个元素的乘积。 </p>
<p>每一项按行指标成自然排序排好位置，当列指标形成的排列为偶排列，该项带正号，当列指标形成的排列为奇排列，该项带负号。</p>
<p>A的行列式：|A|或detA</p>
<h2 id="上三角行列式"><a href="#上三角行列式" class="headerlink" title="上三角行列式"></a>上三角行列式</h2><script type="math/tex; mode=display">
\begin{vmatrix}  
  a_{11}  a_{12}  ... a_{1n}\\  
  0\ \  0\ ...\ ... \\  
 0\ ...\ ... a_{nn}\\  
\end{vmatrix}</script><h2 id="行列式性质"><a href="#行列式性质" class="headerlink" title="行列式性质"></a>行列式性质</h2><p>性质1：转置后值不变</p>
<p>​    A的转置：$ A^{‘}或A^T或A^t $ </p>
<p>性质2：若A的i行乘了k后为B，则|B|=k|A|</p>
<p>性质3：若A的某一行每一项拆为$B_n+C_n,则|A|=|B|+|C|$</p>
<p>性质4：若A的某两行互换，则|C|=-|A|</p>
<p>性质5：两行相等，行列式的值为0</p>
<p>性质6：两行成比例。行列式的值为0/</p>
<p>性质7：若A的k行加上L倍的i行，则|D|=|A|</p>
<h1 id="代数余子式"><a href="#代数余子式" class="headerlink" title="代数余子式"></a>代数余子式</h1><p>定义1：n阶矩阵A=$a<em>{ij}$,划去A的（i，j）元所在的第i行第j列，剩下的元素按原来的顺序构成一个n-1阶行列式，称为A的（i，j）元的余子式，记作$M</em>{ij}$。</p>
<p>定理1：|A|=$a<em>{i1}A</em>{i1}+a<em>{i2}+A</em>{i2}+…+a<em>{in}A</em>{in}$</p>
<p>定理3：n阶矩阵A=$a<em>{ij}$,当$k \neq i时，a</em>{i1}A<em>{k1}+a</em>{i2}A<em>{k2}+…+a</em>{in}A_{kn}=0$</p>
<p>数域上线性方程组什么情况下有唯一解？</p>
<p>增广矩阵$\tilde{A}$</p>
]]></content>
      <categories>
        <category>数学</category>
      </categories>
      <tags>
        <tag>高等代数</tag>
      </tags>
  </entry>
  <entry>
    <title>to-do list</title>
    <url>/2024/04/18/%E6%9D%82%E8%B0%88/to-do%20list/</url>
    <content><![CDATA[<p>社会哲学的自然原理</p>
<p>ai装修机器人-ai建筑机器人-冯诺依曼探测器</p>
<p>如何构建将各个学科连贯的串联在一起的大学科并以此更新教育方式</p>
<p>精确到课堂级的分班策略-不固定座位和班级，使用软件在每节课开课前分班。</p>
<p>反重力飞行器</p>
]]></content>
  </entry>
  <entry>
    <title>讣告</title>
    <url>/2025/07/17/%E6%9D%82%E8%B0%88/%E5%A2%93%E5%BF%97%E9%93%AD/</url>
    <content><![CDATA[<p>马文蔚，90岁，因心力衰竭逝世。</p>
<p>哲学家，数学家，物理学家，脑神经科学家，游戏设计师，游戏开发者。著有《社会哲学的数学原理》，《脑神经数学原理》，《反物质推进器原理》。沉稳，喜怒不幸于色，知世故而不世故，自律，规律生活，好学，博学，善良，不易相处。改变了自己和世界。</p>
<p>使用ai代替所有体力劳动；使用ai取代人类法律，政治，经济系统；实现大脑的复制/粘贴，人类的思想永生；实现反物质推进器；实现婴儿工厂；</p>
<p>创办有一家游戏公司，一家硬件公司（机械臂，通用ai机器人），一家基础服务公司（脑干，低级神经系统）</p>
]]></content>
  </entry>
  <entry>
    <title>康德：如何管理你的时间？</title>
    <url>/2024/03/11/%E6%9D%82%E8%B0%88/%E5%BA%B7%E5%BE%B7%EF%BC%9A%E5%A6%82%E4%BD%95%E7%AE%A1%E7%90%86%E4%BD%A0%E7%9A%84%E6%97%B6%E9%97%B4%EF%BC%9F/</url>
    <content><![CDATA[<h2 id="1、组织你的生活"><a href="#1、组织你的生活" class="headerlink" title="1、组织你的生活"></a>1、组织你的生活</h2><p>“science is organized knowledge，and wisdom is organized life ”<br>康德认为缺乏规律和结构的生活方式会消耗我们的身体、精神和情绪，所以我们需要组织自己的生活。<br>开始组织生活的最好方式就是思考你的长期目标是什么，以及需要通过哪些日常事例来实现这些目标。好的时间管理能够帮助我们专注于重要的事以及高效的实现目标。<br>那么你的目标是什么呢？<br>你是如何安排自己的日常事例的？<br>“如果你不主动安排自己的日程，只是被动的接受安排那你就是在无休止帮助别人实现他的长期目标”</p>
<h2 id="2、贯彻执行你的计划"><a href="#2、贯彻执行你的计划" class="headerlink" title="2、贯彻执行你的计划"></a>2、贯彻执行你的计划</h2><p>“man must be disciplined for he is by nature raw and wild”<br>你需要从最难最重要的事开始做起，建立正向反馈<br>每完成一个任务记得奖励你的大象（nature）</p>
<h2 id="3、在日常生活中遵循普遍性原则"><a href="#3、在日常生活中遵循普遍性原则" class="headerlink" title="3、在日常生活中遵循普遍性原则"></a>3、在日常生活中遵循普遍性原则</h2><p>想要放纵自己的时候问问自己<br>这是必要的吗？<br>我的行为准则是什么？<br>如果每个人都遵循这样的原则（世界/社会/公司……）会怎么样？</p>
<h2 id="4、安排时间来发展你的技能"><a href="#4、安排时间来发展你的技能" class="headerlink" title="4、安排时间来发展你的技能"></a>4、安排时间来发展你的技能</h2><p>“we are not rich by what we possess，but by what we can do without”<br>发展你的技能，学习相关领域的知识，不断了解该领域的最新信息……不要总想着拍老板马屁，或者刻意贬低同事错误以获得重视或者升迁。<br>对于想要发展的技能，每天至少花费1小时。<br>把日程表上更多的时间投入到自我提升上。</p>
<h2 id="5、为小事留出时间"><a href="#5、为小事留出时间" class="headerlink" title="5、为小事留出时间"></a>5、为小事留出时间</h2><p>“Look closely ，the beautiful maybe small”<br>欣赏美能让我们产生敬畏心和保护欲，欣赏日出日落、花鸟蝉鸣、甚至是都市林立的大厦和博物馆的展藏，都能让我们变得更加柔和、感恩。</p>
<h2 id="6、为职责留出时间"><a href="#6、为职责留出时间" class="headerlink" title="6、为职责留出时间"></a>6、为职责留出时间</h2><p>我们每个人一生都在扮演任何角色，家庭的、工作的、社会的…每个角色都需要我们花时间去平衡，比如固定时间给父母打电话，不能因为最近太忙或者压力太大而不打，这是不道德的。如果你在理性上理解了与父母保持联系的重要性，不论时间多么紧张都要跟父母留点时间。</p>
<h2 id="7、留点时间进行道德上的自我发展。"><a href="#7、留点时间进行道德上的自我发展。" class="headerlink" title="7、留点时间进行道德上的自我发展。"></a>7、留点时间进行道德上的自我发展。</h2>]]></content>
  </entry>
  <entry>
    <title>康波周期</title>
    <url>/2024/11/29/%E6%9D%82%E8%B0%88/%E5%BA%B7%E6%B3%A2%E5%91%A8%E6%9C%9F/</url>
    <content><![CDATA[<h1 id="康波周期介绍"><a href="#康波周期介绍" class="headerlink" title="康波周期介绍"></a>康波周期介绍</h1><p><strong>1.人生发财靠康波</strong></p>
<p>康波在现实中的表现就是价格波动，价格波动规律为我们提供了宏观对冲和人生财富规划的密码。在研究了长期的价格波动规律之后，本文还对2016至2018年的世界大宗商品价格波动做了预测。</p>
<p><strong>2.康波就是价格波动</strong></p>
<p>我们对康波的认识：1、每一个康波是指一个相当长时期的总的价格的上升或总的价格的下降。2、价格的长期波动不是自己产生的，是资本主义体系本质的结果；3、每一个康波又嵌套着几个库兹涅茨周期和几个朱格拉周期。4、上述特征决定了康波就是国际<a href="https://zhida.zhihu.com/search?content_id=2250214&amp;content_type=Article&amp;match_order=2&amp;q=宏观对冲&amp;zhida_source=entity">宏观对冲</a>的根本理论。</p>
<p><strong>3.康波中价格剧烈波动的原因</strong></p>
<p>康波价格的剧烈波动主要集中于从衰退到萧条的阶段，这是由于1、当效率提升放缓时，供需的原有平衡边际上发生了变化；2、<a href="https://zhida.zhihu.com/search?content_id=2250214&amp;content_type=Article&amp;match_order=1&amp;q=长鞭效应&amp;zhida_source=entity">长鞭效应</a>。</p>
<p><strong>4.康波中的能源和金属价格</strong></p>
<p>1、不能用当期供需来解释能源和金属价格，康波中的价格冲击是一个累积的结果，是劳动生产率下降，长鞭效应和追赶国工业化的共同结果；2、工业化起飞国家的资源消耗会呈现出一个倒U型的结构，在其边际爬升的时候，对资源价格影响最大。3、短期的资源消费增速遵从于朱格拉周期，所以短期的价格波动是与经济增长率相关的。</p>
<p><strong>5.康波中的太阳黑子和农业</strong></p>
<p>1、太阳黑子以一种未知的原因影响着人类的情绪和商业行为，从而成为三周期嵌套天道中的决定因素。2、农业价格并未表现出明显的长周期波动特点，反而倒是受到<a href="https://zhida.zhihu.com/search?content_id=2250214&amp;content_type=Article&amp;match_order=1&amp;q=施瓦贝&amp;zhida_source=entity">施瓦贝</a>循环的直接影响，更直接的是厄尔尼诺循环。</p>
<p><strong>6.康波中的黄金价格</strong></p>
<p>1、黄金理论上就是大宗商品的<a href="https://zhida.zhihu.com/search?content_id=2250214&amp;content_type=Article&amp;match_order=1&amp;q=一般等价物&amp;zhida_source=entity">一般等价物</a>。2、在康波的萧条，回升及衰退阶段，黄金价格与<a href="https://zhida.zhihu.com/search?content_id=2250214&amp;content_type=Article&amp;match_order=1&amp;q=实际利率&amp;zhida_source=entity">实际利率</a>的负相关真实存在，但在繁荣期，这种关系基本不存在，甚至相反。</p>
<p><strong>7.第五次康波中的价格波动</strong></p>
<p>1、2002年之后，大宗商品经历了一个长达10年的牛市，2008年和2011年视为大宗商品牛市的双头，自2012年之后，大宗商品一直在熊市中运行。2、经历了2008年的康波一次冲击之后，2015年之后康波应进入二次冲击阶段并向萧条转换，衰退和萧条的连接点一定是一个康波大宗商品价格的最低点，即2016至2018年之间是商品价格转换点；3、从中周期的意义上看，每轮中周期大宗商品都会出现一次波段行情，这个行情大概率都会出现在第三库存周期位置。4、2016年第三库存周期启动，大宗商品价格中级反弹，全球将经历一次小型滞胀。</p>
<p><strong>前言</strong></p>
<p><strong>人生发财靠康波</strong></p>
<p>关于<a href="https://zhida.zhihu.com/search?content_id=2250214&amp;content_type=Article&amp;match_order=1&amp;q=康德拉季耶夫周期&amp;zhida_source=entity">康德拉季耶夫周期</a>的研究，上一个活跃期是在20世纪的70年代，事实上，那是第四波康波的衰退和萧条阶段。而在2005年之后，我们一直致力于<a href="https://zhida.zhihu.com/search?content_id=2250214&amp;content_type=Article&amp;match_order=1&amp;q=康波理论&amp;zhida_source=entity">康波理论</a>的研究，在2008年美国次贷危机之后，也有一些经济周期的著作出现，但大部分并不涉及对康波的系统论述。</p>
<p>2014年中期之后，我们有一个切身的感受，当房地产作为一类资产的投资价值渐渐淡去之后，中国庞大的货币面临着方向的选择，我们当时即有一个判断，随着中国步入工业化的后期，中国已经开始进入宏观对冲时代。但中国的宏观对冲研究依然处于一个懵懂阶段，自2005年以来，我们一直致力于中国的工业化和<a href="https://zhida.zhihu.com/search?content_id=2250214&amp;content_type=Article&amp;match_order=1&amp;q=经济周期理论&amp;zhida_source=entity">经济周期理论</a>研究，我们一直有一个愿望，即建立一套适用于中国的经济周期理论体系，而这套理论体系的目的，是为了宏观对冲，并非是一种学院式研究。</p>
<p>以我们对康波的理解，虽然一般在康波进入衰退之后才更容易引起人们对这一理论的重视。但事实上人生就是一次康波，康波的形成，是人的集体行为的结果，而这种集体行为决定于人的代际更迭。康波研究者曾指出：</p>
<p>康波依赖于使用资本设备的生产方法，依赖于资本设备和建筑的寿命，以及依赖于人们在经济部门中移动的缓慢速度。长波因人们提前做计划的时间和他们对过去经济灾难记忆的时间的长度而加深，而这两个方面又在很大程度上决定于人的寿命的长度。在导致<a href="https://zhida.zhihu.com/search?content_id=2250214&amp;content_type=Article&amp;match_order=2&amp;q=长波&amp;zhida_source=entity">长波</a>出现的这些因素中，没有一个是严重依赖更快的通讯或技术变化的细节。—杰伊.W.<a href="https://zhida.zhihu.com/search?content_id=2250214&amp;content_type=Article&amp;match_order=1&amp;q=福雷斯特&amp;zhida_source=entity">福雷斯特</a></p>
<p><strong>所以，康波的长度是一个<a href="https://zhida.zhihu.com/search?content_id=2250214&amp;content_type=Article&amp;match_order=1&amp;q=甲子&amp;zhida_source=entity">甲子</a>。</strong>而对于一个人的一生来讲，其出生在康波的那个时点，就注定了人一生的经济轨迹，某种意义上看，人生的财富由康波注定，因为康波的本质表现是价格的波动，而人生的财富积累根本还是来源于资产价格的投资或投机，人生发财必然是靠康波，康波就是人生的财富规划。</p>
<p>上述对康波的基本认识指出了一个康波的本质，康波在现实中的表现就是康波中的价格波动，所以，康波中的价格波动规律为我们提供了宏观对冲和人生财富规划的密码，本文，就是从康波中的价格波动开始研究。而在研究了长期的价格波动规律之后，本文还对2016至2018年的世界大宗商品价格波动做了预测，相信这是未来三年最重要的机会所在了。</p>
<p><strong>康波周期概述</strong></p>
<p>对康波的早期研究是在19世纪末，俄国人帕尔乌斯已经发现了经济增长中的大体50-60年的长期波动，1913年，荷兰经济学家范·盖尔德林提出经济发展中的大循环，其周期是60年。1919-1922年，苏联经济学家康德拉季耶夫提出了长波假设，发表在《战时和战后时期的世界经济和经济波动》一书中。1924年-1925年他发表了题为《经济生活中的长周期》一文，奠定了康波研究的理论基础。从那时起到二战，是康波研究的活跃期，主要研究重点是统计证明和康波原因的定性分析。而在其后的30年内，康波研究一直沉寂，想来，那是第四波康波的繁荣阶段。1970年代之后，康波的研究再度活跃，而彼时对康波的研究，肯定是源于第四波康波进入了衰退和萧条阶段，1970年代之后的康波研究除了欧美的经济学家弗雷斯特、曼德尔、罗斯托之外，日本在这方面异军突起，最有成就的是筱原三代平。</p>
<p><strong>1.1、有关康波时期的各种划分方法</strong></p>
<p>表1是各个康波研究者对前四波康波的划分，需要注意的是，如果按照繁荣、衰退、萧条、回升这样四个阶段来划分康波，康波的顶指的是衰退期的结束，也就是说，繁荣和衰退是康波的上升期。而康波的谷指的是回升的结束，也就是说，萧条和回升是康波的下降期。从各种划分来看，康波基本上围绕着50-60年的周期循环。</p>
<p><img src="https://pic3.zhimg.com/96f24faa56b4e36166f10fa2d646a112_1440w.jpg" alt="img"></p>
<p>目前受到比较广泛认可的康波划分方法是荷兰经济学家<a href="https://zhida.zhihu.com/search?content_id=2250214&amp;content_type=Article&amp;match_order=1&amp;q=雅各布·范杜因&amp;zhida_source=entity">雅各布·范杜因</a>的划分。在他的划分中列出了有资本主义世界以来前四次康波的四阶段划分，以及标志性的技术创新。从表2中可以看出，第五次康波自1982年起进入回升阶段，1991年之后进入繁荣，而根据我们对康波的理解，我们定位主导国美国繁荣的高点为康波繁荣的顶点，即2000年或2004年。2004年之后，康波进入衰退阶段，而第五波康波的标志性技术创新为信息技术。</p>
<p><img src="https://pic3.zhimg.com/089492bc9a470e39e2a935e9fa390ae2_1440w.jpg" alt="img"></p>
<p><strong>1.2、当前对康波的基本认识</strong></p>
<p>美国的伊斯伯尔丁对康波做了简单而又深刻的描述，这也基本上符合我们对康波的认识：1、每一个康波是指一个相当长时期的总的价格的上升或总的价格的下降。2、价格的长期波动不是自己产生的，而康德拉季耶夫认为这是资本主义体系本质的结果；3、每一个康波又嵌套着几个<a href="https://zhida.zhihu.com/search?content_id=2250214&amp;content_type=Article&amp;match_order=2&amp;q=库兹涅茨周期&amp;zhida_source=entity">库兹涅茨周期</a>和几个朱格拉周期。</p>
<p>康波的研究最初就是一种统计现象研究，支持长波假设的最有力的经验型证据来自价格序列。支持性的证据还可以在长期利率的运动、世界能源生产和创新中发现。有限的证据可以在工业生产、失业和投资中见到。所以，康波的根本问题还是世界资源品价格的长期波动问题，资源品价格又包括商品属性和金融属性两个方面。而这一点也决定了康波就是国际宏观对冲的根本理论。</p>
<p>为什么价格会呈现50-60年的周期波动，目前还是认为这是资本主义自身运动的结果，但到底是什么力量推动了资本主义的长期周期运动，依然没有统一的观点。关于康波根本推动力的理论，目前看有以下几种：1、创新说，即把长波归因于技术革命；2、货币说，即在<a href="https://zhida.zhihu.com/search?content_id=2250214&amp;content_type=Article&amp;match_order=1&amp;q=金本位&amp;zhida_source=entity">金本位</a>下由于黄金产量的变动带来货币量变化，从而带来价格变动；3、新的国家进入世界体系，包含战争革命等因素；4、初级产品及能源的供给限制。在<a href="https://zhida.zhihu.com/search?content_id=2250214&amp;content_type=Article&amp;match_order=1&amp;q=康波推动力&amp;zhida_source=entity">康波推动力</a>的研究中，<a href="https://zhida.zhihu.com/search?content_id=2250214&amp;content_type=Article&amp;match_order=1&amp;q=熊彼特&amp;zhida_source=entity">熊彼特</a>显然是最深远的，他提出了三周期嵌套模式，并且提出了创新导致康波的理论。</p>
<p>所以，康波的根本问题还是世界资源品价格的长期波动问题，资源品价格又包括商品属性和金融属性两个方面。而这一点也决定了康波研究的入手点就是康波中的价格波动。</p>
<p><strong>1.3、康波中的增长与通胀</strong></p>
<p>我们对于康波表象的基本认识，实际上就是康波中增长与通胀的关系。任何的周期的机制，都可以理解为价格对增长的反制，康波也不例外。但是康波中通胀对增长的抑制是十分暴力的，基本上以冲击的形式完成。而且，这种冲击要延续十年以上的时间，期间将经历两次重要的危机阶段。所以，增长与通胀的关系是划定康波阶段的核心问题。而这一点对宏观对冲的意义在于，在康波的框架中，不同阶段增长与通胀的关系是变化的，不是不变的，十年的经验甚至对后十年没有借鉴意义，而必须追溯到50年之前，才能更恰当。</p>
<p>在康波的繁荣阶段，往往高速增长与低通胀伴随，这可以解释为新的技术提高了效率，高增长并没有引发资源约束。而当新的技术对生产率的提升边际递减时，康波就进入了资源约束阶段。这种对康波进入衰退的解释是简单而牵强的，实际上，我们理解当效率降低时，资本主义体系仍然期望按照原有的增长速度运行，这就必然增加了资本投资。与此同时，新的引入资本主义发达体系的国家开始工业化，从而造成了资源需求的边际上升，而以前资源价格低位时供给没有充分准备，从而带来供需边际变化之间短期内不平衡，资源约束启动，价格迅速上升，这一点与<a href="https://zhida.zhihu.com/search?content_id=2250214&amp;content_type=Article&amp;match_order=1&amp;q=资本收益率&amp;zhida_source=entity">资本收益率</a>的下降契合在一起，就发生了经济冲击。在每一个康波的衰退阶段，衰退的前半期都是高增长引发高通胀，而后半期都是滞胀，从衰退期到萧条期总是如此反复。康波从萧条向回升的转换本质上就是从滞胀向通缩的转换，此时经济增速不断下移，商品价格明显回落，通缩成为社会的共识，这个过程，也有十年之久。在衰退后半期，我们都将讨论世界经济陷入一种无奈的状态，对康波的研究也都往往在这个阶段发生。</p>
<p>从康波的形态来看，最复杂的就是衰退阶段，一般来讲，衰退阶段首先都会出现一个标志性的经济危机，比如第四波康波的1971-1973年布雷顿森林货币体系崩溃，2008年美国的次贷危机，事实上都确认了康波进入衰退阶段，而在这个冲击阶段之后，世界都将迎来一个暂时的稳定阶段，即两次冲击之间的<a href="https://zhida.zhihu.com/search?content_id=2250214&amp;content_type=Article&amp;match_order=1&amp;q=间歇期&amp;zhida_source=entity">间歇期</a>，间歇期的结束，一般是以发生新的冲击为标志。而我们看到，往往第二次冲击都更多的会发生在新兴经济体或者资源国，比如第四次康波萧条中陷入悲惨增长的拉美。在两次冲击后，康波进入萧条阶段，此时是一个通缩与滞胀反复的局面。从萧条向回升的过渡是缓慢而且漫长的，大约要经历十年以上的时间，期间，我们可能会看到一些新兴经济体的复兴，比如1980至1990年代的<a href="https://zhida.zhihu.com/search?content_id=2250214&amp;content_type=Article&amp;match_order=1&amp;q=亚洲四小龙&amp;zhida_source=entity">亚洲四小龙</a>，这就发生在第五波康波的回升阶段。</p>
<p>但是从以往的康波形态来看，衰退期和萧条期都表现出极其复杂的状态，特别是进入美元本位制后，货币对康波形态的扰动明显增加，第四波康波的衰退起点目前定在1966年，即美国经济增长的高点，随后出现<a href="https://zhida.zhihu.com/search?content_id=2250214&amp;content_type=Article&amp;match_order=2&amp;q=布雷顿森林货币体系&amp;zhida_source=entity">布雷顿森林货币体系</a>崩溃，属于康波衰退的冲击，但在萧条阶段的9年中，1974和1979年再次发生两次石油危机。萧条期没有表现出明显的通缩，而是长期的滞胀，这显然与货币因素，政治因素都有关系。</p>
<p><img src="https://pic1.zhimg.com/ff54d72cfb952f1be2bce994299ad982_1440w.jpg" alt="img"></p>
<p><img src="https://picx.zhimg.com/ac31a413e5f87a3a7dd90613514deb63_1440w.jpg" alt="img"></p>
<p>（在第四波康波中，实际日本在1971年后就已经出现了严重的通胀局面，日本在1974年石油冲击之后，通胀与增长的反向关系达到极致，但在1974年冲击之后，日本经济走出了明显的V字型反转，这也是经典的康波冲击形态。见《双底演绎-PPI回落后的实体经济和<a href="https://zhida.zhihu.com/search?content_id=2250214&amp;content_type=Article&amp;match_order=1&amp;q=虚拟经济&amp;zhida_source=entity">虚拟经济</a>》，<a href="https://zhida.zhihu.com/search?content_id=2250214&amp;content_type=Article&amp;match_order=3&amp;q=周金涛&amp;zhida_source=entity">周金涛</a>，2008年。）</p>
<p><img src="https://pic2.zhimg.com/5214e0cb10d01ed19508fe55bd08ba65_1440w.jpg" alt="img"></p>
<p>（1966年之后，美国结束了高增长低通胀的局面，而在1966年至1982年，始终处于滞胀状态，这就是康波的衰退与萧条期，1982年之后，美国又进入了高增长低通胀的局面，直到2007年。但2007年后，全球的本质是<a href="https://zhida.zhihu.com/search?content_id=2250214&amp;content_type=Article&amp;match_order=5&amp;q=通缩&amp;zhida_source=entity">通缩</a>，这一点与经典的康波是一致的，但这并不等于说，本次康波将在通缩的局面中结束。）</p>
<p><img src="https://pic3.zhimg.com/7d5cf161b5f79c9972ecd296e1eed24e_1440w.jpg" alt="img"></p>
<p>（从产能利用率上可以清晰的看到，1983年是产能利用率的低点，也是康波萧条的结束和第五波康波复苏的开始。）</p>
<p><strong>康波中的价格现象</strong></p>
<p>对康波中的价格现象认识最为深刻的当属罗斯托，当然最终在判断第五波康波的时候他也犯了错误。<a href="https://zhida.zhihu.com/search?content_id=2250214&amp;content_type=Article&amp;match_order=3&amp;q=罗斯托&amp;zhida_source=entity">罗斯托</a>用<a href="https://zhida.zhihu.com/search?content_id=2250214&amp;content_type=Article&amp;match_order=1&amp;q=价格运动&amp;zhida_source=entity">价格运动</a>来解释康波，他认为形成长期波动的基本原因在于粮食和初级产品的相对丰裕和匮乏。他认为三种力量即增长的领先部门，粮食与原材料的价格，国际和国内人口迁移是研究康波的关键。这一认识的分支是太阳黑子学说，因为太阳黑子的变化导致了气候的变化，从而导致初级产品价格波动，现在看来，这个分支对研究农业和石油的价格波动具有重要意义。</p>
<p><strong>2.1、康波中的价格现象</strong></p>
<p>罗斯托在他的《为什么穷者变富了而富者富的慢了？》一书中写到“在第一个康波上升时期，在英国，价格上涨趋势有66%发生在1799和1801年；在第二个上升时期，价格上涨有71%发生在1852年和1854年；在第三个个上升时期，价格上涨有57%发生在1898年和1900年；在1973到1975年，世界经济经历了这样一种痉挛式的上升。罗斯托注意到在康期波动的顶点，物价在三年中猛涨60-70%乃至两倍这一现象，并主张对这种现象应当从实物方面进行分析而不是从货币方面进行分析。</p>
<p>对于康波而言，价格的剧烈波动是其有别于其他周期的重要特征，而这种价格的剧烈波动主要集中于从衰退到萧条的阶段，罗斯托的观察描述了这种康波价格波动的基本特征，即价格的波动在一个很短的时间内急剧放大，从而最终对经济造成冲击，这实际上就是所谓的康波衰退的冲击，而这种冲击一般集中于康波衰退期，但在第四波康波中，冲击贯穿于整个衰退和萧条。</p>
<p><img src="https://pic4.zhimg.com/a5cb29bd17dc551ba25b75a6bb13d27b_1440w.jpg" alt="img"></p>
<p><img src="https://picx.zhimg.com/6268d337311f71abd03a74ae2fe51281_1440w.jpg" alt="img"></p>
<p><img src="https://pica.zhimg.com/32a239caaed91ed2d58572d6ad548136_1440w.jpg" alt="img"></p>
<p><img src="https://pic3.zhimg.com/8ecad2a4620124033a5603562dce8d9c_1440w.jpg" alt="img"></p>
<p>这里的核心问题是，到底是什么造成了康波价格的突然上行，目前的解释集中在三个原因，第一是创新的原因，即罗斯托说的主导部门问题，由于新的技术发明对劳动生产率的提升作用在繁荣的高潮期开始削减，造成了增长更多的依赖投资，从而造成价格上涨，这是一个常见的<a href="https://zhida.zhihu.com/search?content_id=2250214&amp;content_type=Article&amp;match_order=1&amp;q=供需解释&amp;zhida_source=entity">供需解释</a>。第二是关于追赶国的工业化问题，由于新的国家的工业化加入了世界资本主义体系，造成了对资源品边际供需差的突然增加，从而加剧了价格的波动，我们认为这是核心原因；第三，就是关于农业及相关初级材料的丰歉问题，这个问题被有些康波研究者认为是康波价格波动的基础原因，而迄今为止，我们无法以一种完美的理论来解释农业价格波动的原因，而其最有体系的，则是太阳黑子学说。</p>
<p>在第四波康波之后，世界货币本位制彻底与黄金脱钩，此时之后的初级产品价格水平呈现一个中枢不断上移的形态，但目前来看，<a href="https://zhida.zhihu.com/search?content_id=2250214&amp;content_type=Article&amp;match_order=2&amp;q=货币本位制&amp;zhida_source=entity">货币本位制</a>的变化的确改变了价格波动的中枢，但没有改变康波中价格波动的形式。价格中枢的上移是全球脱离金本位之后的结果，但康波认为，价格的波动当以黄金的购买力来衡量，我们用<a href="https://zhida.zhihu.com/search?content_id=2250214&amp;content_type=Article&amp;match_order=1&amp;q=黄金原油价格比率&amp;zhida_source=entity">黄金原油价格比率</a>来间接解释价格的波动，可以看出，黄金原油价格比率一直围绕着中枢波动，这就解释了我们上面的观点。</p>
<p><strong>2.2、康波中商品价格牛熊的原因</strong></p>
<p>关于康波中初级产品价格的解释，罗斯托认为：初级产品部门（含能源、原材料和食品）。生产能力的不足和生产能力的过剩交替过程较长，原因在于这些产品的需求不能平稳发展。其原因在于：1、在获利能力出现之后和为开发它进行投资决策之间存在着长时间的延迟，在开辟新的生产能力上的长时间酝酿；2、在完成投资和最有效的利用之间存在着耽搁。</p>
<p>实际上，大宗商品价格本身也会随着经济中周期和短周期而波动，这是一个比较简单的供需机制问题，而康波对<a href="https://zhida.zhihu.com/search?content_id=2250214&amp;content_type=Article&amp;match_order=1&amp;q=价格研究&amp;zhida_source=entity">价格研究</a>的意义在于，价格机制会在康波繁荣到达顶点之前发生突然变化，即所谓的大宗商品十年牛市，而在十年牛市之后，又会出现一个价格剧烈波动的熊市阶段，这个熊市一般贯穿于康波的衰退和萧条，主要下跌阶段维持15年。在大宗商品牛市和熊市阶段中增长与通胀表现出迥异于以往的特征，从而过去十年价格的波动特征，不一定适用于未来十年，必须在<a href="https://zhida.zhihu.com/search?content_id=2250214&amp;content_type=Article&amp;match_order=1&amp;q=大周期&amp;zhida_source=entity">大周期</a>格局下理解短期的价格波动，这才是研究康波价格的根本意义。</p>
<p>至于为什么供需之间的边际突然拉大，这应该被视为一个积累的结果，因为从大的格局看，在从康波的回升到繁荣的过程中，总体来看价格是处于稳定状态的，周期研究认为，这是由于技术创新推动效率的提升，而当效率提升放缓时，为了保持原有的增速就需要更多的依赖投资，供需的原有平衡边际上发生了变化。从图中可以看出美国<a href="https://zhida.zhihu.com/search?content_id=2250214&amp;content_type=Article&amp;match_order=1&amp;q=全要素生产率&amp;zhida_source=entity">全要素生产率</a>的增长在2003年达到高点，而2002年之后，正是本轮大宗商品牛市的启动点。</p>
<p><img src="https://pic2.zhimg.com/3efdd8b619105c165f51a004f62b8e25_1440w.jpg" alt="img"></p>
<p><img src="https://pic1.zhimg.com/621a5716d13300720a74f5b63788ccee_1440w.jpg" alt="img"></p>
<p>（在第四波康波中，美国的全要素生产率在1966年附近到达高点，这正是康波繁荣的顶点，也是最后价格波动的起点，在经历了波动之后，全要素生产率的低点出现在1982年，即第四波康波萧条的结束点。）</p>
<p>还有一个问题，就是所谓的长鞭效应，由于上游资源品处于供应链的最末端，其波动性是最大的。</p>
<p><strong>（长鞭效应（bullwhip effect））</strong></p>
<p>“长鞭效应”其基本思想是：当供应链上的各节点企业只根据来自其相邻的下级企业的需求信息进行生产或者供应决策时，需求信息的不真实性会沿着供应链逆流而上，产生逐级放大的现象。当信息达到最源头的供应商时，其所获得的需求信息和实际消费市场中的顾客需求信息发生了很大的偏差。由于这种<a href="https://zhida.zhihu.com/search?content_id=2250214&amp;content_type=Article&amp;match_order=1&amp;q=需求放大效应&amp;zhida_source=entity">需求放大效应</a>的影响，供应方往往维持比需求方更高的库存水平或者说是生产准备计划。</p>
<p><img src="https://pic2.zhimg.com/438bd9d2c3034b97bc04617f78a19edf_1440w.jpg" alt="img"></p>
<p>但是在70年代之后，世界开始变得尤其复杂，第五波康波出现了明显的全球化特征，更多的要用共生模式来解释，从而世界的低通胀主要靠共生模式中中国的低成本来承担，这是在2010年代流行的一种<a href="https://zhida.zhihu.com/search?content_id=2250214&amp;content_type=Article&amp;match_order=5&amp;q=低通胀&amp;zhida_source=entity">低通胀</a>的解释，但当2012年大宗商品出现牛市头部之后，虽然全球的共生模式依然存在，但世界经济进入通缩的趋势已经非常明显，这里面的核心问题是，全球化分工并不改变周期的秩序，自英国工业化以来，就不断有新的国家和人口被纳入资本主义体系，但这并不改变周期波动的本质，从康波意义上讲，更多的人口加入资本主义体系之后，波动不是减小了，反而是放大了。</p>
<p><img src="https://pic1.zhimg.com/74e56ff99c2e4b3a646ec246a4d2f292_1440w.jpg" alt="img"></p>
<p><strong>2.3、康波衰退和萧条期的滞胀和通缩</strong></p>
<p>第五波康波以来，目前并没有出现类似第四波康波的滞胀问题，而是表现出明显的通缩特征，这是需要讨论的。而这一点的解释对我们判断未来中期的价格形势非常重要。为了研究这个问题，我们努力寻找高频的价格序列，但现在来看，最有代表性的长序列还是美国的CPI，美国的CPI和PPI长期来看是一致的，所以我们以康波划分美国的CPI趋势，得到的结论是很有意义的。</p>
<p><img src="https://pic2.zhimg.com/c1bf10369c488bb5c53c20ea80612619_1440w.jpg" alt="img"></p>
<p>从图的结论来看，1、康波的繁荣期100%概率是价格的平稳期；2、康波的回升期三次中有两次价格平稳；3、康波的衰退期价格100%剧烈波动；4、康波的萧条期100%都是冲高回落。这个研究的意义在于，我们正处在衰退即将结束，向第五波<a href="https://zhida.zhihu.com/search?content_id=2250214&amp;content_type=Article&amp;match_order=4&amp;q=康波萧条&amp;zhida_source=entity">康波萧条</a>过渡的阶段，而当前全球都处于货币大量释放后的通缩阶段，康波的规律向我们预示了，目前处于5年价格低点的概率非常高，未来5年，我们研究的重点不是如何防范通缩，而是如果应对滞胀。</p>
<p><strong>康波中的能源和有色金属</strong></p>
<p><strong>3.1、康波中的能源问题</strong></p>
<p>1983年，日本经济学家木船久雄在他的著作《<a href="https://zhida.zhihu.com/search?content_id=2250214&amp;content_type=Article&amp;match_order=1&amp;q=经济的长期波动与能源&amp;zhida_source=entity">经济的长期波动与能源</a>》中研究了康波中的能源问题，他研究了日本和美国的<a href="https://zhida.zhihu.com/search?content_id=2250214&amp;content_type=Article&amp;match_order=1&amp;q=一次能源&amp;zhida_source=entity">一次能源</a>供给对国民生产总值的弹性值，并得出了几个结论。</p>
<p><strong>1、从超长期来看，弹性值集中于1。</strong>在约100年的时间内，尽管出现了重大的产业和社会结构变革，但作为<a href="https://zhida.zhihu.com/search?content_id=2250214&amp;content_type=Article&amp;match_order=1&amp;q=生产要素&amp;zhida_source=entity">生产要素</a>和作为家庭最终消费品的能源消费合计增长率基本上与收入增长率相近似。2、从长期看，虽然弹性值集中于1，但仍有一定的波动，受到很大的干扰。按计测期间来计算，日本是在1947年到1954年间，美国是从1933年到1940年间，弹性值波动都很大。两国弹性值受干扰的时期均出现经济增长水平的急剧下降。3、经济增长率即使发生变化，<a href="https://zhida.zhihu.com/search?content_id=2250214&amp;content_type=Article&amp;match_order=1&amp;q=能源消费结构&amp;zhida_source=entity">能源消费结构</a>瞬间并不能适应这种变化而变化。经济增长率下降及其后的数年间，能源弹性值仍呈上升趋势，而形成适应低速增长率的能源消费结构后数年，增长率开始回升，弹性值进入下降局面而形成谷底。</p>
<p>我们观察美国的长期一次能源供给对国民生产总值的弹性值，美国两次弹性值超过1，且与国民生产总值趋势产生背离的阶段，一次是在1911到1922年，一次是在1972年到1976年，这两次都是处于长波的繁荣向衰退转换的过程中，在后一次，美国的核心CPI直到1980年才见到最高点，因此也许<a href="https://zhida.zhihu.com/search?content_id=2250214&amp;content_type=Article&amp;match_order=1&amp;q=第二次石油危机&amp;zhida_source=entity">第二次石油危机</a>的发生只能够更多的被解释为偶然因素。</p>
<p>但是，我们需要理解的为什么在经济衰退之后依然出现一定时期的能源价格上涨呢，这个就存在着能源消费的惯性规律问题。对此，<a href="https://zhida.zhihu.com/search?content_id=2250214&amp;content_type=Article&amp;match_order=2&amp;q=木船久雄&amp;zhida_source=entity">木船久雄</a>解释道“日本即使在石油危机之后，尽管能源价格发生了变化，但是，战后近30年培植起来的多耗能产业和消费结构也难以因价格变化而急速转换。1960年代末到1978年前后，日本弹性值超过1，正是由于这一时期是带有前一时期余韵的惯性时期。相反，弹性值有下降趋势时，情况亦相同”。</p>
<p><img src="https://pic4.zhimg.com/80e9ccc9db488c968bca3128eeaaa8e9_1440w.jpg" alt="img"></p>
<p><img src="https://pic2.zhimg.com/67e93cf3fcac48d3cd58a106def26fd7_1440w.jpg" alt="img"></p>
<p><img src="https://picx.zhimg.com/1cb74f51b0d2af8fae0376c183455bd1_1440w.jpg" alt="img"></p>
<p>（2000年之后，美国的能源消耗增速是下降的，而石油的价格是上涨的，所以，不能用当期供需来解释价格的长期波动的原因，这是我们一贯的观点，能源价格的波动，是一个长期累积的结果。）</p>
<p>上面只是静态的看已经完成工业化国家的情况，对康波资源价格影响最大的是追赶国的工业化，这就是所谓的当年流行的金砖四国理论的根基。追赶国在康波的繁荣后期至衰退期进入工业化起飞阶段，这是一个康波中的重要现象，包括第四波康波中工业化的日本和第五波康波中工业化的中国，都具有类似的情况。从工业化过程中的能源消耗来看，一般认为工业化起飞国家的能源消耗会呈现出一个倒U型的结构，在其边际爬升的时候，对资源价格影响最大。从第四波日本的工业化可以看出，日本工业化经济增速的高点在1964年，其一次能源消耗的同比增长率高点滞后三年在1967年出现，而彼时第四波康波资源牛市刚刚启动，四年后布雷顿森林货币体系崩溃视为第四次康波衰退的第一次冲击，1974年发生第一次石油冲击的时候（1974年第一次石油危机是康波衰退的第二次冲击，是衰退的结束），日本的一次能源消耗的同比增速早已回落，所以，我们一直认为，康波资源牛市是一个累积的结果，当期供需并不是核心原因。</p>
<p><img src="https://pic1.zhimg.com/65f9d52fab9322a90c2f03fb9e4d7fbe_1440w.jpg" alt="img"></p>
<p><img src="https://pic1.zhimg.com/81084884145752ea63f22315d8fda238_1440w.jpg" alt="img"></p>
<p>从第五波康波中工业化起飞的中国来看，中国一次能源消费增速从1998年开始启动，而这正好是中国的中周期低点附近，可以看到，中国一次能源增速高点是在2004年，正好是中国固定资产投资的高点，而随后开始增速回落，但资源价格牛市的冲击是发生在2007-2008年，恰好也在4年之后，由此可见，资源价格的冲击是一个累积的结果，而且也正好体现出了木船久雄所提出的能源结构调整的滞后性问题。巧合的是，我在2006年发表了《色即是空》，提出了这一思想，那是我们康波研究的肇始。</p>
<p><img src="https://pic1.zhimg.com/dd431f549c37be9096401a4914d4266c_1440w.jpg" alt="img"></p>
<p>从能源冲击的角度看，康波中的能源冲击是一个累积的结果，是<a href="https://zhida.zhihu.com/search?content_id=2250214&amp;content_type=Article&amp;match_order=3&amp;q=劳动生产率&amp;zhida_source=entity">劳动生产率</a>下降，长鞭效应和追赶国工业化的共同结果，但这一框架仅适用于分析冲击阶段。作为短期的能源波动分析而言，我们发现，能源消费增速遵从于朱格拉周期，所以短期的能源价格波动是与经济增长率相关的，而康波中的能源价格波动显然是要遵从我们上面提出的框架。</p>
<p><strong>3.2、康波中的工业金属</strong></p>
<p>从康波中大宗商品价格波动的原理来看，能源与工业金属是一致的，所以，在阐述了能源问题之后，我们这里只将工业金属价格与能源价格做对比，来研究工业金属价格波动与能源价格波动的差异性。</p>
<p>总体趋势来看，工业金属（铜、铅、锌）价格走势与能源（石油）价格走势呈现较强的一致性。繁荣期（1991-2004年）是价格波动的稳定期，价格的剧烈波动主要集中在衰退（2005-2015年）和萧条期，符合康波中大宗商品价格波动的特征。周期研究认为：价格的波动是效率边际变化与供需平衡重构的结果。当技术创新刚被引入带来效率提升，较少的投入可以提供足额的产出，但当效率提升放缓时，为了保持原有的增速就需要更多的依赖投资，这种势必将打破原有的平衡关系，使得供求发生较长时间的重构。这种长时间的重构也进一步解释了工业金属和能源在更短周期里的不一致性。</p>
<p>值得注意的是，90年代之前，工业金属价格与能源的价格波动关联度较小。从20世纪下半页石油价格的历史梳理来看，在70年代才形成OPEC<a href="https://zhida.zhihu.com/search?content_id=2250214&amp;content_type=Article&amp;match_order=1&amp;q=供给侧&amp;zhida_source=entity">供给侧</a>寡头垄断，在此之前石油的定价权完全掌握在英美石油公司手中。直到90年代之后，期货与金融因素对于油价的影响逐渐加大，最终产生了由OPEC、石油需求和国际石油资本共同决定的局面，至此，国际油价才基本实现市场定价。这也回答了为什么在90年代之前，能源价格波动幅度较小，并且与工业金属价格波动关联度偏低。</p>
<p><img src="https://pic2.zhimg.com/c64f492e0ba5597e11309f0a22b43d6b_1440w.jpg" alt="img"></p>
<p><img src="https://pic1.zhimg.com/599560f14c1a687350fc2eb02c44fd04_1440w.jpg" alt="img"></p>
<p><img src="https://pic4.zhimg.com/a7eade63cd956cd7d58d8102ac7145e3_1440w.jpg" alt="img"></p>
<p><strong>康波中的农业和太阳黑子</strong></p>
<p>在早期的康波研究中，农业一直是一个重要研究对象，英国统计学家海德·克拉克在1847年就发现了以54年为周期的欧洲的<a href="https://zhida.zhihu.com/search?content_id=2250214&amp;content_type=Article&amp;match_order=1&amp;q=饥馑&amp;zhida_source=entity">饥馑</a>的长期波动。这里面最杰出的是威廉·S·杰文斯，他在论文《<a href="https://zhida.zhihu.com/search?content_id=2250214&amp;content_type=Article&amp;match_order=1&amp;q=商业危机和太阳黑子&amp;zhida_source=entity">商业危机和太阳黑子</a>》中推定平均为10.45年的<a href="https://zhida.zhihu.com/search?content_id=2250214&amp;content_type=Article&amp;match_order=8&amp;q=太阳黑子&amp;zhida_source=entity">太阳黑子</a>活动周期。但到了1970年代第四次康波研究高潮的时候，农业几乎成为一个十分边缘的问题，这一定与工业化社会农业对经济影响的弱化有关。农业与其他资源品相比的特殊性在于他的供给受到天气的极大影响，所以，农业价格的研究逻辑一直十分重视太阳黑子运动。我们也试图观察了长期的农业价格波动序列，但从直观的统计数据来看，农业价格并未表现出明显的长周期波动特点，反而倒是受到施瓦贝循环的直接影响，所以，目前证据无法证明农业价格存在着与康波同步的波动。</p>
<p><strong>4.1、太阳黑子周期与康波</strong></p>
<p>如果我们将世界看作是广泛联系的，与康波的三周期嵌套模式最为类似的就是<a href="https://zhida.zhihu.com/search?content_id=2250214&amp;content_type=Article&amp;match_order=2&amp;q=太阳黑子周期&amp;zhida_source=entity">太阳黑子周期</a>，太阳黑子周期最显著的影响是通过影响气候来影响农产品的产量，这是其与康波周期最直接的联系，但事实上，进入工业化社会之后，农产品价格对周期的中长期趋势的影响远没有那么显著，但周期理论的一个重要分支确实对太阳黑子对<a href="https://zhida.zhihu.com/search?content_id=2250214&amp;content_type=Article&amp;match_order=3&amp;q=三周期嵌套模式&amp;zhida_source=entity">三周期嵌套模式</a>的影响有着深入的研究。研究者认为，除了农产品价格之外，太阳黑子以一种未知的原因影响着人类的情绪和商业行为，从而成为周期的天道中的决定因素。</p>
<p>前人对太阳黑子活动的周期性研究，将太阳黑子活动划分为以下几个周期：厄尔尼诺循环（2-7年）、黑子周期（施瓦贝循环、11年）、磁活动周期（<a href="https://zhida.zhihu.com/search?content_id=2250214&amp;content_type=Article&amp;match_order=1&amp;q=海耳定律&amp;zhida_source=entity">海耳定律</a>、22年）、吉村循环（55年）。国际天文学界以1755年3月为太阳黑子活动周元年，至今已经历23个完整的黑子周期和4个吉村循环。</p>
<p><img src="https://pic3.zhimg.com/6de985a9ac7ccfbc8ef8a4a416da77bc_1440w.jpg" alt="img"></p>
<p>自2008年3月至今的第24周已历83月，目前处于第5个大周期的第四个小周期内，从月度黑子数据来看，最大值较历史均值偏低，说明本轮黑子周期相对较弱。</p>
<p><img src="https://picx.zhimg.com/ebc5c88b4e4e8ba3508cccb6cce399c5_1440w.jpg" alt="img"></p>
<p>从太阳黑子的周期循环来看，基本对应了四周期嵌套模式的各个周期级别。厄尔尼诺循环（2-7年）大致对应库存周期、施瓦贝循环（11年）大致对应<a href="https://zhida.zhihu.com/search?content_id=2250214&amp;content_type=Article&amp;match_order=5&amp;q=朱格拉周期&amp;zhida_source=entity">朱格拉周期</a>、海耳循环（22年）大致对应库兹涅茨周期、吉村循环（55年）大致对应康德拉季耶夫周期。从太阳黑子与景气的关系来看，大致太阳黑子的低谷期对应经济周期的高潮期，至于其中奥妙，只能用天道解释了。</p>
<p><img src="https://picx.zhimg.com/ff06a6e303e8d276f0725163a102eb65_1440w.jpg" alt="img"></p>
<p><strong>4.2、农产品价格的周期属性</strong></p>
<p>根据我们的研究，农产品价格实际上并不显著遵循长周期波动，反而与施瓦贝循环（11年）有着较强的关系，这一点我们将在后面的农产品价格中谈到。当然在康波价格波动的高潮期，农业价格也表现出波动放大的特点，例如在70年代石油危机和2007年金融危机前后，但这显然不是由天气造成的农业价格波动，从而仍是一种需求角度的原因，从这个角度看，农业并未表现出因天气影响供给从而影响长周期价格波动的特点，也就是说，农业供给不是康波波动的原因。天气对农业价格波动的影响可能更多的属于施瓦贝循环的级别，而在一个施瓦贝循环中，<a href="https://zhida.zhihu.com/search?content_id=2250214&amp;content_type=Article&amp;match_order=4&amp;q=厄尔尼诺循环&amp;zhida_source=entity">厄尔尼诺循环</a>带来农业价格的短周期波动。</p>
<p>太阳黑子活动施瓦贝循环和厄尔尼诺循环与全球农产品价格表现出强相关性。我们将1866年起的太阳黑子活动数据与玉米、大豆、食糖和小麦的价格波动相比，发现了非常显著的负相关关系，即黑子较多、活动频繁的时候，由于气候相对温暖湿润，往往大宗农产品产量增长，价格加速下跌；而黑子较少时，往往对应着该段时间内农产品产量的低点，价格有上扬趋势。</p>
<p><img src="https://pica.zhimg.com/1710d732099e791e88c89274949f1a6e_1440w.jpg" alt="img"></p>
<p><img src="https://pica.zhimg.com/67c3b2051c9419522d85da87c0ae40b8_1440w.jpg" alt="img"></p>
<p><img src="https://pic2.zhimg.com/823a83b7da8828df29c18dcf8c1a7eff_1440w.jpg" alt="img"></p>
<p><img src="https://pic1.zhimg.com/b2bb292ee088512f596100958fb9e280_1440w.jpg" alt="img"></p>
<p><img src="https://pic2.zhimg.com/9de1cdb6b09fcd82b015941e235e7931_1440w.jpg" alt="img"></p>
<p>从第四波康波来看，农业价格的下降在1964年达到低点，从<a href="https://zhida.zhihu.com/search?content_id=2250214&amp;content_type=Article&amp;match_order=1&amp;q=南方涛动&amp;zhida_source=entity">南方涛动</a>指数来看，1972-1973年出现了厄尔尼诺，歉收推动了农产品价格上涨，而随后发生两次石油危机和大宗商品价格上行，1982-1983年，发生超强厄尔尼诺，将农产品价格推向高峰。但是，第五波康波中，1997年至1998年超强厄尔尼诺并没有带动价格上行，反而是在2000年后没有发生超强厄尔尼诺的情况下出现商品牛市，从这个角度看，太阳黑子运动确实不是农产品价格的长周期推动力量，其更多的是影响短周期价格波动问题。</p>
<p><img src="https://pic3.zhimg.com/22ec5a24eb02c6dca61fb9f20ba32c54_1440w.jpg" alt="img"></p>
<p><strong>康波中的黄金</strong></p>
<p>在康波中，黄金作为货币，其<a href="https://zhida.zhihu.com/search?content_id=2250214&amp;content_type=Article&amp;match_order=1&amp;q=价格理论&amp;zhida_source=entity">价格理论</a>上是与大宗商品的总体走势一致的，但事实也并非如此，黄金与货币脱钩之后，这个关系变得复杂。最核心的变化是，黄金虽然不再是货币，但依然有货币属性，当货币体系发生动荡时，黄金的价格变化则表现出明显的独立走势，显示出黄金的信用特征。</p>
<p>货币体系金本位直至<a href="https://zhida.zhihu.com/search?content_id=2250214&amp;content_type=Article&amp;match_order=1&amp;q=金汇兑本位制&amp;zhida_source=entity">金汇兑本位制</a>瓦解之后，黄金的价格开始波动加大，从1967年开始，黄金价格大幅波动，这实际上都是黄金的<a href="https://zhida.zhihu.com/search?content_id=2250214&amp;content_type=Article&amp;match_order=1&amp;q=名义价格&amp;zhida_source=entity">名义价格</a>。全球黄金的需求在很大程度上受到投资需求变化的左右，投资需求的变化主要受通胀率、美元汇率、避险需求三个因素的影响，所以，黄金价格最终还是由其货币属性所决定。Erb and Havey的研究发现，历史上黄金价格与美国CPI的<a href="https://zhida.zhihu.com/search?content_id=2250214&amp;content_type=Article&amp;match_order=1&amp;q=定基指数&amp;zhida_source=entity">定基指数</a>的比率为3.2倍，这可以视为是黄金购买力的均值，成为黄金常数。剔除美国的通胀率后，可以得出黄金的实际价格的长期走势，从实际价格趋势看，黄金的价格围绕着这一中枢波动，而波动的特征与康波中的价格波动一致，这就是说黄金理论上就是大宗商品的一般等价物。</p>
<p><img src="https://pic4.zhimg.com/cff2434caf228d5dd61a1e940c72fdc3_1440w.jpg" alt="img"></p>
<p><img src="https://picx.zhimg.com/b0786f6910cdeebb10b9d80a9bf0f60b_1440w.jpg" alt="img"></p>
<p><img src="https://pic2.zhimg.com/88b8de54e7ce82fd697abea6d5c495bb_1440w.jpg" alt="img"></p>
<p><img src="https://pica.zhimg.com/f0641119606437b24053191bf1462998_1440w.jpg" alt="img"></p>
<p>除此之外，黄金作为康波中的货币，对其购买力的检验是其相对其他大宗商品的价格比率，在这方面，黄金-原油价格比率是广泛应用的指标。根据Salesman（2013）年的研究，自1971年美元与黄金脱钩以来，黄金的美元价格与原油的美元价格保持着很强的相关性，在<a href="https://zhida.zhihu.com/search?content_id=2250214&amp;content_type=Article&amp;match_order=1&amp;q=布雷顿森林体系&amp;zhida_source=entity">布雷顿森林体系</a>下，黄金原油的兑换比例大致为每盎司黄金兑换12.3桶原油。而当前兑换比率为14.3桶。当黄金原油的价格显著脱离这一趋势后，该比率会向这一水平回归，而且主要是靠原油的价格而非黄金的价格的波动来回归。同样的研究也把这一比率基本定位于每盎司黄金兑换10-15桶之间。</p>
<p><img src="https://pica.zhimg.com/9734ca9863fddde696a02c4c2fc4bfca_1440w.jpg" alt="img"></p>
<p>解释完黄金的康波货币属性之后，问题的关键还是要看黄金脱离其中枢的原因，黄金对通胀率的脱离和其对黄金原油比率的脱离是两个问题。黄金对通胀率的脱离，实际上就是所谓的<a href="https://zhida.zhihu.com/search?content_id=2250214&amp;content_type=Article&amp;match_order=1&amp;q=吉布森悖论&amp;zhida_source=entity">吉布森悖论</a>，即将扣除通胀后的实际利率当做持有黄金的<a href="https://zhida.zhihu.com/search?content_id=2250214&amp;content_type=Article&amp;match_order=1&amp;q=机会成本&amp;zhida_source=entity">机会成本</a>，实际利率走低则黄金价格向上。从图中可以看出，在康波的萧条，回升及衰退阶段，黄金价格与实际利率的负相关真实存在，但在繁荣期，这种关系基本不存在，甚至相反，这实际上就是康波中不同阶段大宗商品的表现不同所致。</p>
<p><img src="https://pic1.zhimg.com/669979ee6542de8a7d6426dce6702b4a_1440w.jpg" alt="img"></p>
<p>关于黄金价格对商品购买力的波动，本质上讲不完全是康波问题，更可能是冲击因素所导致，包括商品自身的冲击因素和黄金价格的冲击因素，但从现有数据来看，黄金在大波段方面表现出了与大宗商品的滞后性特征，比如在2004年到2007年，显然黄金是落后于大宗商品的，我们认为这与<a href="https://zhida.zhihu.com/search?content_id=2250214&amp;content_type=Article&amp;match_order=1&amp;q=黄金的货币属性&amp;zhida_source=entity">黄金的货币属性</a>有关系，因为在康波衰退的前半期，主要表现为大宗商品价格的冲击，而在此之后，黄金涨幅超越大宗的原因可能在于几个原因，其一、货币体系动荡，避险情绪的出现；其二，由于货币宽松带来的实际利率的走低。这些都可能是黄金超越大宗商品总体的原因。但可以推测的是，由于在整个萧条期实际利率的走低可能是一个大方向，未来黄金对大宗商品的超越依然还会存在。</p>
<p><img src="https://pic1.zhimg.com/ae3268c0a3004a64811ff5c556983370_1440w.jpg" alt="img"></p>
<p><img src="https://picx.zhimg.com/f2526372c2733d562416b467d5fbe4ed_1440w.jpg" alt="img"></p>
<p><img src="https://pic1.zhimg.com/72d314ca023865144e7064f69e089862_1440w.jpg" alt="img"></p>
<p><img src="https://pic2.zhimg.com/34571c24d0725e732e300481aad76861_1440w.jpg" alt="img"></p>
<p><strong>第五次康波的价格波动</strong></p>
<p><strong>6.1、关于第五次康波周期的研究</strong></p>
<p>关于第五次康波的研究，我们从2006年开始就一直在进行，2006年我们发表了《色即是空》，用长周期及其嵌套理论解释当时的大宗商品牛市。2007年我们发表了《国际化博弈》，摘要中指出“当前的中国经济所面临的世界经济环境与70年代初期的本质相似性在于，以美国经济为中心的世界经济共生模式面临着美国信用的危机，而这种危机在次贷危机，全球通胀的推动下极有可能进一步压缩<a href="https://zhida.zhihu.com/search?content_id=2250214&amp;content_type=Article&amp;match_order=1&amp;q=美国货币政策&amp;zhida_source=entity">美国货币政策</a>的调控空间，而由此显现出的国际金融动荡的趋势可能被美国经济减速的进程所左右，这一点将是2008年决定全球资本市场走势的根源”，成功判断了康波衰退的到来。</p>
<p>2008年我们发表了《走向成熟》，指出康波冲击最剧烈的阶段已经过去，中国经济将出现V字反转。随后发表了《资源约束、<a href="https://zhida.zhihu.com/search?content_id=2250214&amp;content_type=Article&amp;match_order=1&amp;q=信用膨胀&amp;zhida_source=entity">信用膨胀</a>与美元币值-长波中的增长与通胀》，对康波第一次进行了系统性的论述。2009年之后，我们一直把精力集中于<a href="https://zhida.zhihu.com/search?content_id=2250214&amp;content_type=Article&amp;match_order=1&amp;q=房地产周期&amp;zhida_source=entity">房地产周期</a>和库存周期研究。</p>
<p>2011对第五次康波衰退是一个重要关口，本次康波商品牛市的第二个头部在2011年二季度出现。而此时，根据我们对美国房地产周期的跟踪，我们确认2011年三季度美国房地产周期启动。2011年12月15日，我们发表了《美元破百，冲击中国》指出：长波创新周期中，主导国货币与其他货币强弱关系会呈现周期波动，波长约为 15 年。一个长波包含 3 个货币周期。2012 年开始，美国中周期力量恢复。在中、短周期力量促使下，经济上行。同时，利用周期理论，可以判断出世界经济格局美强欧弱。美元指数升值的经济基础已经具备，欧元将在未来下跌20%以上，从而导致美元指数突破100。 2014年下半年之后，我们判断伴随着美元指数的上行，大宗商品的暴跌，世界经济可能进入康波衰退二次冲击的阶段，世界经济将出现动荡加剧的景象。（《康波衰退二次冲击正在靠近》，2014年10月）</p>
<p><strong>6.2、关于第五次康波周期中的价格波动</strong></p>
<p>第五波康波的大宗商品牛市起始于2001年至2002年之间，而美国GDP增长的最高峰是在2000年，按照康波的划分，2000年或者2002年之后，就可以划分为第五波康波的衰退阶段了，2002年之后，大宗商品经历了一个长达10年的牛市，其中2008年可以视为大宗商品牛市的第一头部，2011年视为大宗商品牛市的第二头部，从康波大宗商品牛市的形态上看，我们可以确认本轮康波大宗商品牛市的终结。自2012年之后，大宗商品一直在熊市中运行，至2015年中期已经4年半的时间，这就是对当前大宗商品价格运行的基本定位。但是，问题的复杂性在于，大宗商品的熊市会表现出什么样的走势，这是当前和未来商品价格研究中长期的核心问题。</p>
<p><img src="https://pica.zhimg.com/f9b3b72b08cac024506a826263539a6c_1440w.jpg" alt="img"></p>
<p><img src="https://pic3.zhimg.com/735562a249cc0e2389107a9b3e967fe2_1440w.jpg" alt="img"></p>
<p>（本图周期定位是以康波划分为萧条，回升，繁荣，衰退四个阶段，可以发现，2002年大宗牛市启动，2008年和2011年分别出现双头，随后步入熊市。）</p>
<p>2002年或者2004年之后，康波已经确认了从繁荣向衰退的转换，而经历了2008年的康波一次冲击之后，2015年之后康波应进入二次冲击阶段并向萧条转换，详见《康波二次衰退正在靠近》。有一个结论是可以肯定的，即衰退和萧条的连接点一定是一个康波大宗商品价格的最低点，这一点为前五波康波的价格形态所证明。从前三波康波的价格形态来看，表现出了很明显的古典周期的波动形态，而第四波康波之后，表现出了<a href="https://zhida.zhihu.com/search?content_id=2250214&amp;content_type=Article&amp;match_order=1&amp;q=增长型周期&amp;zhida_source=entity">增长型周期</a>的波动形态，这与世界经济的历史趋势相吻合。所以，可以肯定的是，第五次康波衰退向萧条转换的位置，应是一个大宗商品价格的长期低点，而对于本次康波来讲，必然是一个增长型周期，所以我们不必期望商品价格可以回到2001年的低点，而是要根据供需边际及货币环境对低点的价格进行评估，这是我们未来需要继续深入研究的问题。</p>
<p>（前三次康波的价格波动都是古典型周期，第四波康波是增长型周期，除了第四波之外，前三次衰退与萧条的转换点都是价格低点，我们推测，第五次康波衰退与萧条的转换时点大致在2016至2018年之间。）</p>
<p><img src="https://pic2.zhimg.com/db9bd9c044c30fd0e91bfa9ea0eab0f7_1440w.jpg" alt="img"></p>
<p><strong>6.3、关于大宗商品的中级反弹</strong></p>
<p>从历史的康波价格运行来看，萧条期的开始必然是一个价格反弹的过程，所以，这里一个非常重要的问题，就是我们这次康波衰退向萧条的转换点在哪里，这也就是对商品价格最终低点的确认过程。关于这个问题，我们有如下推测。从一般康波的划分机制来看，衰退与萧条的转换点应划分在中周期的低点之上，作为本次康波衰退而言，衰退与萧条的转换点应推测在2018年。但是，以周期的双底结构来看，在终极低点之前，应该出现一个一次探底的过程，这个过程显然以现在的世界经济周期运动状态来看，应该在2015年四季度至2016年上半年之间，恰好，在这个位置出现了商品价格的下跌。那么在2016至2018年之间，理论上会出现一次超跌反弹的过程，这个过程可以进一步探寻其理由。</p>
<p>康波中大宗商品熊市的形态是非常复杂的，由于数据的可得性，我们最多可以研究第四波康波衰退后的大宗商品价格，而第三波康波衰退后的大宗商品熊市形态，只能用美国的部分长数据系列替代研究。严格意义上，第四波康波大宗商品熊市是从1980年第二次石油危机之后开始的，这一过程一直持续到2002年结束，历时22年，这22年期间，我们可以清晰的发现，虽然大宗并未出现康波意义上的牛市行情，但是，从中周期的意义上看，每轮中周期大宗商品都会出现一次波段行情，而就这几个样本看，这个行情大概率都会出现在中周期的末尾阶段，基本上位于<a href="https://zhida.zhihu.com/search?content_id=2250214&amp;content_type=Article&amp;match_order=3&amp;q=第三库存周期&amp;zhida_source=entity">第三库存周期</a>位置。这个问题也不难理解，这就是周期嵌套模式使然。虽然大宗商品处于康波意义上的熊市，但他的价格依然会跟随中周期波动，而中周期第三库存周期往往是滞胀阶段，所以出现大宗商品中周期反弹顺理成章。</p>
<p><img src="https://pic2.zhimg.com/4c882f878a1ba133c8c3ac04a27ff92b_1440w.jpg" alt="img"></p>
<p>（本图是以美国的中周期划分的周期位置，我们可以清晰发现，每一个中周期的末尾段都会出现一次大宗商品行情，基本位于第三库存周期。）</p>
<p><img src="https://pic4.zhimg.com/2ca83a1d01efd165a64c98a27b81aed1_1440w.jpg" alt="img"></p>
<p><img src="https://pic2.zhimg.com/901626527b5013c2454b5f755111738f_1440w.jpg" alt="img"></p>
<p><img src="https://pic2.zhimg.com/2c3c68863ad29e0ce94063334967759f_1440w.jpg" alt="img"></p>
<p><strong>6.4、关于第五次康波周期中价格研究的后续问题</strong></p>
<p>我们已经说明，大宗商品价格处于一个长期的低点附近，当然从短期的角度看，这个低点需要反复的确认，不是一蹴而就的。以我们对世界经济周期运动的理解，这个长期低点的确认需要三年以上的时间。但以我们对世界库存周期的研究，我们认为2016年即将启动本轮中周期第三库存周期，这轮库存周期来源于中国房地产周期的B浪反弹，以及美国房地产周期的高位延续，随着周期复苏和<a href="https://zhida.zhihu.com/search?content_id=2250214&amp;content_type=Article&amp;match_order=1&amp;q=货币乘数&amp;zhida_source=entity">货币乘数</a>上升，将给全球带来一次小的滞胀过程，我们认为这可以视为商品的一次触底。而当2018年的三期共振低点来临之时，也许才是商品价格的真正长期低点。所以我们后面就是要在这一框架下紧跟美国、欧洲、中国的经济周期运动，从而判断<a href="https://zhida.zhihu.com/search?content_id=2250214&amp;content_type=Article&amp;match_order=4&amp;q=美元指数&amp;zhida_source=entity">美元指数</a>，经济复苏的基本趋势，把握商品的长期低点反复震荡的机会。</p>
<h1 id="五次康波周期"><a href="#五次康波周期" class="headerlink" title="五次康波周期"></a>五次康波周期</h1><p><img src="https://xqimg.imedao.com/18df49df77c5465c3fc3398f.png!800.jpg" alt="img"></p>
<p><img src="https://xqimg.imedao.com/18df49e3c4241b1e3f90a991.png!800.jpg" alt="img"></p>
<p>萧条期应该不止到2025，可能到2029，然后从2029一直到2040/2050都是回升期，2050/2055年以后进入繁荣期。</p>
<h2 id="中国未来60年的康波周期"><a href="#中国未来60年的康波周期" class="headerlink" title="中国未来60年的康波周期"></a>中国未来60年的康波周期</h2><p>根据搜索结果，我们可以预测中国未来60年在康波周期中可能处于的阶段：</p>
<ol>
<li><p><strong>2024年-2025年</strong>：根据多个来源，包括腾讯新闻的文章《鲁政委：突破周期的宿命——2024年宏观经济展望》和雪球的文章《90后的第一个康波周期要来了吗？》，当前全球正处于第五轮康波周期之末，而中国可能正处于萧条期的末期。预计从2025年左右开始，中国将逐渐迈入萧条后的回升期。</p>
</li>
<li><p><strong>2025年-2045年</strong>：根据第一智库的文章《百年来中美经济对比与预判——基于康波周期的大历史视角分析》，第五个康波周期可能从2020-2025年开始计算，大概会经历20年左右的上升期（2025—2045）。这意味着从2025年到2045年，中国可能处于康波周期的回升期。</p>
</li>
<li><p><strong>2045年-2055年</strong>：同一篇文章提到，2045—2055年可能是平台期，预计完成第二个百年目标。这个阶段可能标志着康波周期中的繁荣期或过渡建设期。</p>
</li>
<li><p><strong>2055年-2075年</strong>：从2055年到2075年，根据第一智库的预测，可能是康波周期的下行期，这个阶段可能对应于衰退期或滞涨期。</p>
</li>
</ol>
<p>综上所述，中国未来60年可能经历的康波周期阶段如下：</p>
<ul>
<li><strong>2024年-2025年</strong>：萧条期末期，逐渐进入回升期。</li>
<li><strong>2025年-2045年</strong>：回升期。</li>
<li><strong>2045年-2055年</strong>：繁荣期或过渡建设期。</li>
<li><strong>2055年-2075年</strong>：下行期，可能对应衰退期或滞涨期。</li>
</ul>
<h2 id="萧条期的特征"><a href="#萧条期的特征" class="headerlink" title="萧条期的特征"></a>萧条期的特征</h2><ol>
<li><p><strong>低增长、低通胀</strong>：萧条期的经济增长率较低，通胀率也相对较低。</p>
</li>
<li><p><strong>供给和需求处于较低水平</strong>：在萧条期，经济前景不明朗，社会需求不足，资产缩水，失业率较高。</p>
</li>
<li><p><strong>大宗商品市场波动</strong>：萧条期是大宗商品特别容易出现暴利的时期，市场对任何风吹草动反应剧烈，大宗商品价格可能被推至极端高位。</p>
</li>
<li><p><strong>技术创新下降</strong>：萧条期并非完全不存在技术创新，但技术从成熟变得缺乏活力，资本投入的效率下降，经济扩张渐渐放慢。</p>
</li>
<li><p><strong>资本收缩</strong>：萧条期的投资收缩及存货增加，中性利率长期下降，经济增长越来越偏离长期均衡水平。</p>
</li>
<li><p><strong>产能过剩与需求不足</strong>：没有大规模的增量需求，一旦出现大规模资本开支，很快就出现了产能过剩与需求不足，这反而验证了“康波萧条周期”的特征。</p>
</li>
<li><p><strong>失业率上升</strong>：萧条期更容易出现被动性垄断出清，同时资本和劳动力冲突加剧，失业率往往出现阶段性上升，失业率的高点也一般会出现在这个阶段。</p>
</li>
<li><p><strong>逆全球化浪潮</strong>：康波萧条期更容易出现逆全球化浪潮。</p>
</li>
</ol>
]]></content>
  </entry>
  <entry>
    <title>社会心理学</title>
    <url>/2025/11/22/%E6%9D%82%E8%B0%88/%E7%A4%BE%E4%BC%9A%E5%BF%83%E7%90%86%E5%AD%A6/</url>
    <content><![CDATA[<p>里面讲了很多各种各样的理论，我认为有意思的大概记录一下：</p>
<p>爱情的分类来自心理学家罗伯特·斯滕伯格（Robert Sternberg）提出的“爱情三角理论”（Triangular Theory of Love），这一理论被广泛收录在《社会心理学》等教材中。</p>
<p>斯滕伯格认为，爱情由三个基本成分构成：<strong>亲密（Intimacy）</strong>、<strong>激情（Passion）</strong> 和 <strong>承诺（Commitment）</strong>。不同的爱情类型是这三个成分不同组合的结果。</p>
<hr>
<h3 id="一、三个核心成分详解："><a href="#一、三个核心成分详解：" class="headerlink" title="一、三个核心成分详解："></a>一、三个核心成分详解：</h3><h4 id="1-亲密（Intimacy）"><a href="#1-亲密（Intimacy）" class="headerlink" title="1. 亲密（Intimacy）"></a>1. 亲密（Intimacy）</h4><ul>
<li><strong>定义</strong>：指两个人之间情感上的亲近感、信任、理解和支持。</li>
<li><strong>表现</strong>：彼此愿意分享内心想法和感受，感到被对方接纳和重视。</li>
<li><strong>作用</strong>：提供情感联结和温暖，是长期关系稳定的基础。</li>
<li><strong>不含激情或承诺时</strong>：可能表现为深厚的友谊。</li>
</ul>
<h4 id="2-激情（Passion）"><a href="#2-激情（Passion）" class="headerlink" title="2. 激情（Passion）"></a>2. 激情（Passion）</h4><ul>
<li><strong>定义</strong>：指强烈的生理吸引、性欲、浪漫渴望以及情绪上的兴奋。</li>
<li><strong>表现</strong>：心跳加速、思念、理想化对方、“坠入爱河”的感觉。</li>
<li><strong>特点</strong>：通常在恋爱初期最强烈，随时间可能减弱。</li>
<li><strong>单独存在时</strong>：可能表现为一夜情或迷恋。</li>
</ul>
<h4 id="3-承诺（Commitment）"><a href="#3-承诺（Commitment）" class="headerlink" title="3. 承诺（Commitment）"></a>3. 承诺（Commitment）</h4><ul>
<li>定义：包含两个层面：<ul>
<li><strong>短期</strong>：决定去爱一个人；</li>
<li><strong>长期</strong>：维持这段关系的决心，即使遇到困难也不轻易放弃。</li>
</ul>
</li>
<li><strong>表现</strong>：忠诚、责任感、共同规划未来。</li>
<li><strong>不含亲密与激情时</strong>：可能表现为“空洞的婚姻”或出于现实考虑的结合。</li>
</ul>
<hr>
<h3 id="二、七种爱情类型（三要素的不同组合）"><a href="#二、七种爱情类型（三要素的不同组合）" class="headerlink" title="二、七种爱情类型（三要素的不同组合）"></a>二、七种爱情类型（三要素的不同组合）</h3><div class="table-container">
<table>
<thead>
<tr>
<th>爱情类型</th>
<th>亲密</th>
<th>激情</th>
<th>承诺</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>无爱（Non-love）</strong></td>
<td>✗</td>
<td>✗</td>
<td>✗</td>
<td>三者皆无，普通关系或陌生人</td>
</tr>
<tr>
<td><strong>喜欢（Liking）</strong></td>
<td>✓</td>
<td>✗</td>
<td>✗</td>
<td>友谊，有亲密但无激情或承诺</td>
</tr>
<tr>
<td><strong>迷恋（Infatuation）</strong></td>
<td>✗</td>
<td>✓</td>
<td>✗</td>
<td>“一见钟情”，只有激情，缺乏了解和承诺</td>
</tr>
<tr>
<td><strong>空洞的爱（Empty love）</strong></td>
<td>✗</td>
<td>✗</td>
<td>✓</td>
<td>仅有承诺，常见于长期婚姻感情淡漠后</td>
</tr>
<tr>
<td><strong>浪漫的爱（Romantic love）</strong></td>
<td>✓</td>
<td>✓</td>
<td>✗</td>
<td>有亲密+激情，如热恋期情侣，但未决定长期在一起</td>
</tr>
<tr>
<td><strong>伴侣的爱（Companionate love）</strong></td>
<td>✓</td>
<td>✗</td>
<td>✓</td>
<td>亲密+承诺，如老夫老妻，激情消退但感情深厚</td>
</tr>
<tr>
<td><strong>愚昧的爱（Fatuous love）</strong></td>
<td>✗</td>
<td>✓</td>
<td>✓</td>
<td>激情+承诺，但缺乏深入了解，如闪婚</td>
</tr>
<tr>
<td><strong>完美的爱（Consummate love）</strong></td>
<td>✓</td>
<td>✓</td>
<td>✓</td>
<td>三者兼具，斯滕伯格认为这是最完整、理想的爱情</td>
</tr>
</tbody>
</table>
</div>
<blockquote>
<p>注意：有些版本将“无爱”不算作爱情类型，因此常称“六种”或“七种”爱情类型。</p>
</blockquote>
<hr>
<h3 id="三、现实意义"><a href="#三、现实意义" class="headerlink" title="三、现实意义"></a>三、现实意义</h3><ul>
<li>理想的爱情（完美的爱）很难长期维持三者平衡，尤其激情会随时间自然减弱。</li>
<li>健康的长期关系往往从浪漫的爱逐渐过渡到伴侣的爱。</li>
<li>理解这三个维度有助于人们反思自己的关系状态，比如是否缺乏沟通（亲密不足）、是否只剩责任（激情缺失）等。</li>
</ul>
]]></content>
      <categories>
        <category>杂谈</category>
      </categories>
  </entry>
  <entry>
    <title>查理芒格推荐的理论</title>
    <url>/2024/11/21/%E6%9D%82%E8%B0%88/%E6%9F%A5%E7%90%86%E8%8A%92%E6%A0%BC%E6%8E%A8%E8%8D%90%E7%9A%84%E7%90%86%E8%AE%BA/</url>
    <content><![CDATA[<p>数学：复利原理，排列组合原理，费马帕斯卡系统</p>
<p>统计学：高斯分布</p>
<p>物理学：平衡，临界质量</p>
<p>生物学：进化论。复杂适应系统</p>
<p>工程学：后备系统，断裂点理论</p>
<p>社会科学：自我组织理论，层次进化理论。艾尔法罗预判模型</p>
<p>心理学：误判心理学</p>
<h1 id="复利原理"><a href="#复利原理" class="headerlink" title="复利原理"></a>复利原理</h1><p>爱因斯坦说过这么一句：</p>
<p>“Compound interest is the eighth wonder of the world. He who understands it, earns it … he who doesn’t … pays it.”</p>
<p>翻译过来：复利是<a href="https://zhida.zhihu.com/search?content_id=111888482&amp;content_type=Article&amp;match_order=1&amp;q=世界第八大奇迹&amp;zhida_source=entity">世界第八大奇迹</a>。知之者赚、不知之者被赚。</p>
<p>复利，是世界运行的底层逻辑之一。</p>
<p>今天，我们就聊聊“<a href="https://zhida.zhihu.com/search?content_id=111888482&amp;content_type=Article&amp;match_order=3&amp;q=复利&amp;zhida_source=entity">复利</a>”。</p>
<p><img src="https://pic1.zhimg.com/v2-8f50e4c25b45c7637ad568b3a0fdfd52_1440w.jpg" alt="img"></p>
<h2 id="先说“利息”"><a href="#先说“利息”" class="headerlink" title="先说“利息”"></a>先说“利息”</h2><p>利息，这个概念虽然简单，但人们普遍接受利息的存在，也就是近一百年内的事情。</p>
<p>在中国人的印象里，“利滚利”是缺德的，是地主恶霸做的事；</p>
<p>在西方人眼里，莎士比亚笔下的<a href="https://zhida.zhihu.com/search?content_id=111888482&amp;content_type=Article&amp;match_order=1&amp;q=夏洛克&amp;zhida_source=entity">夏洛克</a>代表着邪恶；</p>
<p>地球上绝大多数宗教，都有严格的教义，禁止收取利息。甚至，连善于理财的犹太人，他们的教义里都规定“不得向同族收取任何利息”。</p>
<p>随着经济学的发展，人们认识到：<strong>“利息”是最高效的调配资源方法</strong>。</p>
<p>哪里缺钱，哪里就出个高利息，自然就会有钱过去。</p>
<p>在利率的计算上面一般分两种：<strong>单利</strong>，<strong>复利</strong>。</p>
<p>所谓<a href="https://zhida.zhihu.com/search?content_id=111888482&amp;content_type=Article&amp;match_order=2&amp;q=单利&amp;zhida_source=entity">单利</a>，就是本金固定，到最后一次性结算利息。</p>
<p>10万元，年利率为5%，借5年，最后的利息总和2.5万元，就是单利的算法。</p>
<p>你把钱存进银行，他们会给你利息，不过全世界绝大多银行都只支付单利，因为银行在占你便宜。</p>
<h2 id="“复利”概念"><a href="#“复利”概念" class="headerlink" title="“复利”概念"></a>“复利”概念</h2><p>复利，俗称“利滚利”，就是<strong>上一期的利息加入到下一期的本金</strong>。</p>
<p>单利的本金=<a href="https://zhida.zhihu.com/search?content_id=111888482&amp;content_type=Article&amp;match_order=1&amp;q=初始本金&amp;zhida_source=entity">初始本金</a></p>
<p>复利的本金=初始本金+上一期利息</p>
<p>如果对比单利与复利的收益率，你会发现，银行究竟占了你多少便宜。</p>
<p><img src="https://pic4.zhimg.com/v2-2489ba7d8326b8da1384bad1052f9cb7_1440w.jpg" alt="img"></p>
<p><strong>只要能积累的东西，基本上最终都会产生<a href="https://zhida.zhihu.com/search?content_id=111888482&amp;content_type=Article&amp;match_order=1&amp;q=复利效应&amp;zhida_source=entity">复利效应</a>。</strong></p>
<p>那么，它的增长最终大抵是这样的：</p>
<p><img src="https://picx.zhimg.com/v2-af5eff4a5d3c76c62555b773607f6eab_1440w.jpg" alt="img"></p>
<h2 id="复利的构成"><a href="#复利的构成" class="headerlink" title="复利的构成"></a>复利的构成</h2><p>复利有两个基本要素：<strong>时间</strong>与<strong>利率</strong></p>
<p>巴菲特说过：“人生就像滚雪球，关键是要找到足够湿的雪，和足够长的坡。”</p>
<p>湿的雪就是利率，长的坡就是时间。</p>
<p><strong>（1）复利的时间</strong></p>
<p>时间是一种的伟大力量</p>
<p>我们常常高估一天内可以做到的事情，却低估了一年里可以做到的事情。</p>
<p>据测算，假设20%的<a href="https://zhida.zhihu.com/search?content_id=111888482&amp;content_type=Article&amp;match_order=1&amp;q=年化收益&amp;zhida_source=entity">年化收益</a>，10年变成6倍，20年变成39倍，50年将变成9100倍。</p>
<p>有人曾对1975-1982年美国股票市场上市值最大的500只股票进行统计。</p>
<p>这8年是股市的波动不大。</p>
<p>在1年的时间里，有3%的股票上涨了1倍，</p>
<p>时间拉长到3年，有18.6%上涨了1倍以上</p>
<p>5年，价格上涨超一倍的股票有38%。</p>
<p>换句话说，你买30支股票，一年里有可能1支股票翻倍，五年里会有10支以上翻倍，这就是时间的力量。</p>
<p><strong>(2）复利的利率</strong></p>
<p>利率很重要，但很多人容易忽视开始时的小收益而会选择放弃。</p>
<p>例如：1万块，年化10%利率计算，一年下来也也就1000收益，每天也就2元多一点，对很多人来说都没有多大的吸引力。</p>
<p>但做过投资的人知道，保持10%的<a href="https://zhida.zhihu.com/search?content_id=111888482&amp;content_type=Article&amp;match_order=1&amp;q=年化收益率&amp;zhida_source=entity">年化收益率</a>是多么困难。</p>
<p>股神巴菲特也才年化20%。</p>
<p>投资中有个<strong><a href="https://zhida.zhihu.com/search?content_id=111888482&amp;content_type=Article&amp;match_order=1&amp;q=72法则&amp;zhida_source=entity">72法则</a></strong>，即用72除以你的<a href="https://zhida.zhihu.com/search?content_id=111888482&amp;content_type=Article&amp;match_order=1&amp;q=年化利率&amp;zhida_source=entity">年化利率</a>，得到的结果就是资产翻番所要的时间。</p>
<p>如果年化<a href="https://zhida.zhihu.com/search?content_id=111888482&amp;content_type=Article&amp;match_order=1&amp;q=复合利率&amp;zhida_source=entity">复合利率</a>12%，资产翻番要6年，年化15%，资产翻番需要5年。</p>
<p>接受开始的进步很小这个事实，有助于对复利这个概念形成正确的期待，拥有足够的耐心等待复利效果的显现。</p>
<h2 id="世界运行中的“复利”"><a href="#世界运行中的“复利”" class="headerlink" title="世界运行中的“复利”"></a>世界运行中的“复利”</h2><p><strong>（1）财富投资</strong></p>
<p>巴菲特一生中99%的财富都是他50岁之后获得的。</p>
<p>也就是说，50岁之前，他也是一个普通的<a href="https://zhida.zhihu.com/search?content_id=111888482&amp;content_type=Article&amp;match_order=1&amp;q=中产阶级&amp;zhida_source=entity">中产阶级</a>。</p>
<p>从27岁，他投资的<a href="https://zhida.zhihu.com/search?content_id=111888482&amp;content_type=Article&amp;match_order=1&amp;q=年复利&amp;zhida_source=entity">年复利</a>是20%，50岁之后，进入财富爆炸期，靠的就是时间和复利的力量。</p>
<p><img src="https://pica.zhimg.com/v2-45a041564bfa9fd0ab5921aeca16f19c_1440w.jpg" alt="img"></p>
<p><strong>（2）个人成长</strong></p>
<p>个人的成长也同样符合复利增长曲线。</p>
<p>无论是读书、锻炼或者学习某一个知识。只要是积累型的操作，都会接着复利的力量，完成个人的蜕变。</p>
<p><img src="https://pic1.zhimg.com/v2-12fe70ef586e46f1cbeab817ff45ddaa_1440w.jpg" alt="img"></p>
<p><strong>（3）历史进程</strong></p>
<p>正如上文所说：在任何可以积累的系统里，都存在“复利”。</p>
<p>这种曲线在很多地方都是一样的</p>
<p>世界人口增长曲线也是这样的：</p>
<p><img src="https://pic3.zhimg.com/v2-459f5ba9a9f05a7d4e97d132fbbc878c_1440w.jpg" alt="img"></p>
<p><a href="https://zhida.zhihu.com/search?content_id=111888482&amp;content_type=Article&amp;match_order=1&amp;q=道琼斯指数&amp;zhida_source=entity">道琼斯指数</a>过去一百年的增长曲线也如此：</p>
<p><img src="https://pic4.zhimg.com/v2-a202d22cb52ba1f36c8436b42281754d_1440w.jpg" alt="img"></p>
<p>科学技术也是如此：</p>
<p><img src="https://pic4.zhimg.com/v2-2846f4def1583b1cb9b2c29328f73893_1440w.jpg" alt="img"></p>
<p>其实，我们正站在人类社会发展的拐点上，经过漫长的积累，人类社会正在进入高速发展期。</p>
<p>因此，我们在对未来进行评估时，不能根据过去的经验。</p>
<p><strong>因为未来的发展，会远超我们对现在的认知。</strong></p>
<p><img src="https://pica.zhimg.com/v2-d5cf2c81aeccd7140719a4d59b2d1faa_1440w.jpg" alt="img"></p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>（1）复利，是世界运行的底层逻辑之一。</p>
<p>（2）在任何可以积累的系统里，都存在“复利”。</p>
<p>（3）在财富投资与个人成长中，相信时间的力量，坚守复利原则。</p>
<p>（4）预测未来，要有“复利”的视角。</p>
<h1 id="费马帕斯卡系统"><a href="#费马帕斯卡系统" class="headerlink" title="费马帕斯卡系统"></a>费马帕斯卡系统</h1><p>一、什么是费马帕斯卡系统？<br>故事起源：</p>
<p>说起概率论起源的故事，就要提到法国的两个数学家。一个叫做帕斯卡，一个叫做费马。</p>
<p>帕斯卡是17世纪有名的“神童”数学家。费马是一位业余的大数学家，许多故事都与他有关。</p>
<p>帕斯卡认识的朋友中有两个是赌徒。   1651年，法国一位贵族梅累向法国数学家、物理学家帕斯卡提出了一个十分有趣的“分赌注”问题。这两个赌徒说，他俩下赌金之后，约定谁先赢满5局，谁就获得全部赌金。赌了半天， A赢了4局， B赢了3局，时间很晚了，他们都不想再赌下去了。那么，这个钱应该怎么分？是不是把钱分成7份，赢了4局的就拿4份，赢了3局的就拿3份呢？或者，因为最早说的是满5局，而谁也没达到，所以就一人分一半呢？这两种分法都不对。</p>
<p>正确的答案是：赢了4局的拿这个钱的3／4,赢了3局的拿这个钱的1／4。为什么呢？假定他们俩再赌一局，或者 A赢，或者 B赢。若是 A赢满了5局，钱应该全归他； A如果输了，即 A、 B各赢4局，这个钱应该对半分。现在， A赢、输的可能性都是1／2,所以，他拿的钱应该是1／2×1＋1／2×1／2＝3／4,当然， B就应该得1／4。这个问题可把他难住了，他苦苦思考了两三年，到1654年才算有了点眉目。于是他写信给的好友费马，两人讨论结果，取得了一致的意见：不应该按已经完成的赌局盘数来计算赌注分配，而是应该把目光放在赌局中断时，后面应该继续进行的盘数上。</p>
<p>梅累的分法是对的，他应得64个金币的，赌友应得64金币的。</p>
<p>所以，已经完成的盘数不重要，重要的是赌徒们如果要最终赢得赌局，需要去完成的盘数。</p>
<p>通过这次讨论，开始形成了概率论当中一个重要的概念—————数学期望。</p>
<p>在上述问题中，数学期望是一个平均值，就是对将来不确定的钱今天应该怎么算，这就要用A赢输的概率1／2去乘上他可能得到的钱，再把它们加起来。概率论从此就发展起来，今天已经成为应用非常广泛的一门学科。   </p>
<p>二、帕斯卡三角<br>费马假设：费马和帕斯卡一起玩抛硬币游戏，每一次【头】（head）和【尾】（tail）的概率都是1/2。两人各出50法郎做赌注。规则是： 先赢10盘就能赢得100法郎。抛硬币是【头】，费马赢，记为「h」；如果是【尾】，则帕斯卡赢，记为「t」。</p>
<p>赌局进行到{ 费马8 ：帕斯卡7 }的时候，这个赌局需要提前结束 。该怎么公平分100法郎呢？</p>
<p>帕斯卡发现，可以用他发现的「帕斯卡三角」来解「赌注分配问题」。</p>
<p>这个三角形的「塔尖」是一个「1」，这一行称为「0」行。下面依次是1、2、3、4、5、6…行。每一行的左右两边数字都是1，每行里的数字是它上面两个数字之和。</p>
<p>我们回到费马和帕斯卡那个抛硬币的赌局里。8 - 7，刚才说了，还需要4盘才能决出胜负。好，我们看上图中的第4行，「1,4,6,4,1」。</p>
<p>这里有一点值得注意 ：费马现在赢了8局，再赢2局即可赢得赌局。那么前两个数字「1,4」就代表了帕斯卡赢的概率；同理，帕斯卡需要再赢3局——&gt;可推：「6,4,1」则代表了费马赢的概率。</p>
<p>前面算过，最后4盘有16种不同的结果，正好是「1+4+6+4+1=16」。费马赢的概率：6+4+1=11，11/16=68.75%。帕斯卡的概率为 1-费马赢的概率。</p>
<p><img src="https://i-blog.csdnimg.cn/blog_migrate/027fbabedac342babc6bebc0b4a64432.png" alt="帕斯卡三角"><br>总结<br>就如查理.芒格所言：</p>
<p>如果你没有把这个基本的，但有些不那么自然的基础数学概率方法变成你生活的一部分，缺乏数学运算能力，在我们大多数人所过的生活中，你们将会像一个参加踢屁股比赛的独腿人。这等于将胜利拱手他人。</p>
<p>因此我们需要学好用好概率论来帮助我们做出最大概率获胜的决策。</p>
<h1 id="正态分布"><a href="#正态分布" class="headerlink" title="正态分布"></a>正态分布</h1><p>统计学里面，正态分布（normal distribution）最常见。男女身高、寿命、血压、考试成绩、测量误差等等，都属于正态分布。</p>
<p><img src="http://www.ruanyifeng.com/blogimg/asset/2017/bg2017073006.jpg" alt="img"></p>
<p>以前，我认为中间状态是事物的常态，过高和过低都属于少数，这导致了正态分布的普遍性。最近，读到了 <a href="https://www.johndcook.com/blog/2015/03/09/why-isnt-everything-normally-distributed/">John D. Cook</a> 的文章，才知道我的这种想法是错的。</p>
<p>正态分布为什么常见？真正原因是<a href="https://baike.baidu.com/item/中心极限定理">中心极限定理</a>（central limit theorem）。</p>
<blockquote>
<p>“多个独立统计量的和的平均值，符合正态分布。”</p>
</blockquote>
<p><img src="http://www.ruanyifeng.com/blogimg/asset/2017/bg2017073002.gif" alt="img"></p>
<p>上图中，随着统计量个数的增加，它们和的平均值越来越符合正态分布。</p>
<p><strong>根据中心极限定理，如果一个事物受到多种因素的影响，不管每个因素本身是什么分布，它们加总后，结果的平均值就是正态分布。</strong></p>
<p>举例来说，人的身高既有先天因素（基因），也有后天因素（营养）。每一种因素对身高的影响都是一个统计量，不管这些统计量本身是什么分布，它们和的平均值符合正态分布。（注意：男性身高和女性身高都是正态分布，但男女混合人群的身高<a href="https://www.johndcook.com/blog/2008/11/25/distribution-of-adult-heights/">不是</a>正态分布。）</p>
<p>许多事物都受到多种因素的影响，这导致了正态分布的常见。</p>
<p>读到这里，读者可能马上就会提出一个问题：<strong>正态分布是对称的（高个子与矮个子的比例相同），但是很多真实世界的分布是不对称的。</strong></p>
<p><img src="http://www.ruanyifeng.com/blogimg/asset/2017/bg2017073003.png" alt="img"></p>
<p>比如，财富的分布就是不对称的，富人的有钱程度（可能比平均值高出上万倍），远远超出穷人的贫穷程度（平均值的十分之一就是赤贫了），即财富分布曲线有右侧的长尾。相比来说，身高的差异就小得多，最高和最矮的人与平均身高的差距，都在30%多。</p>
<p>这是为什么呢，财富明明也受到多种因素的影响，怎么就不是正态分布呢？</p>
<p>原来，正态分布只适合各种因素累加的情况，如果这些因素不是彼此独立的，会互相加强影响，那么就不是正态分布了。一个人是否能够挣大钱，由多种因素决定：</p>
<blockquote>
<ul>
<li>家庭</li>
<li>教育</li>
<li>运气</li>
<li>工作</li>
<li>…</li>
</ul>
</blockquote>
<p>这些因素都不是独立的，会彼此加强。如果出生在上层家庭，那么你就有更大的机会接受良好的教育、找到高薪的工作、遇见好机会，反之亦然。也就是说，这不是 1 + 1 = 2 的效果，而是 1 + 1 &gt; 2。</p>
<p>统计学家发现，如果各种因素对结果的影响不是相加，而是相乘，那么最终结果不是正态分布，而是<a href="https://baike.baidu.com/item/对数正态分布">对数正态分布</a>（log normal distribution），即<code>x</code>的对数值<code>log(x)</code>满足正态分布。</p>
<p><img src="http://www.ruanyifeng.com/blogimg/asset/2017/bg2017073004.gif" alt="img"></p>
<p>这就是说，财富的对数值满足正态分布。如果平均财富是10,000元，那么1000元～10,000元之间的穷人（比平均值低一个数量级，宽度为9000）与10,000元~100,000元之间的富人（比平均值高一个数量级，宽度为90,000）人数一样多。因此，财富曲线左侧的范围比较窄，右侧出现长尾。</p>
<h1 id="临界质量"><a href="#临界质量" class="headerlink" title="临界质量"></a>临界质量</h1><p>“物理学中的临界质量是一个非常强大的模型。”——查理芒格。</p>
<p>临界质量最早是在核物理学中，指的是维持核子连锁反应所需的裂变材料质量。引申到从量变到质变的拐点，也就是临界点。</p>
<p>在之前讲复利模型到时候就提到过临界点，说的是复利模型，有一个关键的要素就是达到临界点之后才能产生裂变式的指数增长。</p>
<p>临界点，也可以叫裂变阈值，说的是有些东西积累到一定程度，就有可能激发连锁反应，迅速扩张，形成裂变。我们可以用来理解世界非常重要的模型之一，很多现象都可以用这个模型来解释。</p>
<p>比如有的谣言经过少数人的传播，慢慢积累到一定程度之后，就会变成被普遍认可的谣言。比如小的时候的一个经典谣言，说是在月球上可以看到唯一一个地球的建筑就是长城。相信这个谣言，最开始是某些国家荣誉感爆棚的人编造的，但是慢慢的居然发酵成了一个被普遍认同的谣言。</p>
<p>再比如朋友圈的一些热点文章，即便它的标题一点都不吸引人，如果有三五个好友连续的转发了这篇文章，你也很可能就会点进去。所以朋友圈的爆文也是有一个临界点的，到达临界点之后才能得到广泛的传播。</p>
<p>再比如从众效应也是有一个临界点的，之前有人做过一个实验，就是一个街道有一群人向着一个方向跑，假装很慌张的样子，最开始向这个方向跑的人很少，然后实验的人数慢慢增多，到达某一个人说的时候，就会影响到周围的人，那些人本能的也会跟着这些人跑，然后跑的人越来越多，即使他们根本不知道他们为什么跑。</p>
<p>再比如新技术和某些产品的普及中，临界质量也是非常重要的。有些技术要用的人多到一定程度之后才有意义，比如说电话，如果电话不能用来打电话给其他人，那就没有意义。同样的，社交软件也是如此，如果你的社交软件里面没有好友，那就不是社交软件。如果一个线上社区没有人发内容，没有人评论，那么这个社区肯定也没有人能待下去。所以像微信、知乎这些产品增长过程中，都有很明显的临界点。</p>
<p>关于临界点，马尔科姆有一本书是《引爆点》，对这种思想进行了非常详细的阐述，并且得到了更多的例子。</p>
<p>当然除了解释现实生活中的一些现象临界点，也可以指导我们的一些行动。只要是可持续积累的，会产生连锁反应的，我们都要坚持积累，直到临界点的到来。</p>
<p>比如说学习，最开始学习的时候只有一些零散的知识点，但是一旦这些知识点积累到一定程度之后，他们之间就会形成关联，达到融会贯通的程度，再学相关的知识就会变得非常快，产生裂变反应。</p>
<p>同样的自己的关系网络，自己的资金，都可以积累到产生这种明显的连锁反应，但是很可能开始很长一段时间都是看不到回报的，必须撑到临界点之后。如果你知道这个模型，那么你就会更有信心，即便是在看不到回报的情况下也能坚持，因为你知道临界点终归有一天会到来。</p>
<h1 id="复杂适应系统"><a href="#复杂适应系统" class="headerlink" title="复杂适应系统"></a>复杂适应系统</h1><p><a href="https://www.cnblogs.com/haohai9309/p/16794238.html">系统论——复杂适应系统CAS（三） - 郝hai - 博客园</a></p>
<h1 id="后备系统"><a href="#后备系统" class="headerlink" title="后备系统"></a>后备系统</h1><p>工程学中，典型的工程冗余（rǒng yú）指的是向系统添加“额外”的<strong>关键组件</strong>，它是利用系统的<strong>并联模型</strong>来提高系统可靠性的一种手段，通常使用备份或者自动防故障装置。冗余也常被称为“<strong>多数表决系统</strong>”或“<strong>表决逻辑系统</strong>”。</p>
<p>在许多安全导向的系统上，比如飞机上的双引擎和液压系统，控制系统上的某些部件也许会被<strong>一式三份</strong>，专业术语：三重模块冗余（TMR）。一个部件出错将会被另外两个备份部件所取代。</p>
<p><a href="https://www.madewill.com/wp-content/uploads/2018/01/冗余备份模型.jpg"><img src="https://www.madewill.com/wp-content/uploads/2018/01/%E5%86%97%E4%BD%99%E5%A4%87%E4%BB%BD%E6%A8%A1%E5%9E%8B-700x379.jpg" alt="冗余备份模型"></a>冗余备份模型</p>
<p>在工程领域有很多这样的例子，从火箭的控制和动力系统，到数据中心大量使用的额外硬盘和备用电源。</p>
<p>一种常见形式的被动冗余 是在桥梁上使用超高强度的钢桁和支柱。这种高强度能够允许一些部件的老化但不至于使桥垮塌。</p>
<p>互联网本身就是一个典型冗余实例，它的大多数核心传输网络和站点都被设计成可以抵御单个链接或节点的故障。</p>
<p>人体的听觉系统和视觉系统都是冗余备份的典型例子，视觉系统失去一只眼睛不至完全失明，但却会深深损害知觉。听力系统失去一只耳朵不至耳聋，但肯定会受到损害。性能下降是常常是跟发生少数失效的被动冗余关联在一起的。</p>
<p>冗余方案还可以添加到各种系统中，能够帮助我们避免灾难的发生。</p>
<h2 id="一、工程以外的应用"><a href="#一、工程以外的应用" class="headerlink" title="一、工程以外的应用"></a>一、<strong>工程以外的应用</strong></h2><p>冗余备份是<a href="https://www.madewill.com/thinking-model/top-thinking-model.html">查理芒格</a>提到的一个重要模型，它源于工程学，但思路可以应用到很多领域。一旦你尝试给自己的生活增加稳定可靠性，就会找到很多这样的例子，例如：</p>
<p>越野车的备用轮胎<br>商场或公司里的发电机<br>跳伞的备用伞包<br>商业轮船上的多个精密计时器<br>软件的多版本编程系统<br>大厦的防火安全通道等等</p>
<h3 id="冗余备份并不总是值得的"><a href="#冗余备份并不总是值得的" class="headerlink" title="冗余备份并不总是值得的"></a><strong>冗余备份并不总是值得的</strong></h3><p>我们从上面的实例中不难得出关于冗余的两个特征:</p>
<ul>
<li><strong>向系统中添加冗余肯定会增加整个系统的成本。</strong></li>
<li><strong>在不同的系统，不同的场景中，失败带来的后果是不一样的。</strong></li>
</ul>
<p>考虑了这两点后，在向系统中添加冗余时，就要<strong>权衡增加它的成本和如果没有冗余机制所带来的后果。</strong></p>
<ul>
<li>如果系统中断，你会失去什么?</li>
<li>预防某种故障发生需要付出什么代价?</li>
<li>增加冗余的成本是否大于潜在的损失?</li>
</ul>
<p>一旦你发现为系统增加冗余可以避免一些失败，就可能会不计成本的增加一些备份方案，但它们并不都是值得的。</p>
<p>例如美国总统和副总统同时访问同一地区，会安排分开乘机，如果只是一家上市公司的高管呢？</p>
<h3 id="为家庭财务系统增加冗余"><a href="#为家庭财务系统增加冗余" class="headerlink" title="为家庭财务系统增加冗余"></a><strong>为家庭财务系统增加冗余</strong></h3><p>在日常生活中也有很多冗余方案的使用。我最喜欢的一个例子就是家庭财务的冗余应用。把你的家庭收入当做一个系统：</p>
<p>你是怎么赚钱的?</p>
<p>你有多少个收入来源?</p>
<p>如果主要收入出现问题，会发生什么?</p>
<p>假如你是双职工家庭的一员呢?若夫妻双方在同一个单位工作，情况会有什么不同?</p>
<p>我们通常不会对个人及家庭的收入使用冗余方案，但这一点其实值得我们去不断思考。</p>
<p>经常思考这些问题，就会强化思维，从而建立正确的<a href="https://www.madewill.com/thinking-model/认知升级：提升理解层次的nlp思维框架.html">思维框架</a>。</p>
<h1 id="断裂点理论"><a href="#断裂点理论" class="headerlink" title="断裂点理论"></a>断裂点理论</h1><p>“零售引力规律”、“城市断裂点理论”和“价格断裂点理论”都查了,看完觉得跟“临界点理论”应该放在一起看，说的都是量变引起质变的极值问题，极值前后的结果截然不同。类比房价就是泡沫崩盘的价格极点；类比零售就是产品定价和销量预估的函数极值；类比生活就是做一件事，从过程看如果积累没达到断裂点，从结果看就不会产生明显变化。</p>
<h1 id="自我组织理论"><a href="#自我组织理论" class="headerlink" title="自我组织理论"></a>自我组织理论</h1><p><a href="https://wiki.swarma.org/index.php/自组织">自组织 - 集智百科 - 复杂系统|人工智能|复杂科学|复杂网络|自组织</a></p>
<h1 id="层次进化理论"><a href="#层次进化理论" class="headerlink" title="层次进化理论"></a>层次进化理论</h1><p>层次进化理论是一个涉及多个学科的广泛概念，它探讨了复杂系统中不同层次结构的演变和发展。以下是层次进化理论的一些关键点：</p>
<ol>
<li><p><strong>定义与核心问题</strong>：<br>层次进化理论认为，复杂性以层级结构存在，层级是复杂性的必要条件。系统的层级进化问题就是复杂性不断生成的过程。</p>
</li>
<li><p><strong>适应性层级进化思想</strong>：<br>复杂适应系统理论的进化思想可以概括为适应性层级进化思想，这是系统层级进化思想的重要组成部分。适应性层级进化思想体现为适应性主体相互作用的多级网络，基于主体的模型与模拟适应性进化的遗传算法，以及适应性景观与适应性进化过程。</p>
</li>
<li><p><strong>适应性主体相互作用的多级网络</strong>：<br>适应性主体是在一定层次上收集有关周围环境以及它自己和自己行为的信息，然后加工与处理这些信息，并向环境输出信息和作用，从而适应环境的行为主体。适应性主体之间通过资源交换、信息流相互作用进化成多级网络。</p>
</li>
<li><p><strong>基于主体的模型与模拟适应性进化的遗传算法</strong>：<br>对主体及其适应性进行建模，并创立了以综合进化论为基础的遗传算法。基于主体的模型和遗传算法为适应性层级进化的研究提供了科学基础。</p>
</li>
<li><p><strong>适应性景观与适应性进化过程</strong>：<br>适应性层级进化思想强调个体在进化中的主动性以及以计算建模为主的研究方法。由于计算机模型同时具备理论和实验的特性，因此，计算建模为系统适应性层级进化思想的研究提供了科学基础。</p>
</li>
<li><p><strong>层创进化</strong>：<br>层创进化是一种在20世纪初为摆脱生机论和机械论的论证而从科学和哲学角度提出的理论。通过进化，新的统一体可能“突生”，并呈现出一种从它们先前的角度不可能分析到的不可预料的特质，因此需要一种新的研究模式。</p>
</li>
</ol>
<p>层次进化理论在理解复杂系统的结构和功能、以及这些系统如何随时间演变方面提供了重要的视角。它强调了个体和群体层面上的相互作用，以及这些相互作用如何导致新层次结构的出现和复杂性的增加。</p>
<h1 id="埃罗预测法"><a href="#埃罗预测法" class="headerlink" title="埃罗预测法"></a>埃罗预测法</h1><p><strong>埃罗预测法（Elo rating system）</strong>： 埃罗预测法最初由美国物理学家埃洛·阿奇博尔德·哈里森（Elo Arpad Haraszti）在1960年代提出，用于评估国际象棋中棋手的实力。后来，杰奎斯·布莱克根据1500场英超比赛对埃罗法进行了改进和创新，并被广泛应用于各种竞技体育，包括足球，以评估球队或球员的相对实力。埃罗评分系统的核心公式如下： RA′=RA+K(SA−EA)<em>R**A</em>′=<em>R**A</em>+<em>K</em>(<em>S**A</em>−<em>E**A</em>) RB′=RB+K(SB−EB)<em>R**B</em>′=<em>R**B</em>+<em>K</em>(<em>S**B</em>−<em>E**B</em>) 其中，RA<em>R**A</em> 和 RB<em>R**B</em> 分别为比赛前球队A和球队B的评分，RA′<em>R**A</em>′ 和 RB′<em>R**B</em>′ 为比赛后更新的评分，SA<em>S**A</em> 和 SB<em>S**B</em> 为比赛结果（胜/负/平）对应的实际得分（通常为1/0/0.5），EA<em>E**A</em> 和 EB<em>E**B</em> 为比赛前预测的胜率，K<em>K</em> 是一个常量，决定了评分更新的幅度，通常取值为20或30</p>
<h1 id="误判心理学"><a href="#误判心理学" class="headerlink" title="误判心理学"></a>误判心理学</h1><p>查理·芒格（Charlie Munger）在他的演讲和著作中详细阐述了人类误判心理学的概念，他提出了25个常见的心理倾向，这些倾向影响着人们的思考和行为，导致误判。以下是一些关键点：</p>
<ol>
<li><strong>奖励和惩罚超级反应倾向</strong>：人们对于奖励和惩罚的过度反应，这会影响他们的决策和行为。</li>
<li><strong>喜欢/热爱倾向</strong>：人们倾向于忽略所爱对象的缺点，对其百依百顺。</li>
<li><strong>讨厌/憎恨倾向</strong>：与喜欢/热爱倾向相反，人们会因为讨厌或憎恨某个事物而产生偏见。</li>
<li><strong>避免怀疑倾向</strong>：人们不愿意陷入怀疑和不确定的状态中，总是想立即作出决定。</li>
<li><strong>避免不一致性倾向</strong>：人们讨厌前后不一致，总想前后协调起来。</li>
<li><strong>好奇心倾向</strong>：人们天生具有好奇心，这驱使他们探索未知。</li>
<li><strong>康德式公平倾向</strong>：人们追求公平，这种倾向影响他们的决策。</li>
<li><strong>艳羡/妒忌倾向</strong>：人们可能会因为他人的成功或拥有而感到妒忌。</li>
<li><strong>回馈倾向</strong>：人们倾向于回报他人的好意或恶意。</li>
<li><strong>受简单联想影响的倾向</strong>：人们可能会因为某个事物与另一个积极或消极的事物相联系而受到影响。</li>
<li><strong>简单的、避免痛苦的心理否认</strong>：人们可能会否认痛苦的现实，以避免心理上的痛苦。</li>
<li><strong>自视过高的倾向</strong>：人们往往高估自己的能力和拥有的物品的价值。</li>
<li><strong>过度乐观倾向</strong>：人们往往过于乐观地评估未来事件的可能性和结果。</li>
<li><strong>被剥夺超级反应倾向</strong>：人们对于即将失去的东西反应强烈。</li>
<li><strong>社会认同倾向</strong>：人们倾向于模仿他们认同的群体的行为。</li>
</ol>
]]></content>
  </entry>
  <entry>
    <title>Prometheus监控kafka和redis配置文档</title>
    <url>/2023/04/30/%E8%AE%A1%E7%AE%97%E6%9C%BA/Prometheus%E7%9B%91%E6%8E%A7kafka%E5%92%8Credis%E9%85%8D%E7%BD%AE%E6%96%87%E6%A1%A3/</url>
    <content><![CDATA[<h1 id="Prometheus监控kafka和redis配置文档"><a href="#Prometheus监控kafka和redis配置文档" class="headerlink" title="Prometheus监控kafka和redis配置文档"></a>Prometheus监控kafka和redis配置文档</h1><h2 id="1-上传镜像"><a href="#1-上传镜像" class="headerlink" title="1.上传镜像"></a>1.上传镜像</h2><p>上传kafka_exporter.tar,redis_exporter.tar</p>
<p><img src="https://pic.imgdb.cn/item/6301ce5116f2c2beb14898b4.png" alt="arc"></p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> /tmp/prom</span><br><span class="line"><span class="built_in">ls</span></span><br><span class="line">docker load &lt; kafka_exporter.tar</span><br><span class="line">docker load &lt; redis_exporter.tar </span><br><span class="line">docker tag danielqsj/kafka-exporter:latest 172.31.10.118/monitor/kafka-exporter:v1.0</span><br><span class="line"></span><br><span class="line">docker tag prom/grafana 172.31.70.135:8443/prom/grafana:v1.0</span><br><span class="line">docker push 172.31.70.135:8443/prom/grafana:v1.0</span><br><span class="line">docker tag prom/node-exporter:v0.15.2  172.31.70.135:8443/prom/node-exporter:v0.15.2</span><br><span class="line">docker push 172.31.70.135:8443/prom/node-exporter:v0.15.2</span><br><span class="line"></span><br><span class="line">docker tag prom/prometheus:v2.2.1  172.31.70.135:8443/prom/prometheus:v2.2.1</span><br><span class="line">docker push 172.31.70.135:8443/prom/prometheus:v2.2.1</span><br><span class="line"></span><br><span class="line">docker tag oliver006/redis_exporter:latest 172.31.10.118/monitor/redis_exporter:v1.0</span><br><span class="line">docker login 172.31.10.118</span><br><span class="line">docker push 172.31.10.118/monitor/kafka-exporter:v1.0</span><br><span class="line">docker push 172.31.10.118/monitor/redis_exporter:v1.0</span><br></pre></td></tr></table></figure>
<h2 id="2-docker部署kafka-exporter"><a href="#2-docker部署kafka-exporter" class="headerlink" title="2.docker部署kafka_exporter"></a>2.docker部署kafka_exporter</h2><p>在172.31.10.127上</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">docker run -d --restart=always --net=host --name kafka_exporter 172.31.10.118/monitor/kafka-exporter:v1.0 --kafka.server=172.31.10.127:9092</span><br></pre></td></tr></table></figure>
<h2 id="3-docker部署redis-exporter"><a href="#3-docker部署redis-exporter" class="headerlink" title="3.docker部署redis_exporter"></a>3.docker部署redis_exporter</h2><p>在172.31.10.123上</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">docker run -d --name redis_exporter -p 9121:9121 172.31.10.118/monitor/redis_exporter:v1.0 --redis.addr 172.31.10.123:6379 --redis.password <span class="string">&#x27;redis密码&#x27;</span></span><br></pre></td></tr></table></figure>
<h2 id="4-修改Prometheus配置"><a href="#4-修改Prometheus配置" class="headerlink" title="4.修改Prometheus配置"></a>4.修改Prometheus配置</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">kubectl edit cm -n monitoring monitor-prometheus-server</span><br></pre></td></tr></table></figure>
<p>增加配置</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line">    <span class="bullet">-</span> <span class="attr">alert:</span> <span class="string">RedisDown</span></span><br><span class="line">      <span class="attr">expr:</span> <span class="string">redis_up</span>  <span class="string">==</span> <span class="number">0</span></span><br><span class="line">      <span class="attr">for:</span> <span class="string">5m</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">severity:</span> <span class="string">error</span></span><br><span class="line">      <span class="attr">annotations:</span></span><br><span class="line">        <span class="attr">summary:</span> <span class="string">&quot;Redis down (instance <span class="template-variable">&#123;&#123; $labels.instance &#125;&#125;</span>)&quot;</span></span><br><span class="line">        <span class="attr">description:</span> <span class="string">&quot;Redis 挂了啊，mmp\n  VALUE = <span class="template-variable">&#123;&#123; $value &#125;&#125;</span>\n  LABELS: <span class="template-variable">&#123;&#123; $labels &#125;&#125;</span>&quot;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">alert:</span> <span class="string">MissingBackup</span></span><br><span class="line">      <span class="attr">expr:</span> <span class="string">time()</span> <span class="bullet">-</span> <span class="string">redis_rdb_last_save_timestamp_seconds</span> <span class="string">&gt;</span> <span class="number">60</span> <span class="string">*</span> <span class="number">60</span> <span class="string">*</span> <span class="number">24</span></span><br><span class="line">      <span class="attr">for:</span> <span class="string">5m</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">severity:</span> <span class="string">error</span></span><br><span class="line">      <span class="attr">annotations:</span></span><br><span class="line">        <span class="attr">summary:</span> <span class="string">&quot;Missing backup (instance <span class="template-variable">&#123;&#123; $labels.instance &#125;&#125;</span>)&quot;</span></span><br><span class="line">        <span class="attr">description:</span> <span class="string">&quot;Redis has not been backuped for 24 hours\n  VALUE = <span class="template-variable">&#123;&#123; $value &#125;&#125;</span>\n  LABELS: <span class="template-variable">&#123;&#123; $labels &#125;&#125;</span>&quot;</span>       </span><br><span class="line">    <span class="bullet">-</span> <span class="attr">alert:</span> <span class="string">OutOfMemory</span></span><br><span class="line">      <span class="attr">expr:</span> <span class="string">redis_memory_used_bytes</span> <span class="string">/</span> <span class="string">redis_total_system_memory_bytes</span> <span class="string">*</span> <span class="number">100</span> <span class="string">&gt;</span> <span class="number">90</span></span><br><span class="line">      <span class="attr">for:</span> <span class="string">5m</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">severity:</span> <span class="string">warning</span></span><br><span class="line">      <span class="attr">annotations:</span></span><br><span class="line">        <span class="attr">summary:</span> <span class="string">&quot;Out of memory (instance <span class="template-variable">&#123;&#123; $labels.instance &#125;&#125;</span>)&quot;</span></span><br><span class="line">        <span class="attr">description:</span> <span class="string">&quot;Redis is running out of memory (&gt; 90%)\n  VALUE = <span class="template-variable">&#123;&#123; $value &#125;&#125;</span>\n  LABELS: <span class="template-variable">&#123;&#123; $labels &#125;&#125;</span>&quot;</span></span><br><span class="line">        </span><br><span class="line">    <span class="bullet">-</span> <span class="attr">alert:</span> <span class="string">告警！Kafka</span> <span class="string">Topics</span> <span class="string">副本数少于3</span></span><br><span class="line">      <span class="attr">expr:</span> <span class="string">sum(kafka_topic_partition_in_sync_replica)</span> <span class="string">by</span> <span class="string">(topic)</span> <span class="string">&lt;</span> <span class="number">3</span></span><br><span class="line">      <span class="attr">for:</span> <span class="string">0m</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">      <span class="attr">severity:</span> <span class="string">严重告警</span></span><br><span class="line">      <span class="attr">annotations:</span></span><br><span class="line">        <span class="attr">summary:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; $labels.instance &#125;&#125;</span> Kafka topics 副本数少于3&quot;</span></span><br><span class="line">        <span class="attr">description:</span> <span class="string">&quot;Kafka topic 分区不同步\n  当前值 = <span class="template-variable">&#123;&#123; $value &#125;&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line">   <span class="bullet">-</span> <span class="attr">alert:</span> <span class="string">告警！KafkaConsumersGroup</span></span><br><span class="line">     <span class="attr">expr:</span> <span class="string">sum(kafka_consumergroup_lag)</span> <span class="string">by</span> <span class="string">(consumergroup)</span> <span class="string">&gt;</span> <span class="number">50</span></span><br><span class="line">     <span class="attr">for:</span> <span class="string">1m</span></span><br><span class="line">     <span class="attr">labels:</span></span><br><span class="line">       <span class="attr">severity:</span> <span class="string">严重告警</span></span><br><span class="line">     <span class="attr">annotations:</span></span><br><span class="line">       <span class="attr">summary:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; $labels.instance &#125;&#125;</span> Kafka consumers group&quot;</span></span><br><span class="line">       <span class="attr">description:</span> <span class="string">&quot;Kafka consumers group\n  当前值 = <span class="template-variable">&#123;&#123; $value &#125;&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">&#x27;kafka&#x27;</span></span><br><span class="line">    <span class="attr">scrape_interval:</span> <span class="string">30s</span></span><br><span class="line">    <span class="attr">static_configs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">targets:</span> [<span class="string">&#x27;172.31.10.127:9308&#x27;</span>]</span><br><span class="line"><span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">&#x27;redis&#x27;</span></span><br><span class="line">    <span class="attr">scrape_interval:</span> <span class="string">30s</span></span><br><span class="line">    <span class="attr">static_configs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">targets:</span> [<span class="string">&#x27;172.31.10.123:9121&#x27;</span>]</span><br></pre></td></tr></table></figure>
<h2 id="5-增加grafana仪表盘"><a href="#5-增加grafana仪表盘" class="headerlink" title="5.增加grafana仪表盘"></a>5.增加grafana仪表盘</h2><p>kafka的模板id：12326</p>
<p>redis的模板id：11692</p>
]]></content>
      <categories>
        <category>计算机</category>
      </categories>
  </entry>
  <entry>
    <title>apache griffin安装文档</title>
    <url>/2023/04/30/%E8%AE%A1%E7%AE%97%E6%9C%BA/apache%20griffin%E9%83%A8%E7%BD%B2%E6%96%87%E6%A1%A3/</url>
    <content><![CDATA[<h1 id="apache-griffin安装文档"><a href="#apache-griffin安装文档" class="headerlink" title="apache griffin安装文档"></a>apache griffin安装文档</h1><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"> </span><br><span class="line"> griffin:</span><br><span class="line">  image: apachegriffin/griffin_spark2:0.3.0</span><br><span class="line">  hostname: griffin</span><br><span class="line">  links:</span><br><span class="line">    - es</span><br><span class="line">  environment:</span><br><span class="line">    ES_HOSTNAME: es</span><br><span class="line">  volumes:</span><br><span class="line">    - /var/lib/mysql</span><br><span class="line">  ports:</span><br><span class="line">    - 32122:2122</span><br><span class="line">    - 38088:8088  <span class="comment"># yarn rm web ui</span></span><br><span class="line">    - 33306:3306  <span class="comment"># mysql</span></span><br><span class="line">    - 35432:5432  <span class="comment"># postgres</span></span><br><span class="line">    - 38042:8042  <span class="comment"># yarn nm web ui</span></span><br><span class="line">    - 39083:9083  <span class="comment"># hive-metastore</span></span><br><span class="line">    - 38998:8998  <span class="comment"># livy</span></span><br><span class="line">    - 38080:8080  <span class="comment"># griffin ui</span></span><br><span class="line">  <span class="built_in">tty</span>: <span class="literal">true</span></span><br><span class="line">  container_name: griffin</span><br><span class="line"></span><br><span class="line">es:</span><br><span class="line">  image: apachegriffin/elasticsearch</span><br><span class="line">  hostname: es</span><br><span class="line">  ports:</span><br><span class="line">    - 39200:9200</span><br><span class="line">    - 39300:9300</span><br><span class="line">  container_name: es</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>计算机</category>
      </categories>
  </entry>
  <entry>
    <title>在线datahub搭建</title>
    <url>/2023/04/30/%E8%AE%A1%E7%AE%97%E6%9C%BA/centos7%E5%9C%A8%E7%BA%BFdatahub%E6%90%AD%E5%BB%BA/</url>
    <content><![CDATA[<h1 id="centos7在线datahub搭建"><a href="#centos7在线datahub搭建" class="headerlink" title="centos7在线datahub搭建"></a>centos7在线datahub搭建</h1><h2 id="1-安装vmware"><a href="#1-安装vmware" class="headerlink" title="1.安装vmware"></a>1.安装vmware</h2><h2 id="2-安装centos7"><a href="#2-安装centos7" class="headerlink" title="2.安装centos7"></a>2.安装centos7</h2><p>设置虚拟机为8g内存，2核处理器，80g硬盘</p>
<h2 id="3-环境准备"><a href="#3-环境准备" class="headerlink" title="3.环境准备"></a>3.环境准备</h2><h3 id="关闭并禁用防火墙"><a href="#关闭并禁用防火墙" class="headerlink" title="关闭并禁用防火墙"></a>关闭并禁用防火墙</h3><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">su root</span><br><span class="line">systemctl stop firewalld</span><br><span class="line">systemctl <span class="built_in">disable</span> firewalld</span><br><span class="line"><span class="comment">#关闭selinux鉴权</span></span><br><span class="line">vim  /etc/selinux/config</span><br><span class="line">SELINUX=<span class="built_in">disable</span></span><br></pre></td></tr></table></figure>
<p>然后xshell连接虚拟机，方便操作</p>
<h3 id="挂载共享文件夹"><a href="#挂载共享文件夹" class="headerlink" title="挂载共享文件夹"></a>挂载共享文件夹</h3><p>在vmware里挂载对应目录</p>
<p>然后在虚拟机内</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> /mnt/hgfs</span><br><span class="line">yum install open-vm-tools</span><br><span class="line">vmhgfs-fuse .host:/ /mnt/hgfs</span><br></pre></td></tr></table></figure>
<h3 id="yum换源"><a href="#yum换源" class="headerlink" title="yum换源"></a>yum换源</h3><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment">#安装wget</span></span><br><span class="line">yum install wget -y</span><br><span class="line"><span class="comment">#备份原来的源</span></span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">mv</span> /etc/yum.repos.d/CentOS-Base.repo /etc/yum.repos.d/CentOS-Base.repo.bk</span><br><span class="line"><span class="comment">#下载阿里源</span></span><br><span class="line"><span class="built_in">cd</span> /etc/yum.repos.d</span><br><span class="line"><span class="built_in">sudo</span> wget -nc http://mirrors.aliyun.com/repo/Centos-7.repo</span><br><span class="line"><span class="comment">#更改阿里yum源为默认源</span></span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">mv</span> Centos-7.repo CentOS-Base.repo</span><br><span class="line"><span class="comment">#更新本地yum缓存</span></span><br><span class="line"><span class="comment"># 全部清除</span></span><br><span class="line">yum clean all</span><br><span class="line"><span class="comment"># 更新列表</span></span><br><span class="line">yum list</span><br><span class="line"><span class="comment"># 缓存yum包信息到本机，提高搜索速度</span></span><br><span class="line">yum makecache</span><br></pre></td></tr></table></figure>
<h3 id="安装docker"><a href="#安装docker" class="headerlink" title="安装docker"></a>安装docker</h3><p>外面下好docker-19.03.9.tgz，并放在虚拟机的共享文件夹里</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> /mnt/hgfs/tmp</span><br><span class="line">tar zxvf docker-19.03.9.tgz</span><br><span class="line"><span class="built_in">cp</span> docker/* /usr/bin</span><br></pre></td></tr></table></figure>
<h4 id="systemd管理docker"><a href="#systemd管理docker" class="headerlink" title="systemd管理docker"></a>systemd管理docker</h4><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cat</span> &gt; /usr/lib/systemd/system/docker.service &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string">[Unit]</span></span><br><span class="line"><span class="string">Description=Docker Application Container Engine</span></span><br><span class="line"><span class="string">Documentation=https://docs.docker.com</span></span><br><span class="line"><span class="string">After=network-online.target firewalld.service</span></span><br><span class="line"><span class="string">Wants=network-online.target</span></span><br><span class="line"><span class="string">[Service]</span></span><br><span class="line"><span class="string">Type=notify</span></span><br><span class="line"><span class="string">ExecStart=/usr/bin/dockerd</span></span><br><span class="line"><span class="string">ExecReload=/bin/kill -s HUP $MAINPID</span></span><br><span class="line"><span class="string">LimitNOFILE=infinity</span></span><br><span class="line"><span class="string">LimitNPROC=infinity</span></span><br><span class="line"><span class="string">LimitCORE=infinity</span></span><br><span class="line"><span class="string">TimeoutStartSec=0</span></span><br><span class="line"><span class="string">Delegate=yes</span></span><br><span class="line"><span class="string">KillMode=process</span></span><br><span class="line"><span class="string">Restart=on-failure</span></span><br><span class="line"><span class="string">StartLimitBurst=3</span></span><br><span class="line"><span class="string">StartLimitInterval=60s</span></span><br><span class="line"><span class="string">[Install]</span></span><br><span class="line"><span class="string">WantedBy=multi-user.target</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure>
<h4 id="创建配置文件"><a href="#创建配置文件" class="headerlink" title="创建配置文件"></a>创建配置文件</h4><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> /etc/docker</span><br><span class="line"><span class="built_in">cat</span> &gt; /etc/docker/daemon.json &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">  &quot;registry-mirrors&quot;: [&quot;https://b9pmyelo.mirror.aliyuncs.com&quot;],</span></span><br><span class="line"><span class="string">  &quot;log-driver&quot;:&quot;json-file&quot;,</span></span><br><span class="line"><span class="string">  &quot;log-opts&quot;: &#123;&quot;max-size&quot;:&quot;500m&quot;, &quot;max-file&quot;:&quot;3&quot;&#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure>
<h4 id="启动并设置开机启动"><a href="#启动并设置开机启动" class="headerlink" title="启动并设置开机启动"></a>启动并设置开机启动</h4><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl start docker</span><br><span class="line">systemctl <span class="built_in">enable</span> docker</span><br></pre></td></tr></table></figure>
<h3 id="安装docker-compse-v2"><a href="#安装docker-compse-v2" class="headerlink" title="安装docker compse v2"></a>安装docker compse v2</h3><p>外面下好docker-compose-linux-x86_64，并放在虚拟机的共享文件夹里</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">mkdir -p ~/.docker/cli-plugins/</span><br><span class="line">cd /mnt/hgfs/tmp</span><br><span class="line">cp docker-compose-linux-x86_64 ~/.docker/cli-plugins/docker-compose</span><br><span class="line">chmod +x ~/.docker/cli-plugins/docker-compose</span><br><span class="line">docker compose version</span><br></pre></td></tr></table></figure>
<h3 id="安装python3"><a href="#安装python3" class="headerlink" title="安装python3"></a>安装python3</h3><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">yum -y groupinstall <span class="string">&quot;Development tools&quot;</span></span><br><span class="line">yum -y install zlib-devel bzip2-devel openssl-devel ncurses-devel sqlite-devel readline-devel tk-devel gdbm-devel db4-devel libpcap-devel xz-devel</span><br><span class="line">yum install -y libffi-devel zlib1g-dev</span><br><span class="line">yum install zlib* -y</span><br></pre></td></tr></table></figure>
<p>外面下好Python-3.10.10.tar.xz，并放在虚拟机的共享文件夹里</p>
<h4 id="安装openssl-1-1-1"><a href="#安装openssl-1-1-1" class="headerlink" title="安装openssl-1.1.1"></a>安装openssl-1.1.1</h4><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">wget http://www.openssl.org/source/openssl-1.1.1.tar.gz --no-check-certificate</span><br><span class="line">tar -zxvf openssl-1.1.1.tar.gz</span><br><span class="line"><span class="built_in">cp</span> openssl-1.1.1 /root/openssl-1.1.1 -r</span><br><span class="line"><span class="built_in">cd</span> /root/openssl-1.1.1</span><br><span class="line">./config --prefix=<span class="variable">$HOME</span>/openssl shared zlib</span><br><span class="line">make &amp;&amp; make install</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;export LD_LIBRARY_PATH=<span class="variable">$LD_LIBRARY_PATH</span>:<span class="variable">$HOME</span>/openssl/lib&quot;</span> &gt;&gt; <span class="variable">$HOME</span>/.bash_profile</span><br><span class="line"><span class="built_in">source</span> <span class="variable">$HOME</span>/.bash_profile</span><br></pre></td></tr></table></figure>
<h4 id="安装Python"><a href="#安装Python" class="headerlink" title="安装Python"></a>安装Python</h4><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">tar -zxvf Python-3.10.10.tgz </span><br><span class="line"><span class="built_in">mkdir</span> /usr/local/python3 </span><br><span class="line"><span class="built_in">cd</span> Python-3.10.10</span><br><span class="line">./configure --prefix=/usr/local/python3 --with-ssl --with-openssl=<span class="variable">$HOME</span>/openssl</span><br><span class="line"><span class="comment">#第一个指定安装的路径,不指定的话,安装过程中可能软件所需要的文件复制到其他不同目录,删除软件很不方便,复制软件也不方便.</span></span><br><span class="line"><span class="comment">#第三个是为了安装pip需要用到ssl,后面报错会有提到.</span></span><br><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></table></figure>
<h4 id="创建软链接"><a href="#创建软链接" class="headerlink" title="创建软链接"></a>创建软链接</h4><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">ln</span> -s /usr/local/python3/bin/python3 /usr/local/bin/python3</span><br><span class="line"><span class="built_in">ln</span> -s /usr/local/python3/bin/pip3 /usr/local/bin/pip3</span><br></pre></td></tr></table></figure>
<h4 id="验证"><a href="#验证" class="headerlink" title="验证"></a>验证</h4><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">python3 -V</span><br><span class="line">pip3 -V</span><br></pre></td></tr></table></figure>
<h4 id="import-ssl"><a href="#import-ssl" class="headerlink" title="import ssl"></a>import ssl</h4><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">python3</span><br><span class="line">import ssl</span><br></pre></td></tr></table></figure>
<h4 id="修改pip安装源"><a href="#修改pip安装源" class="headerlink" title="修改pip安装源"></a>修改pip安装源</h4><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> ~</span><br><span class="line"><span class="built_in">mkdir</span> .pip</span><br><span class="line"><span class="built_in">cd</span> .pip</span><br><span class="line">vim pip.conf</span><br><span class="line"><span class="comment">#进入后添加以下内容,保存退出.</span></span><br><span class="line">[global]</span><br><span class="line">index-url = https://mirrors.aliyun.com/pypi/simple</span><br></pre></td></tr></table></figure>
<h2 id="datahub安装"><a href="#datahub安装" class="headerlink" title="datahub安装"></a>datahub安装</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">python3 -m pip install --upgrade pip wheel setuptools</span><br><span class="line">python3 -m pip uninstall datahub acryl-datahub || <span class="literal">true</span>  <span class="comment"># sanity check - ok if it fails</span></span><br><span class="line">python3 -m pip install --upgrade acryl-datahub</span><br><span class="line"></span><br><span class="line">python3 -m datahub version</span><br><span class="line">python3 -m datahub check plugins</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">#<span class="number">192.168</span><span class="number">.184</span><span class="number">.2</span>的安装需要额外的命令</span><br><span class="line"><span class="keyword">GRANT</span> USAGE <span class="keyword">ON</span> <span class="operator">*</span>.<span class="operator">*</span> <span class="keyword">TO</span> <span class="string">&#x27;datahub&#x27;</span>@<span class="string">&#x27;%&#x27;</span> IDENTIFIED <span class="keyword">BY</span> <span class="string">&#x27;datahub&#x27;</span> <span class="keyword">WITH</span> <span class="keyword">GRANT</span> OPTION;</span><br><span class="line"><span class="keyword">GRANT</span> USAGE <span class="keyword">ON</span> <span class="operator">*</span>.<span class="operator">*</span> <span class="keyword">TO</span> <span class="string">&#x27;datahub&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span> IDENTIFIED <span class="keyword">BY</span> <span class="string">&#x27;datahub&#x27;</span> <span class="keyword">WITH</span> <span class="keyword">GRANT</span> OPTION;</span><br><span class="line">FLUSH PRIVILEGES;</span><br></pre></td></tr></table></figure>
<h3 id="启动datahub"><a href="#启动datahub" class="headerlink" title="启动datahub"></a>启动datahub</h3><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">python3 -m datahub docker quickstart</span><br><span class="line">python3 -m datahub docker quickstart --quickstart-compose-file /mnt/hgfs/tmp/datahub/datahub-master/docker/quickstart/docker-compose.quickstart.yml</span><br><span class="line">python3 -m datahub docker quickstart --quickstart-compose-file /mnt/hgfs/tmp/datahub/docker-compose-without-neo4j.quickstart.yml</span><br><span class="line">python3 -m datahub docker quickstart --stop</span><br></pre></td></tr></table></figure>
<h2 id="引入mysql数据源"><a href="#引入mysql数据源" class="headerlink" title="引入mysql数据源"></a>引入mysql数据源</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">python3 -m pip install <span class="string">&#x27;acryl-datahub[mysql]&#x27;</span></span><br><span class="line">python3 -m datahub ingest -c mysql.yaml</span><br></pre></td></tr></table></figure>
<p>mysql.yaml</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">source:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">mysql</span></span><br><span class="line">  <span class="attr">config:</span></span><br><span class="line">    <span class="comment"># Coordinates</span></span><br><span class="line">    <span class="attr">host_port:</span> <span class="number">172.31</span><span class="number">.70</span><span class="number">.133</span><span class="string">:3306</span></span><br><span class="line">    <span class="attr">database:</span> <span class="string">supervision-safety</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># Credentials</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">xjkaiya123,.</span></span><br></pre></td></tr></table></figure>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">source:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">mysql</span></span><br><span class="line">    <span class="attr">config:</span></span><br><span class="line">        <span class="attr">host_port:</span> <span class="string">&#x27;172.31.70.196:3306&#x27;</span></span><br><span class="line">        <span class="attr">database:</span> <span class="string">snowlotus</span></span><br><span class="line">        <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">        <span class="attr">password:</span> <span class="string">&#x27;xjkaiya123,.&#x27;</span></span><br><span class="line">        <span class="attr">include_tables:</span> <span class="literal">true</span></span><br><span class="line">        <span class="attr">include_views:</span> <span class="literal">true</span></span><br><span class="line">        <span class="attr">profiling:</span></span><br><span class="line">            <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">            <span class="attr">profile_table_level_only:</span> <span class="literal">true</span></span><br><span class="line">        <span class="attr">stateful_ingestion:</span></span><br><span class="line">            <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">        <span class="attr">password:</span> <span class="string">&#x27;xjkaiya123,.&#x27;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;operationName&quot;</span><span class="punctuation">:</span><span class="string">&quot;createIngestionSource&quot;</span><span class="punctuation">,</span><span class="attr">&quot;variables&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;input&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span><span class="string">&quot;mysql&quot;</span><span class="punctuation">,</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;70.196-necares_auth&quot;</span><span class="punctuation">,</span><span class="attr">&quot;config&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;recipe&quot;</span><span class="punctuation">:</span><span class="string">&quot;&#123;\&quot;source\&quot;:&#123;\&quot;type\&quot;:\&quot;mysql\&quot;,\&quot;config\&quot;:&#123;\&quot;host_port\&quot;:\&quot;172.31.70.196:3306\&quot;,\&quot;database\&quot;:\&quot;necares_auth\&quot;,\&quot;username\&quot;:\&quot;root\&quot;,\&quot;include_tables\&quot;:true,\&quot;include_views\&quot;:true,\&quot;profiling\&quot;:&#123;\&quot;enabled\&quot;:true,\&quot;profile_table_level_only\&quot;:true&#125;,\&quot;stateful_ingestion\&quot;:&#123;\&quot;enabled\&quot;:true&#125;,\&quot;password\&quot;:\&quot;xjkaiya123,.\&quot;&#125;&#125;&#125;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;executorId&quot;</span><span class="punctuation">:</span><span class="string">&quot;default&quot;</span><span class="punctuation">,</span><span class="attr">&quot;debugMode&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="attr">&quot;schedule&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;interval&quot;</span><span class="punctuation">:</span><span class="string">&quot;0 0 * * *&quot;</span><span class="punctuation">,</span><span class="attr">&quot;timezone&quot;</span><span class="punctuation">:</span><span class="string">&quot;Asia/Shanghai&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">&#125;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="attr">&quot;query&quot;</span><span class="punctuation">:</span><span class="string">&quot;mutation createIngestionSource($input: UpdateIngestionSourceInput!) &#123;\n  createIngestionSource(input: $input)\n&#125;\n&quot;</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>计算机</category>
      </categories>
  </entry>
  <entry>
    <title>常用graphql操作</title>
    <url>/2023/04/30/%E8%AE%A1%E7%AE%97%E6%9C%BA/datahub%E7%9A%84graphql%E6%9F%A5%E8%AF%A2%E8%AF%AD%E5%8F%A5/</url>
    <content><![CDATA[<h1 id="常用graphql操作"><a href="#常用graphql操作" class="headerlink" title="常用graphql操作"></a>常用graphql操作</h1><p><a href="http://localhost:9002/api/graphiql">localhost:9002/api/graphiql</a></p>
<h2 id="获取鉴权token"><a href="#获取鉴权token" class="headerlink" title="获取鉴权token"></a>获取鉴权token</h2><p>输入</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="string">mutation</span> &#123;</span><br><span class="line">  <span class="attr">createAccessToken(input:</span> &#123;<span class="attr">type:</span> <span class="string">PERSONAL</span>, <span class="attr">actorUrn:</span> <span class="string">&quot;urn:li:corpuser:datahub&quot;</span>, <span class="attr">duration:</span> <span class="string">ONE_HOUR</span>, <span class="attr">name:</span> <span class="string">&quot;my personal token&quot;</span>&#125;<span class="string">)</span> &#123;</span><br><span class="line">    <span class="string">accessToken</span></span><br><span class="line">    <span class="string">metadata</span> &#123;</span><br><span class="line">      <span class="string">id</span></span><br><span class="line">      <span class="string">name</span></span><br><span class="line">      <span class="string">description</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>执行</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;data&quot;:</span> &#123;</span><br><span class="line">    <span class="attr">&quot;createAccessToken&quot;:</span> &#123;</span><br><span class="line">      <span class="attr">&quot;accessToken&quot;:</span> <span class="string">&quot;eyJhbGciOiJIUzI1NiJ9.eyJhY3RvclR5cGUiOiJVU0VSIiwiYWN0b3JJZCI6ImRhdGFodWIiLCJ0eXBlIjoiUEVSU09OQUwiLCJ2ZXJzaW9uIjoiMiIsImp0aSI6ImM1ZjViOWRjLTg0ODktNDgxNS05ZDg5LTZkNzIyMTMyNjY0OCIsInN1YiI6ImRhdGFodWIiLCJleHAiOjE2ODA0OTQ4NTQsImlzcyI6ImRhdGFodWItbWV0YWRhdGEtc2VydmljZSJ9.mESshq5MlbF24PiRAcbunVYpAJYP5vUSX6onYpfvn6A&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;metadata&quot;:</span> &#123;</span><br><span class="line">        <span class="attr">&quot;id&quot;:</span> <span class="string">&quot;h603AUtusRH7eHVT/Aw4g+p5tfEVw+Tf0oyCiMql310=&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;name&quot;:</span> <span class="string">&quot;my personal token&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;description&quot;:</span> <span class="literal">null</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;extensions&quot;:</span> &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>查询所有token</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">listAccessTokens(input:</span> &#123;<span class="attr">start:</span> <span class="number">0</span>, <span class="attr">count:</span> <span class="number">100</span>, <span class="attr">filters:</span> [&#123;<span class="attr">field:</span> <span class="string">&quot;ownerUrn&quot;</span>, <span class="attr">value:</span> <span class="string">&quot;urn:li:corpuser:datahub&quot;</span>&#125;]&#125;<span class="string">)</span> &#123;</span><br><span class="line">    <span class="string">start</span></span><br><span class="line">    <span class="string">count</span></span><br><span class="line">    <span class="string">total</span></span><br><span class="line">    <span class="string">tokens</span> &#123;</span><br><span class="line">      <span class="string">urn</span></span><br><span class="line">      <span class="string">id</span></span><br><span class="line">      <span class="string">actorUrn</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>撤销token</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="string">mutation</span> &#123;</span><br><span class="line">  <span class="attr">revokeAccessToken(tokenId:</span> <span class="string">&quot;HnMJylxuowJ1FKN74BbGogLvXCS4w+fsd3MZdI35+8A=&quot;</span><span class="string">)</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">eyJhbGciOiJIUzI1NiJ9.eyJhY3RvclR5cGUiOiJVU0VSIiwiYWN0b3JJZCI6ImRhdGFodWIiLCJ0eXBlIjoiUEVSU09OQUwiLCJ2ZXJzaW9uIjoiMiIsImp0aSI6IjRjYzBlYjNkLWI4NmEtNDczMi1hYzczLWYyZjliMWY4NmUyOCIsInN1YiI6ImRhdGFodWIiLCJpc3MiOiJkYXRhaHViLW1ldGFkYXRhLXNlcnZpY2UifQ.fLtEwO24nc5IszuKunFm4EroZRhGuUaUR68s4iZiV8Q</span><br><span class="line"></span><br><span class="line">curl -X POST <span class="string">&#x27;http://localhost:9002/api/graphql&#x27;</span> \</span><br><span class="line">--header <span class="string">&#x27;Authorization: Bearer eyJhbGciOiJIUzI1NiJ9.eyJhY3RvclR5cGUiOiJVU0VSIiwiYWN0b3JJZCI6ImRhdGFodWIiLCJ0eXBlIjoiUEVSU09OQUwiLCJ2ZXJzaW9uIjoiMiIsImp0aSI6IjRjYzBlYjNkLWI4NmEtNDczMi1hYzczLWYyZjliMWY4NmUyOCIsInN1YiI6ImRhdGFodWIiLCJpc3MiOiJkYXRhaHViLW1ldGFkYXRhLXNlcnZpY2UifQ.fLtEwO24nc5IszuKunFm4EroZRhGuUaUR68s4iZiV8Q&#x27;</span> \</span><br><span class="line">--header <span class="string">&#x27;Content-Type: application/json&#x27;</span> \</span><br><span class="line">-d <span class="string">&#x27;&#123;&quot;query&quot;:&quot;&#123;\n  me &#123;\n    corpUser &#123;\n        username\n    &#125;\n  &#125;\n&#125;&quot;,&quot;variables&quot;:&#123;&#125;&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line">eyJhbGciOiJIUzI1NiJ9.eyJhY3RvclR5cGUiOiJVU0VSIiwiYWN0b3JJZCI6ImRhdGFodWIiLCJ0eXBlIjoiUEVSU09OQUwiLCJ2ZXJzaW9uIjoiMiIsImp0aSI6ImExMDQ3OTIzLWRjNzYtNGQwZC1hYzNkLTg3MGI5ODVhNjkyZCIsInN1YiI6ImRhdGFodWIiLCJleHAiOjE2ODM5NDczODMsImlzcyI6ImRhdGFodWItbWV0YWRhdGEtc2VydmljZSJ9.KqWKqA_x1rjn8UcYuW_X9pxLyRY47y6eFVmARk3JnII</span><br><span class="line"></span><br><span class="line">curl -X POST <span class="string">&#x27;http://localhost:9002/api/graphql&#x27;</span> \</span><br><span class="line">--header <span class="string">&#x27;Authorization: Bearer eyJhbGciOiJIUzI1NiJ9.eyJhY3RvclR5cGUiOiJVU0VSIiwiYWN0b3JJZCI6ImRhdGFodWIiLCJ0eXBlIjoiUEVSU09OQUwiLCJ2ZXJzaW9uIjoiMiIsImp0aSI6ImExMDQ3OTIzLWRjNzYtNGQwZC1hYzNkLTg3MGI5ODVhNjkyZCIsInN1YiI6ImRhdGFodWIiLCJleHAiOjE2ODM5NDczODMsImlzcyI6ImRhdGFodWItbWV0YWRhdGEtc2VydmljZSJ9.KqWKqA_x1rjn8UcYuW_X9pxLyRY47y6eFVmARk3JnII&#x27;</span> \</span><br><span class="line">--header <span class="string">&#x27;Content-Type: application/json&#x27;</span> \</span><br><span class="line">--data <span class="string">&#x27;&#123;&quot;query&quot;:&quot;&#123;\n  me &#123;\n    corpUser &#123;\n        username\n    &#125;\n  &#125;\n&#125;&quot;,&quot;variables&quot;:&#123;&#125;&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line">curl <span class="string">&#x27;http://localhost:9002/api/gms/entities/urn:li:corpuser:datahub&#x27;</span> -H <span class="string">&#x27;Authorization: Bearer eyJhbGciOiJIUzI1NiJ9.eyJhY3RvclR5cGUiOiJVU0VSIiwiYWN0b3JJZCI6ImRhdGFodWIiLCJ0eXBlIjoiUEVSU09OQUwiLCJ2ZXJzaW9uIjoiMiIsImp0aSI6ImExMDQ3OTIzLWRjNzYtNGQwZC1hYzNkLTg3MGI5ODVhNjkyZCIsInN1YiI6ImRhdGFodWIiLCJleHAiOjE2ODM5NDczODMsImlzcyI6ImRhdGFodWItbWV0YWRhdGEtc2VydmljZSJ9.KqWKqA_x1rjn8UcYuW_X9pxLyRY47y6eFVmARk3JnII</span></span><br></pre></td></tr></table></figure>
<p>查token</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    me&#123;</span><br><span class="line">        corpUser&#123;</span><br><span class="line">            username</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="查询mysql数据源属性"><a href="#查询mysql数据源属性" class="headerlink" title="查询mysql数据源属性"></a>查询mysql数据源属性</h2><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">ingestionSource(urn:&quot;urn:li:dataHubIngestionSource:ad984b8a-28be-4faa-b397-d8dc3a18c643&quot;)</span>&#123;</span><br><span class="line">  <span class="string">urn</span></span><br><span class="line">    <span class="string">type</span></span><br><span class="line"> <span class="string">name</span></span><br><span class="line">    <span class="string">platform</span>&#123;</span><br><span class="line">      <span class="string">urn</span></span><br><span class="line">      <span class="string">name</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="string">config</span>&#123;</span><br><span class="line">      <span class="string">recipe</span></span><br><span class="line">      <span class="string">executorId</span></span><br><span class="line">      <span class="string">version</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="string">executions</span>&#123;</span><br><span class="line">      <span class="string">start</span></span><br><span class="line">      <span class="string">count</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="string">java</span> <span class="string">-jar</span> <span class="string">C:\Users\Developer\.m2\repository\org\example\table-manage\1.0-SNAPSHOT\table-manage-1.0-SNAPSHOT.jar</span></span><br></pre></td></tr></table></figure>
<h2 id="列出所有域"><a href="#列出所有域" class="headerlink" title="列出所有域"></a>列出所有域</h2><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="string">listDomains(input:&#123;start:0,count:100&#125;)&#123;</span></span><br><span class="line">    <span class="string">domains&#123;</span></span><br><span class="line">      <span class="string">urn</span></span><br><span class="line">      <span class="string">type</span></span><br><span class="line">      <span class="string">id</span></span><br><span class="line">      <span class="string">properties&#123;</span></span><br><span class="line">        <span class="string">name</span></span><br><span class="line">        <span class="string">description</span></span><br><span class="line">      <span class="string">&#125;</span></span><br><span class="line">    <span class="string">&#125;</span></span><br><span class="line">  <span class="string">&#125;</span></span><br></pre></td></tr></table></figure>
<h2 id="获取所有根词汇节点"><a href="#获取所有根词汇节点" class="headerlink" title="获取所有根词汇节点"></a>获取所有根词汇节点</h2><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">getRootGlossaryNodes(input:</span>&#123;<span class="string">start:0</span>,<span class="string">count:100</span>&#125;<span class="string">)</span>&#123;</span><br><span class="line">    <span class="string">count</span></span><br><span class="line">    <span class="string">nodes</span>&#123;</span><br><span class="line">      <span class="string">urn</span></span><br><span class="line">      <span class="string">properties</span>&#123;</span><br><span class="line">        <span class="string">name</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="string">parentNodes</span>&#123;</span><br><span class="line">        <span class="string">nodes</span>&#123;</span><br><span class="line">          <span class="string">urn</span></span><br><span class="line">          <span class="string">properties</span>&#123;</span><br><span class="line">            <span class="string">name</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="获取所有根词汇术语"><a href="#获取所有根词汇术语" class="headerlink" title="获取所有根词汇术语"></a>获取所有根词汇术语</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  getRootGlossaryTerms(input:&#123;start:0,count:100&#125;)&#123;</span><br><span class="line">    count</span><br><span class="line">    terms&#123;</span><br><span class="line">      urn</span><br><span class="line">      properties&#123;</span><br><span class="line">        name</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="用dataSet的urn查dataSet信息"><a href="#用dataSet的urn查dataSet信息" class="headerlink" title="用dataSet的urn查dataSet信息"></a>用dataSet的urn查dataSet信息</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  dataset(urn:<span class="string">&quot;urn:li:container:ee6a71df5d49df25c6f9e879ebef78a1&quot;</span>)&#123;</span><br><span class="line">    lastIngested</span><br><span class="line">    subTypes&#123;</span><br><span class="line">      typeNames</span><br><span class="line">    &#125;</span><br><span class="line">   relationships(input:&#123;start:0,count:100,types:<span class="string">&quot;&quot;</span>,direction:INCOMING&#125;)&#123;</span><br><span class="line">    total</span><br><span class="line">    </span><br><span class="line">  &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>计算机</category>
      </categories>
  </entry>
  <entry>
    <title>authDfs网关部署文档</title>
    <url>/2023/04/30/%E8%AE%A1%E7%AE%97%E6%9C%BA/fastdfs%E6%96%B0%E7%BD%91%E5%85%B3%E9%85%8D%E7%BD%AE/</url>
    <content><![CDATA[<h1 id="authDfs网关部署文档"><a href="#authDfs网关部署文档" class="headerlink" title="authDfs网关部署文档"></a>authDfs网关部署文档</h1><h1 id="1-新增authDfs网关服务"><a href="#1-新增authDfs网关服务" class="headerlink" title="1.新增authDfs网关服务"></a>1.新增authDfs网关服务</h1><p>服务名：rabc-saas-fastdfs-gateway</p>
<p>端口9998</p>
<h1 id="2-新增authDfs网关Apollo配置"><a href="#2-新增authDfs网关Apollo配置" class="headerlink" title="2.新增authDfs网关Apollo配置"></a>2.新增authDfs网关Apollo配置</h1><p>id：rabc-saas-fastdfs-gateway</p>
<h1 id="3-新增nginx配置"><a href="#3-新增nginx配置" class="headerlink" title="3.新增nginx配置"></a>3.新增nginx配置</h1><h3 id="配置防盗链：校验rerfer"><a href="#配置防盗链：校验rerfer" class="headerlink" title="配置防盗链：校验rerfer"></a>配置防盗链：校验rerfer</h3><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 拦截非法referer </span></span><br><span class="line">    valid_referers none 172.31.70.136; </span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$invalid_referer</span>) &#123; </span><br><span class="line">        <span class="built_in">return</span> 403 ; </span><br><span class="line">        <span class="comment">#rewrite ^.*$ http://www.baidu.com/403.jpg; </span></span><br><span class="line">    &#125; </span><br></pre></td></tr></table></figure>
<p><img src="C:\Users\Developer\AppData\Roaming\Typora\typora-user-images\image-20230321165948689.png" alt="image-20230321165948689"></p>
<h3 id="配置authDfs路由"><a href="#配置authDfs路由" class="headerlink" title="配置authDfs路由"></a>配置authDfs路由</h3><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">upstream dfsGateway &#123;</span><br><span class="line">       server 172.31.70.137:9998 weight=1 max_fails=3 fail_timeout=180s;</span><br><span class="line">       server 172.31.70.136:9998 weight=1 max_fails=3 fail_timeout=180s;</span><br><span class="line">       server 172.31.70.139:9998 weight=1 max_fails=3 fail_timeout=180s;</span><br><span class="line">       server 172.31.70.140:9998 weight=1 max_fails=3 fail_timeout=180s;</span><br><span class="line">       server 172.31.70.113:9998 weight=1 max_fails=3 fail_timeout=180s;</span><br><span class="line">       server 172.31.70.114:9998 weight=1 max_fails=3 fail_timeout=180s;</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># authDfs网关</span></span><br><span class="line">       location /authDfs/ &#123;</span><br><span class="line">           proxy_pass http://dfsGateway/;</span><br><span class="line">           proxy_set_header Host <span class="variable">$host</span>;</span><br><span class="line">           proxy_set_header X-Real-IP <span class="variable">$remote_addr</span>;</span><br><span class="line">           proxy_set_header X-Real-Port <span class="variable">$remote_port</span>;</span><br><span class="line">           proxy_set_header X-Forwarded-For <span class="variable">$proxy_add_x_forwarded_for</span>;</span><br><span class="line">           add_header Access-Control-Allow-Headers <span class="variable">$http_access_control_request_headers</span>;</span><br><span class="line">           <span class="comment">#上传文件大小配置</span></span><br><span class="line">           client_max_body_size 100m;</span><br><span class="line">       &#125;</span><br></pre></td></tr></table></figure>
<h1 id="4-新增authDfs网关Jenkins项目"><a href="#4-新增authDfs网关Jenkins项目" class="headerlink" title="4.新增authDfs网关Jenkins项目"></a>4.新增authDfs网关Jenkins项目</h1><p>复制堡准正常-网关项目，配置文件修改为：</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">node &#123;</span><br><span class="line">    stage(<span class="string">&#x27;scm&#x27;</span>) &#123;</span><br><span class="line">        checkout([<span class="variable">$class</span>: <span class="string">&#x27;GitSCM&#x27;</span>, branches: [[name: <span class="string">&#x27;$&#123;branchName&#125;&#x27;</span>]], doGenerateSubmoduleConfigurations: <span class="literal">false</span>, extensions: [], submoduleCfg: [], userRemoteConfigs: [[credentialsId: <span class="string">&#x27;xjcares_git&#x27;</span>, url: <span class="string">&#x27;http://172.31.70.132:33788/necares/snowlotus-authority.git&#x27;</span>]]])</span><br><span class="line">        sh <span class="string">&#x27;echo \&#x27;</span>nodefinished:&lt;\&#x27;$(<span class="built_in">date</span> +%Y-%m-%d\\ %H:%M:%S)\&#x27;&gt;\&#x27;<span class="string">&#x27;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    stage(&#x27;</span>Build core<span class="string">&#x27;) &#123;</span></span><br><span class="line"><span class="string">        sh &#x27;</span><span class="string">&#x27;&#x27;</span></span><br><span class="line">            <span class="built_in">cd</span> core-paas-component</span><br><span class="line">            mvn clean deploy -Dmaven.test.skip=<span class="literal">true</span> -U</span><br><span class="line">            </span><br><span class="line">            <span class="string">&#x27;&#x27;</span><span class="string">&#x27;</span></span><br><span class="line"><span class="string">        sh &#x27;</span><span class="built_in">echo</span> \&#x27;nodefinished:&lt;\&#x27;$(<span class="built_in">date</span> +%Y-%m-%d\\ %H:%M:%S)\&#x27;&gt;\&#x27;<span class="string">&#x27;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    stage(&#x27;</span>Build dao<span class="string">&#x27;) &#123;</span></span><br><span class="line"><span class="string">        sh &#x27;</span><span class="string">&#x27;&#x27;</span></span><br><span class="line">            <span class="built_in">cd</span> dao-paas-component</span><br><span class="line">            mvn clean deploy -Dmaven.test.skip=<span class="literal">true</span> -U</span><br><span class="line">            </span><br><span class="line">            <span class="string">&#x27;&#x27;</span><span class="string">&#x27;</span></span><br><span class="line"><span class="string">        sh &#x27;</span><span class="built_in">echo</span> \&#x27;nodefinished:&lt;\&#x27;$(<span class="built_in">date</span> +%Y-%m-%d\\ %H:%M:%S)\&#x27;&gt;\&#x27;<span class="string">&#x27;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    stage(&#x27;</span>Build common<span class="string">&#x27;) &#123;</span></span><br><span class="line"><span class="string">        sh &#x27;</span><span class="string">&#x27;&#x27;</span></span><br><span class="line">            <span class="built_in">cd</span> rabc-saas-service/rabc-saas-common</span><br><span class="line">            mvn clean install -U -Dmaven.test.skip=<span class="literal">true</span> </span><br><span class="line">            <span class="string">&#x27;&#x27;</span><span class="string">&#x27;</span></span><br><span class="line"><span class="string">        sh &#x27;</span><span class="built_in">echo</span> \&#x27;nodefinished:&lt;\&#x27;$(<span class="built_in">date</span> +%Y-%m-%d\\ %H:%M:%S)\&#x27;&gt;\&#x27;<span class="string">&#x27;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    stage(&#x27;</span>Build<span class="string">&#x27;) &#123;</span></span><br><span class="line"><span class="string">        sh &#x27;</span><span class="string">&#x27;&#x27;</span></span><br><span class="line">            <span class="built_in">cd</span> rabc-saas-service/rabc-saas-gateway</span><br><span class="line">            mvn clean package -U -Dmaven.test.skip=<span class="literal">true</span> </span><br><span class="line">            <span class="string">&#x27;&#x27;</span><span class="string">&#x27;</span></span><br><span class="line"><span class="string">        sh &#x27;</span><span class="built_in">echo</span> \&#x27;nodefinished:&lt;\&#x27;$(<span class="built_in">date</span> +%Y-%m-%d\\ %H:%M:%S)\&#x27;&gt;\&#x27;<span class="string">&#x27;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    stage(&#x27;</span>build and push image<span class="string">&#x27;) &#123;</span></span><br><span class="line"><span class="string">        sh &#x27;</span><span class="string">&#x27;&#x27;</span></span><br><span class="line">            <span class="built_in">cd</span> rabc-saas-service/rabc-saas-gateway/target</span><br><span class="line">            REPOSITORY=172.31.70.135:8443/xjcares/rabc-saas-gateway</span><br><span class="line">            <span class="built_in">cat</span> &gt;&gt; Dockerfile &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">            FROM newjava:9</span></span><br><span class="line"><span class="string">            VOLUME /tmp</span></span><br><span class="line"><span class="string">            ADD rabc-saas-gateway-1.0-SNAPSHOT.jar app.jar</span></span><br><span class="line"><span class="string">            RUN bash -c &#x27;touch /app.jar&#x27;</span></span><br><span class="line"><span class="string">            ENTRYPOINT [&quot;java&quot;,&quot;-Djava.security.egd=file:/dev/./urandom&quot;,&quot;-jar&quot;,&quot;-Denv=pro&quot;,&quot;/app.jar&quot;, &quot;--spring.profiles.active=dfsFat&quot;, &quot;-Xmx=768m&quot;, &quot;-Xms=768m&quot;]</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line">            docker build -t <span class="variable">$REPOSITORY</span> .</span><br><span class="line">            docker login -u admin -p Cmcc@#123 172.31.70.135:8443</span><br><span class="line">            docker push <span class="variable">$REPOSITORY</span></span><br><span class="line">            docker <span class="built_in">logout</span> 172.31.70.135:8443</span><br><span class="line">            docker rmi <span class="variable">$REPOSITORY</span></span><br><span class="line">            <span class="string">&#x27;&#x27;</span><span class="string">&#x27;</span></span><br><span class="line"><span class="string">        sh &#x27;</span><span class="built_in">echo</span> \&#x27;nodefinished:&lt;\&#x27;$(<span class="built_in">date</span> +%Y-%m-%d\\ %H:%M:%S)\&#x27;&gt;\&#x27;<span class="string">&#x27;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    stage(&#x27;</span>deploy to k8s<span class="string">&#x27;) &#123;</span></span><br><span class="line"><span class="string">        def remote = [:]</span></span><br><span class="line"><span class="string">        remote.name = &#x27;</span>kubernetes<span class="string">&#x27;</span></span><br><span class="line"><span class="string">        remote.host = &#x27;</span>172.31.70.137<span class="string">&#x27;</span></span><br><span class="line"><span class="string">        remote.allowAnyHosts = true</span></span><br><span class="line"><span class="string">        withCredentials([usernamePassword(credentialsId: &#x27;</span>sshUser<span class="string">&#x27;, passwordVariable: &#x27;</span>passWord<span class="string">&#x27;, usernameVariable: &#x27;</span>userName<span class="string">&#x27;)]) &#123;</span></span><br><span class="line"><span class="string">            remote.user = userName</span></span><br><span class="line"><span class="string">            remote.password = passWord         </span></span><br><span class="line"><span class="string">            catchError(buildResult: &#x27;</span>SUCCESS<span class="string">&#x27;, message: &#x27;</span>未部署<span class="string">&#x27;) &#123;</span></span><br><span class="line"><span class="string">                sshCommand remote: remote, command: &quot;kubectl delete -f /gateway/rabc-saas-fastdfs-gateway.yaml&quot;</span></span><br><span class="line"><span class="string">            &#125;</span></span><br><span class="line"><span class="string">            sshCommand remote: remote, command: &quot;kubectl apply -f /gateway/rabc-saas-fastdfs-gateway.yaml&quot;</span></span><br><span class="line"><span class="string">            sh &#x27;</span><span class="built_in">echo</span> \&#x27;nodefinished:&lt;\&#x27;$(<span class="built_in">date</span> +%Y-%m-%d\\ %H:%M:%S)\&#x27;&gt;\&#x27;<span class="string">&#x27;</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure>
<p>文件位置：/gateway/rabc-saas-fastdfs-gateway.yaml</p>
<p>rabc-saas-fastdfs-gateway.yaml如下：</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">rabc-saas-fastdfs-gateway</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">rabc-saas-fastdfs-gateway</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">rabc-saas-fastdfs-gateway</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">initContainers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">image:</span> <span class="string">spring2go/skywalkwing-agent-sidecar:8.3.0</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">sw-agent-sidecar</span></span><br><span class="line">        <span class="attr">imagePullPolicy:</span> <span class="string">IfNotPresent</span></span><br><span class="line">        <span class="attr">command:</span> [<span class="string">&#x27;sh&#x27;</span>]</span><br><span class="line">        <span class="attr">args:</span></span><br><span class="line">            [</span><br><span class="line">                <span class="string">&#x27;-c&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;mkdir -p /skywalking/agent &amp;&amp; cp -r /usr/skywalking/agent/* /skywalking/agent&#x27;</span></span><br><span class="line">            ]</span><br><span class="line">        <span class="attr">volumeMounts:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">mountPath:</span> <span class="string">/skywalking/agent</span></span><br><span class="line">          <span class="attr">name:</span> <span class="string">sw-agent</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">rabc-gateway-service</span></span><br><span class="line">        <span class="attr">image:</span> <span class="number">172.31</span><span class="number">.70</span><span class="number">.135</span><span class="string">:8443/xjcares/rabc-saas-gateway:latest</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">9998</span></span><br><span class="line">          <span class="attr">hostPort:</span> <span class="number">9998</span></span><br><span class="line">        <span class="attr">livenessProbe:</span></span><br><span class="line">          <span class="attr">httpGet:</span></span><br><span class="line">            <span class="attr">path:</span> <span class="string">/actuator/health</span></span><br><span class="line">            <span class="attr">port:</span> <span class="number">9998</span></span><br><span class="line">          <span class="attr">initialDelaySeconds:</span> <span class="number">120</span></span><br><span class="line">          <span class="attr">periodSeconds:</span> <span class="number">30</span></span><br><span class="line">          <span class="attr">timeoutSeconds:</span> <span class="number">3</span></span><br><span class="line">          <span class="attr">successThreshold:</span> <span class="number">1</span></span><br><span class="line">          <span class="attr">failureThreshold:</span> <span class="number">5</span></span><br><span class="line">        <span class="attr">readinessProbe:</span></span><br><span class="line">          <span class="attr">httpGet:</span></span><br><span class="line">            <span class="attr">path:</span> <span class="string">/actuator/health</span></span><br><span class="line">            <span class="attr">port:</span> <span class="number">9998</span></span><br><span class="line">          <span class="attr">initialDelaySeconds:</span> <span class="number">120</span></span><br><span class="line">          <span class="attr">periodSeconds:</span> <span class="number">30</span></span><br><span class="line">          <span class="attr">timeoutSeconds:</span> <span class="number">3</span></span><br><span class="line">          <span class="attr">successThreshold:</span> <span class="number">1</span></span><br><span class="line">          <span class="attr">failureThreshold:</span> <span class="number">5</span></span><br><span class="line">        <span class="attr">env:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">JAVA_TOOL_OPTIONS</span></span><br><span class="line">          <span class="attr">value:</span> <span class="string">-javaagent:/usr/skywalking/agent/skywalking-agent.jar</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">SW_AGENT_NAME</span></span><br><span class="line">          <span class="attr">value:</span> <span class="string">gateway</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">SW_AGENT_COLLECTOR_BACKEND_SERVICES</span></span><br><span class="line">          <span class="attr">value:</span> <span class="string">oap.skywalking:11800</span></span><br><span class="line">        <span class="attr">volumeMounts:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">sw-agent</span></span><br><span class="line">          <span class="attr">mountPath:</span> <span class="string">/usr/skywalking/agent</span></span><br><span class="line">        <span class="attr">resources:</span></span><br><span class="line">          <span class="attr">limits:</span></span><br><span class="line">            <span class="attr">cpu:</span> <span class="string">&quot;1&quot;</span></span><br><span class="line">            <span class="attr">memory:</span> <span class="string">1024Mi</span></span><br><span class="line">          <span class="attr">requests:</span></span><br><span class="line">            <span class="attr">cpu:</span> <span class="string">&quot;0.2&quot;</span></span><br><span class="line">            <span class="attr">memory:</span> <span class="string">256Mi</span></span><br><span class="line">      <span class="attr">volumes:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">sw-agent</span></span><br><span class="line">          <span class="attr">emptyDir:</span> &#123;&#125;</span><br><span class="line">      <span class="comment"># nodeSelector:</span></span><br><span class="line">        <span class="comment"># used: bzzc</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>计算机</category>
      </categories>
  </entry>
  <entry>
    <title>二进制部署k8s文档</title>
    <url>/2023/04/30/%E8%AE%A1%E7%AE%97%E6%9C%BA/k8s%E9%83%A8%E7%BD%B2%E6%96%87%E6%A1%A3/</url>
    <content><![CDATA[<h1 id="二进制部署k8s文档"><a href="#二进制部署k8s文档" class="headerlink" title="二进制部署k8s文档"></a>二进制部署k8s文档</h1><h2 id="1-环境准备"><a href="#1-环境准备" class="headerlink" title="1.环境准备"></a>1.环境准备</h2><p>软件环境</p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left">软件</th>
<th>版本</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">操作系统</td>
<td>虚拟机为CentOS Linux release 7.9.2009 (Core)；生产为CentOS Linux release 7.7.1908 (Core)</td>
</tr>
<tr>
<td style="text-align:left">docker</td>
<td>19.03.8</td>
</tr>
<tr>
<td style="text-align:left">kubernetes</td>
<td>1.13.0</td>
</tr>
</tbody>
</table>
</div>
<p>服务器整体规划：</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>角色</th>
<th>ip</th>
<th>组件</th>
</tr>
</thead>
<tbody>
<tr>
<td>master</td>
<td>192.168.188.128</td>
<td>kube-apiserver，kube-controller-manager，kube-scheduler，etcd</td>
</tr>
<tr>
<td>node1</td>
<td>192.168.188.129</td>
<td>kubelet，kube-proxy，docker etcd</td>
</tr>
<tr>
<td>node2</td>
<td>192.168.188.110</td>
<td>kubelet，kube-proxy，docker etcd</td>
</tr>
</tbody>
</table>
</div>
<p>w1-192.168.188.129</p>
<p>w2- 192.168.188.128</p>
<p>w3-192.168.188.130</p>
<p>操作系统初始化配置</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 关闭防火墙</span></span><br><span class="line">systemctl stop firewalld</span><br><span class="line">systemctl <span class="built_in">disable</span> firewalld</span><br><span class="line"></span><br><span class="line"><span class="comment"># 关闭selinux</span></span><br><span class="line">sed -i <span class="string">&#x27;s/enforcing/disabled/&#x27;</span> /etc/selinux/config  <span class="comment"># 永久</span></span><br><span class="line">setenforce 0  <span class="comment"># 临时</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 关闭swap</span></span><br><span class="line">swapoff -a  <span class="comment"># 临时</span></span><br><span class="line">sed -ri <span class="string">&#x27;s/.*swap.*/#&amp;/&#x27;</span> /etc/fstab    <span class="comment"># 永久</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#w2- 192.168.188.128- master</span></span><br><span class="line">hostnamectl set-hostname k8s-master</span><br><span class="line"></span><br><span class="line"><span class="comment">#w1-192.168.188.129- node1</span></span><br><span class="line">hostnamectl set-hostname k8s-node1</span><br><span class="line"></span><br><span class="line"><span class="comment">#w3-192.168.188.130- node2</span></span><br><span class="line">hostnamectl set-hostname k8s-node2</span><br><span class="line"></span><br><span class="line"><span class="comment"># 在master添加hosts</span></span><br><span class="line"><span class="built_in">cat</span> &gt;&gt; /etc/hosts &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string">192.168.188.128 k8s-master</span></span><br><span class="line"><span class="string">192.168.188.129 k8s-node1</span></span><br><span class="line"><span class="string">192.168.188.130 k8s-node2</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 时间同步</span></span><br><span class="line">yum install ntpdate -y</span><br><span class="line">ntpdate time.windows.com</span><br><span class="line"><span class="comment">#指定东8时区</span></span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">cp</span> -a /usr/share/zoneinfo/Etc/GMT-8  /etc/localtime</span><br></pre></td></tr></table></figure>
<h2 id="2-部署etcd集群"><a href="#2-部署etcd集群" class="headerlink" title="2.部署etcd集群"></a>2.部署etcd集群</h2><div class="table-container">
<table>
<thead>
<tr>
<th>节点名称</th>
<th>ip</th>
</tr>
</thead>
<tbody>
<tr>
<td>etcd-1</td>
<td>192.168.188.128</td>
</tr>
<tr>
<td>etcd-2</td>
<td>192.168.188.129</td>
</tr>
<tr>
<td>etcd-3</td>
<td>192.168.188.130</td>
</tr>
</tbody>
</table>
</div>
<h3 id="准备开源的证书管理工具cfssl，使用json生成证书"><a href="#准备开源的证书管理工具cfssl，使用json生成证书" class="headerlink" title="准备开源的证书管理工具cfssl，使用json生成证书"></a>准备开源的证书管理工具cfssl，使用json生成证书</h3><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">wget https://pkg.cfssl.org/R1.2/cfssl_linux-amd64</span><br><span class="line">wget https://pkg.cfssl.org/R1.2/cfssljson_linux-amd64</span><br><span class="line">wget https://pkg.cfssl.org/R1.2/cfssl-certinfo_linux-amd64</span><br><span class="line"><span class="built_in">chmod</span> +x cfssl_linux-amd64 cfssljson_linux-amd64 cfssl-certinfo_linux-amd64</span><br><span class="line"><span class="built_in">mv</span> cfssl_linux-amd64 /usr/local/bin/cfssl</span><br><span class="line"><span class="built_in">mv</span> cfssljson_linux-amd64 /usr/local/bin/cfssljson</span><br><span class="line"><span class="built_in">mv</span> cfssl-certinfo_linux-amd64 /usr/bin/cfssl-certinfo</span><br></pre></td></tr></table></figure>
<p>因为下载地址在外网，虚拟机配代理比较麻烦，有ssl验证，dns解析等问题，所以是在本地下好用共享文件夹传进去。</p>
<h3 id="生成Etcd证书"><a href="#生成Etcd证书" class="headerlink" title="生成Etcd证书"></a>生成Etcd证书</h3><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> -p ~/TLS/&#123;etcd,k8s&#125;</span><br><span class="line"><span class="built_in">cd</span> ~</span><br><span class="line"><span class="built_in">cd</span> TLS/etcd</span><br><span class="line"></span><br><span class="line"><span class="comment">#自签CA</span></span><br><span class="line"><span class="built_in">cat</span> &gt; ca-config.json &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">  &quot;signing&quot;: &#123;</span></span><br><span class="line"><span class="string">    &quot;default&quot;: &#123;</span></span><br><span class="line"><span class="string">      &quot;expiry&quot;: &quot;87600h&quot;</span></span><br><span class="line"><span class="string">    &#125;,</span></span><br><span class="line"><span class="string">    &quot;profiles&quot;: &#123;</span></span><br><span class="line"><span class="string">      &quot;www&quot;: &#123;</span></span><br><span class="line"><span class="string">         &quot;expiry&quot;: &quot;87600h&quot;,</span></span><br><span class="line"><span class="string">         &quot;usages&quot;: [</span></span><br><span class="line"><span class="string">            &quot;signing&quot;,</span></span><br><span class="line"><span class="string">            &quot;key encipherment&quot;,</span></span><br><span class="line"><span class="string">            &quot;server auth&quot;,</span></span><br><span class="line"><span class="string">            &quot;client auth&quot;</span></span><br><span class="line"><span class="string">        ]</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">cat</span> &gt; ca-csr.json &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">    &quot;CN&quot;: &quot;etcd CA&quot;,</span></span><br><span class="line"><span class="string">    &quot;key&quot;: &#123;</span></span><br><span class="line"><span class="string">        &quot;algo&quot;: &quot;rsa&quot;,</span></span><br><span class="line"><span class="string">        &quot;size&quot;: 2048</span></span><br><span class="line"><span class="string">    &#125;,</span></span><br><span class="line"><span class="string">    &quot;names&quot;: [</span></span><br><span class="line"><span class="string">        &#123;</span></span><br><span class="line"><span class="string">            &quot;C&quot;: &quot;CN&quot;,</span></span><br><span class="line"><span class="string">            &quot;L&quot;: &quot;Beijing&quot;,</span></span><br><span class="line"><span class="string">            &quot;ST&quot;: &quot;Beijing&quot;</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">    ]</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#生成证书</span></span><br><span class="line">cfssl gencert -initca ca-csr.json | cfssljson -bare ca -</span><br><span class="line"></span><br><span class="line"><span class="built_in">ls</span> *pem</span><br><span class="line"></span><br><span class="line"><span class="comment">#使用自签CA签发Etcd HTTPS证书</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#创建证书申请文件</span></span><br><span class="line"><span class="built_in">cat</span> &gt; server-csr.json &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">    &quot;CN&quot;: &quot;etcd&quot;,</span></span><br><span class="line"><span class="string">    &quot;hosts&quot;: [</span></span><br><span class="line"><span class="string">    &quot;192.168.188.128&quot;,</span></span><br><span class="line"><span class="string">    &quot;192.168.188.129&quot;,</span></span><br><span class="line"><span class="string">    &quot;192.168.188.130&quot;</span></span><br><span class="line"><span class="string">    ],</span></span><br><span class="line"><span class="string">    &quot;key&quot;: &#123;</span></span><br><span class="line"><span class="string">        &quot;algo&quot;: &quot;rsa&quot;,</span></span><br><span class="line"><span class="string">        &quot;size&quot;: 2048</span></span><br><span class="line"><span class="string">    &#125;,</span></span><br><span class="line"><span class="string">    &quot;names&quot;: [</span></span><br><span class="line"><span class="string">        &#123;</span></span><br><span class="line"><span class="string">            &quot;C&quot;: &quot;CN&quot;,</span></span><br><span class="line"><span class="string">            &quot;L&quot;: &quot;BeiJing&quot;,</span></span><br><span class="line"><span class="string">            &quot;ST&quot;: &quot;BeiJing&quot;</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">    ]</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line">cfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=www server-csr.json | cfssljson -bare server</span><br><span class="line"></span><br><span class="line">2023/03/09 18:18:11 [INFO] generate received request</span><br><span class="line">2023/03/09 18:18:11 [INFO] received CSR</span><br><span class="line">2023/03/09 18:18:11 [INFO] generating key: rsa-2048</span><br><span class="line">2023/03/09 18:18:11 [INFO] encoded CSR</span><br><span class="line">2023/03/09 18:18:11 [INFO] signed certificate with serial number 302139856182803477179962090624930630774019179150</span><br><span class="line">2023/03/09 18:18:11 [WARNING] This certificate lacks a <span class="string">&quot;hosts&quot;</span> field. This makes it unsuitable <span class="keyword">for</span></span><br><span class="line">websites. For more information see the Baseline Requirements <span class="keyword">for</span> the Issuance and Management</span><br><span class="line">of Publicly-Trusted Certificates, v.1.1.6, from the CA/Browser Forum (https://cabforum.org);</span><br><span class="line">specifically, section 10.2.3 (<span class="string">&quot;Information Requirements&quot;</span>).</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="部署etcd集群"><a href="#部署etcd集群" class="headerlink" title="部署etcd集群"></a>部署etcd集群</h3><p>下载：<a href="https://github.com/etcd-io/etcd/releases/download/v3.4.9/etcd-v3.4.9-linux-amd64.tar.gz">https://github.com/etcd-io/etcd/releases/download/v3.4.9/etcd-v3.4.9-linux-amd64.tar.gz</a></p>
<p>在节点1上操作完再复制到2和3</p>
<h4 id="创建工作目录并解压二进制包"><a href="#创建工作目录并解压二进制包" class="headerlink" title="创建工作目录并解压二进制包"></a>创建工作目录并解压二进制包</h4><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> /opt/etcd/&#123;bin,cfg,ssl&#125; -p</span><br><span class="line">tar zxvf etcd-v3.4.9-linux-amd64.tar.gz</span><br><span class="line"><span class="built_in">mv</span> etcd-v3.4.9-linux-amd64/&#123;etcd,etcdctl&#125; /opt/etcd/bin/</span><br></pre></td></tr></table></figure>
<h4 id="创建etcd配置文件"><a href="#创建etcd配置文件" class="headerlink" title="创建etcd配置文件"></a>创建etcd配置文件</h4><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cat</span> &gt; /opt/etcd/cfg/etcd.conf &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string">#[Member]</span></span><br><span class="line"><span class="string">ETCD_NAME=&quot;etcd-1&quot;</span></span><br><span class="line"><span class="string">ETCD_DATA_DIR=&quot;/var/lib/etcd/default.etcd&quot;</span></span><br><span class="line"><span class="string">ETCD_LISTEN_PEER_URLS=&quot;https://192.168.188.128:2380&quot;</span></span><br><span class="line"><span class="string">ETCD_LISTEN_CLIENT_URLS=&quot;https://192.168.188.128:2379&quot;</span></span><br><span class="line"><span class="string">#[Clustering]</span></span><br><span class="line"><span class="string">ETCD_INITIAL_ADVERTISE_PEER_URLS=&quot;https://192.168.188.128:2380&quot;</span></span><br><span class="line"><span class="string">ETCD_ADVERTISE_CLIENT_URLS=&quot;https://192.168.188.128:2379&quot;</span></span><br><span class="line"><span class="string">ETCD_INITIAL_CLUSTER=&quot;etcd-1=https://192.168.188.128:2380,etcd-2=https://192.168.188.128:2380,etcd-3=https://192.168.188.128:2380&quot;</span></span><br><span class="line"><span class="string">ETCD_INITIAL_CLUSTER_TOKEN=&quot;etcd-cluster&quot;</span></span><br><span class="line"><span class="string">ETCD_INITIAL_CLUSTER_STATE=&quot;new&quot;</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure>
<h4 id="systemd管理etcd"><a href="#systemd管理etcd" class="headerlink" title="systemd管理etcd"></a>systemd管理etcd</h4><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cat</span> &gt; /usr/lib/systemd/system/etcd.service &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string">[Unit]</span></span><br><span class="line"><span class="string">Description=Etcd Server</span></span><br><span class="line"><span class="string">After=network.target</span></span><br><span class="line"><span class="string">After=network-online.target</span></span><br><span class="line"><span class="string">Wants=network-online.target</span></span><br><span class="line"><span class="string">[Service]</span></span><br><span class="line"><span class="string">Type=notify</span></span><br><span class="line"><span class="string">EnvironmentFile=/opt/etcd/cfg/etcd.conf</span></span><br><span class="line"><span class="string">ExecStart=/opt/etcd/bin/etcd \</span></span><br><span class="line"><span class="string">--cert-file=/opt/etcd/ssl/server.pem \</span></span><br><span class="line"><span class="string">--key-file=/opt/etcd/ssl/server-key.pem \</span></span><br><span class="line"><span class="string">--peer-cert-file=/opt/etcd/ssl/server.pem \</span></span><br><span class="line"><span class="string">--peer-key-file=/opt/etcd/ssl/server-key.pem \</span></span><br><span class="line"><span class="string">--trusted-ca-file=/opt/etcd/ssl/ca.pem \</span></span><br><span class="line"><span class="string">--peer-trusted-ca-file=/opt/etcd/ssl/ca.pem \</span></span><br><span class="line"><span class="string">--logger=zap</span></span><br><span class="line"><span class="string">Restart=on-failure</span></span><br><span class="line"><span class="string">LimitNOFILE=65536</span></span><br><span class="line"><span class="string">[Install]</span></span><br><span class="line"><span class="string">WantedBy=multi-user.target</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure>
<h4 id="拷贝刚才生成的证书"><a href="#拷贝刚才生成的证书" class="headerlink" title="拷贝刚才生成的证书"></a>拷贝刚才生成的证书</h4><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cp</span> ~/TLS/etcd/ca*pem ~/TLS/etcd/server*pem /opt/etcd/ssl/</span><br></pre></td></tr></table></figure>
<h4 id="启动并设置开机启动"><a href="#启动并设置开机启动" class="headerlink" title="启动并设置开机启动"></a>启动并设置开机启动</h4><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl start etcd</span><br><span class="line">systemctl <span class="built_in">enable</span> etcd</span><br></pre></td></tr></table></figure>
<h4 id="将上面节点1所有生成的文件拷贝到节点2和节点3"><a href="#将上面节点1所有生成的文件拷贝到节点2和节点3" class="headerlink" title="将上面节点1所有生成的文件拷贝到节点2和节点3"></a>将上面节点1所有生成的文件拷贝到节点2和节点3</h4><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">scp -r /opt/etcd/ root@192.168.188.129:/opt/</span><br><span class="line">scp /usr/lib/systemd/system/etcd.service root@192.168.188.129:/usr/lib/systemd/system/</span><br><span class="line">scp -r /opt/etcd/ root@192.168.188.130:/opt/</span><br><span class="line">scp /usr/lib/systemd/system/etcd.service root@192.168.188.130:/usr/lib/systemd/system/</span><br></pre></td></tr></table></figure>
<h4 id="然后在节点2和节点3分别修改etcd-conf配置文件中的节点名称和当前服务器IP："><a href="#然后在节点2和节点3分别修改etcd-conf配置文件中的节点名称和当前服务器IP：" class="headerlink" title="然后在节点2和节点3分别修改etcd.conf配置文件中的节点名称和当前服务器IP："></a>然后在节点2和节点3分别修改etcd.conf配置文件中的节点名称和当前服务器IP：</h4><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">vi /opt/etcd/cfg/etcd.conf</span><br><span class="line"><span class="comment">#[Member]</span></span><br><span class="line">ETCD_NAME=<span class="string">&quot;etcd-1&quot;</span>   <span class="comment"># 修改此处，节点2改为etcd-2，节点3改为etcd-3</span></span><br><span class="line">ETCD_DATA_DIR=<span class="string">&quot;/var/lib/etcd/default.etcd&quot;</span></span><br><span class="line">ETCD_LISTEN_PEER_URLS=<span class="string">&quot;https://192.168.31.71:2380&quot;</span>   <span class="comment"># 修改此处为当前服务器IP</span></span><br><span class="line">ETCD_LISTEN_CLIENT_URLS=<span class="string">&quot;https://192.168.31.71:2379&quot;</span> <span class="comment"># 修改此处为当前服务器IP</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#[Clustering]</span></span><br><span class="line">ETCD_INITIAL_ADVERTISE_PEER_URLS=<span class="string">&quot;https://192.168.31.71:2380&quot;</span> <span class="comment"># 修改此处为当前服务器IP</span></span><br><span class="line">ETCD_ADVERTISE_CLIENT_URLS=<span class="string">&quot;https://192.168.31.71:2379&quot;</span> <span class="comment"># 修改此处为当前服务器IP</span></span><br><span class="line">ETCD_INITIAL_CLUSTER=<span class="string">&quot;etcd-1=https://192.168.31.71:2380,etcd-2=https://192.168.31.72:2380,etcd-3=https://192.168.31.73:2380&quot;</span></span><br><span class="line">ETCD_INITIAL_CLUSTER_TOKEN=<span class="string">&quot;etcd-cluster&quot;</span></span><br><span class="line">ETCD_INITIAL_CLUSTER_STATE=<span class="string">&quot;new&quot;</span></span><br></pre></td></tr></table></figure>
<h4 id="查看集群状态"><a href="#查看集群状态" class="headerlink" title="查看集群状态"></a>查看集群状态</h4><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">ETCDCTL_API=3 /opt/etcd/bin/etcdctl --cacert=/opt/etcd/ssl/ca.pem --cert=/opt/etcd/ssl/server.pem --key=/opt/etcd/ssl/server-key.pem --endpoints=<span class="string">&quot;https://192.168.188.128:2379,https://192.168.188.129:2379,https://192.168.188.130:2379&quot;</span> endpoint health</span><br></pre></td></tr></table></figure>
<h2 id="3-安装docker"><a href="#3-安装docker" class="headerlink" title="3.安装docker"></a>3.安装docker</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> /mnt/hgfs/tmp</span><br><span class="line">tar zxvf docker-19.03.9.tgz</span><br><span class="line"><span class="built_in">cp</span> docker/* /usr/bin</span><br></pre></td></tr></table></figure>
<h4 id="systemd管理docker"><a href="#systemd管理docker" class="headerlink" title="systemd管理docker"></a>systemd管理docker</h4><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cat</span> &gt; /usr/lib/systemd/system/docker.service &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string">[Unit]</span></span><br><span class="line"><span class="string">Description=Docker Application Container Engine</span></span><br><span class="line"><span class="string">Documentation=https://docs.docker.com</span></span><br><span class="line"><span class="string">After=network-online.target firewalld.service</span></span><br><span class="line"><span class="string">Wants=network-online.target</span></span><br><span class="line"><span class="string">[Service]</span></span><br><span class="line"><span class="string">Type=notify</span></span><br><span class="line"><span class="string">ExecStart=/usr/bin/dockerd</span></span><br><span class="line"><span class="string">ExecReload=/bin/kill -s HUP $MAINPID</span></span><br><span class="line"><span class="string">LimitNOFILE=infinity</span></span><br><span class="line"><span class="string">LimitNPROC=infinity</span></span><br><span class="line"><span class="string">LimitCORE=infinity</span></span><br><span class="line"><span class="string">TimeoutStartSec=0</span></span><br><span class="line"><span class="string">Delegate=yes</span></span><br><span class="line"><span class="string">KillMode=process</span></span><br><span class="line"><span class="string">Restart=on-failure</span></span><br><span class="line"><span class="string">StartLimitBurst=3</span></span><br><span class="line"><span class="string">StartLimitInterval=60s</span></span><br><span class="line"><span class="string">[Install]</span></span><br><span class="line"><span class="string">WantedBy=multi-user.target</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure>
<h4 id="创建配置文件"><a href="#创建配置文件" class="headerlink" title="创建配置文件"></a>创建配置文件</h4><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> /etc/docker</span><br><span class="line"><span class="built_in">cat</span> &gt; /etc/docker/daemon.json &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">  &quot;registry-mirrors&quot;: [&quot;https://b9pmyelo.mirror.aliyuncs.com&quot;],</span></span><br><span class="line"><span class="string">  &quot;log-driver&quot;:&quot;json-file&quot;,</span></span><br><span class="line"><span class="string">  &quot;log-opts&quot;: &#123;&quot;max-size&quot;:&quot;500m&quot;, &quot;max-file&quot;:&quot;3&quot;&#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure>
<h4 id="启动并设置开机启动-1"><a href="#启动并设置开机启动-1" class="headerlink" title="启动并设置开机启动"></a>启动并设置开机启动</h4><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl start docker</span><br><span class="line">systemctl <span class="built_in">enable</span> docker</span><br></pre></td></tr></table></figure>
<h2 id="4-部署Master-Node"><a href="#4-部署Master-Node" class="headerlink" title="4.部署Master Node"></a>4.部署Master Node</h2><h3 id="生成kube-apiserver证书"><a href="#生成kube-apiserver证书" class="headerlink" title="生成kube-apiserver证书"></a>生成kube-apiserver证书</h3><h4 id="自签证书颁发机构（CA）"><a href="#自签证书颁发机构（CA）" class="headerlink" title="自签证书颁发机构（CA）"></a>自签证书颁发机构（CA）</h4><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> /root/TLS/k8s</span><br><span class="line"><span class="built_in">cat</span> &gt; ca-config.json &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">  &quot;signing&quot;: &#123;</span></span><br><span class="line"><span class="string">    &quot;default&quot;: &#123;</span></span><br><span class="line"><span class="string">      &quot;expiry&quot;: &quot;87600h&quot;</span></span><br><span class="line"><span class="string">    &#125;,</span></span><br><span class="line"><span class="string">    &quot;profiles&quot;: &#123;</span></span><br><span class="line"><span class="string">      &quot;kubernetes&quot;: &#123;</span></span><br><span class="line"><span class="string">         &quot;expiry&quot;: &quot;87600h&quot;,</span></span><br><span class="line"><span class="string">         &quot;usages&quot;: [</span></span><br><span class="line"><span class="string">            &quot;signing&quot;,</span></span><br><span class="line"><span class="string">            &quot;key encipherment&quot;,</span></span><br><span class="line"><span class="string">            &quot;server auth&quot;,</span></span><br><span class="line"><span class="string">            &quot;client auth&quot;</span></span><br><span class="line"><span class="string">        ]</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"><span class="built_in">cat</span> &gt; ca-csr.json &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">    &quot;CN&quot;: &quot;kubernetes&quot;,</span></span><br><span class="line"><span class="string">    &quot;key&quot;: &#123;</span></span><br><span class="line"><span class="string">        &quot;algo&quot;: &quot;rsa&quot;,</span></span><br><span class="line"><span class="string">        &quot;size&quot;: 2048</span></span><br><span class="line"><span class="string">    &#125;,</span></span><br><span class="line"><span class="string">    &quot;names&quot;: [</span></span><br><span class="line"><span class="string">        &#123;</span></span><br><span class="line"><span class="string">            &quot;C&quot;: &quot;CN&quot;,</span></span><br><span class="line"><span class="string">            &quot;L&quot;: &quot;Beijing&quot;,</span></span><br><span class="line"><span class="string">            &quot;ST&quot;: &quot;Beijing&quot;,</span></span><br><span class="line"><span class="string">            &quot;O&quot;: &quot;k8s&quot;,</span></span><br><span class="line"><span class="string">            &quot;OU&quot;: &quot;System&quot;</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">    ]</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure>
<h4 id="生成证书"><a href="#生成证书" class="headerlink" title="生成证书"></a>生成证书</h4><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">cfssl gencert -initca ca-csr.json | cfssljson -bare ca -</span><br><span class="line"></span><br><span class="line"><span class="built_in">ls</span> *pem</span><br></pre></td></tr></table></figure>
<h4 id="使用自签CA签发kube-apiserver-HTTPS证书"><a href="#使用自签CA签发kube-apiserver-HTTPS证书" class="headerlink" title="使用自签CA签发kube-apiserver HTTPS证书"></a>使用自签CA签发kube-apiserver HTTPS证书</h4><p>创建证书申请文件：</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> TLS/k8s</span><br><span class="line"><span class="built_in">cat</span> &gt; server-csr.json &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">    &quot;CN&quot;: &quot;kubernetes&quot;,</span></span><br><span class="line"><span class="string">    &quot;hosts&quot;: [</span></span><br><span class="line"><span class="string">      &quot;10.0.0.1&quot;,</span></span><br><span class="line"><span class="string">      &quot;127.0.0.1&quot;,</span></span><br><span class="line"><span class="string">      &quot;192.168.188.128&quot;,</span></span><br><span class="line"><span class="string">      &quot;192.168.188.129&quot;,</span></span><br><span class="line"><span class="string">      &quot;192.168.188.130&quot;,</span></span><br><span class="line"><span class="string">      &quot;kubernetes&quot;,</span></span><br><span class="line"><span class="string">      &quot;kubernetes.default&quot;,</span></span><br><span class="line"><span class="string">      &quot;kubernetes.default.svc&quot;,</span></span><br><span class="line"><span class="string">      &quot;kubernetes.default.svc.cluster&quot;,</span></span><br><span class="line"><span class="string">      &quot;kubernetes.default.svc.cluster.local&quot;</span></span><br><span class="line"><span class="string">    ],</span></span><br><span class="line"><span class="string">    &quot;key&quot;: &#123;</span></span><br><span class="line"><span class="string">        &quot;algo&quot;: &quot;rsa&quot;,</span></span><br><span class="line"><span class="string">        &quot;size&quot;: 2048</span></span><br><span class="line"><span class="string">    &#125;,</span></span><br><span class="line"><span class="string">    &quot;names&quot;: [</span></span><br><span class="line"><span class="string">        &#123;</span></span><br><span class="line"><span class="string">            &quot;C&quot;: &quot;CN&quot;,</span></span><br><span class="line"><span class="string">            &quot;L&quot;: &quot;BeiJing&quot;,</span></span><br><span class="line"><span class="string">            &quot;ST&quot;: &quot;BeiJing&quot;,</span></span><br><span class="line"><span class="string">            &quot;O&quot;: &quot;k8s&quot;,</span></span><br><span class="line"><span class="string">            &quot;OU&quot;: &quot;System&quot;</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">    ]</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure>
<p>生成证书：</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">cfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=kubernetes server-csr.json | cfssljson -bare server</span><br></pre></td></tr></table></figure>
<p>解压二进制包</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> -p /opt/kubernetes/&#123;bin,cfg,ssl,logs&#125; </span><br><span class="line">tar zxvf kubernetes-server-linux-amd64.tar.gz</span><br><span class="line"><span class="built_in">cd</span> kubernetes/server/bin</span><br><span class="line"><span class="built_in">cp</span> kube-apiserver kube-scheduler kube-controller-manager /opt/kubernetes/bin</span><br><span class="line"><span class="built_in">cp</span> kubectl /usr/bin/</span><br></pre></td></tr></table></figure>
<h4 id="部署kube-apiserver"><a href="#部署kube-apiserver" class="headerlink" title="部署kube-apiserver"></a>部署kube-apiserver</h4><p>创建配置文件</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cat</span> &gt; /opt/kubernetes/cfg/kube-apiserver.conf &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string">KUBE_APISERVER_OPTS=&quot;--logtostderr=false \\</span></span><br><span class="line"><span class="string">--v=2 \\</span></span><br><span class="line"><span class="string">--log-dir=/opt/kubernetes/logs \\</span></span><br><span class="line"><span class="string">--etcd-servers=https://192.168.188.128:2379,https://192.168.188.129:2379,https://192.168.188.130:2379 \\</span></span><br><span class="line"><span class="string">--bind-address=192.168.188.128 \\</span></span><br><span class="line"><span class="string">--secure-port=6443 \\</span></span><br><span class="line"><span class="string">--advertise-address=192.168.188.128 \\</span></span><br><span class="line"><span class="string">--allow-privileged=true \\</span></span><br><span class="line"><span class="string">--service-cluster-ip-range=10.0.0.0/24 \\</span></span><br><span class="line"><span class="string">--enable-admission-plugins=NamespaceLifecycle,LimitRanger,ServiceAccount,ResourceQuota,NodeRestriction \\</span></span><br><span class="line"><span class="string">--authorization-mode=RBAC,Node \\</span></span><br><span class="line"><span class="string">--enable-bootstrap-token-auth=true \\</span></span><br><span class="line"><span class="string">--token-auth-file=/opt/kubernetes/cfg/token.csv \\</span></span><br><span class="line"><span class="string">--service-node-port-range=30000-32767 \\</span></span><br><span class="line"><span class="string">--kubelet-client-certificate=/opt/kubernetes/ssl/server.pem \\</span></span><br><span class="line"><span class="string">--kubelet-client-key=/opt/kubernetes/ssl/server-key.pem \\</span></span><br><span class="line"><span class="string">--tls-cert-file=/opt/kubernetes/ssl/server.pem  \\</span></span><br><span class="line"><span class="string">--tls-private-key-file=/opt/kubernetes/ssl/server-key.pem \\</span></span><br><span class="line"><span class="string">--client-ca-file=/opt/kubernetes/ssl/ca.pem \\</span></span><br><span class="line"><span class="string">--service-account-key-file=/opt/kubernetes/ssl/ca-key.pem \\</span></span><br><span class="line"><span class="string">--etcd-cafile=/opt/etcd/ssl/ca.pem \\</span></span><br><span class="line"><span class="string">--etcd-certfile=/opt/etcd/ssl/server.pem \\</span></span><br><span class="line"><span class="string">--etcd-keyfile=/opt/etcd/ssl/server-key.pem \\</span></span><br><span class="line"><span class="string">--audit-log-maxage=30 \\</span></span><br><span class="line"><span class="string">--audit-log-maxbackup=3 \\</span></span><br><span class="line"><span class="string">--audit-log-maxsize=100 \\</span></span><br><span class="line"><span class="string">--audit-log-path=/opt/kubernetes/logs/k8s-audit.log&quot;</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure>
<h4 id="拷贝刚才生成的证书-1"><a href="#拷贝刚才生成的证书-1" class="headerlink" title="拷贝刚才生成的证书"></a>拷贝刚才生成的证书</h4><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cp</span> ~/TLS/k8s/ca*pem ~/TLS/k8s/server*pem /opt/kubernetes/ssl/</span><br></pre></td></tr></table></figure>
<h4 id="启用-TLS-Bootstrapping-机制"><a href="#启用-TLS-Bootstrapping-机制" class="headerlink" title="启用 TLS Bootstrapping 机制"></a>启用 TLS Bootstrapping 机制</h4><p>创建上述配置文件中token文件：</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cat</span> &gt; /opt/kubernetes/cfg/token.csv &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string">c47ffb939f5ca36231d9e3121a252940,kubelet-bootstrap,10001,&quot;system:node-bootstrapper&quot;</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure>
<p>生成token：</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">head</span> -c 16 /dev/urandom | <span class="built_in">od</span> -An -t x | <span class="built_in">tr</span> -d <span class="string">&#x27; &#x27;</span></span><br></pre></td></tr></table></figure>
<h4 id="systemd管理apiserver"><a href="#systemd管理apiserver" class="headerlink" title="systemd管理apiserver"></a>systemd管理apiserver</h4><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cat</span> &gt; /usr/lib/systemd/system/kube-apiserver.service &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string">[Unit]</span></span><br><span class="line"><span class="string">Description=Kubernetes API Server</span></span><br><span class="line"><span class="string">Documentation=https://github.com/kubernetes/kubernetes</span></span><br><span class="line"><span class="string">[Service]</span></span><br><span class="line"><span class="string">EnvironmentFile=/opt/kubernetes/cfg/kube-apiserver.conf</span></span><br><span class="line"><span class="string">ExecStart=/opt/kubernetes/bin/kube-apiserver \$KUBE_APISERVER_OPTS</span></span><br><span class="line"><span class="string">Restart=on-failure</span></span><br><span class="line"><span class="string">[Install]</span></span><br><span class="line"><span class="string">WantedBy=multi-user.target</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure>
<h4 id="启动并设置开机启动-2"><a href="#启动并设置开机启动-2" class="headerlink" title="启动并设置开机启动"></a>启动并设置开机启动</h4><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl start kube-apiserver</span><br><span class="line">systemctl <span class="built_in">enable</span> kube-apiserver</span><br></pre></td></tr></table></figure>
<h4 id="授权kubelet-bootstrap用户允许请求证书"><a href="#授权kubelet-bootstrap用户允许请求证书" class="headerlink" title="授权kubelet-bootstrap用户允许请求证书"></a>授权kubelet-bootstrap用户允许请求证书</h4><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">kubectl create clusterrolebinding kubelet-bootstrap \</span><br><span class="line">--clusterrole=system:node-bootstrapper \</span><br><span class="line">--user=kubelet-bootstrap</span><br></pre></td></tr></table></figure>
<h3 id="部署kube-controller-manager"><a href="#部署kube-controller-manager" class="headerlink" title="部署kube-controller-manager"></a>部署kube-controller-manager</h3><h4 id="创建配置文件-1"><a href="#创建配置文件-1" class="headerlink" title="创建配置文件"></a>创建配置文件</h4><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cat</span> &gt; /opt/kubernetes/cfg/kube-controller-manager.conf &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string">KUBE_CONTROLLER_MANAGER_OPTS=&quot;--logtostderr=false \\</span></span><br><span class="line"><span class="string">--v=2 \\</span></span><br><span class="line"><span class="string">--log-dir=/opt/kubernetes/logs \\</span></span><br><span class="line"><span class="string">--leader-elect=true \\</span></span><br><span class="line"><span class="string">--master=127.0.0.1:8080 \\</span></span><br><span class="line"><span class="string">--bind-address=127.0.0.1 \\</span></span><br><span class="line"><span class="string">--allocate-node-cidrs=true \\</span></span><br><span class="line"><span class="string">--cluster-cidr=10.244.0.0/16 \\</span></span><br><span class="line"><span class="string">--service-cluster-ip-range=10.0.0.0/24 \\</span></span><br><span class="line"><span class="string">--cluster-signing-cert-file=/opt/kubernetes/ssl/ca.pem \\</span></span><br><span class="line"><span class="string">--cluster-signing-key-file=/opt/kubernetes/ssl/ca-key.pem  \\</span></span><br><span class="line"><span class="string">--root-ca-file=/opt/kubernetes/ssl/ca.pem \\</span></span><br><span class="line"><span class="string">--service-account-private-key-file=/opt/kubernetes/ssl/ca-key.pem \\</span></span><br><span class="line"><span class="string">--experimental-cluster-signing-duration=87600h0m0s&quot;</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure>
<h4 id="systemd管理controller-manager"><a href="#systemd管理controller-manager" class="headerlink" title="systemd管理controller-manager"></a>systemd管理controller-manager</h4><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cat</span> &gt; /usr/lib/systemd/system/kube-controller-manager.service &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string">[Unit]</span></span><br><span class="line"><span class="string">Description=Kubernetes Controller Manager</span></span><br><span class="line"><span class="string">Documentation=https://github.com/kubernetes/kubernetes</span></span><br><span class="line"><span class="string">[Service]</span></span><br><span class="line"><span class="string">EnvironmentFile=/opt/kubernetes/cfg/kube-controller-manager.conf</span></span><br><span class="line"><span class="string">ExecStart=/opt/kubernetes/bin/kube-controller-manager \$KUBE_CONTROLLER_MANAGER_OPTS</span></span><br><span class="line"><span class="string">Restart=on-failure</span></span><br><span class="line"><span class="string">[Install]</span></span><br><span class="line"><span class="string">WantedBy=multi-user.target</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure>
<h4 id="启动并设置开机启动-3"><a href="#启动并设置开机启动-3" class="headerlink" title="启动并设置开机启动"></a>启动并设置开机启动</h4><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl start kube-controller-manager</span><br><span class="line">systemctl <span class="built_in">enable</span> kube-controller-manager</span><br></pre></td></tr></table></figure>
<h3 id="部署kube-scheduler"><a href="#部署kube-scheduler" class="headerlink" title="部署kube-scheduler"></a>部署kube-scheduler</h3><h4 id="创建配置文件-2"><a href="#创建配置文件-2" class="headerlink" title="创建配置文件"></a>创建配置文件</h4><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cat</span> &gt; /opt/kubernetes/cfg/kube-scheduler.conf &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string">KUBE_SCHEDULER_OPTS=&quot;--logtostderr=false \</span></span><br><span class="line"><span class="string">--v=2 \</span></span><br><span class="line"><span class="string">--log-dir=/opt/kubernetes/logs \</span></span><br><span class="line"><span class="string">--leader-elect \</span></span><br><span class="line"><span class="string">--master=127.0.0.1:8080 \</span></span><br><span class="line"><span class="string">--bind-address=127.0.0.1&quot;</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure>
<h4 id="systemd管理scheduler"><a href="#systemd管理scheduler" class="headerlink" title="systemd管理scheduler"></a>systemd管理scheduler</h4><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cat</span> &gt; /usr/lib/systemd/system/kube-scheduler.service &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string">[Unit]</span></span><br><span class="line"><span class="string">Description=Kubernetes Scheduler</span></span><br><span class="line"><span class="string">Documentation=https://github.com/kubernetes/kubernetes</span></span><br><span class="line"><span class="string">[Service]</span></span><br><span class="line"><span class="string">EnvironmentFile=/opt/kubernetes/cfg/kube-scheduler.conf</span></span><br><span class="line"><span class="string">ExecStart=/opt/kubernetes/bin/kube-scheduler \$KUBE_SCHEDULER_OPTS</span></span><br><span class="line"><span class="string">Restart=on-failure</span></span><br><span class="line"><span class="string">[Install]</span></span><br><span class="line"><span class="string">WantedBy=multi-user.target</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure>
<h4 id="启动并设置开机启动-4"><a href="#启动并设置开机启动-4" class="headerlink" title="启动并设置开机启动"></a>启动并设置开机启动</h4><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl start kube-scheduler</span><br><span class="line">systemctl <span class="built_in">enable</span> kube-scheduler</span><br></pre></td></tr></table></figure>
<h4 id="查看集群状态-1"><a href="#查看集群状态-1" class="headerlink" title="查看集群状态"></a>查看集群状态</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">kubectl get cs</span><br></pre></td></tr></table></figure>
<h2 id="5-部署Worker-Node"><a href="#5-部署Worker-Node" class="headerlink" title="5.部署Worker Node"></a>5.部署Worker Node</h2><h3 id="创建工作目录并拷贝二进制文件"><a href="#创建工作目录并拷贝二进制文件" class="headerlink" title="创建工作目录并拷贝二进制文件"></a>创建工作目录并拷贝二进制文件</h3><p>在所有worker node创建工作目录：</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> -p /opt/kubernetes/&#123;bin,cfg,ssl,logs&#125; </span><br></pre></td></tr></table></figure>
<p>从master节点拷贝：</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> /mnt/hgfs/tmp/kubernetes/server/bin</span><br><span class="line"><span class="built_in">cp</span> kubelet kube-proxy /opt/kubernetes/bin   <span class="comment"># 本地拷贝</span></span><br></pre></td></tr></table></figure>
<h3 id="部署kubelet"><a href="#部署kubelet" class="headerlink" title="部署kubelet"></a>部署kubelet</h3><h4 id="创建配置文件-3"><a href="#创建配置文件-3" class="headerlink" title="创建配置文件"></a>创建配置文件</h4><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cat</span> &gt; /opt/kubernetes/cfg/kubelet.conf &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string">KUBELET_OPTS=&quot;--logtostderr=false \\</span></span><br><span class="line"><span class="string">--v=2 \\</span></span><br><span class="line"><span class="string">--log-dir=/opt/kubernetes/logs \\</span></span><br><span class="line"><span class="string">--hostname-override=k8s-master \\</span></span><br><span class="line"><span class="string">--network-plugin=cni \\</span></span><br><span class="line"><span class="string">--kubeconfig=/opt/kubernetes/cfg/kubelet.kubeconfig \\</span></span><br><span class="line"><span class="string">--bootstrap-kubeconfig=/opt/kubernetes/cfg/bootstrap.kubeconfig \\</span></span><br><span class="line"><span class="string">--config=/opt/kubernetes/cfg/kubelet-config.yml \\</span></span><br><span class="line"><span class="string">--cert-dir=/opt/kubernetes/ssl \\</span></span><br><span class="line"><span class="string">--pod-infra-container-image=lizhenliang/pause-amd64:3.0&quot;</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">cat</span> &gt; /opt/kubernetes/cfg/kubelet.conf &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string">KUBELET_OPTS=&quot;--logtostderr=false \\</span></span><br><span class="line"><span class="string">--v=2 \\</span></span><br><span class="line"><span class="string">--log-dir=/opt/kubernetes/logs \\</span></span><br><span class="line"><span class="string">--hostname-override=k8s-node1 \\</span></span><br><span class="line"><span class="string">--network-plugin=cni \\</span></span><br><span class="line"><span class="string">--kubeconfig=/opt/kubernetes/cfg/kubelet.kubeconfig \\</span></span><br><span class="line"><span class="string">--bootstrap-kubeconfig=/opt/kubernetes/cfg/bootstrap.kubeconfig \\</span></span><br><span class="line"><span class="string">--config=/opt/kubernetes/cfg/kubelet-config.yml \\</span></span><br><span class="line"><span class="string">--cert-dir=/opt/kubernetes/ssl \\</span></span><br><span class="line"><span class="string">--pod-infra-container-image=lizhenliang/pause-amd64:3.0&quot;</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">cat</span> &gt; /opt/kubernetes/cfg/kubelet.conf &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string">KUBELET_OPTS=&quot;--logtostderr=false \\</span></span><br><span class="line"><span class="string">--v=2 \\</span></span><br><span class="line"><span class="string">--log-dir=/opt/kubernetes/logs \\</span></span><br><span class="line"><span class="string">--hostname-override=k8s-node2 \\</span></span><br><span class="line"><span class="string">--network-plugin=cni \\</span></span><br><span class="line"><span class="string">--kubeconfig=/opt/kubernetes/cfg/kubelet.kubeconfig \\</span></span><br><span class="line"><span class="string">--bootstrap-kubeconfig=/opt/kubernetes/cfg/bootstrap.kubeconfig \\</span></span><br><span class="line"><span class="string">--config=/opt/kubernetes/cfg/kubelet-config.yml \\</span></span><br><span class="line"><span class="string">--cert-dir=/opt/kubernetes/ssl \\</span></span><br><span class="line"><span class="string">--pod-infra-container-image=lizhenliang/pause-amd64:3.0&quot;</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure>
<h4 id="配置参数文件"><a href="#配置参数文件" class="headerlink" title="配置参数文件"></a>配置参数文件</h4><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cat</span> &gt; /opt/kubernetes/cfg/kubelet-config.yml &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string">kind: KubeletConfiguration</span></span><br><span class="line"><span class="string">apiVersion: kubelet.config.k8s.io/v1beta1</span></span><br><span class="line"><span class="string">address: 0.0.0.0</span></span><br><span class="line"><span class="string">port: 10250</span></span><br><span class="line"><span class="string">readOnlyPort: 10255</span></span><br><span class="line"><span class="string">cgroupDriver: cgroupfs</span></span><br><span class="line"><span class="string">clusterDNS:</span></span><br><span class="line"><span class="string">- 10.0.0.2</span></span><br><span class="line"><span class="string">clusterDomain: cluster.local </span></span><br><span class="line"><span class="string">failSwapOn: false</span></span><br><span class="line"><span class="string">authentication:</span></span><br><span class="line"><span class="string">  anonymous:</span></span><br><span class="line"><span class="string">    enabled: false</span></span><br><span class="line"><span class="string">  webhook:</span></span><br><span class="line"><span class="string">    cacheTTL: 2m0s</span></span><br><span class="line"><span class="string">    enabled: true</span></span><br><span class="line"><span class="string">  x509:</span></span><br><span class="line"><span class="string">    clientCAFile: /opt/kubernetes/ssl/ca.pem </span></span><br><span class="line"><span class="string">authorization:</span></span><br><span class="line"><span class="string">  mode: Webhook</span></span><br><span class="line"><span class="string">  webhook:</span></span><br><span class="line"><span class="string">    cacheAuthorizedTTL: 5m0s</span></span><br><span class="line"><span class="string">    cacheUnauthorizedTTL: 30s</span></span><br><span class="line"><span class="string">evictionHard:</span></span><br><span class="line"><span class="string">  imagefs.available: 15%</span></span><br><span class="line"><span class="string">  memory.available: 100Mi</span></span><br><span class="line"><span class="string">  nodefs.available: 10%</span></span><br><span class="line"><span class="string">  nodefs.inodesFree: 5%</span></span><br><span class="line"><span class="string">maxOpenFiles: 1000000</span></span><br><span class="line"><span class="string">maxPods: 110</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure>
<h4 id="生成bootstrap-kubeconfig文件"><a href="#生成bootstrap-kubeconfig文件" class="headerlink" title="生成bootstrap.kubeconfig文件"></a>生成bootstrap.kubeconfig文件</h4><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">KUBE_APISERVER=<span class="string">&quot;https://192.168.188.128:6443&quot;</span> <span class="comment"># apiserver IP:PORT</span></span><br><span class="line">TOKEN=<span class="string">&quot;c47ffb939f5ca36231d9e3121a252940&quot;</span> <span class="comment"># 与token.csv里保持一致</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 生成 kubelet bootstrap kubeconfig 配置文件</span></span><br><span class="line">kubectl config set-cluster kubernetes \</span><br><span class="line">  --certificate-authority=/opt/kubernetes/ssl/ca.pem \</span><br><span class="line">  --embed-certs=<span class="literal">true</span> \</span><br><span class="line">  --server=<span class="variable">$&#123;KUBE_APISERVER&#125;</span> \</span><br><span class="line">  --kubeconfig=bootstrap.kubeconfig</span><br><span class="line">kubectl config set-credentials <span class="string">&quot;kubelet-bootstrap&quot;</span> \</span><br><span class="line">  --token=<span class="variable">$&#123;TOKEN&#125;</span> \</span><br><span class="line">  --kubeconfig=bootstrap.kubeconfig</span><br><span class="line">kubectl config set-context default \</span><br><span class="line">  --cluster=kubernetes \</span><br><span class="line">  --user=<span class="string">&quot;kubelet-bootstrap&quot;</span> \</span><br><span class="line">  --kubeconfig=bootstrap.kubeconfig</span><br><span class="line">kubectl config use-context default --kubeconfig=bootstrap.kubeconfig</span><br></pre></td></tr></table></figure>
<p>拷贝到配置文件路径：</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cp</span> bootstrap.kubeconfig /opt/kubernetes/cfg</span><br></pre></td></tr></table></figure>
<h4 id="systemd管理kubelet"><a href="#systemd管理kubelet" class="headerlink" title="systemd管理kubelet"></a>systemd管理kubelet</h4><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cat</span> &gt; /usr/lib/systemd/system/kubelet.service &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string">[Unit]</span></span><br><span class="line"><span class="string">Description=Kubernetes Kubelet</span></span><br><span class="line"><span class="string">After=docker.service</span></span><br><span class="line"><span class="string">[Service]</span></span><br><span class="line"><span class="string">EnvironmentFile=/opt/kubernetes/cfg/kubelet.conf</span></span><br><span class="line"><span class="string">ExecStart=/opt/kubernetes/bin/kubelet \$KUBELET_OPTS</span></span><br><span class="line"><span class="string">Restart=on-failure</span></span><br><span class="line"><span class="string">LimitNOFILE=65536</span></span><br><span class="line"><span class="string">[Install]</span></span><br><span class="line"><span class="string">WantedBy=multi-user.target</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure>
<h4 id="启动并设置开机启动-5"><a href="#启动并设置开机启动-5" class="headerlink" title="启动并设置开机启动"></a>启动并设置开机启动</h4><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl start kubelet</span><br><span class="line">systemctl <span class="built_in">enable</span> kubelet</span><br></pre></td></tr></table></figure>
<h3 id="批准kubelet证书申请并加入集群"><a href="#批准kubelet证书申请并加入集群" class="headerlink" title="批准kubelet证书申请并加入集群"></a>批准kubelet证书申请并加入集群</h3><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 查看kubelet证书请求</span></span><br><span class="line">kubectl get csr</span><br><span class="line">NAME                                                   AGE   REQUESTOR           CONDITION</span><br><span class="line">node-csr-Hn8Xzb1N8xf2-UQ0qKy3HRnqjsqvVKZXhK8w9R4efng   18s   kubelet-bootstrap   Pending</span><br><span class="line"><span class="comment"># 批准申请</span></span><br><span class="line">kubectl certificate approve node-csr-Hn8Xzb1N8xf2-UQ0qKy3HRnqjsqvVKZXhK8w9R4efng</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看节点</span></span><br><span class="line">kubectl get node</span><br></pre></td></tr></table></figure>
<h3 id="部署kube-proxy"><a href="#部署kube-proxy" class="headerlink" title="部署kube-proxy"></a>部署kube-proxy</h3><h4 id="创建配置文件-4"><a href="#创建配置文件-4" class="headerlink" title="创建配置文件"></a>创建配置文件</h4><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cat</span> &gt; /opt/kubernetes/cfg/kube-proxy.conf &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string">KUBE_PROXY_OPTS=&quot;--logtostderr=false \\</span></span><br><span class="line"><span class="string">--v=2 \\</span></span><br><span class="line"><span class="string">--log-dir=/opt/kubernetes/logs \\</span></span><br><span class="line"><span class="string">--config=/opt/kubernetes/cfg/kube-proxy-config.yml&quot;</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure>
<h4 id="配置参数文件-1"><a href="#配置参数文件-1" class="headerlink" title="配置参数文件"></a>配置参数文件</h4><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cat</span> &gt; /opt/kubernetes/cfg/kube-proxy-config.yml &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string">kind: KubeProxyConfiguration</span></span><br><span class="line"><span class="string">apiVersion: kubeproxy.config.k8s.io/v1alpha1</span></span><br><span class="line"><span class="string">bindAddress: 0.0.0.0</span></span><br><span class="line"><span class="string">metricsBindAddress: 0.0.0.0:10249</span></span><br><span class="line"><span class="string">clientConnection:</span></span><br><span class="line"><span class="string">  kubeconfig: /opt/kubernetes/cfg/kube-proxy.kubeconfig</span></span><br><span class="line"><span class="string">hostnameOverride: k8s-master</span></span><br><span class="line"><span class="string">clusterCIDR: 10.0.0.0/24</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure>
<h4 id="生成kube-proxy-kubeconfig文件"><a href="#生成kube-proxy-kubeconfig文件" class="headerlink" title="生成kube-proxy.kubeconfig文件"></a>生成kube-proxy.kubeconfig文件</h4><p>生成kube-proxy证书：</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 切换工作目录</span></span><br><span class="line"><span class="built_in">cd</span> ~/TLS/k8s</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建证书请求文件</span></span><br><span class="line"><span class="built_in">cat</span> &gt; kube-proxy-csr.json &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">  &quot;CN&quot;: &quot;system:kube-proxy&quot;,</span></span><br><span class="line"><span class="string">  &quot;hosts&quot;: [],</span></span><br><span class="line"><span class="string">  &quot;key&quot;: &#123;</span></span><br><span class="line"><span class="string">    &quot;algo&quot;: &quot;rsa&quot;,</span></span><br><span class="line"><span class="string">    &quot;size&quot;: 2048</span></span><br><span class="line"><span class="string">  &#125;,</span></span><br><span class="line"><span class="string">  &quot;names&quot;: [</span></span><br><span class="line"><span class="string">    &#123;</span></span><br><span class="line"><span class="string">      &quot;C&quot;: &quot;CN&quot;,</span></span><br><span class="line"><span class="string">      &quot;L&quot;: &quot;BeiJing&quot;,</span></span><br><span class="line"><span class="string">      &quot;ST&quot;: &quot;BeiJing&quot;,</span></span><br><span class="line"><span class="string">      &quot;O&quot;: &quot;k8s&quot;,</span></span><br><span class="line"><span class="string">      &quot;OU&quot;: &quot;System&quot;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">  ]</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 生成证书</span></span><br><span class="line">cfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=kubernetes kube-proxy-csr.json | cfssljson -bare kube-proxy</span><br><span class="line"></span><br><span class="line"><span class="built_in">ls</span> kube-proxy*pem</span><br><span class="line">kube-proxy-key.pem  kube-proxy.pem</span><br></pre></td></tr></table></figure>
<p>生成kubeconfig文件：</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">KUBE_APISERVER=<span class="string">&quot;https://192.168.188.128:6443&quot;</span></span><br><span class="line"></span><br><span class="line">kubectl config set-cluster kubernetes \</span><br><span class="line">  --certificate-authority=/opt/kubernetes/ssl/ca.pem \</span><br><span class="line">  --embed-certs=<span class="literal">true</span> \</span><br><span class="line">  --server=<span class="variable">$&#123;KUBE_APISERVER&#125;</span> \</span><br><span class="line">  --kubeconfig=kube-proxy.kubeconfig</span><br><span class="line">kubectl config set-credentials kube-proxy \</span><br><span class="line">  --client-certificate=./kube-proxy.pem \</span><br><span class="line">  --client-key=./kube-proxy-key.pem \</span><br><span class="line">  --embed-certs=<span class="literal">true</span> \</span><br><span class="line">  --kubeconfig=kube-proxy.kubeconfig</span><br><span class="line">kubectl config set-context default \</span><br><span class="line">  --cluster=kubernetes \</span><br><span class="line">  --user=kube-proxy \</span><br><span class="line">  --kubeconfig=kube-proxy.kubeconfig</span><br><span class="line">kubectl config use-context default --kubeconfig=kube-proxy.kubeconfig</span><br></pre></td></tr></table></figure>
<p>拷贝到配置文件指定路径：</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cp</span> kube-proxy.kubeconfig /opt/kubernetes/cfg/</span><br></pre></td></tr></table></figure>
<h4 id="systemd管理kube-proxy"><a href="#systemd管理kube-proxy" class="headerlink" title="systemd管理kube-proxy"></a>systemd管理kube-proxy</h4><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cat</span> &gt; /usr/lib/systemd/system/kube-proxy.service &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string">[Unit]</span></span><br><span class="line"><span class="string">Description=Kubernetes Proxy</span></span><br><span class="line"><span class="string">After=network.target</span></span><br><span class="line"><span class="string">[Service]</span></span><br><span class="line"><span class="string">EnvironmentFile=/opt/kubernetes/cfg/kube-proxy.conf</span></span><br><span class="line"><span class="string">ExecStart=/opt/kubernetes/bin/kube-proxy \$KUBE_PROXY_OPTS</span></span><br><span class="line"><span class="string">Restart=on-failure</span></span><br><span class="line"><span class="string">LimitNOFILE=65536</span></span><br><span class="line"><span class="string">[Install]</span></span><br><span class="line"><span class="string">WantedBy=multi-user.target</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure>
<h4 id="启动并设置开机启动-6"><a href="#启动并设置开机启动-6" class="headerlink" title="启动并设置开机启动"></a>启动并设置开机启动</h4><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl start kube-proxy</span><br><span class="line">systemctl <span class="built_in">enable</span> kube-proxy</span><br></pre></td></tr></table></figure>
<h3 id="部署CNI网络"><a href="#部署CNI网络" class="headerlink" title="部署CNI网络"></a>部署CNI网络</h3><p>先准备好CNI二进制文件：</p>
<p>下载地址：<a href="https://github.com/containernetworking/plugins/releases/download/v0.8.6/cni-plugins-linux-amd64-v0.8.6.tgz">https://github.com/containernetworking/plugins/releases/download/v0.8.6/cni-plugins-linux-amd64-v0.8.6.tgz</a></p>
<p>解压二进制包并移动到默认工作目录：</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"> <span class="built_in">mkdir</span> /etc/cni/net.d -p</span><br><span class="line"><span class="built_in">cd</span> /mnt/hgfs/tmp/</span><br><span class="line"><span class="built_in">mkdir</span> /opt/cni/bin -p</span><br><span class="line"><span class="built_in">cp</span> cni-plugins-linux-amd64-v0.8.6.tgz /opt/cni/bin/cni-plugins-linux-amd64-v0.8.6.tgz</span><br><span class="line"><span class="built_in">cd</span> /opt/cni/bin</span><br><span class="line">tar zxvf cni-plugins-linux-amd64-v0.8.6.tgz -C /opt/cni/bin</span><br></pre></td></tr></table></figure>
<p>部署CNI网络：</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">wget https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml</span><br><span class="line"><span class="built_in">cp</span> /mnt/hgfs/tmp/kube-flannel.yml /opt/cni/bin</span><br><span class="line"><span class="comment"># 默认镜像地址无法访问，修改为docker hub镜像仓库。</span></span><br><span class="line">sed -i -r <span class="string">&quot;s#quay.io/coreos/flannel:.*-amd64#lizhenliang/flannel:v0.12.0-amd64#g&quot;</span> kube-flannel.yml</span><br><span class="line"></span><br><span class="line">kubectl -n kube-system apply -f</span><br><span class="line">wget https://raw.githubusercontent.com/coreos/flannel/bc79dd1505b0c8681ece4de4c0d86c5cd2643275/Documentation/kube-flannel.yml</span><br><span class="line"></span><br><span class="line">sed -i -r <span class="string">&quot;s#quay.io/coreos/flannel:.*-amd64#lizhenliang/flannel:v0.10.0-amd64#g&quot;</span> kube-flannel.yml.2</span><br></pre></td></tr></table></figure>
<p>手动下载：kube-flannel.yml</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Namespace</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">kube-flannel</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">pod-security.kubernetes.io/enforce:</span> <span class="string">privileged</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ClusterRole</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">flannel</span></span><br><span class="line"><span class="attr">rules:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">apiGroups:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&quot;&quot;</span></span><br><span class="line">  <span class="attr">resources:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">pods</span></span><br><span class="line">  <span class="attr">verbs:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">get</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">apiGroups:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&quot;&quot;</span></span><br><span class="line">  <span class="attr">resources:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">nodes</span></span><br><span class="line">  <span class="attr">verbs:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">get</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">list</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">watch</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">apiGroups:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&quot;&quot;</span></span><br><span class="line">  <span class="attr">resources:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">nodes/status</span></span><br><span class="line">  <span class="attr">verbs:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">patch</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">apiGroups:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&quot;networking.k8s.io&quot;</span></span><br><span class="line">  <span class="attr">resources:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">clustercidrs</span></span><br><span class="line">  <span class="attr">verbs:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">list</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">watch</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ClusterRoleBinding</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">flannel</span></span><br><span class="line"><span class="attr">roleRef:</span></span><br><span class="line">  <span class="attr">apiGroup:</span> <span class="string">rbac.authorization.k8s.io</span></span><br><span class="line">  <span class="attr">kind:</span> <span class="string">ClusterRole</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">flannel</span></span><br><span class="line"><span class="attr">subjects:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">kind:</span> <span class="string">ServiceAccount</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">flannel</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">kube-flannel</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ServiceAccount</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">flannel</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">kube-flannel</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">kube-flannel-cfg</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">kube-flannel</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">tier:</span> <span class="string">node</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">flannel</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">cni-conf.json:</span> <span class="string">|</span></span><br><span class="line"><span class="string">    &#123;</span></span><br><span class="line"><span class="string">      &quot;name&quot;: &quot;cbr0&quot;,</span></span><br><span class="line"><span class="string">      &quot;cniVersion&quot;: &quot;0.3.1&quot;,</span></span><br><span class="line"><span class="string">      &quot;plugins&quot;: [</span></span><br><span class="line"><span class="string">        &#123;</span></span><br><span class="line"><span class="string">          &quot;type&quot;: &quot;flannel&quot;,</span></span><br><span class="line"><span class="string">          &quot;delegate&quot;: &#123;</span></span><br><span class="line"><span class="string">            &quot;hairpinMode&quot;: true,</span></span><br><span class="line"><span class="string">            &quot;isDefaultGateway&quot;: true</span></span><br><span class="line"><span class="string">          &#125;</span></span><br><span class="line"><span class="string">        &#125;,</span></span><br><span class="line"><span class="string">        &#123;</span></span><br><span class="line"><span class="string">          &quot;type&quot;: &quot;portmap&quot;,</span></span><br><span class="line"><span class="string">          &quot;capabilities&quot;: &#123;</span></span><br><span class="line"><span class="string">            &quot;portMappings&quot;: true</span></span><br><span class="line"><span class="string">          &#125;</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">      ]</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string"></span>  <span class="attr">net-conf.json:</span> <span class="string">|</span></span><br><span class="line"><span class="string">    &#123;</span></span><br><span class="line"><span class="string">      &quot;Network&quot;: &quot;10.244.0.0/16&quot;,</span></span><br><span class="line"><span class="string">      &quot;Backend&quot;: &#123;</span></span><br><span class="line"><span class="string">        &quot;Type&quot;: &quot;vxlan&quot;</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string"></span><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">DaemonSet</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">kube-flannel-ds</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">kube-flannel</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">tier:</span> <span class="string">node</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">flannel</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">flannel</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">tier:</span> <span class="string">node</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">flannel</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">affinity:</span></span><br><span class="line">        <span class="attr">nodeAffinity:</span></span><br><span class="line">          <span class="attr">requiredDuringSchedulingIgnoredDuringExecution:</span></span><br><span class="line">            <span class="attr">nodeSelectorTerms:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">matchExpressions:</span></span><br><span class="line">              <span class="bullet">-</span> <span class="attr">key:</span> <span class="string">kubernetes.io/os</span></span><br><span class="line">                <span class="attr">operator:</span> <span class="string">In</span></span><br><span class="line">                <span class="attr">values:</span></span><br><span class="line">                <span class="bullet">-</span> <span class="string">linux</span></span><br><span class="line">      <span class="attr">hostNetwork:</span> <span class="literal">true</span></span><br><span class="line">      <span class="attr">priorityClassName:</span> <span class="string">system-node-critical</span></span><br><span class="line">      <span class="attr">tolerations:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">operator:</span> <span class="string">Exists</span></span><br><span class="line">        <span class="attr">effect:</span> <span class="string">NoSchedule</span></span><br><span class="line">      <span class="attr">serviceAccountName:</span> <span class="string">flannel</span></span><br><span class="line">      <span class="attr">initContainers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">install-cni-plugin</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">docker.io/flannel/flannel-cni-plugin:v1.1.2</span></span><br><span class="line">       <span class="comment">#image: docker.io/rancher/mirrored-flannelcni-flannel-cni-plugin:v1.1.2</span></span><br><span class="line">        <span class="attr">command:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">cp</span></span><br><span class="line">        <span class="attr">args:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">-f</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">/flannel</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">/opt/cni/bin/flannel</span></span><br><span class="line">        <span class="attr">volumeMounts:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">cni-plugin</span></span><br><span class="line">          <span class="attr">mountPath:</span> <span class="string">/opt/cni/bin</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">install-cni</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">docker.io/flannel/flannel:v0.21.3</span></span><br><span class="line">       <span class="comment">#image: docker.io/rancher/mirrored-flannelcni-flannel:v0.21.3</span></span><br><span class="line">        <span class="attr">command:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">cp</span></span><br><span class="line">        <span class="attr">args:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">-f</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">/etc/kube-flannel/cni-conf.json</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">/etc/cni/net.d/10-flannel.conflist</span></span><br><span class="line">        <span class="attr">volumeMounts:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">cni</span></span><br><span class="line">          <span class="attr">mountPath:</span> <span class="string">/etc/cni/net.d</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">flannel-cfg</span></span><br><span class="line">          <span class="attr">mountPath:</span> <span class="string">/etc/kube-flannel/</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">kube-flannel</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">docker.io/flannel/flannel:v0.21.3</span></span><br><span class="line">       <span class="comment">#image: docker.io/rancher/mirrored-flannelcni-flannel:v0.21.3</span></span><br><span class="line">        <span class="attr">command:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">/opt/bin/flanneld</span></span><br><span class="line">        <span class="attr">args:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">--ip-masq</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">--kube-subnet-mgr</span></span><br><span class="line">        <span class="attr">resources:</span></span><br><span class="line">          <span class="attr">requests:</span></span><br><span class="line">            <span class="attr">cpu:</span> <span class="string">&quot;100m&quot;</span></span><br><span class="line">            <span class="attr">memory:</span> <span class="string">&quot;50Mi&quot;</span></span><br><span class="line">        <span class="attr">securityContext:</span></span><br><span class="line">          <span class="attr">privileged:</span> <span class="literal">false</span></span><br><span class="line">          <span class="attr">capabilities:</span></span><br><span class="line">            <span class="attr">add:</span> [<span class="string">&quot;NET_ADMIN&quot;</span>, <span class="string">&quot;NET_RAW&quot;</span>]</span><br><span class="line">        <span class="attr">env:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">POD_NAME</span></span><br><span class="line">          <span class="attr">valueFrom:</span></span><br><span class="line">            <span class="attr">fieldRef:</span></span><br><span class="line">              <span class="attr">fieldPath:</span> <span class="string">metadata.name</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">POD_NAMESPACE</span></span><br><span class="line">          <span class="attr">valueFrom:</span></span><br><span class="line">            <span class="attr">fieldRef:</span></span><br><span class="line">              <span class="attr">fieldPath:</span> <span class="string">metadata.namespace</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">EVENT_QUEUE_DEPTH</span></span><br><span class="line">          <span class="attr">value:</span> <span class="string">&quot;5000&quot;</span></span><br><span class="line">        <span class="attr">volumeMounts:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">run</span></span><br><span class="line">          <span class="attr">mountPath:</span> <span class="string">/run/flannel</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">flannel-cfg</span></span><br><span class="line">          <span class="attr">mountPath:</span> <span class="string">/etc/kube-flannel/</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">xtables-lock</span></span><br><span class="line">          <span class="attr">mountPath:</span> <span class="string">/run/xtables.lock</span></span><br><span class="line">      <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">run</span></span><br><span class="line">        <span class="attr">hostPath:</span></span><br><span class="line">          <span class="attr">path:</span> <span class="string">/run/flannel</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">cni-plugin</span></span><br><span class="line">        <span class="attr">hostPath:</span></span><br><span class="line">          <span class="attr">path:</span> <span class="string">/opt/cni/bin</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">cni</span></span><br><span class="line">        <span class="attr">hostPath:</span></span><br><span class="line">          <span class="attr">path:</span> <span class="string">/etc/cni/net.d</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">flannel-cfg</span></span><br><span class="line">        <span class="attr">configMap:</span></span><br><span class="line">          <span class="attr">name:</span> <span class="string">kube-flannel-cfg</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">xtables-lock</span></span><br><span class="line">        <span class="attr">hostPath:</span></span><br><span class="line">          <span class="attr">path:</span> <span class="string">/run/xtables.lock</span></span><br><span class="line">          <span class="attr">type:</span> <span class="string">FileOrCreate</span></span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">kubectl apply -f kube-flannel.yml</span><br><span class="line"></span><br><span class="line">namespace/kube-flannel created</span><br><span class="line">clusterrole.rbac.authorization.k8s.io/flannel created</span><br><span class="line">clusterrolebinding.rbac.authorization.k8s.io/flannel created</span><br><span class="line">serviceaccount/flannel created</span><br><span class="line">configmap/kube-flannel-cfg created</span><br><span class="line">daemonset.apps/kube-flannel-ds created</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="新增加Worker-Node"><a href="#新增加Worker-Node" class="headerlink" title="新增加Worker Node"></a>新增加Worker Node</h3><h4 id="拷贝已部署好的Node相关文件到新节点"><a href="#拷贝已部署好的Node相关文件到新节点" class="headerlink" title="拷贝已部署好的Node相关文件到新节点"></a>拷贝已部署好的Node相关文件到新节点</h4><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">scp -r /opt/kubernetes root@192.168.188.129:/opt/</span><br><span class="line"></span><br><span class="line">scp -r /usr/lib/systemd/system/&#123;kubelet,kube-proxy&#125;.service root@192.168.188.129:/usr/lib/systemd/system</span><br><span class="line"></span><br><span class="line">scp -r /opt/cni/ root@192.168.188.129:/opt/</span><br><span class="line"></span><br><span class="line">scp /opt/kubernetes/ssl/ca.pem root@192.168.188.129:/opt/kubernetes/ssl</span><br><span class="line"><span class="comment">######</span></span><br><span class="line">scp -r /opt/kubernetes root@192.168.188.130:/opt/</span><br><span class="line"></span><br><span class="line">scp -r /usr/lib/systemd/system/&#123;kubelet,kube-proxy&#125;.service root@192.168.188.130:/usr/lib/systemd/system</span><br><span class="line"></span><br><span class="line">scp -r /opt/cni/ root@192.168.188.130:/opt/</span><br><span class="line"></span><br><span class="line">scp /opt/kubernetes/ssl/ca.pem root@192.168.188.130:/opt/kubernetes/ssl</span><br></pre></td></tr></table></figure>
<h4 id="删除kubelet证书和kubeconfig文件"><a href="#删除kubelet证书和kubeconfig文件" class="headerlink" title="删除kubelet证书和kubeconfig文件"></a>删除kubelet证书和kubeconfig文件</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">rm /opt/kubernetes/cfg/kubelet.kubeconfig </span><br><span class="line">rm -f /opt/kubernetes/ssl/kubelet*</span><br></pre></td></tr></table></figure>
<h4 id="修改主机名"><a href="#修改主机名" class="headerlink" title="修改主机名"></a>修改主机名</h4><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">vi /opt/kubernetes/cfg/kubelet.conf</span><br><span class="line">--hostname-override=k8s-node1</span><br><span class="line"></span><br><span class="line">vi /opt/kubernetes/cfg/kube-proxy-config.yml</span><br><span class="line">hostnameOverride: k8s-node1</span><br></pre></td></tr></table></figure>
<h4 id="启动并设置开机启动-7"><a href="#启动并设置开机启动-7" class="headerlink" title="启动并设置开机启动"></a>启动并设置开机启动</h4><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl start kubelet</span><br><span class="line">systemctl <span class="built_in">enable</span> kubelet</span><br><span class="line">systemctl start kube-proxy</span><br><span class="line">systemctl <span class="built_in">enable</span> kube-proxy</span><br></pre></td></tr></table></figure>
<h4 id="在Master上批准新Node-kubelet证书申请"><a href="#在Master上批准新Node-kubelet证书申请" class="headerlink" title="在Master上批准新Node kubelet证书申请"></a>在Master上批准新Node kubelet证书申请</h4><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">kubectl get csr</span><br><span class="line">NAME                                                   AGE   SIGNERNAME                                    REQUESTOR           CONDITION</span><br><span class="line">node-csr-4zTjsaVSrhuyhIGqsefxzVoZDCNKei-aE2jyTP81Uro   89s   kubernetes.io/kube-apiserver-client-kubelet   kubelet-bootstrap   Pending</span><br><span class="line"></span><br><span class="line">kubectl certificate approve node-csr-4zTjsaVSrhuyhIGqsefxzVoZDCNKei-aE2jyTP81Uro</span><br></pre></td></tr></table></figure>
<h4 id="查看Node状态"><a href="#查看Node状态" class="headerlink" title="查看Node状态"></a>查看Node状态</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">kubectl get node</span><br><span class="line">NAME         STATUS   ROLES    AGE   VERSION</span><br><span class="line">k8s-master   Ready    &lt;none&gt;   26h   v1.18.3</span><br><span class="line">k8s-node1    Ready    &lt;none&gt;   21h   v1.13.0</span><br><span class="line">k8s-node2    Ready    &lt;none&gt;   21h   v1.13.0</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="部署kubeboard和CoreDNS"><a href="#部署kubeboard和CoreDNS" class="headerlink" title="部署kubeboard和CoreDNS"></a>部署kubeboard和CoreDNS</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">kubectl apply -f https://kuboard.cn/install-script/kuboard.yaml</span><br><span class="line">kubectl apply -f https://addons.kuboard.cn/metrics-server/0.3.7/metrics-server.yaml</span><br><span class="line"></span><br><span class="line">kubectl get pods -l k8s.kuboard.cn/name=kuboard -n kube-system</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取Token</span></span><br><span class="line"><span class="comment"># 如果您参考 www.kuboard.cn 提供的文档安装 Kuberenetes，可在第一个 Master 节点上执行此命令</span></span><br><span class="line"><span class="comment"># https://kuboard.cn/install/install-dashboard.html#%E8%8E%B7%E5%8F%96token</span></span><br><span class="line"><span class="built_in">echo</span> $(kubectl -n kube-system get secret $(kubectl -n kube-system get secret | grep ^kuboard-user | awk <span class="string">&#x27;&#123;print $1&#125;&#x27;</span>) -o go-template=<span class="string">&#x27;&#123;&#123;.data.token&#125;&#125;&#x27;</span> | <span class="built_in">base64</span> -d)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="部署CoreDNS"><a href="#部署CoreDNS" class="headerlink" title="部署CoreDNS"></a>部署CoreDNS</h3><p>CoreDNS用于集群内部Service名称解析。</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">kubectl apply -f coredns.yaml</span><br><span class="line"></span><br><span class="line">kubectl get pods -n kube-system </span><br></pre></td></tr></table></figure>
<p>DNS解析测试：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">kubectl run -it --rm dns-test --image=busybox:1.28.4 sh</span><br><span class="line">If you don&#x27;t see a command prompt, try pressing enter.</span><br><span class="line"></span><br><span class="line">/ # nslookup kubernetes</span><br><span class="line">Server:    10.0.0.2</span><br><span class="line">Address 1: 10.0.0.2 kube-dns.kube-system.svc.cluster.local</span><br><span class="line"></span><br><span class="line">Name:      kubernetes</span><br><span class="line">Address 1: 10.0.0.1 kubernetes.default.svc.cluster.local</span><br></pre></td></tr></table></figure>
<h2 id="Docker-Compose-安装"><a href="#Docker-Compose-安装" class="headerlink" title="Docker Compose 安装"></a>Docker Compose 安装</h2><p>下载 docker-compose文件：</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">sudo</span> curl -L <span class="string">&quot;https://get.daocloud.io/docker/compose/releases/download/1.27.4/docker-compose-<span class="subst">$(uname -s)</span>-<span class="subst">$(uname -m)</span>&quot;</span> -o /usr/local/bin/docker-compose</span><br></pre></td></tr></table></figure>
<p>赋予执行权限：</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">sudo</span> <span class="built_in">chmod</span> +x /usr/local/bin/docker-compose</span><br></pre></td></tr></table></figure>
<p>使用命令 docker-compose -v 查看 compose 版本</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">[root@k8s-master tmp]# docker-compose -v</span><br><span class="line">docker-compose version 1.27.4, build 40524192</span><br></pre></td></tr></table></figure>
<h2 id="Harbor安装"><a href="#Harbor安装" class="headerlink" title="Harbor安装"></a>Harbor安装</h2><p>在master节点：</p>
<p>离线安装包：<a href="https://pan.baidu.com/s/1I75uievCd4kVi0eIpXHkZQ?from=init">harbor-offline-installer-v1.5.0.tgz_免费高速下载|百度网盘-分享无限制 (baidu.com)</a></p>
<p>解压</p>
<p>tar xzvf 包名</p>
<p>进入解压出来的文件夹harbor中</p>
<p>vi harbor.cfg</p>
<p>把其中的hostname修改为：master1 的IP地址；然后 修改harbor的登录密码</p>
<p>执行命令：</p>
<p><strong>./prepare</strong></p>
<p><strong>./install.sh</strong></p>
<p>启动完，查看一下</p>
<p>docker-compose ps</p>
<p>用网页看下</p>
<p><a href="http://localhost/harbor/projects">Harbor</a></p>
<h2 id="gitlab安装"><a href="#gitlab安装" class="headerlink" title="gitlab安装"></a>gitlab安装</h2><p>在node1节点</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> gitlab &amp;&amp; <span class="built_in">cd</span> gitlab</span><br><span class="line">vim docker-compose.yml</span><br><span class="line"></span><br><span class="line">version: <span class="string">&#x27;3&#x27;</span></span><br><span class="line"></span><br><span class="line">services:</span><br><span class="line">    gitlab:</span><br><span class="line">      image: <span class="string">&#x27;twang2218/gitlab-ce-zh&#x27;</span></span><br><span class="line">      container_name: <span class="string">&#x27;gitlab&#x27;</span></span><br><span class="line">      restart: always</span><br><span class="line">      hostname: <span class="string">&#x27;192.168.188.129&#x27;</span> <span class="comment">#部署机器的ip,非容器ip(因为是本地不是线上所以用ip，线上的话可以用域名)</span></span><br><span class="line">      environment:</span><br><span class="line">        TZ: <span class="string">&#x27;Asia/Shanghai&#x27;</span></span><br><span class="line">        GITLAB_OMNIBUS_CONFIG: |</span><br><span class="line">         external_url <span class="string">&#x27;http://192.168.188.129:81&#x27;</span>  <span class="comment">#使用这个地址访问gitlab web ui(因为是本地不是线上所以用ip，线上的话可以用域名)</span></span><br><span class="line">         gitlab_rails[<span class="string">&#x27;gitlab_shell_ssh_port&#x27;</span>] = 2222 <span class="comment">#ssh clone代码地址</span></span><br><span class="line">         unicorn[<span class="string">&#x27;port&#x27;</span>] = 8888 <span class="comment">#gitlab一个内部端口</span></span><br><span class="line">      ports:</span><br><span class="line">        - <span class="string">&#x27;80:81&#x27;</span>        <span class="comment">#web 80 端口</span></span><br><span class="line">       <span class="comment">#- &#x27;443:443&#x27;      #web 443 端口,本次未使用就不开放了</span></span><br><span class="line">        - <span class="string">&#x27;2222:22&#x27;</span>      <span class="comment">#ssh 检出代码 端口</span></span><br><span class="line">      volumes:</span><br><span class="line">        - ./etc:/etc/gitlab             <span class="comment">#Gitlab配置文件目录</span></span><br><span class="line">        - ./data:/var/opt/gitlab  <span class="comment">#Gitlab数据目录</span></span><br><span class="line">        - ./logs:/var/log/gitlab   <span class="comment">#Gitlab日志目录</span></span><br><span class="line">        </span><br><span class="line">    </span><br></pre></td></tr></table></figure>
<p>启动gitlab</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">docker-compose up -d</span><br></pre></td></tr></table></figure>
<p>重启gitlab</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">docker-compose stop</span><br><span class="line">docker-compose up -d</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>计算机</category>
      </categories>
  </entry>
  <entry>
    <title>Prometheus监控文档</title>
    <url>/2023/04/30/%E8%AE%A1%E7%AE%97%E6%9C%BA/prometheus%E7%9B%91%E6%8E%A7%E6%96%87%E6%A1%A3/</url>
    <content><![CDATA[<h1 id="Prometheus监控文档"><a href="#Prometheus监控文档" class="headerlink" title="Prometheus监控文档"></a>Prometheus监控文档</h1><h2 id="1-SRE-Google运维解密"><a href="#1-SRE-Google运维解密" class="headerlink" title="1.SRE: Google运维解密"></a>1.SRE: Google运维解密</h2><p>​        为了让亿万用户使用到稳定可靠的服务，Google 组建了一支专业的团队负责运行这些后端服务，这些工程师有一个共同的名字：Site Reliability Engineer。了解 Google SRE 的人常说的一句话是：和你们相比，大部分公司还处于刀耕火种时代，什么时候你们这些最佳实践能够帮助帮助其他的公司呢？资深 Google SRE Chris Jones 等人联合撰写了《Google SRE: How Google runs production systems》（以下简称《Google SRE》），首次向外界解密了谷歌的生产环境。前 Google 资深 SRE ，现 <a href="https://link.zhihu.com/?target=https%3A//coding.net">Coding.net</a> CTO <a href="https://link.zhihu.com/?target=https%3A//coding.net/u/thefallentree">孙宇聪</a> 先生担任了本书译者。</p>
<p>​        Prometheus受启发于Google的Brogmon监控系统（相似的Kubernetes是从Google的Brog系统演变而来）</p>
<p><strong>康威定律</strong> (康威法则 , Conway’s Law) 是<a href="https://zh.wikipedia.org/wiki/马尔文·康威">马尔文·康威</a>1967年提出的：</p>
<blockquote>
<p>“设计系统的架构受制于产生这些设计的组织的沟通结构。”</p>
</blockquote>
<p>即系统设计本质上反映了企业的组织机构。系统各个模块间的接口也反映了企业各个部门之间的信息流动和合作方式，系统架构是组织架构的副本。</p>
<h3 id="1-主旨"><a href="#1-主旨" class="headerlink" title="1. 主旨"></a>1. 主旨</h3><p>之前有人问我这本书的中心思想是什么？忘记了当时给出的答案了，但是让我现在在回答一次的话，应该是——漫步 Google 运维，讲述 Google 这个拥有海量数据、多数据中心的公司，是如果通过各种手段来保证它的可用性。接下来将会分为四部分对该书进行总结：</p>
<ul>
<li>概览——了解 SRE 的定义，以及该职位与传统运维的区别</li>
<li>指导思想——讨论 SRE 的工作模式、行事方法，以及日常运维工作中关注的焦点</li>
<li>具体实践——理解 SRE 日常工作背后的理念，讨论具体的构建与运维大型分布式系统的实践。</li>
<li>管理——探索 Google 在培训，内部沟通，以及在会议方面的最佳实践。（ps 这篇笔记里针对这部分是没有描述的，感兴趣建议自己阅读</li>
</ul>
<h3 id="2-概览"><a href="#2-概览" class="headerlink" title="2. 概览"></a>2. 概览</h3><h4 id="2-1-提出-SRE-的动力？"><a href="#2-1-提出-SRE-的动力？" class="headerlink" title="2.1 提出 SRE 的动力？"></a>2.1 提出 SRE 的动力？</h4><p>很多公司开发部（Dev）和运维部（Ops）是分属两个不同部门的，这种 Dev/Ops 分离的团队模型，无法避免的带来两类成本问题：</p>
<ul>
<li>直接成本：随着系统复杂度的增加，部署规模的扩大，团队的大小基本与系统负载成线性关系，共同增长。</li>
<li>间接成本：研发团队和运维团队背景各异，技术能力和工具使用习惯上差距巨大，工作目标存在不可调和分歧点，而这些会严重影响产品的迭代。</li>
</ul>
<p>但SRE 团队的作为解决上分歧点被提出来，在快速迭代与系统稳定性直接做了平衡。SRE 团队的出现也大大节省了公司的开支。</p>
<p>公司作为盈利性组织，任何能够节省公司开支的举措都会被大力支持的，这才是核心动力。</p>
<blockquote>
<p>DevOps 这个名词的核心思想是尽早的将 IT 相关的技术与产品设计和开发过程结合起来，着重强调自动化而不是人工操作，以及利用软件工程手段执行运维任务等。可以认为 DevOps 是 SRE 核心理念的普适版，SER 是 DevOps 模型在 Google 的具体实践。</p>
</blockquote>
<h4 id="2-2-SRE-聚焦问题点"><a href="#2-2-SRE-聚焦问题点" class="headerlink" title="2.2 SRE 聚焦问题点"></a>2.2 SRE 聚焦问题点</h4><ul>
<li>确保长期关注研发工作：Google 将 SRE 团队的运维工作限制在 50% 以内，剩余的时间花在研发项目上。你需要拥有上帝视角，才能更好的解决问题。</li>
<li>在保障服务 SLO 的前提下最大化迭代的速度：Dev 和 Ops 不可调和的矛盾点是 迭代创新的速度与产品稳定程度之间的矛盾迭代创新的速度与产品稳定程度之间的矛盾 。 但是请记住，任何软件都不应该一味地追求 100% 可靠，因为大多数情况下 99.999% 和 100% 的可靠性是没有实质区别的。所以你需要「错误预算」。</li>
</ul>
<blockquote>
<p>你需要思考的是，花费巨大的精力将系统变为 100% 可靠是否能为用户带来实质意义上的好处？<br>从用户终端到服务器之间有很多中间系统（用户终端、家庭 wifi、网络提供商和输电线路等）这些系统综合起来的可靠性要远远低于 99.999%。</p>
</blockquote>
<ul>
<li>监控系统：一个监控系统应该只有三类输出：紧急警报、工单、日志</li>
</ul>
<p>不论是如何优秀研发人员，过多的噪音，一定会影响你对事物的判断。狼来了的故事教育我们，你要在狼真的来的时候才去呼救。</p>
<h2 id="2-监控的目标"><a href="#2-监控的目标" class="headerlink" title="2.监控的目标"></a>2.监控的目标</h2><p>在《SRE: Google运维解密》一书中指出，监控系统需要能够有效的支持白盒监控和黑盒监控。通过白盒能够了解其内部的实际运行状态，通过对监控指标的观察能够预判可能出现的问题，从而对潜在的不确定因素进行优化。而黑盒监控，常见的如HTTP探针，TCP探针等，可以在系统或者服务在发生故障时能够快速通知相关的人员进行处理。通过建立完善的监控体系，从而达到以下目的：</p>
<ul>
<li>长期趋势分析：通过对监控样本数据的持续收集和统计，对监控指标进行长期趋势分析。例如，通过对磁盘空间增长率的判断，我们可以提前预测在未来什么时间节点上需要对资源进行扩容。</li>
<li>对照分析：两个版本的系统运行资源使用情况的差异如何？在不同容量情况下系统的并发和负载变化如何？通过监控能够方便的对系统进行跟踪和比较。</li>
<li>告警：当系统出现或者即将出现故障时，监控系统需要迅速反应并通知管理员，从而能够对问题进行快速的处理或者提前预防问题的发生，避免出现对业务的影响。</li>
<li>故障分析与定位：当问题发生后，需要对问题进行调查和处理。通过对不同监控监控以及历史数据的分析，能够找到并解决根源问题。</li>
<li>数据可视化：通过可视化仪表盘能够直接获取系统的运行状态、资源使用情况、以及服务运行状态等直观的信息。</li>
</ul>
<h3 id="黑盒监控和白盒监控"><a href="#黑盒监控和白盒监控" class="headerlink" title="黑盒监控和白盒监控"></a>黑盒监控和白盒监控</h3><p><img src="https://ask.qcloudimg.com/http-save/yehe-8958129/6yfzcyd0y9.png?imageView2/2/w/2560/h/7000" alt="img"></p>
<p>黑盒监控：主要关注的现象，一般都是正在发生的东西，例如出现一个告警，业务接口不正常，那么这种监控就是站在用户的角度能看到的监控，重点在于能对正在发生的故障进行告警。</p>
<p>白盒监控：主要关注的是原因，也就是系统内部暴露的一些指标，例如redis的info中显示redis slave down，这个就是redis info显示的一个内部的指标，重点在于原因，可能是在黑盒监控中看到redis down，而查看内部信息的时候，显示redis port is refused connection。</p>
<h2 id="3-Prometheus"><a href="#3-Prometheus" class="headerlink" title="3.Prometheus"></a>3.Prometheus</h2><p>Prometheus：不仅是一款时间序列数据库，在整个生态上还是一套完整的监控系统，可以用作对k8s的资源进行监控。</p>
<p>特点：</p>
<ul>
<li><p>通过PromQL实现多维度数据模型的灵活查询。</p>
</li>
<li><p>定义了开放指标数据的标准，自定义探针（如Exporter等），编写简单方便。</p>
</li>
<li><p>PushGateway组件让这款监控系统可以接收监控数据。</p>
</li>
<li><p>提供了VM和容器化的版本。</p>
<p>尤其是第一点，这是很多监控系统望尘莫及的。多维度的数据模型和灵活的查询方式，使监控指标可以关联到多个标签，并对时间序列进行切片和切块，以支持各种图形、表格和告警场景。</p>
</li>
</ul>
<h3 id="1-官方架构图"><a href="#1-官方架构图" class="headerlink" title="1.官方架构图"></a>1.官方架构图</h3><p><img src="https://img-blog.csdnimg.cn/img_convert/bbb8ce98307cda5526df37183b2a0693.png" alt="img"></p>
<h3 id="2-组件介绍"><a href="#2-组件介绍" class="headerlink" title="2 组件介绍"></a>2 组件介绍</h3><h4 id="2-1-Prometheus-Server"><a href="#2-1-Prometheus-Server" class="headerlink" title="2.1 Prometheus Server"></a>2.1 Prometheus Server</h4><p>用于收集和存储时间序列数据。Prometheus Server 是 Prometheus 组件中的核心部分，负责实现对监控数据的获取，存储以及查询。 Prometheus Server 可以通过静态配置管理监控目标，也可以配合使用 Service Discovery 的方式动态管理监控目标，并从这些监控目标中获取数据。其次 Prometheus Server 需要对采集到的监控数据进行存储，Prometheus Server 本身就是一个时序数据库，将采集到的监控数据按照时间序列的方式存储在本地磁盘当中。最后Prometheus Server 对外提供了自定义的 PromQL 语言，实现对数据的查询以及分析。</p>
<h4 id="2-2-Exporter"><a href="#2-2-Exporter" class="headerlink" title="2.2 Exporter"></a>2.2 Exporter</h4><p>用于暴露已有的第三方服务的 metrics 给 Prometheus。Exporter 将监控数据采集的端点通过 HTTP 服务的形式暴露给 Prometheus Server，Prometheus Server 通过访问该 Exporter 提供的 Endpoint 端点，即可获取到需要采集的监控数据。</p>
<h4 id="2-3-Push-Gateway"><a href="#2-3-Push-Gateway" class="headerlink" title="2.3 Push Gateway"></a>2.3 Push Gateway</h4><p>主要用于短期的 jobs。由于这类 jobs 存在时间较短，可能在 Prometheus 来 pull 之前就消失了。为此，这些 jobs 可以直接向 Prometheus server 端推送它们的 metrics。</p>
<h4 id="2-4-Grafana"><a href="#2-4-Grafana" class="headerlink" title="2.4 Grafana"></a>2.4 Grafana</h4><p>第三方展示工具，可以编写 PromQL 查询语句，通过 http 协议与 prometheus 集成。</p>
<h4 id="2-5-AlertManager"><a href="#2-5-AlertManager" class="headerlink" title="2.5 AlertManager"></a>2.5 AlertManager</h4><p>从 Prometheus Server 端接收到 alerts 后，会进行去除重复数据，分组，并路由到对方的接受方式，发出报警。常见的接收方式有：电子邮件，钉钉、企业微信，pagerduty等。</p>
<h4 id="2-6-Client-Library"><a href="#2-6-Client-Library" class="headerlink" title="2.6 Client Library"></a>2.6 Client Library</h4><p>客户端库，为需要监控的服务生成相应的 metrics 并暴露给 Prometheus Server。当 Prometheus Server 来 pull 时，直接返回实时状态的 metrics。</p>
<h3 id="3-Prometheus工作流程"><a href="#3-Prometheus工作流程" class="headerlink" title="3 Prometheus工作流程"></a>3 Prometheus工作流程</h3><p>指标采集：prometheus server 通过 pull 形式采集监控指标，可以直接拉取监控指标，也可以通过 pushgateway 做中间环节，监控目标先 push 形式上报数据到 pushgateway；<br>指标处理：prometheus server 将采集的数据存储在自身 db 或者第三方 db；<br>指标展示：prometheus server 通过提供 http 接口，提供自带或者第三方展示系统；<br>指标告警：prometheus server 通过 push 告警信息到 alert-manager，alert-manager 通过”静默-抑制-整合-下发”4个阶段处理通知到观察者。</p>
<h3 id="4-Prometheus四种指标分类"><a href="#4-Prometheus四种指标分类" class="headerlink" title="4 Prometheus四种指标分类"></a>4 Prometheus四种指标分类</h3><p>Counter</p>
<p>计数器类型，只增不减，如机器的启动时间，HTTP 访问量等。机器重启不会置零，在使用这种指标类型时，通常会结合rate()方法获取该指标在某个时间段的变化率。</p>
<p>Gauge</p>
<p>仪表盘，可增可减，如CPU使用率，大部分监控数据都是这种类型的。</p>
<p>Summary</p>
<p>客户端定义；Summary，Histogram 都属于高级指标，用于凸显数据的分布情况。</p>
<p>Histogram</p>
<p>服务端定义，相比 Summary 性能更好，反应了某个区间内的样本数。</p>
<h3 id="5-prometheus修改数据保留时间"><a href="#5-prometheus修改数据保留时间" class="headerlink" title="5.prometheus修改数据保留时间"></a>5.prometheus修改数据保留时间</h3><p>—storage.tsdb.retention</p>
<p>该参数决定何时删除旧数据，默认为15天。<br>在启动脚本里更改<code>--storage.tsdb.retention=90d</code>可以延长，或者启动时带上这个参数即可。</p>
<h3 id="6-修改抓取信息周期"><a href="#6-修改抓取信息周期" class="headerlink" title="6.修改抓取信息周期"></a>6.修改抓取信息周期</h3><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">global:</span></span><br><span class="line">  <span class="attr">scrape_interval:</span>   <span class="string">60s</span> <span class="comment"># Set the scrape interval to every 15 seconds. Default is every 1 minute.</span></span><br><span class="line">  <span class="attr">evaluation_interval:</span> <span class="string">60s</span> <span class="comment"># Evaluate rules every 15 seconds. The default is every 1 minute.</span></span><br></pre></td></tr></table></figure>
<p>Prometheus以scrape_interval（默认为1m）规则周期，从监控目标上收集信息。其中scrape_interval可以基于全局或基于单个metric定义；然后将监控信息持久存储在其本地存储上。</p>
<p>Prometheus以evaluation_interval（默认为1m）另一个独立的规则周期，对告警规则做定期计算。其中evaluation_interval只有全局值；然后更新告警状态。</p>
<p>其中包含三种告警状态：</p>
<p>inactive：没有触发阈值</p>
<p>pending：已触发阈值但未满足告警持续时间</p>
<p>firing：已触发阈值且满足告警持续时间</p>
<p>举一个例子，阈值告警的配置如下：</p>
<p><img src="https://img-blog.csdn.net/20180905130207648?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0FjdGlvblRlY2g=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="img"></p>
<p>收集到的mysql_uptime&gt;=30,告警状态为inactive</p>
<p>收集到的mysql_uptime&lt;30,且持续时间小于10s，告警状态为pending</p>
<p>收集到的mysql_uptime&lt;30,且持续时间大于10s，告警状态为firing</p>
<p>⚠ 注意：配置中的for语法就是用来设置告警持续时间的；如果配置中不设置for或者设置为0，那么pending状态会被直接跳过。</p>
<p>那么怎么来计算告警阈值持续时间呢，需要回到上文的scrape_interval和evaluation_interval，假设scrape_interval为5s采集一次信息；evaluation_interval为10s；mysql_uptime告警阈值需要满足10s持续时间。</p>
<p><img src="https://img-blog.csdn.net/20180905130242384?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0FjdGlvblRlY2g=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="img"></p>
<p>如上图所示：</p>
<p>Prometheus以5s（scrape_interval）一个采集周期采集状态；</p>
<p>然后根据采集到状态按照10s（evaluation_interval）一个计算周期，计算表达式；</p>
<p>表达式为真，告警状态切换到pending；</p>
<p>下个计算周期，表达式仍为真，且符合for持续10s，告警状态变更为active，并将告警从Prometheus发送给Altermanger；</p>
<p>下个计算周期，表达式仍为真，且符合for持续10s，持续告警给Altermanger；</p>
<p>直到某个计算周期，表达式为假，告警状态变更为inactive，发送一个resolve给Altermanger，说明此告警已解决。</p>
<h2 id="4-监控kafka和redis"><a href="#4-监控kafka和redis" class="headerlink" title="4.监控kafka和redis"></a>4.监控kafka和redis</h2><h3 id="1-上传镜像"><a href="#1-上传镜像" class="headerlink" title="1.上传镜像"></a>1.上传镜像</h3><p>上传kafka_exporter.tar,redis_exporter.tar</p>
<p><img src="https://pic.imgdb.cn/item/6301ce5116f2c2beb14898b4.png" alt="arc"></p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> /tmp/prom</span><br><span class="line"><span class="built_in">ls</span></span><br><span class="line">docker load &lt; kafka_exporter.tar</span><br><span class="line">docker load &lt; redis_exporter.tar </span><br><span class="line">docker tag danielqsj/kafka-exporter:latest 172.31.10.118/monitor/kafka-exporter:v1.0</span><br><span class="line"></span><br><span class="line">docker tag prom/grafana 172.31.70.135:8443/prom/grafana:v1.0</span><br><span class="line">docker push 172.31.70.135:8443/prom/grafana:v1.0</span><br><span class="line">docker tag prom/node-exporter:v0.15.2  172.31.70.135:8443/prom/node-exporter:v0.15.2</span><br><span class="line">docker push 172.31.70.135:8443/prom/node-exporter:v0.15.2</span><br><span class="line"></span><br><span class="line">docker tag prom/prometheus:v2.2.1  172.31.70.135:8443/prom/prometheus:v2.2.1</span><br><span class="line">docker push 172.31.70.135:8443/prom/prometheus:v2.2.1</span><br><span class="line"></span><br><span class="line">docker tag oliver006/redis_exporter:latest 172.31.10.118/monitor/redis_exporter:v1.0</span><br><span class="line">docker login 172.31.10.118</span><br><span class="line">docker push 172.31.10.118/monitor/kafka-exporter:v1.0</span><br><span class="line">docker push 172.31.10.118/monitor/redis_exporter:v1.0</span><br></pre></td></tr></table></figure>
<h3 id="2-docker部署kafka-exporter"><a href="#2-docker部署kafka-exporter" class="headerlink" title="2.docker部署kafka_exporter"></a>2.docker部署kafka_exporter</h3><p>在172.31.10.127上</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">docker run -d --restart=always --net=host --name kafka_exporter 172.31.10.118/monitor/kafka-exporter:v1.0 --kafka.server=172.31.10.127:9092</span><br></pre></td></tr></table></figure>
<h3 id="3-docker部署redis-exporter"><a href="#3-docker部署redis-exporter" class="headerlink" title="3.docker部署redis_exporter"></a>3.docker部署redis_exporter</h3><p>在172.31.10.123上</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">docker run -d --name redis_exporter -p 9121:9121 172.31.10.118/monitor/redis_exporter:v1.0 --redis.addr 172.31.10.123:6379 --redis.password <span class="string">&#x27;redis密码&#x27;</span></span><br></pre></td></tr></table></figure>
<h3 id="4-修改Prometheus配置"><a href="#4-修改Prometheus配置" class="headerlink" title="4.修改Prometheus配置"></a>4.修改Prometheus配置</h3><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">kubectl edit cm -n monitoring monitor-prometheus-server</span><br></pre></td></tr></table></figure>
<p>增加配置</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line">    <span class="bullet">-</span> <span class="attr">alert:</span> <span class="string">RedisDown</span></span><br><span class="line">      <span class="attr">expr:</span> <span class="string">redis_up</span>  <span class="string">==</span> <span class="number">0</span></span><br><span class="line">      <span class="attr">for:</span> <span class="string">5m</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">severity:</span> <span class="string">error</span></span><br><span class="line">      <span class="attr">annotations:</span></span><br><span class="line">        <span class="attr">summary:</span> <span class="string">&quot;Redis down (instance <span class="template-variable">&#123;&#123; $labels.instance &#125;&#125;</span>)&quot;</span></span><br><span class="line">        <span class="attr">description:</span> <span class="string">&quot;Redis 挂了啊，mmp\n  VALUE = <span class="template-variable">&#123;&#123; $value &#125;&#125;</span>\n  LABELS: <span class="template-variable">&#123;&#123; $labels &#125;&#125;</span>&quot;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">alert:</span> <span class="string">MissingBackup</span></span><br><span class="line">      <span class="attr">expr:</span> <span class="string">time()</span> <span class="bullet">-</span> <span class="string">redis_rdb_last_save_timestamp_seconds</span> <span class="string">&gt;</span> <span class="number">60</span> <span class="string">*</span> <span class="number">60</span> <span class="string">*</span> <span class="number">24</span></span><br><span class="line">      <span class="attr">for:</span> <span class="string">5m</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">severity:</span> <span class="string">error</span></span><br><span class="line">      <span class="attr">annotations:</span></span><br><span class="line">        <span class="attr">summary:</span> <span class="string">&quot;Missing backup (instance <span class="template-variable">&#123;&#123; $labels.instance &#125;&#125;</span>)&quot;</span></span><br><span class="line">        <span class="attr">description:</span> <span class="string">&quot;Redis has not been backuped for 24 hours\n  VALUE = <span class="template-variable">&#123;&#123; $value &#125;&#125;</span>\n  LABELS: <span class="template-variable">&#123;&#123; $labels &#125;&#125;</span>&quot;</span>       </span><br><span class="line">    <span class="bullet">-</span> <span class="attr">alert:</span> <span class="string">OutOfMemory</span></span><br><span class="line">      <span class="attr">expr:</span> <span class="string">redis_memory_used_bytes</span> <span class="string">/</span> <span class="string">redis_total_system_memory_bytes</span> <span class="string">*</span> <span class="number">100</span> <span class="string">&gt;</span> <span class="number">90</span></span><br><span class="line">      <span class="attr">for:</span> <span class="string">5m</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">severity:</span> <span class="string">warning</span></span><br><span class="line">      <span class="attr">annotations:</span></span><br><span class="line">        <span class="attr">summary:</span> <span class="string">&quot;Out of memory (instance <span class="template-variable">&#123;&#123; $labels.instance &#125;&#125;</span>)&quot;</span></span><br><span class="line">        <span class="attr">description:</span> <span class="string">&quot;Redis is running out of memory (&gt; 90%)\n  VALUE = <span class="template-variable">&#123;&#123; $value &#125;&#125;</span>\n  LABELS: <span class="template-variable">&#123;&#123; $labels &#125;&#125;</span>&quot;</span></span><br><span class="line">        </span><br><span class="line">    <span class="bullet">-</span> <span class="attr">alert:</span> <span class="string">告警！Kafka</span> <span class="string">Topics</span> <span class="string">副本数少于3</span></span><br><span class="line">      <span class="attr">expr:</span> <span class="string">sum(kafka_topic_partition_in_sync_replica)</span> <span class="string">by</span> <span class="string">(topic)</span> <span class="string">&lt;</span> <span class="number">3</span></span><br><span class="line">      <span class="attr">for:</span> <span class="string">0m</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">      <span class="attr">severity:</span> <span class="string">严重告警</span></span><br><span class="line">      <span class="attr">annotations:</span></span><br><span class="line">        <span class="attr">summary:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; $labels.instance &#125;&#125;</span> Kafka topics 副本数少于3&quot;</span></span><br><span class="line">        <span class="attr">description:</span> <span class="string">&quot;Kafka topic 分区不同步\n  当前值 = <span class="template-variable">&#123;&#123; $value &#125;&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line">   <span class="bullet">-</span> <span class="attr">alert:</span> <span class="string">告警！KafkaConsumersGroup</span></span><br><span class="line">     <span class="attr">expr:</span> <span class="string">sum(kafka_consumergroup_lag)</span> <span class="string">by</span> <span class="string">(consumergroup)</span> <span class="string">&gt;</span> <span class="number">50</span></span><br><span class="line">     <span class="attr">for:</span> <span class="string">1m</span></span><br><span class="line">     <span class="attr">labels:</span></span><br><span class="line">       <span class="attr">severity:</span> <span class="string">严重告警</span></span><br><span class="line">     <span class="attr">annotations:</span></span><br><span class="line">       <span class="attr">summary:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; $labels.instance &#125;&#125;</span> Kafka consumers group&quot;</span></span><br><span class="line">       <span class="attr">description:</span> <span class="string">&quot;Kafka consumers group\n  当前值 = <span class="template-variable">&#123;&#123; $value &#125;&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">&#x27;kafka&#x27;</span></span><br><span class="line">    <span class="attr">scrape_interval:</span> <span class="string">30s</span></span><br><span class="line">    <span class="attr">static_configs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">targets:</span> [<span class="string">&#x27;172.31.10.127:9308&#x27;</span>]</span><br><span class="line"><span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">&#x27;redis&#x27;</span></span><br><span class="line">    <span class="attr">scrape_interval:</span> <span class="string">30s</span></span><br><span class="line">    <span class="attr">static_configs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">targets:</span> [<span class="string">&#x27;172.31.10.123:9121&#x27;</span>]</span><br></pre></td></tr></table></figure>
<h3 id="5-增加grafana仪表盘"><a href="#5-增加grafana仪表盘" class="headerlink" title="5.增加grafana仪表盘"></a>5.增加grafana仪表盘</h3><p>kafka的模板id：12326</p>
<p>redis的模板id：11692</p>
<h2 id="5-node-exporter和process-exporter"><a href="#5-node-exporter和process-exporter" class="headerlink" title="5.node_exporter和process_exporter"></a>5.node_exporter和process_exporter</h2><h3 id="1-docker部署node-exporter和process-exporter"><a href="#1-docker部署node-exporter和process-exporter" class="headerlink" title="1.docker部署node_exporter和process_exporter"></a>1.docker部署node_exporter和process_exporter</h3><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment">#登录harbor</span></span><br><span class="line">docker login -u admin -p Harbor12345 172.31.10.118</span><br><span class="line"></span><br><span class="line"><span class="comment"># 启动node-exporter</span></span><br><span class="line">docker run -d --name node-exporter --restart=always -p 9100:9100 -v <span class="string">&quot;/proc:/host/proc:ro&quot;</span> -v <span class="string">&quot;/sys:/host/sys:ro&quot;</span> -v <span class="string">&quot;/:/rootfs:ro&quot;</span> 172.31.10.118/monitor/node-exporter:v0.18.1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 启动process-exporter</span></span><br><span class="line">docker run --restart=always -tid -p 9256:9256 --privileged -v /proc:/host/proc -v `<span class="built_in">pwd</span>`:/config --name process-exporter 172.31.10.118/monitor/process-exporter:0.7.1 --procfs /host/proc -config.path /config/process-name.yaml</span><br><span class="line"></span><br><span class="line">vi process.yml</span><br><span class="line"></span><br><span class="line">process_names:</span><br><span class="line">  - name: <span class="string">&quot;&#123;&#123;.Matches&#125;&#125;&quot;</span></span><br><span class="line">    cmdline:</span><br><span class="line">    - <span class="string">&#x27;mysqld&#x27;</span></span><br><span class="line"></span><br><span class="line">process_names:</span><br><span class="line">  - name: <span class="string">&quot;&#123;&#123;.Matches&#125;&#125;&quot;</span></span><br><span class="line">    cmdline:</span><br><span class="line">    - <span class="string">&#x27;nginx&#x27;</span></span><br><span class="line"></span><br><span class="line">  - name: <span class="string">&quot;&#123;&#123;.Matches&#125;&#125;&quot;</span></span><br><span class="line">    cmdline:</span><br><span class="line">    - <span class="string">&#x27;keepalived&#x27;</span></span><br></pre></td></tr></table></figure>
<h3 id="2-prometheus添加对应配置"><a href="#2-prometheus添加对应配置" class="headerlink" title="2.prometheus添加对应配置"></a>2.prometheus添加对应配置</h3><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">kubectl edit cm -n monitoring monitor-prometheus-server</span><br><span class="line"><span class="comment">#热部署Prometheus</span></span><br><span class="line">curl -X POST http://172.31.10.113:41000/-/reload</span><br></pre></td></tr></table></figure>
<h2 id="6-自定义exporter"><a href="#6-自定义exporter" class="headerlink" title="6.自定义exporter"></a>6.自定义exporter</h2><p>client_java是Prometheus针对JVM类开发语言的client library库，我们可以直接基于client_java用户可以快速实现独立运行的Exporter程序，也可以在我们的项目源码中集成client_java以支持Prometheus。</p>
<p>e.g. 检查安全隐患的level和flowStatus是否一致</p>
<p>1.添加依赖</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/io.prometheus/simpleclient --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.prometheus<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>simpleclient<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.16.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> List&lt;MetricFamilySamples&gt; <span class="title function_">collect</span><span class="params">()</span> &#123;</span><br><span class="line">        List&lt;MetricFamilySamples&gt; mfs = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">metricName</span> <span class="operator">=</span> <span class="string">&quot;risk_level_error_num_guage&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Your code to get metrics</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;SELECT\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;\tpotential_risk.flow_status, \n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;\tpotential_risk.`level`\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;FROM\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;\tpotential_risk\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;WHERE\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;\tpotential_risk.yn_agree = 1&quot;</span>;</span><br><span class="line">        <span class="type">Conn</span> <span class="variable">c</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Conn</span>();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            c.getConnection(); <span class="comment">// 调用连接数据库的方法</span></span><br><span class="line"></span><br><span class="line">            <span class="type">Statement</span> <span class="variable">st</span> <span class="operator">=</span> c.getCon().createStatement();</span><br><span class="line">            <span class="type">ResultSet</span> <span class="variable">rs</span> <span class="operator">=</span> st.executeQuery(sql);</span><br><span class="line">            <span class="comment">//  根据结果集进行遍历，id，door_name，tel字段是数据库对应的字段，需要注意字段对应的类型</span></span><br><span class="line">            <span class="type">Integer</span> <span class="variable">num</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">            ArrayList&lt;MetricFamilySamples.Sample&gt; samples1 = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">            <span class="keyword">while</span> (rs.next()) &#123;</span><br><span class="line">                <span class="type">String</span> <span class="variable">flowStatus</span> <span class="operator">=</span> rs.getString(<span class="number">1</span>);</span><br><span class="line">                <span class="type">String</span> <span class="variable">level</span> <span class="operator">=</span> rs.getString(<span class="number">2</span>);</span><br><span class="line">                <span class="keyword">if</span> (StringUtils.isNotEmpty(level)) &#123;</span><br><span class="line">                    <span class="type">String</span> <span class="variable">levelNum</span> <span class="operator">=</span> getLevelNum(level);</span><br><span class="line">                    <span class="keyword">if</span> (!flowStatus.equals(levelNum))&#123;</span><br><span class="line">                        num++;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                   num++;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            rs.close();</span><br><span class="line">            st.close();</span><br><span class="line">            c.getCon().close();</span><br><span class="line"></span><br><span class="line">            MetricFamilySamples.<span class="type">Sample</span> <span class="variable">sample</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MetricFamilySamples</span>.Sample(metricName, Collections.singletonList(<span class="string">&quot;l1&quot;</span>), Collections.singletonList(<span class="string">&quot;v1&quot;</span>), num);</span><br><span class="line"></span><br><span class="line">            <span class="type">MetricFamilySamples</span> <span class="variable">samples</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MetricFamilySamples</span>(metricName, Type.GAUGE, <span class="string">&quot;risk that level!=flowStatus&quot;</span>, Collections.singletonList(sample));</span><br><span class="line"></span><br><span class="line">            mfs.add(samples);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> mfs;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 得到层级</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> level level</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> &#123;<span class="doctag">@link</span> String&#125;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String <span class="title function_">getLevelNum</span><span class="params">(String level)</span> &#123;</span><br><span class="line">        <span class="keyword">switch</span> (level) &#123;</span><br><span class="line">            <span class="keyword">case</span> ROLE_CODE_LEVEL_GROUP:</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;15&quot;</span>;</span><br><span class="line">            <span class="keyword">case</span> ROLE_CODE_LEVEL_AIRPORT:</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;13&quot;</span>;</span><br><span class="line">            <span class="keyword">case</span> ROLE_CODE_LEVEL_DEPARTMENT:</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;7&quot;</span>;</span><br><span class="line">            <span class="keyword">case</span> ROLE_CODE_LEVEL_OFFICE:</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;3&quot;</span>;</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p><img src="C:\Users\Developer\AppData\Roaming\Typora\typora-user-images\image-20230418094550731.png" alt="image-20230418094550731"></p>
<p>和zabbix比较：</p>
<p>zabbix使用sql的结果告警，对于判断逻辑比较复杂，不好使用sql写出来，要用代码写的告警不容易实现，就可以用Prometheus的自定义exporter</p>
<p><img src="C:\Users\Developer\AppData\Roaming\Typora\typora-user-images\image-20230418100340060.png" alt="image-20230418100340060"></p>
<p><img src="C:\Users\Developer\AppData\Roaming\Typora\typora-user-images\image-20230418100405064.png" alt="image-20230418100405064"></p>
<h2 id="7-相关资料链接"><a href="#7-相关资料链接" class="headerlink" title="7.相关资料链接"></a>7.相关资料链接</h2><p><a href="https://www.prometheus.wang/">Introduction · Prometheus中文技术文档</a></p>
<p><a href="https://prometheus.io/docs/introduction/overview/">概述 |普罗 米修斯 (prometheus.io)</a></p>
<p><a href="https://zhuanlan.zhihu.com/p/22354002">Google 如何运行 |《Google SRE》中文版 - 知乎 (zhihu.com)</a></p>
<p><a href="https://zhuanlan.zhihu.com/p/91215371">为什么说 Prometheus 是足以取代 Zabbix 的监控神器？ - 知乎 (zhihu.com)</a></p>
<p><a href="https://blog.csdn.net/iuskye/article/details/116493478">Prometheus监控系列三 | 架构详解<em>prometheus架构</em>程序猿Simon的博客-CSDN博客</a></p>
<p><a href="https://blog.csdn.net/qq_44766883/article/details/126559323">Prometheus的架构和操作介绍+K8S的部署+HPA的创建+资源限制<em>prometheus hpa</em>迷雾总会解的博客-CSDN博客</a></p>
<p><a href="https://blog.csdn.net/ActionTech/article/details/82421894">Prometheus一条告警是怎么触发的_evaluation_interval_ActionTech的博客-CSDN博客</a></p>
]]></content>
      <categories>
        <category>计算机</category>
      </categories>
  </entry>
  <entry>
    <title>vue3+springboot项目开发流程</title>
    <url>/2024/08/28/%E8%AE%A1%E7%AE%97%E6%9C%BA/vue3+springboot%E9%A1%B9%E7%9B%AE%E5%BC%80%E5%8F%91%E6%B5%81%E7%A8%8B/</url>
    <content><![CDATA[<p>vue3+springboot项目开发流程：</p>
<p><img src="https://img.picui.cn/free/2024/08/28/66ceab2f2a74d.png" alt="sp-global.png"></p>
<p>一般来说要首先有一个idea，然后把idea扩展成包含目标用户+解决了什么问题+简易需求文档+简易原型 。</p>
<p>个人开发者就直接出需求文档+原型。把目标用户+解决的问题+需求设计+产品设计+开发设计写到一起就行，不需要像图里这样出很多个不同的文档。</p>
<p>​        我是使用axure出的原型，word写的文档，模板参考的是这个：<a href="https://github.com/cuizhenjie/software-engineering-document">cuizhenjie/software-engineering-document: 软件工程常用文档模板及示例：可行性分析报告、开发计划、需求分析文档、概要设计文档、详细设计文档、用户操作手册、测试计划、测试分析报告、开发进度报告、项目开发总结报告、软件维护手册等 (github.com)</a></p>
<p>​        然后采用了vue3+springboot最普适的方案。项目不要从头写，直接用脚手架。我参考的是：</p>
<p>前端：<a href="https://github.com/xiangshu233/vue3-vant4-mobile">xiangshu233/vue3-vant4-mobile: 👋👋👋 基于Vue3.4、Vite5、Vant4、Pinia、Typescript、UnoCSS等主流技术开发，集成 Dark Mode(暗黑)模式和系统主题色，且持久化保存，集成 Mock 数据，包括登录/注册/找回/keep-alive/Axios/useEcharts/IconSvg等其他扩展。你可以在此之上直接开发你的业务代码！ (github.com)</a></p>
<p>后端：<a href="https://github.com/macrozheng/mall-tiny">macrozheng/mall-tiny: mall-tiny是一款基于SpringBoot+MyBatis-Plus的快速开发脚手架，拥有完整的权限管理功能，可对接Vue前端，开箱即用。 (github.com)</a></p>
<p>所以需要了解后端java+springboot+mybatisplus，前端ts+vue3+vant的相关教程。其中前端使用unocss+iconsvg能够快速的加图标和样式，后端也有根据mysql的表快速生成model+controller+service+mapper的代码生成器，能快速开发出最小可行产品。</p>
<p>​        项目部署：个人开发者的项目部署需要云服务器（公网ip）+域名。可以在b站或者知乎找收集整理各大服务器商的云服务器的价格的up主，来找到适合自己的云服务器。后端简单的部署直接nohup java -jar your-jar-file.jar &amp; ，mysql和redis用docker部署，并注册成系统服务；前端使用nginx映射到对应的dist文件夹内。</p>
<p>​    android+H5：我直接使用的<a href="https://github.com/imchloeo/android-webView-H5">imchloeo/android-webView-H5: 使用安卓 webView 打包 H5 页面/网站，可以像 App 一样安装在安卓手机上 (github.com)</a></p>
<p>这个模板，直接把网址写上就可以生成Android包了。</p>
]]></content>
      <categories>
        <category>计算机</category>
      </categories>
  </entry>
  <entry>
    <title>安装 WSL2</title>
    <url>/2023/04/30/%E8%AE%A1%E7%AE%97%E6%9C%BA/wsl%E5%AE%89%E8%A3%85/</url>
    <content><![CDATA[<h1 id="安装-WSL2"><a href="#安装-WSL2" class="headerlink" title="安装 WSL2"></a>安装 WSL2</h1><h2 id="1-电脑设置"><a href="#1-电脑设置" class="headerlink" title="1. 电脑设置"></a>1. 电脑设置</h2><h3 id="1-1-虚拟化设置"><a href="#1-1-虚拟化设置" class="headerlink" title="1.1 虚拟化设置"></a>1.1 虚拟化设置</h3><p><img src="https://pic3.zhimg.com/80/v2-14dab23bc473ca60891773a86e675be2_1440w.webp" alt="img"></p>
<h3 id="1-2-系统设置"><a href="#1-2-系统设置" class="headerlink" title="1.2 系统设置"></a>1.2 系统设置</h3><p>控制面板-&gt;程序-&gt;启用或关闭 windows 功能，开启 Windows 虚拟化和 Linux 子系统（WSL2)以及Hyper-V</p>
<p>勾选完成后，Windows11 会自己下载些东西，并提示你重启。等电脑彻底重启完以后，进行后续操作</p>
<p>打开Power Shell 以管理员命令输入下方代码：</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">bcdedit /set hypervisorlaunchtype auto</span><br></pre></td></tr></table></figure>
<h2 id="2-系统安装"><a href="#2-系统安装" class="headerlink" title="2. 系统安装"></a>2. 系统安装</h2><p><strong>命令行</strong>和<strong>微软商店</strong>哪个安装方式都可以，二选一即可。</p>
<p>使用PowerShell，以管理员权限启动，输入下方命令执行：</p>
<p>这个就是下载的是Ubuntu的系统镜像（需要访问github）</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">wsl --install -d Ubuntu</span><br></pre></td></tr></table></figure>
<p>如果报WslRegisterDistribution failed with error: 0x800701bc<br>Error: 0x800701bc WSL 2 ?????????????????? <a href="https://aka.ms/wsl2kernel这个错">https://aka.ms/wsl2kernel这个错</a></p>
<p>需要下载<a href="https://wslstorestorage.blob.core.windows.net/wslblob/wsl_update_x64.msi然后安装（更新wsl内核）">https://wslstorestorage.blob.core.windows.net/wslblob/wsl_update_x64.msi然后安装（更新wsl内核）</a></p>
]]></content>
      <categories>
        <category>计算机</category>
      </categories>
  </entry>
  <entry>
    <title>kubeadm安装k8s</title>
    <url>/2023/04/30/%E8%AE%A1%E7%AE%97%E6%9C%BA/%E4%BD%BF%E7%94%A8kubeadm%E6%90%AD%E5%BB%BA%E9%AB%98%E5%8F%AF%E7%94%A8%E7%9A%84K8s%E9%9B%86%E7%BE%A4/</url>
    <content><![CDATA[<p>kubeadm是官方社区推出的一个用于快速部署kubernetes集群的工具。</p>
<p>这个工具能通过两条指令完成一个kubernetes集群的部署：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># 创建一个 Master 节点</span><br><span class="line">$ kubeadm init</span><br><span class="line"></span><br><span class="line"># 将一个 Node 节点加入到当前集群中</span><br><span class="line">$ kubeadm join &lt;Master节点的IP和端口 &gt;</span><br></pre></td></tr></table></figure>
<h2 id="1-安装要求"><a href="#1-安装要求" class="headerlink" title="1. 安装要求"></a>1. 安装要求</h2><p>在开始之前，部署Kubernetes集群机器需要满足以下几个条件：</p>
<ul>
<li>一台或多台机器，操作系统 CentOS7.x-86_x64</li>
<li>硬件配置：2GB或更多RAM，2个CPU或更多CPU，硬盘30GB或更多</li>
<li>可以访问外网，需要拉取镜像，如果服务器不能上网，需要提前下载镜像并导入节点</li>
<li>禁止swap分区</li>
</ul>
<h2 id="2-准备环境"><a href="#2-准备环境" class="headerlink" title="2. 准备环境"></a>2. 准备环境</h2><div class="table-container">
<table>
<thead>
<tr>
<th>角色</th>
<th>IP</th>
</tr>
</thead>
<tbody>
<tr>
<td>master1</td>
<td>192.168.44.155</td>
</tr>
<tr>
<td>master2</td>
<td>192.168.44.156</td>
</tr>
<tr>
<td>node1</td>
<td>192.168.44.157</td>
</tr>
<tr>
<td>VIP（虚拟ip）</td>
<td>192.168.44.158</td>
</tr>
</tbody>
</table>
</div>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># 关闭防火墙</span><br><span class="line">systemctl stop firewalld</span><br><span class="line">systemctl disable firewalld</span><br><span class="line"></span><br><span class="line"># 关闭selinux</span><br><span class="line">sed -i &#x27;s/enforcing/disabled/&#x27; /etc/selinux/config  # 永久</span><br><span class="line">setenforce 0  # 临时</span><br><span class="line"></span><br><span class="line"># 关闭swap</span><br><span class="line">swapoff -a  # 临时</span><br><span class="line">sed -ri &#x27;s/.*swap.*/#&amp;/&#x27; /etc/fstab    # 永久</span><br><span class="line"></span><br><span class="line"># 根据规划设置主机名</span><br><span class="line">hostnamectl set-hostname &lt;hostname&gt;</span><br><span class="line"></span><br><span class="line"># 在master添加hosts</span><br><span class="line">cat &gt;&gt; /etc/hosts &lt;&lt; EOF</span><br><span class="line">192.168.44.158    master.k8s.io   k8s-vip</span><br><span class="line">192.168.44.155    master01.k8s.io master1</span><br><span class="line">192.168.44.156    master02.k8s.io master2</span><br><span class="line">192.168.44.157    node01.k8s.io   node1</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"># 将桥接的IPv4流量传递到iptables的链</span><br><span class="line">cat &gt; /etc/sysctl.d/k8s.conf &lt;&lt; EOF</span><br><span class="line">net.bridge.bridge-nf-call-ip6tables = 1</span><br><span class="line">net.bridge.bridge-nf-call-iptables = 1</span><br><span class="line">EOF</span><br><span class="line">sysctl --system  # 生效</span><br><span class="line"></span><br><span class="line"># 时间同步</span><br><span class="line">yum install ntpdate -y</span><br><span class="line">ntpdate time.windows.com</span><br></pre></td></tr></table></figure>
<h2 id="3-所有master节点部署keepalived"><a href="#3-所有master节点部署keepalived" class="headerlink" title="3. 所有master节点部署keepalived"></a>3. 所有master节点部署keepalived</h2><h3 id="3-1-安装相关包和keepalived"><a href="#3-1-安装相关包和keepalived" class="headerlink" title="3.1 安装相关包和keepalived"></a>3.1 安装相关包和keepalived</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">yum install -y conntrack-tools libseccomp libtool-ltdl</span><br><span class="line"></span><br><span class="line">yum install -y keepalived</span><br></pre></td></tr></table></figure>
<h3 id="3-2配置master节点"><a href="#3-2配置master节点" class="headerlink" title="3.2配置master节点"></a>3.2配置master节点</h3><p>master1节点配置</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">cat &gt; /etc/keepalived/keepalived.conf &lt;&lt;EOF </span><br><span class="line">! Configuration File for keepalived</span><br><span class="line"></span><br><span class="line">global_defs &#123;</span><br><span class="line">   router_id k8s</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">vrrp_script check_haproxy &#123;</span><br><span class="line">    script &quot;killall -0 haproxy&quot;</span><br><span class="line">    interval 3</span><br><span class="line">    weight -2</span><br><span class="line">    fall 10</span><br><span class="line">    rise 2</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">vrrp_instance VI_1 &#123;</span><br><span class="line">    state MASTER </span><br><span class="line">    interface ens33 </span><br><span class="line">    virtual_router_id 51</span><br><span class="line">    priority 250</span><br><span class="line">    advert_int 1</span><br><span class="line">    authentication &#123;</span><br><span class="line">        auth_type PASS</span><br><span class="line">        auth_pass ceb1b3ec013d66163d6ab</span><br><span class="line">    &#125;</span><br><span class="line">    virtual_ipaddress &#123;</span><br><span class="line">        192.168.44.158</span><br><span class="line">    &#125;</span><br><span class="line">    track_script &#123;</span><br><span class="line">        check_haproxy</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>
<p>master2节点配置</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">cat &gt; /etc/keepalived/keepalived.conf &lt;&lt;EOF </span><br><span class="line">! Configuration File for keepalived</span><br><span class="line"></span><br><span class="line">global_defs &#123;</span><br><span class="line">   router_id k8s</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">vrrp_script check_haproxy &#123;</span><br><span class="line">    script &quot;killall -0 haproxy&quot;</span><br><span class="line">    interval 3</span><br><span class="line">    weight -2</span><br><span class="line">    fall 10</span><br><span class="line">    rise 2</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">vrrp_instance VI_1 &#123;</span><br><span class="line">    state BACKUP </span><br><span class="line">    interface ens33 </span><br><span class="line">    virtual_router_id 51</span><br><span class="line">    priority 200</span><br><span class="line">    advert_int 1</span><br><span class="line">    authentication &#123;</span><br><span class="line">        auth_type PASS</span><br><span class="line">        auth_pass ceb1b3ec013d66163d6ab</span><br><span class="line">    &#125;</span><br><span class="line">    virtual_ipaddress &#123;</span><br><span class="line">        192.168.44.158</span><br><span class="line">    &#125;</span><br><span class="line">    track_script &#123;</span><br><span class="line">        check_haproxy</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>
<h3 id="3-3-启动和检查"><a href="#3-3-启动和检查" class="headerlink" title="3.3 启动和检查"></a>3.3 启动和检查</h3><p>在两台master节点都执行</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># 启动keepalived</span><br><span class="line">$ systemctl start keepalived.service</span><br><span class="line">设置开机启动</span><br><span class="line">$ systemctl enable keepalived.service</span><br><span class="line"># 查看启动状态</span><br><span class="line">$ systemctl status keepalived.service</span><br></pre></td></tr></table></figure>
<p>启动后查看master1的网卡信息</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ip a s ens33</span><br></pre></td></tr></table></figure>
<h2 id="4-部署haproxy"><a href="#4-部署haproxy" class="headerlink" title="4. 部署haproxy"></a>4. 部署haproxy</h2><h3 id="4-1-安装"><a href="#4-1-安装" class="headerlink" title="4.1 安装"></a>4.1 安装</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">yum install -y haproxy</span><br></pre></td></tr></table></figure>
<h3 id="4-2-配置"><a href="#4-2-配置" class="headerlink" title="4.2 配置"></a>4.2 配置</h3><p>两台master节点的配置均相同，配置中声明了后端代理的两个master节点服务器，指定了haproxy运行的端口为16443等，因此16443端口为集群的入口</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">cat &gt; /etc/haproxy/haproxy.cfg &lt;&lt; EOF</span><br><span class="line">#---------------------------------------------------------------------</span><br><span class="line"># Global settings</span><br><span class="line">#---------------------------------------------------------------------</span><br><span class="line">global</span><br><span class="line">    # to have these messages end up in /var/log/haproxy.log you will</span><br><span class="line">    # need to:</span><br><span class="line">    # 1) configure syslog to accept network log events.  This is done</span><br><span class="line">    #    by adding the &#x27;-r&#x27; option to the SYSLOGD_OPTIONS in</span><br><span class="line">    #    /etc/sysconfig/syslog</span><br><span class="line">    # 2) configure local2 events to go to the /var/log/haproxy.log</span><br><span class="line">    #   file. A line like the following can be added to</span><br><span class="line">    #   /etc/sysconfig/syslog</span><br><span class="line">    #</span><br><span class="line">    #    local2.*                       /var/log/haproxy.log</span><br><span class="line">    #</span><br><span class="line">    log         127.0.0.1 local2</span><br><span class="line">    </span><br><span class="line">    chroot      /var/lib/haproxy</span><br><span class="line">    pidfile     /var/run/haproxy.pid</span><br><span class="line">    maxconn     4000</span><br><span class="line">    user        haproxy</span><br><span class="line">    group       haproxy</span><br><span class="line">    daemon </span><br><span class="line">       </span><br><span class="line">    # turn on stats unix socket</span><br><span class="line">    stats socket /var/lib/haproxy/stats</span><br><span class="line">#---------------------------------------------------------------------</span><br><span class="line"># common defaults that all the &#x27;listen&#x27; and &#x27;backend&#x27; sections will</span><br><span class="line"># use if not designated in their block</span><br><span class="line">#---------------------------------------------------------------------  </span><br><span class="line">defaults</span><br><span class="line">    mode                    http</span><br><span class="line">    log                     global</span><br><span class="line">    option                  httplog</span><br><span class="line">    option                  dontlognull</span><br><span class="line">    option http-server-close</span><br><span class="line">    option forwardfor       except 127.0.0.0/8</span><br><span class="line">    option                  redispatch</span><br><span class="line">    retries                 3</span><br><span class="line">    timeout http-request    10s</span><br><span class="line">    timeout queue           1m</span><br><span class="line">    timeout connect         10s</span><br><span class="line">    timeout client          1m</span><br><span class="line">    timeout server          1m</span><br><span class="line">    timeout http-keep-alive 10s</span><br><span class="line">    timeout check           10s</span><br><span class="line">    maxconn                 3000</span><br><span class="line">#---------------------------------------------------------------------</span><br><span class="line"># kubernetes apiserver frontend which proxys to the backends</span><br><span class="line">#--------------------------------------------------------------------- </span><br><span class="line">frontend kubernetes-apiserver</span><br><span class="line">    mode                 tcp</span><br><span class="line">    bind                 *:16443</span><br><span class="line">    option               tcplog</span><br><span class="line">    default_backend      kubernetes-apiserver    </span><br><span class="line">#---------------------------------------------------------------------</span><br><span class="line"># round robin balancing between the various backends</span><br><span class="line">#---------------------------------------------------------------------</span><br><span class="line">backend kubernetes-apiserver</span><br><span class="line">    mode        tcp</span><br><span class="line">    balance     roundrobin</span><br><span class="line">    server      master01.k8s.io   192.168.44.155:6443 check</span><br><span class="line">    server      master02.k8s.io   192.168.44.156:6443 check</span><br><span class="line">#---------------------------------------------------------------------</span><br><span class="line"># collection haproxy statistics message</span><br><span class="line">#---------------------------------------------------------------------</span><br><span class="line">listen stats</span><br><span class="line">    bind                 *:1080</span><br><span class="line">    stats auth           admin:awesomePassword</span><br><span class="line">    stats refresh        5s</span><br><span class="line">    stats realm          HAProxy\ Statistics</span><br><span class="line">    stats uri            /admin?stats</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>
<h3 id="4-3-启动和检查"><a href="#4-3-启动和检查" class="headerlink" title="4.3 启动和检查"></a>4.3 启动和检查</h3><p>两台master都启动</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># 设置开机启动</span><br><span class="line">$ systemctl enable haproxy</span><br><span class="line"># 开启haproxy</span><br><span class="line">$ systemctl start haproxy</span><br><span class="line"># 查看启动状态</span><br><span class="line">$ systemctl status haproxy</span><br></pre></td></tr></table></figure>
<p>检查端口</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">netstat -lntup|grep haproxy</span><br></pre></td></tr></table></figure>
<h2 id="5-所有节点安装Docker-kubeadm-kubelet"><a href="#5-所有节点安装Docker-kubeadm-kubelet" class="headerlink" title="5. 所有节点安装Docker/kubeadm/kubelet"></a>5. 所有节点安装Docker/kubeadm/kubelet</h2><p>Kubernetes默认CRI（容器运行时）为Docker，因此先安装Docker。</p>
<h3 id="5-1-安装Docker"><a href="#5-1-安装Docker" class="headerlink" title="5.1 安装Docker"></a>5.1 安装Docker</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$ wget https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo -O /etc/yum.repos.d/docker-ce.repo</span><br><span class="line">$ yum -y install docker-ce-18.06.1.ce-3.el7</span><br><span class="line">$ systemctl enable docker &amp;&amp; systemctl start docker</span><br><span class="line">$ docker --version</span><br><span class="line">Docker version 18.06.1-ce, build e68fc7a</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$ cat &gt; /etc/docker/daemon.json &lt;&lt; EOF</span><br><span class="line">&#123;</span><br><span class="line">  &quot;registry-mirrors&quot;: [&quot;https://b9pmyelo.mirror.aliyuncs.com&quot;]</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>
<h3 id="5-2-添加阿里云YUM软件源"><a href="#5-2-添加阿里云YUM软件源" class="headerlink" title="5.2 添加阿里云YUM软件源"></a>5.2 添加阿里云YUM软件源</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$ cat &gt; /etc/yum.repos.d/kubernetes.repo &lt;&lt; EOF</span><br><span class="line">[kubernetes]</span><br><span class="line">name=Kubernetes</span><br><span class="line">baseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64</span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=0</span><br><span class="line">repo_gpgcheck=0</span><br><span class="line">gpgkey=https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg https://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>
<h3 id="5-3-安装kubeadm，kubelet和kubectl"><a href="#5-3-安装kubeadm，kubelet和kubectl" class="headerlink" title="5.3 安装kubeadm，kubelet和kubectl"></a>5.3 安装kubeadm，kubelet和kubectl</h3><p>由于版本更新频繁，这里指定版本号部署：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$ yum install -y kubelet-1.16.3 kubeadm-1.16.3 kubectl-1.16.3</span><br><span class="line">$ systemctl enable kubelet</span><br></pre></td></tr></table></figure>
<h2 id="6-部署Kubernetes-Master"><a href="#6-部署Kubernetes-Master" class="headerlink" title="6. 部署Kubernetes Master"></a>6. 部署Kubernetes Master</h2><h3 id="6-1-创建kubeadm配置文件"><a href="#6-1-创建kubeadm配置文件" class="headerlink" title="6.1 创建kubeadm配置文件"></a>6.1 创建kubeadm配置文件</h3><p>在具有vip的master上操作，这里为master1</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$ mkdir /usr/local/kubernetes/manifests -p</span><br><span class="line"></span><br><span class="line">$ cd /usr/local/kubernetes/manifests/</span><br><span class="line"></span><br><span class="line">$ vi kubeadm-config.yaml</span><br><span class="line"></span><br><span class="line">apiServer:</span><br><span class="line">  certSANs:</span><br><span class="line">    - master1</span><br><span class="line">    - master2</span><br><span class="line">    - master.k8s.io</span><br><span class="line">    - 192.168.44.158</span><br><span class="line">    - 192.168.44.155</span><br><span class="line">    - 192.168.44.156</span><br><span class="line">    - 127.0.0.1</span><br><span class="line">  extraArgs:</span><br><span class="line">    authorization-mode: Node,RBAC</span><br><span class="line">  timeoutForControlPlane: 4m0s</span><br><span class="line">apiVersion: kubeadm.k8s.io/v1beta1</span><br><span class="line">certificatesDir: /etc/kubernetes/pki</span><br><span class="line">clusterName: kubernetes</span><br><span class="line">controlPlaneEndpoint: &quot;master.k8s.io:16443&quot;</span><br><span class="line">controllerManager: &#123;&#125;</span><br><span class="line">dns: </span><br><span class="line">  type: CoreDNS</span><br><span class="line">etcd:</span><br><span class="line">  local:    </span><br><span class="line">    dataDir: /var/lib/etcd</span><br><span class="line">imageRepository: registry.aliyuncs.com/google_containers</span><br><span class="line">kind: ClusterConfiguration</span><br><span class="line">kubernetesVersion: v1.16.3</span><br><span class="line">networking: </span><br><span class="line">  dnsDomain: cluster.local  </span><br><span class="line">  podSubnet: 10.244.0.0/16</span><br><span class="line">  serviceSubnet: 10.1.0.0/16</span><br><span class="line">scheduler: &#123;&#125;</span><br></pre></td></tr></table></figure>
<h3 id="6-2-在master1节点执行"><a href="#6-2-在master1节点执行" class="headerlink" title="6.2 在master1节点执行"></a>6.2 在master1节点执行</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$ kubeadm init --config kubeadm-config.yaml</span><br></pre></td></tr></table></figure>
<p>按照提示配置环境变量，使用kubectl工具：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> -p <span class="variable">$HOME</span>/.kube</span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">cp</span> -i /etc/kubernetes/admin.conf <span class="variable">$HOME</span>/.kube/config</span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">chown</span> $(<span class="built_in">id</span> -u):$(<span class="built_in">id</span> -g) <span class="variable">$HOME</span>/.kube/config</span><br><span class="line">$ kubectl get nodes</span><br><span class="line">$ kubectl get pods -n kube-system</span><br></pre></td></tr></table></figure>
<p><strong>按照提示保存以下内容，一会要使用：</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">kubeadm <span class="built_in">join</span> master.k8s.io:16443 --token jv5z7n.3y1zi95p952y9p65 \</span><br><span class="line">    --discovery-token-ca-cert-hash sha256:403bca185c2f3a4791685013499e7ce58f9848e2213e27194b75a2e3293d8812 \</span><br><span class="line">    --control-plane </span><br></pre></td></tr></table></figure>
<p>查看集群状态</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">kubectl get cs</span><br><span class="line"></span><br><span class="line">kubectl get pods -n kube-system</span><br></pre></td></tr></table></figure>
<h2 id="7-安装集群网络"><a href="#7-安装集群网络" class="headerlink" title="7.安装集群网络"></a>7.安装集群网络</h2><p>从官方地址获取到flannel的yaml，在master1上执行</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> flannel</span><br><span class="line"><span class="built_in">cd</span> flannel</span><br><span class="line">wget -c https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml</span><br></pre></td></tr></table></figure>
<p>安装flannel网络</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">kubectl apply -f kube-flannel.yml </span><br></pre></td></tr></table></figure>
<p>检查</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">kubectl get pods -n kube-system</span><br></pre></td></tr></table></figure>
<h2 id="8、master2节点加入集群"><a href="#8、master2节点加入集群" class="headerlink" title="8、master2节点加入集群"></a>8、master2节点加入集群</h2><h3 id="8-1-复制密钥及相关文件"><a href="#8-1-复制密钥及相关文件" class="headerlink" title="8.1 复制密钥及相关文件"></a>8.1 复制密钥及相关文件</h3><p>从master1复制密钥及相关文件到master2</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ssh root@192.168.44.156 mkdir -p /etc/kubernetes/pki/etcd</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># scp /etc/kubernetes/admin.conf root@192.168.44.156:/etc/kubernetes</span></span><br><span class="line">   </span><br><span class="line"><span class="comment"># scp /etc/kubernetes/pki/&#123;ca.*,sa.*,front-proxy-ca.*&#125; root@192.168.44.156:/etc/kubernetes/pki</span></span><br><span class="line">   </span><br><span class="line"><span class="comment"># scp /etc/kubernetes/pki/etcd/ca.* root@192.168.44.156:/etc/kubernetes/pki/etcd</span></span><br></pre></td></tr></table></figure>
<h3 id="8-2-master2加入集群"><a href="#8-2-master2加入集群" class="headerlink" title="8.2 master2加入集群"></a>8.2 master2加入集群</h3><p>执行在master1上init后输出的join命令,需要带上参数<code>--control-plane</code>表示把master控制节点加入集群</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">kubeadm join master.k8s.io:16443 --token ckf7bs.30576l0okocepg8b     --discovery-token-ca-cert-hash sha256:19afac8b11182f61073e254fb57b9f19ab4d798b70501036fc69ebef46094aba --control-plane</span><br></pre></td></tr></table></figure>
<p>检查状态</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">kubectl get node</span><br><span class="line"></span><br><span class="line">kubectl get pods --all-namespaces</span><br></pre></td></tr></table></figure>
<h2 id=""><a href="#" class="headerlink" title=" "></a> </h2><h2 id="5-加入Kubernetes-Node"><a href="#5-加入Kubernetes-Node" class="headerlink" title="5. 加入Kubernetes Node"></a>5. 加入Kubernetes Node</h2><p>在node1上执行</p>
<p>向集群添加新节点，执行在kubeadm init输出的kubeadm join命令：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">kubeadm join master.k8s.io:16443 --token ckf7bs.30576l0okocepg8b     --discovery-token-ca-cert-hash sha256:19afac8b11182f61073e254fb57b9f19ab4d798b70501036fc69ebef46094aba</span><br></pre></td></tr></table></figure>
<p><strong>集群网络重新安装，因为添加了新的node节点</strong></p>
<p>检查状态</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">kubectl get node</span><br><span class="line"></span><br><span class="line">kubectl get pods --all-namespaces</span><br></pre></td></tr></table></figure>
<h2 id="-1"><a href="#-1" class="headerlink" title=" "></a> </h2><h2 id="7-测试kubernetes集群"><a href="#7-测试kubernetes集群" class="headerlink" title="7. 测试kubernetes集群"></a>7. 测试kubernetes集群</h2><p>在Kubernetes集群中创建一个pod，验证是否正常运行：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$ kubectl create deployment nginx --image=nginx</span><br><span class="line">$ kubectl expose deployment nginx --port=80 --type=NodePort</span><br><span class="line">$ kubectl get pod,svc</span><br></pre></td></tr></table></figure>
<p>访问地址：<a href="http://NodeIP:Port">http://NodeIP:Port</a>  </p>
]]></content>
      <categories>
        <category>计算机</category>
      </categories>
  </entry>
  <entry>
    <title>内网higress配置wasm插件流程</title>
    <url>/2025/11/21/%E8%AE%A1%E7%AE%97%E6%9C%BA/%E5%86%85%E7%BD%91higress%E9%85%8D%E7%BD%AEwasm%E6%8F%92%E4%BB%B6%E6%B5%81%E7%A8%8B/</url>
    <content><![CDATA[<h1 id="内网higress配置wasm插件流程"><a href="#内网higress配置wasm插件流程" class="headerlink" title="内网higress配置wasm插件流程"></a>内网higress配置wasm插件流程</h1><p>​    内网环境higress里面的插件用不了，因为插件的镜像是外网的oci://higress-registry.cn-hangzhou.cr.aliyuncs.com/mcp-server/all-in-one:2.0.0</p>
<p>​    但是这个是一个符合 OCI 标准的 Wasm 插件镜像，需要从 OCI 兼容的镜像仓库（如 Docker Hub、Harbor、ACR 等）拉取这个 Wasm 模块。不是所有 Harbor 版本默认启用 OCI Artifact 支持（Wasm 是一种 OCI Artifact，不是普通容器镜像）。<br>​    请确保：<br>Harbor ≥ v2.2.0（推荐 v2.6+）<br>在 Harbor 项目设置中 启用 “支持 Helm Chart、Wasm 等 OCI Artifacts”（通常叫 “Enable OCI Artifacts” 或类似选项）<br>推送 Wasm 时使用 oras 或支持 OCI Artifacts 的工具（不能用 docker push）</p>
<h2 id="使用Harbor-≥-v2-2-0版本推送对应的wasm插件"><a href="#使用Harbor-≥-v2-2-0版本推送对应的wasm插件" class="headerlink" title="使用Harbor ≥ v2.2.0版本推送对应的wasm插件"></a>使用Harbor ≥ v2.2.0版本推送对应的wasm插件</h2><p>日志中的错误：</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">error   wasm    convert the wasm config: 1 error occurred:</span><br><span class="line">        * cannot fetch Wasm module oci://higress-registry.cn-hangzhou.cr.aliyuncs.com/mcp-server/all-in-one:2.0.0: </span><br><span class="line">          could not fetch Wasm OCI image: </span><br><span class="line">          could not fetch manifest: Get &quot;https://higress-registry.cn-hangzhou.cr.aliyuncs.com/v2/&quot;: </span><br><span class="line">          dial tcp 121.40.213.69:443: connect: connection refused</span><br></pre></td></tr></table></figure>
<p>说明：</p>
<ul>
<li>Higress Gateway Pod <strong>无法访问公网</strong>（或私有镜像仓库）。</li>
<li>目标地址 <code>higress-registry.cn-hangzhou.cr.aliyuncs.com</code> 是阿里云容器镜像服务（ACR），但你的集群节点或 Pod <strong>没有网络权限访问该地址</strong>（可能是防火墙、代理、VPC 隔离等原因）。</li>
<li>连接被 <strong><code>connection refused</code></strong>，说明连 TCP 三次握手都失败了，很可能是 <strong>出向网络被阻断</strong>。</li>
</ul>
<hr>
<p>解决方案</p>
<ol>
<li><p><strong>在能访问公网的机器上拉取镜像：</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">crane pull oci://higress-registry.cn-hangzhou.cr.aliyuncs.com/mcp-server/all-in-one:2.0.0 all-in-one-2.0.0.wasm</span><br></pre></td></tr></table></figure>
<p>或使用 <code>oras</code>：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">oras pull higress-registry.cn-hangzhou.cr.aliyuncs.com/mcp-server/all-in-one:2.0.0</span><br></pre></td></tr></table></figure>
</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">   </span><br><span class="line">2. **将 `.wasm` 文件推送到你们内部的镜像仓库（如 Harbor、自建 ACR 等）：**</span><br><span class="line">   ```bash</span><br><span class="line">   oras push your-internal-registry.local/mcp-server/all-in-one:2.0.0 \</span><br><span class="line">       --manifest-config /dev/null:application/vnd.unknown.config.v1+json \</span><br><span class="line">       all-in-one-2.0.0.wasm:application/vnd.wasm.content.layer.v1+wasm</span><br></pre></td></tr></table></figure>
<ol>
<li><p><strong>修改 Higress 插件配置，将 <code>image</code> 字段指向内网地址：</strong></p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">settings:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">oci://your-internal-registry.local/mcp-server/all-in-one:2.0.0</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<blockquote>
<p>✅ 这样 Gateway 就无需访问外网，直接从内网拉取，避免网络问题。</p>
</blockquote>
<h3 id="证书问题"><a href="#证书问题" class="headerlink" title="证书问题"></a>证书问题</h3><p>错误如下</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">* cannot fetch Wasm module oci://harbor01.xjky.com/mcp-server/all-in-one:2.0.0: could not fetch Wasm OCI image: could not fetch manifest: Get <span class="string">&quot;https://harbor01.xjky.com/v2/&quot;</span>: tls: failed to verify certificate: x509: certificate signed by unknown authority</span><br></pre></td></tr></table></figure>
<p>这个错误表明 <strong>Higress Gateway Pod 不信任你的 Harbor 服务器证书</strong>。因为你的 Harbor (<code>harbor01.xjky.com</code>) 使用的是<strong>自签名证书或内部 CA 签发的证书</strong>，而 Pod 的容器内没有信任该 CA。</p>
<p>修改 <code>higress-config</code> ConfigMap，添加 Wasm 拉取的不安全选项：</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">kubectl edit cm -n higress-system higress-config</span><br></pre></td></tr></table></figure>
<p>在 <code>mesh</code> 配置段添加：</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">mesh:</span> <span class="string">|-</span></span><br><span class="line"><span class="string">  defaultConfig:</span></span><br><span class="line"><span class="string"></span><span class="string">​</span>    <span class="string">proxyMeta</span></span><br><span class="line"><span class="string">​</span>      <span class="attr">WASM_INSECURE_SKIP_VERIFY:</span> <span class="string">&quot;true&quot;</span></span><br><span class="line"><span class="string">​</span>      <span class="attr">WASM_INSECURE_SKIP_HOSTNAME_VERIFY:</span> <span class="string">&quot;true&quot;</span></span><br></pre></td></tr></table></figure>
<p>然后重启：</p>
<p>kubectl rollout restart deploy/higress-gateway -n higress-system</p>
<h2 id="其他问题"><a href="#其他问题" class="headerlink" title="其他问题"></a>其他问题</h2><h3 id="禁用不需要的插件"><a href="#禁用不需要的插件" class="headerlink" title="禁用不需要的插件"></a><strong>禁用不需要的插件</strong></h3><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 查看现有的 WasmPlugin</span></span><br><span class="line">kubectl get wasmplugin -A</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除或禁用 key-auth 插件</span></span><br><span class="line">kubectl delete wasmplugin -n higress-system key-auth  <span class="comment"># 或者你的插件名称</span></span><br></pre></td></tr></table></figure>
<h3 id="重启所有组件"><a href="#重启所有组件" class="headerlink" title="重启所有组件"></a><strong>重启所有组件</strong></h3><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 重启 controller 使 ConfigMap 生效</span></span><br><span class="line">kubectl rollout restart deploy/higress-controller -n higress-system</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重启 gateway</span></span><br><span class="line">kubectl rollout restart deploy/higress-gateway -n higress-system</span><br></pre></td></tr></table></figure>
<h2 id="Higress-的主要日志组件"><a href="#Higress-的主要日志组件" class="headerlink" title="Higress 的主要日志组件"></a>Higress 的主要日志组件</h2><ol>
<li><strong>higress-controller</strong><ul>
<li>负责监听 Kubernetes 的 Ingress、Gateway API 等资源变更，并生成配置。</li>
<li>日志内容：配置同步、事件处理、控制器内部状态等。</li>
</ul>
</li>
<li><strong>higress-gateway</strong><ul>
<li>基于 Envoy 的数据面网关，处理实际的 HTTP/HTTPS 流量。</li>
<li>日志内容：访问日志（access log）、错误日志、Wasm 插件日志、Envoy 内部日志等。</li>
</ul>
</li>
<li><strong>Wasm 插件日志（可选）</strong><ul>
<li>如果你启用了自定义或官方 Wasm 插件，插件内部通过 <code>wrapper.Log</code> 打印的日志也会输出到标准输出中 。</li>
</ul>
</li>
</ol>
<h3 id="如何查看日志"><a href="#如何查看日志" class="headerlink" title="如何查看日志"></a>如何查看日志</h3><p>Higress 所有组件的日志默认都输出到 <strong>容器的标准输出（stdout/stderr）</strong>，因此你可以使用 <code>kubectl logs</code> 查看：</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 查看 controller 日志</span></span><br><span class="line">kubectl logs -n higress-system &lt;higress-controller-pod-name&gt;</span><br><span class="line"><span class="comment"># 查看 gateway 日志（可能有多个副本）</span></span><br><span class="line">kubectl logs -n higress-system &lt;higress-gateway-pod-name&gt;</span><br><span class="line">如果你不确定 Pod 名称，可以先列出：</span><br><span class="line">kubectl get pods -n higress-system</span><br><span class="line">例如：</span><br><span class="line">kubectl logs -n higress-system higress-gateway-5cb7f44768-snfbd</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>计算机</category>
      </categories>
  </entry>
  <entry>
    <title>安装node_exporter和process_exporter文档</title>
    <url>/2023/04/30/%E8%AE%A1%E7%AE%97%E6%9C%BA/%E5%AE%89%E8%A3%85node_exporter%E5%92%8Cprocess_exporter%E6%96%87%E6%A1%A3/</url>
    <content><![CDATA[<h2 id="安装node-exporter和process-exporter文档"><a href="#安装node-exporter和process-exporter文档" class="headerlink" title="安装node_exporter和process_exporter文档"></a>安装node_exporter和process_exporter文档</h2><h2 id="1-docker部署node-exporter和process-exporter"><a href="#1-docker部署node-exporter和process-exporter" class="headerlink" title="1.docker部署node_exporter和process_exporter"></a>1.docker部署node_exporter和process_exporter</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment">#登录harbor</span></span><br><span class="line">docker login -u admin -p Harbor12345 172.31.10.118</span><br><span class="line"></span><br><span class="line"><span class="comment"># 启动node-exporter</span></span><br><span class="line">docker run -d --name node-exporter --restart=always -p 9100:9100 -v <span class="string">&quot;/proc:/host/proc:ro&quot;</span> -v <span class="string">&quot;/sys:/host/sys:ro&quot;</span> -v <span class="string">&quot;/:/rootfs:ro&quot;</span> 172.31.10.118/monitor/node-exporter:v0.18.1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 启动process-exporter</span></span><br><span class="line">docker run --restart=always -tid -p 9256:9256 --privileged -v /proc:/host/proc -v `<span class="built_in">pwd</span>`:/config --name process-exporter 172.31.10.118/monitor/process-exporter:0.7.1 --procfs /host/proc -config.path /config/process-name.yaml</span><br><span class="line"></span><br><span class="line">vi process.yml</span><br><span class="line"></span><br><span class="line">process_names:</span><br><span class="line">  - name: <span class="string">&quot;&#123;&#123;.Matches&#125;&#125;&quot;</span></span><br><span class="line">    cmdline:</span><br><span class="line">    - <span class="string">&#x27;mysqld&#x27;</span></span><br><span class="line"></span><br><span class="line">process_names:</span><br><span class="line">  - name: <span class="string">&quot;&#123;&#123;.Matches&#125;&#125;&quot;</span></span><br><span class="line">    cmdline:</span><br><span class="line">    - <span class="string">&#x27;nginx&#x27;</span></span><br><span class="line"></span><br><span class="line">  - name: <span class="string">&quot;&#123;&#123;.Matches&#125;&#125;&quot;</span></span><br><span class="line">    cmdline:</span><br><span class="line">    - <span class="string">&#x27;keepalived&#x27;</span></span><br></pre></td></tr></table></figure>
<h2 id="2-prometheus添加对应配置"><a href="#2-prometheus添加对应配置" class="headerlink" title="2.prometheus添加对应配置"></a>2.prometheus添加对应配置</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">kubectl edit cm -n monitoring monitor-prometheus-server</span><br><span class="line"><span class="comment">#热部署Prometheus</span></span><br><span class="line">curl -X POST http://172.31.10.113:41000/-/reload</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>计算机</category>
      </categories>
  </entry>
  <entry>
    <title>新k8s的higress使用</title>
    <url>/2025/11/19/%E8%AE%A1%E7%AE%97%E6%9C%BA/%E6%96%B0k8s%E7%9A%84higress%E4%BD%BF%E7%94%A8/</url>
    <content><![CDATA[<h1 id="新k8s的higress使用"><a href="#新k8s的higress使用" class="headerlink" title="新k8s的higress使用"></a>新k8s的higress使用</h1><p>Higress 是一个三合一的云原生 API 网关：</p>
<ul>
<li><strong>流量网关</strong>：负责南北向流量调度、负载均衡、协议转换（如 HTTP/gRPC/WebSocket）、SSL/TLS 终止、动静分离等，可完全替代 Nginx / Nginx Ingress。</li>
<li><strong>微服务网关</strong>：深度集成服务发现（支持 Nacos、Consul、Kubernetes Services 等），提供限流、熔断、重试、超时控制、蓝绿发布、灰度发布（基于 Header、Cookie、权重等多维度规则）等服务治理能力，可替代 Spring Cloud Gateway。</li>
<li><strong>安全网关</strong>：内置 Web 应用防火墙（WAF），基于 ModSecurity + OWASP CRS 规则集，防御 SQL 注入、XSS、命令注入等常见攻击；同时支持 <strong>JWT、OAuth2、Key Auth、OIDC</strong> 等统一鉴权机制，实现认证与授权前置化。</li>
<li><strong>插件扩展体系</strong>：支持 Go、WASM、Java 等多语言插件，便于定制路由、鉴权、日志、监控等业务逻辑。</li>
<li><strong>云原生友好</strong>：原生支持 Kubernetes Ingress / Gateway API，兼容 Nginx Ingress 注解，支持配置热更新、多租户、可观测性（Metrics / Logging / Tracing）集成。</li>
</ul>
<p>换句话说，Higress 是一个集 <strong>流量调度 + 服务治理 + 安全防护 + 统一鉴权 + 发布策略控制</strong> 于一体的现代化 API 网关。<br>在典型的微服务架构中，它可以<strong>一站式替代 Nginx（流量入口） + Spring Cloud Gateway（微服务路由） + WAF（Web 安全防护）</strong>，显著简化架构、降低运维复杂度，并提升性能与安全性。后续可逐步将原有 Nginx 与 Spring Cloud Gateway 组件下线，由 Higress 统一承载南北向流量。</p>
<p>关于蓝绿发布与灰度发布（重点补充）</p>
<p>✅ <strong>Higress 完整支持蓝绿发布与灰度发布</strong>，具体能力包括：</p>
<ul>
<li><strong>基于权重的流量切分</strong>：例如将 90% 流量路由到 v1，10% 到 v2。</li>
<li><strong>基于请求特征的灰度</strong>：根据 Header（如 <code>x-user-id</code>）、Cookie、Query 参数、IP 等条件，将特定用户或请求路由到新版本。</li>
<li><strong>服务版本管理</strong>：配合 Kubernetes 的 Service 和 Label，实现版本化路由。</li>
<li><strong>无缝回滚</strong>：通过动态配置更新，秒级切换流量比例或关闭灰度。</li>
</ul>
<p>这些能力通过 Higress 的 <strong>路由规则（Route）和虚拟服务（VirtualService）CRD</strong> 进行声明式配置，无需修改应用代码。</p>
<p>✅ 支持 <strong>API 转 MCP</strong>（Model Context Protocol）</p>
<p>Higress 内置 <strong>MCP Server 插件</strong>，能够<strong>无需编写代码</strong>，将企业已有的 HTTP/REST API 或数据库服务快速转换为 <strong>AI 助手可调用的 MCP 工具</strong>，无缝接入如 Dify、阿里百炼、字节 Coze 等 AI Agent 平台 。</p>
<p>核心能力包括：</p>
<ul>
<li><strong>零代码转换</strong>：只需配置路由和后端服务信息（如 API 地址、认证方式），Higress 自动将 OpenAPI（OAS 3.0）描述转换为 MCP 协议接口 。</li>
<li><strong>多协议兼容</strong>：支持 MCP 的多个迭代版本（如 <code>20241105</code>、<code>20250326</code>），可在同一网关同时处理新旧 MCP 协议请求 。</li>
<li><strong>统一治理</strong>：转换后的 MCP 服务<strong>自动继承 Higress 的鉴权</strong>（JWT/OAuth2）。</li>
<li><strong>生态集成</strong>：已落地于金融、地图、电商等多个场景，例如将高德地图地理编码 API、今日投资金融数据 API 转为 MCP 工具，供 AI 自动调用 。</li>
<li><strong>私有 MCP 市场</strong>：企业可基于 Higress 构建内部 MCP 工具市场，集中管理所有 AI 可调用的服务 。</li>
</ul>
<blockquote>
<p>💡 <strong>典型场景</strong>：<br>一个内部用户查询接口 <code>/api/users/&#123;id&#125;</code>，原本只能被前端或移动端调用。通过 Higress MCP 能力，AI 助手在对话中即可自动识别“查询用户信息”意图，并直接调用该接口获取结构化数据，无需额外开发适配层。 </p>
</blockquote>
<p>测试环境higress地址：</p>
<p>控制台：<a href="http://172.31.70.156:8001/">http://172.31.70.156:8001/</a></p>
<p>网关入口：<a href="http://172.31.70.156:8080/">Welcome to Higress!</a>和<a href="https://172.31.70.156:8443/">Welcome to Higre</a></p>
<p>生产环境higress地址：</p>
<p>控制台：<a href="http://172.31.10.44:32561/">http://172.31.10.44:32561/</a></p>
<p>网关入口：<a href="http://172.31.10.41:32013/和https://172.31.10.41:32518/">http://172.31.10.41:32013/和https://172.31.10.41:32518/</a></p>
<p>用户名admin密码Bzzc@934#</p>
<h2 id="1-添加服务来源"><a href="#1-添加服务来源" class="headerlink" title="1.添加服务来源"></a>1.添加服务来源</h2><p><img src="C:\Users\Developer\AppData\Roaming\Typora\typora-user-images\image-20251113111128448.png" alt="image-20251113111128448"></p>
<h2 id="2-查看服务列表"><a href="#2-查看服务列表" class="headerlink" title="2.查看服务列表"></a>2.查看服务列表</h2><p><img src="C:\Users\Developer\AppData\Roaming\Typora\typora-user-images\image-20251113111209485.png" alt="image-20251113111209485"></p>
<p>注意，从注册中心拉到的服务ip是k8s集群内部的ip，如果higress是单独部署的，或者是跨集群的，是访问不到的，需要单独开nodeport或者load balancer的网络然后使用固定地址访问而不是注册中心。</p>
<h2 id="3-创建路由"><a href="#3-创建路由" class="headerlink" title="3.创建路由"></a>3.创建路由</h2><p><img src="C:\Users\Developer\AppData\Roaming\Typora\typora-user-images\image-20251113112905853.png" alt="image-20251113112905853"></p>
<p><img src="C:\Users\Developer\AppData\Roaming\Typora\typora-user-images\image-20251113112923735.png" alt="image-20251113112923735"></p>
<h3 id="3-1-设置路由插件"><a href="#3-1-设置路由插件" class="headerlink" title="3.1 设置路由插件"></a>3.1 设置路由插件</h3><h3 id=""><a href="#" class="headerlink" title=""></a><img src="C:\Users\Developer\AppData\Roaming\Typora\typora-user-images\image-20251113113013329.png" alt="image-20251113113013329"></h3><p>路径重写：</p>
<p><img src="C:\Users\Developer\AppData\Roaming\Typora\typora-user-images\image-20251113113028844.png" alt="image-20251113113028844"></p>
<p>类似nginx的路径重写</p>
<h2 id="4-mcp服务器插件配置"><a href="#4-mcp服务器插件配置" class="headerlink" title="4.mcp服务器插件配置"></a>4.mcp服务器插件配置</h2><h3 id="当日值班"><a href="#当日值班" class="headerlink" title="当日值班"></a>当日值班</h3><figure class="highlight hs"><table><tr><td class="code"><pre><span class="line"><span class="title">server</span>:</span><br><span class="line">  allowTools:</span><br><span class="line">  - <span class="string">&quot;get-today-duty-info&quot;</span></span><br><span class="line">  name: <span class="string">&quot;duty-service&quot;</span></span><br><span class="line"><span class="title">tools</span>:</span><br><span class="line">- args:</span><br><span class="line">  - <span class="keyword">default</span>: &quot;&#123;&#123; now &#125;&#125;&quot;</span><br><span class="line">    description: <span class="string">&quot;签到日期，格式为 yyyy-MM-dd HH:mm:ss,默认为今天&quot;</span></span><br><span class="line">    name: <span class="string">&quot;signDate&quot;</span></span><br><span class="line">    position: <span class="string">&quot;query&quot;</span></span><br><span class="line">    required: true</span><br><span class="line">    <span class="class"><span class="keyword">type</span>: &quot;string&quot;</span></span><br><span class="line">  - <span class="keyword">default</span>: &quot;-1&quot;</span><br><span class="line">    description: <span class="string">&quot;组织机构ID,传-1表示获取全部,必须传-1&quot;</span></span><br><span class="line">    name: <span class="string">&quot;orgId&quot;</span></span><br><span class="line">    position: <span class="string">&quot;query&quot;</span></span><br><span class="line">    required: true</span><br><span class="line">    <span class="class"><span class="keyword">type</span>: &quot;string&quot;</span></span><br><span class="line">  - description: <span class="string">&quot;认证Token&quot;</span></span><br><span class="line">    name: <span class="string">&quot;Authorization&quot;</span></span><br><span class="line">    position: <span class="string">&quot;header&quot;</span></span><br><span class="line">    required: true</span><br><span class="line">    <span class="class"><span class="keyword">type</span>: &quot;string&quot;</span></span><br><span class="line">  description: <span class="string">&quot;获取当日值班列表信息&quot;</span></span><br><span class="line">  name: <span class="string">&quot;get-today-duty-info&quot;</span></span><br><span class="line">  requestTemplate:</span><br><span class="line">    headers:</span><br><span class="line">    - key: <span class="string">&quot;Authorization&quot;</span></span><br><span class="line">      value: <span class="string">&quot;&#123;&#123;.args.Authorization&#125;&#125;&quot;</span></span><br><span class="line">    method: <span class="string">&quot;GET&quot;</span></span><br><span class="line">    url: <span class="string">&quot;http://172.31.10.113:33001/app/duty/appUserSign/listByOrg?signDate=&#123;&#123;.args.signDate&#125;&#125;&amp;orgId=&#123;&#123;.args.orgId&#125;&#125;&quot;</span></span><br><span class="line">  responseTemplate:</span><br><span class="line">    body: |-</span><br><span class="line">      &#123;<span class="comment">&#123;- if eq .status &quot;200&quot; &#125;&#125;</span></span><br><span class="line"><span class="comment">      ## 当日值班信息</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">      &#123;<span class="comment">&#123;- range .result &#125;&#125;</span></span></span><br><span class="line"><span class="comment"><span class="comment">      ### &#123;&#123; .orgName &#125;&#125; (&#123;&#123; .code &#125;&#125;)</span></span></span><br><span class="line"><span class="comment"><span class="comment">      - **组织ID**: &#123;&#123; .orgId &#125;&#125;</span></span></span><br><span class="line"><span class="comment"><span class="comment">      - **当日值班人数**: &#123;&#123; .todayDutyCount &#125;&#125;</span></span></span><br><span class="line"><span class="comment"><span class="comment">      - **部门用户总数**: &#123;&#123; .orgUserCount &#125;&#125;</span></span></span><br><span class="line"><span class="comment"><span class="comment"></span></span></span><br><span class="line"><span class="comment"><span class="comment">      &#123;<span class="comment">&#123;- if .list &#125;&#125;</span></span></span></span><br><span class="line"><span class="comment"><span class="comment"><span class="comment">      #### 值班人员列表:</span></span></span></span><br><span class="line"><span class="comment"><span class="comment"><span class="comment">      &#123;<span class="comment">&#123;- range .list &#125;&#125;</span></span></span></span></span><br><span class="line"><span class="comment"><span class="comment"><span class="comment"><span class="comment">      - **姓名**: &#123;&#123; .userName &#125;&#125;</span></span></span></span></span><br><span class="line"><span class="comment"><span class="comment"><span class="comment"><span class="comment">        - **岗位**: &#123;&#123; .positionName &#125;&#125;</span></span></span></span></span><br><span class="line"><span class="comment"><span class="comment"><span class="comment"><span class="comment">        - **电话**: &#123;&#123; .phoneNum &#125;&#125;</span></span></span></span></span><br><span class="line"><span class="comment"><span class="comment"><span class="comment"><span class="comment">        - **签到状态**: &#123;&#123; if eq .signYesNo 1 &#125;&#125;已签到&#123;&#123; else &#125;&#125;未签到&#123;&#123; end &#125;&#125;</span></span></span></span></span><br><span class="line"><span class="comment"><span class="comment"><span class="comment"><span class="comment">        - **岗位类型**: &#123;&#123; if eq .signPositionType 1 &#125;&#125;正班&#123;&#123; else if eq .signPositionType 2 &#125;&#125;副班&#123;&#123; else &#125;&#125;其他&#123;&#123; end &#125;&#125;</span></span></span></span></span><br><span class="line"><span class="comment"><span class="comment"><span class="comment"><span class="comment">      &#123;<span class="comment">&#123;- end &#125;&#125;</span></span></span></span></span></span><br><span class="line"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">      &#123;<span class="comment">&#123;- else &#125;&#125;</span></span></span></span></span></span></span><br><span class="line"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">      &gt; 今日暂无值班人员</span></span></span></span></span></span></span><br><span class="line"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">      &#123;<span class="comment">&#123;- end &#125;&#125;</span></span></span></span></span></span></span></span><br><span class="line"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"></span></span></span></span></span></span></span></span><br><span class="line"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">      ---</span></span></span></span></span></span></span></span><br><span class="line"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">      &#123;<span class="comment">&#123;- end &#125;&#125;</span></span></span></span></span></span></span></span></span><br><span class="line"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">      &#123;<span class="comment">&#123;- else &#125;&#125;</span></span></span></span></span></span></span></span></span></span><br><span class="line"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">      ## 请求失败</span></span></span></span></span></span></span></span></span></span><br><span class="line"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">      - **状态码**: &#123;&#123;.status&#125;&#125;</span></span></span></span></span></span></span></span></span></span><br><span class="line"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">      - **错误信息**: &#123;&#123;.message&#125;&#125;</span></span></span></span></span></span></span></span></span></span><br><span class="line"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">      &#123;<span class="comment">&#123;- end &#125;&#125;</span></span></span></span></span></span></span></span></span></span></span><br></pre></td></tr></table></figure>
<h2 id="mcp服务器插件配置生成的提示词模板"><a href="#mcp服务器插件配置生成的提示词模板" class="headerlink" title="mcp服务器插件配置生成的提示词模板"></a>mcp服务器插件配置生成的提示词模板</h2><p>搜索higress的mcp服务器插件配置语法，并模仿如下配置生成一个新配置：</p>
<p>【mcp服务器插件配置】</p>
<p>新配置的功能是获取当日值班的数据，url是<a href="http://172.31.70.156:8080/duty-service/app/duty/appUserSign/listByOrg，是get请求，入参有signDate，格式是yyyy-MM-dd">http://172.31.70.156:8080/duty-service/app/duty/appUserSign/listByOrg，是get请求，入参有signDate，格式是yyyy-MM-dd</a> HH:mm:ss，默认传今天，还有orgId，组织机构id，默认传-1，就是全部的意思，返回的结果是这样的：</p>
<p>【结果返回实际结果】</p>
<p>对应的接口是这样的：</p>
<p>【接口controller代码】</p>
<p>【出入参实体类】</p>
<h3 id="半小时天气"><a href="#半小时天气" class="headerlink" title="半小时天气"></a>半小时天气</h3><p>搜索higress的mcp服务器插件配置语法，并模仿如下配置生成一个新配置：</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">server:</span><br><span class="line">  allowTools:</span><br><span class="line">  - <span class="string">&quot;get-today-duty-info&quot;</span></span><br><span class="line">  name: <span class="string">&quot;duty-service&quot;</span></span><br><span class="line">tools:</span><br><span class="line">- args:</span><br><span class="line">  - default: <span class="string">&quot;&#123;&#123; now &#125;&#125;&quot;</span></span><br><span class="line">    description: <span class="string">&quot;签到日期，格式为 yyyy-MM-dd HH:mm:ss,默认为今天&quot;</span></span><br><span class="line">    name: <span class="string">&quot;signDate&quot;</span></span><br><span class="line">    position: <span class="string">&quot;query&quot;</span></span><br><span class="line">    required: <span class="literal">true</span></span><br><span class="line">    <span class="built_in">type</span>: <span class="string">&quot;string&quot;</span></span><br><span class="line">  - default: <span class="string">&quot;-1&quot;</span></span><br><span class="line">    description: <span class="string">&quot;组织机构ID,传-1表示获取全部,必须传-1&quot;</span></span><br><span class="line">    name: <span class="string">&quot;orgId&quot;</span></span><br><span class="line">    position: <span class="string">&quot;query&quot;</span></span><br><span class="line">    required: <span class="literal">true</span></span><br><span class="line">    <span class="built_in">type</span>: <span class="string">&quot;string&quot;</span></span><br><span class="line">  - description: <span class="string">&quot;认证Token&quot;</span></span><br><span class="line">    name: <span class="string">&quot;Authorization&quot;</span></span><br><span class="line">    position: <span class="string">&quot;header&quot;</span></span><br><span class="line">    required: <span class="literal">true</span></span><br><span class="line">    <span class="built_in">type</span>: <span class="string">&quot;string&quot;</span></span><br><span class="line">  description: <span class="string">&quot;获取当日值班列表信息&quot;</span></span><br><span class="line">  name: <span class="string">&quot;get-today-duty-info&quot;</span></span><br><span class="line">  requestTemplate:</span><br><span class="line">    headers:</span><br><span class="line">    - key: <span class="string">&quot;Authorization&quot;</span></span><br><span class="line">      value: <span class="string">&quot;&#123;&#123;.args.Authorization&#125;&#125;&quot;</span></span><br><span class="line">    method: <span class="string">&quot;GET&quot;</span></span><br><span class="line">    url: <span class="string">&quot;http://172.31.10.113:33001/app/duty/appUserSign/listByOrg?signDate=&#123;&#123;.args.signDate&#125;&#125;&amp;orgId=&#123;&#123;.args.orgId&#125;&#125;&quot;</span></span><br><span class="line">  responseTemplate:</span><br><span class="line">    body: |-</span><br><span class="line">      &#123;&#123;- <span class="keyword">if</span> eq .status <span class="string">&quot;200&quot;</span> &#125;&#125;</span><br><span class="line">      <span class="comment">## 当日值班信息</span></span><br><span class="line"></span><br><span class="line">      &#123;&#123;- range .result &#125;&#125;</span><br><span class="line">      <span class="comment">### &#123;&#123; .orgName &#125;&#125; (&#123;&#123; .code &#125;&#125;)</span></span><br><span class="line">      - **组织ID**: &#123;&#123; .orgId &#125;&#125;</span><br><span class="line">      - **当日值班人数**: &#123;&#123; .todayDutyCount &#125;&#125;</span><br><span class="line">      - **部门用户总数**: &#123;&#123; .orgUserCount &#125;&#125;</span><br><span class="line"></span><br><span class="line">      &#123;&#123;- <span class="keyword">if</span> .list &#125;&#125;</span><br><span class="line">      <span class="comment">#### 值班人员列表:</span></span><br><span class="line">      &#123;&#123;- range .list &#125;&#125;</span><br><span class="line">      - **姓名**: &#123;&#123; .userName &#125;&#125;</span><br><span class="line">        - **岗位**: &#123;&#123; .positionName &#125;&#125;</span><br><span class="line">        - **电话**: &#123;&#123; .phoneNum &#125;&#125;</span><br><span class="line">        - **签到状态**: &#123;&#123; <span class="keyword">if</span> eq .signYesNo 1 &#125;&#125;已签到&#123;&#123; <span class="keyword">else</span> &#125;&#125;未签到&#123;&#123; end &#125;&#125;</span><br><span class="line">        - **岗位类型**: &#123;&#123; <span class="keyword">if</span> eq .signPositionType 1 &#125;&#125;正班&#123;&#123; <span class="keyword">else</span> <span class="keyword">if</span> eq .signPositionType 2 &#125;&#125;副班&#123;&#123; <span class="keyword">else</span> &#125;&#125;其他&#123;&#123; end &#125;&#125;</span><br><span class="line">      &#123;&#123;- end &#125;&#125;</span><br><span class="line">      &#123;&#123;- <span class="keyword">else</span> &#125;&#125;</span><br><span class="line">      &gt; 今日暂无值班人员</span><br><span class="line">      &#123;&#123;- end &#125;&#125;</span><br><span class="line"></span><br><span class="line">      ---</span><br><span class="line">      &#123;&#123;- end &#125;&#125;</span><br><span class="line">      &#123;&#123;- <span class="keyword">else</span> &#125;&#125;</span><br><span class="line">      <span class="comment">## 请求失败</span></span><br><span class="line">      - **状态码**: &#123;&#123;.status&#125;&#125;</span><br><span class="line">      - **错误信息**: &#123;&#123;.message&#125;&#125;</span><br><span class="line">      &#123;&#123;- end &#125;&#125;</span><br></pre></td></tr></table></figure>
<p>新配置的功能是根据机场三字码获取半小时天气的数据，url是<a href="http://172.31.70.156:8080/production-service，是post请求，入参有airportCode，是机场的三字码，入参的json格式是这样的：{&quot;entity">http://172.31.70.156:8080/production-service，是post请求，入参有airportCode，是机场的三字码，入参的json格式是这样的：{&quot;entity</a>“: {“airportCode”: “URC”}}，返回的结果是这样的：</p>
<p>{<br>  “status”: “200”,<br>  “message”: null,<br>  “result”: {<br>    “visibilityColor”: 0,<br>    “avgWindColor”: 0,<br>    “tempColor”: 0,<br>    “lowTempColor”: 0,<br>    “highTempColor”: 0,<br>    “visibilityColorAlertValue”: null,<br>    “avgWindColorAlertValue”: null,<br>    “tempColorAlertValue”: null,<br>    “winddirectionAlertValue”: null,<br>    “weatherInfoValue”: [<br>      “”<br>    ],<br>    “cloudInfoValue”: [<br>      {<br>        “id”: null,<br>        “element”: null,<br>        “describe”: null,<br>        “cloudInfo”: “无重要云”,<br>        “cloudHeight”: null,<br>        “cloudForm”: null<br>      }<br>    ],<br>    “trendforecasTinfoValue”: null,<br>    “warning”: [<br>      {<br>        “wid”: 1,<br>        “yellow”: “8”,<br>        “red”: “14”,<br>        “type”: “windspeed”,<br>        “airportCode”: “URC”<br>      },<br>      {<br>        “wid”: 2,<br>        “yellow”: “800”,<br>        “red”: “550”,<br>        “type”: “RVR”,<br>        “airportCode”: “URC”<br>      }<br>    ],<br>    “cloudDescribe”: “”,<br>    “cloudPic”: null,<br>    “avgwindspeedColor”: “white”,<br>    “weatherinfo”: null,<br>    “cloudinfo”: “NSC”,<br>    “otime”: “0430”,<br>    “odate”: “20251104”,<br>    “rptcontent”: “METAR ZWWW 040430Z 31004MPS 7000 NSC 08/01 Q1015 NOSIG= “,<br>    “avgwindspeed”: “4”,<br>    “verticalvisibility”: null,<br>    “rwysighttrend”: null,<br>    “rwysightTrendValue”: null,<br>    “cavokflag”: null,<br>    “trendforecastinfo”: null,<br>    “winddirection”: “310”,<br>    “inserttime”: “2025-11-04 04:29:20”,<br>    “reftime”: “2025-11-04 12:30:00”,<br>    “maxwindspeed”: null,<br>    “receivetime”: “04:29”,<br>    “temperature”: “8”,<br>    “dewpointtemperature”: “1”,<br>    “airpressure”: “1015”,<br>    “cloudcount”: “1”,<br>    “autoflag”: null,<br>    “winddirectionchange”: null,<br>    “minvisibility”: “7000”,<br>    “minvisibilitydirection”: null,<br>    “maxvisibility”: null,<br>    “maxvisibilitydirection”: null,<br>    “rwycount”: null,<br>    “rwyid”: null,<br>    “rwysight”: null,<br>    “rwysightchange”: null,<br>    “ncdflag”: null,<br>    “reweathercount”: null,<br>    “reweatherinfo”: null,<br>    “wscount”: null,<br>    “wsinfo”: null,<br>    “seatemperature”: null,<br>    “seastate”: null,<br>    “rwystate”: null,<br>    “trendforecastcount”: null,<br>    “cccc”: “ZWWW”,<br>    “skcflag”: null,<br>    “nscflag”: “1”,<br>    “reportid”: “c20251104043117358TXT0001001”,<br>    “tt”: “SA”,<br>    “aa”: “CI”,<br>    “kk”: “39”,<br>    “headdate”: “20251104”,<br>    “headtime”: “0430”,<br>    “bbb”: null,<br>    “obcc”: “ZWWW”,<br>    “weathercount”: null<br>  },<br>  “callback”: null<br>}</p>
<p>相关的代码是这样的：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">package com.xjcares.common.dto.weather;</span><br><span class="line"></span><br><span class="line">import com.xjcares.common.vo.security.WeatherColorVo;</span><br><span class="line">import io.swagger.annotations.ApiModelProperty;</span><br><span class="line">import lombok.Getter;</span><br><span class="line">import lombok.Setter;</span><br><span class="line"></span><br><span class="line">import java.util.List;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 天气小时报文</span><br><span class="line"> *</span><br><span class="line"> * @author root</span><br><span class="line"> */</span><br><span class="line">@Getter</span><br><span class="line">@Setter</span><br><span class="line">public class WeatherSASP extends WeatherColorVo &#123;</span><br><span class="line">    /**</span><br><span class="line">     * &#x27;公报ID+报告顺序号(23 位+3 位) &#x27;,</span><br><span class="line">     */</span><br><span class="line">    @ApiModelProperty(value = &quot;&#x27;公报ID+报告顺序号(23 位+3 位) &quot;)</span><br><span class="line">    private String REPORTID;</span><br><span class="line">    /**</span><br><span class="line">     * &#x27;接收时间（取自文件属性）&#x27;,</span><br><span class="line">     */</span><br><span class="line">    private String RECEIVETIME;</span><br><span class="line">    /**</span><br><span class="line">     * &#x27;入库时间（入库时获取系统时间）&#x27;,</span><br><span class="line">     */</span><br><span class="line">    private String INSERTTIME;</span><br><span class="line">    /**</span><br><span class="line">     * T &#x27;报文类别SA or SP （根据报头判定）&#x27;,</span><br><span class="line">     */</span><br><span class="line">    private String TT;</span><br><span class="line">    /**</span><br><span class="line">     * T &#x27;区域代码， 来自报头中的AA &#x27;,</span><br><span class="line">     */</span><br><span class="line">    private String AA;</span><br><span class="line">    /**</span><br><span class="line">     * T &#x27;公报编号， 来自报头中的KK &#x27;,</span><br><span class="line">     */</span><br><span class="line">    private String KK;</span><br><span class="line">    /**</span><br><span class="line">     * N   转发报日期文件名的年月(YYYYMM)+ 报头中的日(DD)经过比较计算后得到。</span><br><span class="line">     */</span><br><span class="line">    private String HEADDATE;</span><br><span class="line">    /**</span><br><span class="line">     * 转发报时间来自报头的时分(HHMM)</span><br><span class="line">     */</span><br><span class="line">    private String HEADTIME;</span><br><span class="line">    /**</span><br><span class="line">     * 通信发布中心代码</span><br><span class="line">     */</span><br><span class="line">    private String CCCC;</span><br><span class="line">    /**</span><br><span class="line">     * Y   更正/修订标识,来自于报头（AAx、CCx、RRx）</span><br><span class="line">     */</span><br><span class="line">    private String BBB;</span><br><span class="line">    /**</span><br><span class="line">     * 航站代码，来自报告的CCCC</span><br><span class="line">     */</span><br><span class="line">    private String OBCC;</span><br><span class="line">    /**</span><br><span class="line">     * &#x27;观测日期(年月日) 根据报告中CCCC 后面的YYGGggZ 中的日（YY）和文件名的日期比较计算得&#x27;</span><br><span class="line">     */</span><br><span class="line">    private String ODATE;</span><br><span class="line">    /**</span><br><span class="line">     * &#x27;观测时间（时分）指观测时间YYGGgg 中的GGgg ，例如0100 ，表示实况的观测时间为01 时00 分&#x27;</span><br><span class="line">     */</span><br><span class="line">    private String OTIME;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 自动报告标识符,报告中若有AUTO ，则为1，否则为0</span><br><span class="line">     */</span><br><span class="line">    private String AUTOFLAG;</span><br><span class="line">    /**</span><br><span class="line">     * &#x27;风向，来自报告中的ddd or VRB,如果为VRB，则存储为-2,如果为///, 则存储为-1 &#x27;</span><br><span class="line">     */</span><br><span class="line">    private String WINDDIRECTION;</span><br><span class="line">    /**</span><br><span class="line">     * &#x27;平均风速，来自报告中的ff, 如果为///，则存储为-1&#x27;</span><br><span class="line">     */</span><br><span class="line">    private String AVGWINDSPEED;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 没有不显示 &#x27;最大风速（阵风），来自报告中的fmfm 如果为///，则存储为-1 &#x27;</span><br><span class="line">     */</span><br><span class="line">    private String MAXWINDSPEED;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 没有不显示 &#x27;重大风向变化，来自报告中的dndndnVdxdxdx ，风向变化起点，风向变化终点，以V 分隔&#x27;,</span><br><span class="line">     */</span><br><span class="line">    private String WINDDIRECTIONCHANGE;</span><br><span class="line">    /**</span><br><span class="line">     * 最小能见度,来自报告中的VVVV, 如果为////，则存储为-1 &#x27;,</span><br><span class="line">     */</span><br><span class="line">    private String MINVISIBILITY;</span><br><span class="line">    /**</span><br><span class="line">     * &#x27;最小能见度方向，来自报告中的DV，方向不明则存储为//或者NDV &#x27;,</span><br><span class="line">     */</span><br><span class="line">    private String MINVISIBILITYDIRECTION;</span><br><span class="line">    /**</span><br><span class="line">     * 最大能见度，来自报告中的VXVXVXVX, 如果为////，则存储为-1 &#x27;,</span><br><span class="line">     */</span><br><span class="line">    private String MAXVISIBILITY;</span><br><span class="line">    /**</span><br><span class="line">     * &#x27;最大能见度的方向，来自报告中的DV， 方向不明则存储为//或者NDV &#x27;,</span><br><span class="line">     */</span><br><span class="line">    private String MAXVISIBILITYDIRECTION;</span><br><span class="line">    /**</span><br><span class="line">     * &#x27;跑道条数，报告中无对应字段，需要计算得出。&#x27;,</span><br><span class="line">     */</span><br><span class="line">    private String RWYCOUNT;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 跑道信息 &#x27;跑道编号， 来自报告中的DRDR,各跑道编号以“&amp;” 分隔，如果跑道编号不明则用///表示。如果报告中跑道编号带L 或R 或C，则L、R、C 也要存储。&#x27;,</span><br><span class="line">     */</span><br><span class="line">    private String RWYID;</span><br><span class="line">    /**</span><br><span class="line">     * &#x27;跑道视程， 来自报告中的VRVRVRVR 各跑道视程以“&amp;”分隔，如果跑道视程不明则用//// 表示&#x27;,</span><br><span class="line">     */</span><br><span class="line">    private String RWYSIGHT;</span><br><span class="line">    /**</span><br><span class="line">     * &#x27;跑道视程的变化，来自报告中的VRVRVRVR 各跑道视程变化以“&amp;”分隔，如果跑道视程变化不明则用//// 表示，VRVRVRVR 用4 位数字表示&#x27;,</span><br><span class="line">     */</span><br><span class="line">    private String RWYSIGHTCHANGE;</span><br><span class="line">    /**</span><br><span class="line">     * &#x27;跑道视程值的趋势，来自报告中的i 。各跑道视程值的趋势以“&amp;”分隔，如果趋势不明,则用/表示，如果无趋势则用空字符串表示&#x27;,</span><br><span class="line">     */</span><br><span class="line">    private String RWYSIGHTTREND;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * &#x27;是否无重要天气现象，来自报告中的CAVOK ，若无重要天气现象则填入1，此时最小能见度设定为9999，否则为0 &#x27;,</span><br><span class="line">     */</span><br><span class="line">    private String CAVOKFLAG;</span><br><span class="line">    /**</span><br><span class="line">     * &#x27;现在天气的组数&#x27;,</span><br><span class="line">     */</span><br><span class="line">    private String WEATHERCOUNT;</span><br><span class="line">    /**</span><br><span class="line">     * &#x27;现在天气， 来自报告中的w&#x27;&#x27;w&#x27;&#x27; ，各组天气以“&amp;”分隔&#x27;,</span><br><span class="line">     */</span><br><span class="line">    private String WEATHERINFO;</span><br><span class="line">    /**</span><br><span class="line">     * &#x27;云组的个数&#x27;,</span><br><span class="line">     */</span><br><span class="line">    private String CLOUDCOUNT;</span><br><span class="line">    /**</span><br><span class="line">     * &#x27;云量云高云状，各组用“&amp;” 分隔，云量云高云状之间用：分隔,如果云状不明，则用/// 表示，如果云状不存在，则用空字符串表示&#x27;,</span><br><span class="line">     */</span><br><span class="line">    private String CLOUDINFO;</span><br><span class="line">    /**</span><br><span class="line">     * &#x27;垂直能见度，如果不明则用-1 表示&#x27;,</span><br><span class="line">     */</span><br><span class="line">    private String VERTICALVISIBILITY;</span><br><span class="line">    /**</span><br><span class="line">     * &#x27;晴空，来自报告中的SKC， 报告中有SKC,则填入1，否则填入0 &#x27;,</span><br><span class="line">     */</span><br><span class="line">    private String SKCFLAG;</span><br><span class="line">    /**</span><br><span class="line">     * &#x27;无重要云， 来自报告中的NSC，报告中有SKC,则填入1，否则填入0 &#x27;,</span><br><span class="line">     */</span><br><span class="line">    private String NSCFLAG;</span><br><span class="line">    /**</span><br><span class="line">     * &#x27;无云，来自报告中的NCD， 报告中有SKC,则填入1，否则填入0 &#x27;,</span><br><span class="line">     */</span><br><span class="line">    private String NCDFLAG;</span><br><span class="line">    /**</span><br><span class="line">     * &#x27;气温，来自报告中的T&#x27;&#x27;T&#x27;&#x27; &#x27;,</span><br><span class="line">     */</span><br><span class="line">    private String TEMPERATURE;</span><br><span class="line">    /**</span><br><span class="line">     * &#x27;露点温度， 来自报告中的T&#x27;&#x27;dT&#x27;&#x27;d &#x27;,</span><br><span class="line">     */</span><br><span class="line">    private String DEWPOINTTEMPERATURE;</span><br><span class="line">    /**</span><br><span class="line">     * 气压值，来自报告中的PHPHPHPH, 以百帕为单位, 气压不明则用-1 表示&#x27;</span><br><span class="line">     */</span><br><span class="line">    private String AIRPRESSURE;</span><br><span class="line">    /**</span><br><span class="line">     * 近时天气的组数</span><br><span class="line">     */</span><br><span class="line">    private String REWEATHERCOUNT;</span><br><span class="line">    /**</span><br><span class="line">     * &#x27;近时天气，来自报告中RE w&#x27;&#x27;w&#x27;&#x27; 的w&#x27;&#x27;w&#x27;&#x27; ，各组天气以“&amp;”分隔&#x27;,</span><br><span class="line">     */</span><br><span class="line">    private String REWEATHERINFO;</span><br><span class="line">    /**</span><br><span class="line">     * &#x27;风切变组数&#x27;,</span><br><span class="line">     */</span><br><span class="line">    private String WSCOUNT;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 没有不显示 &#x27;风切变，来自报告中的WS， 各组以“&amp;”分隔&#x27;,</span><br><span class="line">     */</span><br><span class="line">    private String WSINFO;</span><br><span class="line">    /**</span><br><span class="line">     * &#x27;海面温度,来自报告中的WT&#x27;&#x27;T&#x27;&#x27;/Sn 中的T&#x27;&#x27;T&#x27;&#x27; &#x27;,</span><br><span class="line">     */</span><br><span class="line">    private String SEATEMPERATURE;</span><br><span class="line">    /**</span><br><span class="line">     * &#x27;海的状况, 来自报告中的WT&#x27;&#x27;T&#x27;&#x27;/Sn 中的n &#x27;</span><br><span class="line">     */</span><br><span class="line">    private String SEASTATE;</span><br><span class="line">    /**</span><br><span class="line">     * &#x27;跑道状况,来自报告中的┌ D1PD2R DRDR │ or └ CLRDXX 包括跑道编号，跑道堆积物，跑道污染的范围，跑道堆积物深度，跑道摩擦系数。如果SNOCLO，则直接保存SNOCLO &#x27;,</span><br><span class="line">     */</span><br><span class="line">    private String RWYSTATE;</span><br><span class="line">    /**</span><br><span class="line">     * &#x27;趋势预报组数&#x27;</span><br><span class="line">     */</span><br><span class="line">    private String TRENDFORECASTCOUNT;</span><br><span class="line">    /**</span><br><span class="line">     * &#x27;趋势预报， 来自报告中的BECMG 或TEMPO，各预报以“&amp;”分隔&#x27;,</span><br><span class="line">     */</span><br><span class="line">    private String TRENDFORECASTINFO;</span><br><span class="line">    /**</span><br><span class="line">     * 资料参照时间取自报告表对应记录的RefTime</span><br><span class="line">     */</span><br><span class="line">    private String REFTIME;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * &#x27;资料参照时间取自报告表对应记录的RefTime&#x27;,  rpt01_cac b表原报文信息</span><br><span class="line">     */</span><br><span class="line">    private String RPTCONTENT;</span><br><span class="line">    /**</span><br><span class="line">     * 天气现象描述信息</span><br><span class="line">     */</span><br><span class="line">    private List&lt;String&gt; weatherInfoValue;</span><br><span class="line">    /**</span><br><span class="line">     * 云要素描述信息</span><br><span class="line">     */</span><br><span class="line">    private List&lt;WeatherChangeInfoVO&gt; cloudInfoValue;</span><br><span class="line">    /**</span><br><span class="line">     * 趋势变化情况描述</span><br><span class="line">     */</span><br><span class="line">    private List&lt;String&gt; trendforecasTinfoValue;</span><br><span class="line">    /**</span><br><span class="line">     * 跑道视成趋势</span><br><span class="line">     */</span><br><span class="line">    private String RWYSightTrendValue;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 预警值   (包装查询机场得所有预警值)</span><br><span class="line">     */</span><br><span class="line">    private List&lt;WeatherWarning&gt; warning;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 云信息</span><br><span class="line">     */</span><br><span class="line">    private String cloudDescribe;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 天气图标值</span><br><span class="line">     */</span><br><span class="line">    private String cloudPic;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 平均风速背景色  orange；reed; white</span><br><span class="line">     */</span><br><span class="line">    private String avgwindspeedColor;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">package com.xjcares.common.dto.weather;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * Create by JYH  2018/3/27 11:06</span><br><span class="line"> * 包装天气变化信息</span><br><span class="line"> * app_weather_cloud_info</span><br><span class="line"> * app_weather_phenomenon_info</span><br><span class="line"> * @author JYH</span><br><span class="line"> */</span><br><span class="line">public class WeatherChangeInfoVO &#123;</span><br><span class="line"></span><br><span class="line">    private Integer id;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 天气值</span><br><span class="line">     */</span><br><span class="line">    private String element;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 天气值解释信息</span><br><span class="line">     */</span><br><span class="line">    private String describe;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 云描述</span><br><span class="line">     */</span><br><span class="line">    private String cloudInfo;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 云高</span><br><span class="line">     */</span><br><span class="line">    private Integer cloudHeight;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 云状</span><br><span class="line">     */</span><br><span class="line">    private String cloudForm;</span><br><span class="line"></span><br><span class="line">    public Integer getId() &#123;</span><br><span class="line">        return id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setId(Integer id) &#123;</span><br><span class="line">        this.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getElement() &#123;</span><br><span class="line">        return element;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setElement(String element) &#123;</span><br><span class="line">        this.element = element;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getDescribe() &#123;</span><br><span class="line">        return describe;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setDescribe(String describe) &#123;</span><br><span class="line">        this.describe = describe;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getCloudInfo() &#123;</span><br><span class="line">        return cloudInfo;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setCloudInfo(String cloudInfo) &#123;</span><br><span class="line">        this.cloudInfo = cloudInfo;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public Integer getCloudHeight() &#123;</span><br><span class="line">        return cloudHeight;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setCloudHeight(Integer cloudHeight) &#123;</span><br><span class="line">        this.cloudHeight = cloudHeight;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getCloudForm() &#123;</span><br><span class="line">        return cloudForm;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setCloudForm(String cloudForm) &#123;</span><br><span class="line">        this.cloudForm = cloudForm;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>结束</p>
<h4 id="配置结果"><a href="#配置结果" class="headerlink" title="配置结果"></a>配置结果</h4><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">server:</span><br><span class="line">  allowTools:</span><br><span class="line">  - <span class="string">&quot;get-airport-weather&quot;</span></span><br><span class="line">  name: <span class="string">&quot;weather-service&quot;</span></span><br><span class="line">tools:</span><br><span class="line">- args:</span><br><span class="line">  - description: <span class="string">&quot;机场三字码，例如URC、PEK、PVG&quot;</span></span><br><span class="line">    name: <span class="string">&quot;airportCode&quot;</span></span><br><span class="line">    position: <span class="string">&quot;body&quot;</span></span><br><span class="line">    required: <span class="literal">true</span></span><br><span class="line">    <span class="built_in">type</span>: <span class="string">&quot;string&quot;</span></span><br><span class="line">  - description: <span class="string">&quot;认证Token&quot;</span></span><br><span class="line">    name: <span class="string">&quot;Authorization&quot;</span></span><br><span class="line">    position: <span class="string">&quot;header&quot;</span></span><br><span class="line">    required: <span class="literal">true</span></span><br><span class="line">    <span class="built_in">type</span>: <span class="string">&quot;string&quot;</span></span><br><span class="line">  description: <span class="string">&quot;获取机场半小时天气数据&quot;</span></span><br><span class="line">  name: <span class="string">&quot;get-airport-weather&quot;</span></span><br><span class="line">  requestTemplate:</span><br><span class="line">    body: |</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">&quot;entity&quot;</span>: &#123;</span><br><span class="line">          <span class="string">&quot;airportCode&quot;</span>: <span class="string">&quot;&#123;&#123;.args.airportCode&#125;&#125;&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    headers:</span><br><span class="line">    - key: <span class="string">&quot;Content-Type&quot;</span></span><br><span class="line">      value: <span class="string">&quot;application/json&quot;</span></span><br><span class="line">    - key: <span class="string">&quot;Authorization&quot;</span></span><br><span class="line">      value: <span class="string">&quot;&#123;&#123;.args.Authorization&#125;&#125;&quot;</span></span><br><span class="line">    method: <span class="string">&quot;POST&quot;</span></span><br><span class="line">    url: <span class="string">&quot;http://production-service/production-service/app/production/weather/getWeatherPredictionByHour&quot;</span></span><br><span class="line">  responseTemplate:</span><br><span class="line">    body: <span class="string">&quot;&#123;&#123;- if eq .status \&quot;200\&quot; &#125;&#125;\n## &#123;&#123; .result.cccc &#125;&#125; 机场半小时天气报告\n\n**观测时间\</span></span><br><span class="line"><span class="string">      **: &#123;&#123; .result.odate &#125;&#125; &#123;&#123; .result.otime &#125;&#125; UTC  \n**接收时间**: &#123;&#123; .result.receivetime\</span></span><br><span class="line"><span class="string">      \ &#125;&#125;  \n**报告ID**: &#123;&#123; .result.reportid &#125;&#125;\n\n### 基本气象要素\n- **风向**: &#123;&#123; .result.winddirection\</span></span><br><span class="line"><span class="string">      \ &#125;&#125;°\n- **平均风速**: &#123;&#123; .result.avgwindspeed &#125;&#125; m/s (&#123;&#123; .result.avgwindspeedColor\</span></span><br><span class="line"><span class="string">      \ &#125;&#125;)\n- **气温**: &#123;&#123; .result.temperature &#125;&#125;°C\n- **露点温度**: &#123;&#123; .result.dewpointtemperature\</span></span><br><span class="line"><span class="string">      \ &#125;&#125;°C\n- **气压**: &#123;&#123; .result.airpressure &#125;&#125; hPa\n- **能见度**: &#123;&#123; .result.minvisibility\</span></span><br><span class="line"><span class="string">      \ &#125;&#125; 米\n\n### 云况信息\n&#123;&#123;- if eq .result.nscflag \&quot;1\&quot; &#125;&#125;\n- **云况**: 无重要云 (NSC)\n\</span></span><br><span class="line"><span class="string">      &#123;&#123;- else &#125;&#125;\n&#123;&#123;- if .result.cloudInfoValue &#125;&#125;\n&#123;&#123;- range .result.cloudInfoValue\</span></span><br><span class="line"><span class="string">      \ &#125;&#125;\n&#123;&#123;- if .cloudInfo &#125;&#125;\n- **&#123;&#123; .cloudInfo &#125;&#125;**\n  &#123;&#123;- if .cloudHeight &#125;&#125;，\</span></span><br><span class="line"><span class="string">      云高: &#123;&#123; .cloudHeight &#125;&#125; 米&#123;&#123; end &#125;&#125;\n  &#123;&#123;- if .cloudForm &#125;&#125;，云状: &#123;&#123; .cloudForm\</span></span><br><span class="line"><span class="string">      \ &#125;&#125;&#123;&#123; end &#125;&#125;\n&#123;&#123;- end &#125;&#125;\n&#123;&#123;- end &#125;&#125;\n&#123;&#123;- end &#125;&#125;\n&#123;&#123;- end &#125;&#125;\n\n### 跑道视程\n\</span></span><br><span class="line"><span class="string">      &#123;&#123;- if .result.rwysight &#125;&#125;\n- **跑道视程**: &#123;&#123; .result.rwysight &#125;&#125; 米\n&#123;&#123;- if .result.rwysightchange\</span></span><br><span class="line"><span class="string">      \ &#125;&#125;\n  - **变化趋势**: &#123;&#123; .result.rwysightchange &#125;&#125;\n&#123;&#123;- end &#125;&#125;\n&#123;&#123;- else &#125;&#125;\n\</span></span><br><span class="line"><span class="string">      - **跑道视程**: 无数据\n&#123;&#123;- end &#125;&#125;\n\n### 天气现象\n&#123;&#123;- if .result.weatherInfoValue &#125;&#125;\n\</span></span><br><span class="line"><span class="string">      &#123;&#123;- range .result.weatherInfoValue &#125;&#125;\n&#123;&#123;- if . &#125;&#125;\n- **天气现象**: &#123;&#123; . &#125;&#125;\n&#123;&#123;-\</span></span><br><span class="line"><span class="string">      \ end &#125;&#125;\n&#123;&#123;- end &#125;&#125;\n&#123;&#123;- end &#125;&#125;\n\n### 预警信息\n&#123;&#123;- if .result.warning &#125;&#125;\n&#123;&#123;-\</span></span><br><span class="line"><span class="string">      \ range .result.warning &#125;&#125;\n&#123;&#123;- if eq .type \&quot;windspeed\&quot; &#125;&#125;\n- **风速预警**: 黄色\</span></span><br><span class="line"><span class="string">      阈值 &#123;&#123; .yellow &#125;&#125; m/s，红色阈值 &#123;&#123; .red &#125;&#125; m/s\n&#123;&#123;- else if eq .type \&quot;RVR\&quot; &#125;&#125;\n\</span></span><br><span class="line"><span class="string">      - **跑道视程预警**: 黄色阈值 &#123;&#123; .yellow &#125;&#125; 米，红色阈值 &#123;&#123; .red &#125;&#125; 米\n&#123;&#123;- else &#125;&#125;\n- **&#123;&#123; .type\</span></span><br><span class="line"><span class="string">      \ &#125;&#125;预警**: 黄色阈值 &#123;&#123; .yellow &#125;&#125;，红色阈值 &#123;&#123; .red &#125;&#125;\n&#123;&#123;- end &#125;&#125;\n&#123;&#123;- end &#125;&#125;\n&#123;&#123;- else\</span></span><br><span class="line"><span class="string">      \ &#125;&#125;\n&gt; 无预警信息\n&#123;&#123;- end &#125;&#125;\n\n### 原始报文\n```\n&#123;&#123; .result.rptcontent &#125;&#125;\n```\n\n\</span></span><br><span class="line"><span class="string">      ---\n&#123;&#123;- else &#125;&#125;\n## 请求失败\n- **状态码**: &#123;&#123;.status&#125;&#125;\n- **错误信息**: &#123;&#123;.message&#125;&#125;\n\</span></span><br><span class="line"><span class="string">      &#123;&#123;- end &#125;&#125;&quot;</span></span><br></pre></td></tr></table></figure>
<h3 id="24小时天气"><a href="#24小时天气" class="headerlink" title="24小时天气"></a>24小时天气</h3><p>搜索higress的mcp服务器插件配置语法，并模仿如下配置生成一个新配置：</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">server:</span><br><span class="line">  allowTools:</span><br><span class="line">  - <span class="string">&quot;get-airport-weather&quot;</span></span><br><span class="line">  name: <span class="string">&quot;weather-service&quot;</span></span><br><span class="line">tools:</span><br><span class="line">- args:</span><br><span class="line">  - description: <span class="string">&quot;机场三字码，例如URC、PEK、PVG&quot;</span></span><br><span class="line">    name: <span class="string">&quot;airportCode&quot;</span></span><br><span class="line">    position: <span class="string">&quot;body&quot;</span></span><br><span class="line">    required: <span class="literal">true</span></span><br><span class="line">    <span class="built_in">type</span>: <span class="string">&quot;string&quot;</span></span><br><span class="line">  - description: <span class="string">&quot;认证Token&quot;</span></span><br><span class="line">    name: <span class="string">&quot;Authorization&quot;</span></span><br><span class="line">    position: <span class="string">&quot;header&quot;</span></span><br><span class="line">    required: <span class="literal">true</span></span><br><span class="line">    <span class="built_in">type</span>: <span class="string">&quot;string&quot;</span></span><br><span class="line">  description: <span class="string">&quot;获取机场半小时天气数据&quot;</span></span><br><span class="line">  name: <span class="string">&quot;get-airport-weather&quot;</span></span><br><span class="line">  requestTemplate:</span><br><span class="line">    body: |</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">&quot;entity&quot;</span>: &#123;</span><br><span class="line">          <span class="string">&quot;airportCode&quot;</span>: <span class="string">&quot;&#123;&#123;.args.airportCode&#125;&#125;&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    headers:</span><br><span class="line">    - key: <span class="string">&quot;Content-Type&quot;</span></span><br><span class="line">      value: <span class="string">&quot;application/json&quot;</span></span><br><span class="line">    - key: <span class="string">&quot;Authorization&quot;</span></span><br><span class="line">      value: <span class="string">&quot;&#123;&#123;.args.Authorization&#125;&#125;&quot;</span></span><br><span class="line">    method: <span class="string">&quot;POST&quot;</span></span><br><span class="line">    url: <span class="string">&quot;http://production-service/production-service/app/production/weather/getWeatherPredictionByHour&quot;</span></span><br><span class="line">  responseTemplate:</span><br><span class="line">    body: <span class="string">&quot;&#123;&#123;- if eq .status \&quot;200\&quot; &#125;&#125;\n## &#123;&#123; .result.cccc &#125;&#125; 机场半小时天气报告\n\n**观测时间\</span></span><br><span class="line"><span class="string">      **: &#123;&#123; .result.odate &#125;&#125; &#123;&#123; .result.otime &#125;&#125; UTC  \n**接收时间**: &#123;&#123; .result.receivetime\</span></span><br><span class="line"><span class="string">      \ &#125;&#125;  \n**报告ID**: &#123;&#123; .result.reportid &#125;&#125;\n\n### 基本气象要素\n- **风向**: &#123;&#123; .result.winddirection\</span></span><br><span class="line"><span class="string">      \ &#125;&#125;°\n- **平均风速**: &#123;&#123; .result.avgwindspeed &#125;&#125; m/s (&#123;&#123; .result.avgwindspeedColor\</span></span><br><span class="line"><span class="string">      \ &#125;&#125;)\n- **气温**: &#123;&#123; .result.temperature &#125;&#125;°C\n- **露点温度**: &#123;&#123; .result.dewpointtemperature\</span></span><br><span class="line"><span class="string">      \ &#125;&#125;°C\n- **气压**: &#123;&#123; .result.airpressure &#125;&#125; hPa\n- **能见度**: &#123;&#123; .result.minvisibility\</span></span><br><span class="line"><span class="string">      \ &#125;&#125; 米\n\n### 云况信息\n&#123;&#123;- if eq .result.nscflag \&quot;1\&quot; &#125;&#125;\n- **云况**: 无重要云 (NSC)\n\</span></span><br><span class="line"><span class="string">      &#123;&#123;- else &#125;&#125;\n&#123;&#123;- if .result.cloudInfoValue &#125;&#125;\n&#123;&#123;- range .result.cloudInfoValue\</span></span><br><span class="line"><span class="string">      \ &#125;&#125;\n&#123;&#123;- if .cloudInfo &#125;&#125;\n- **&#123;&#123; .cloudInfo &#125;&#125;**\n  &#123;&#123;- if .cloudHeight &#125;&#125;，\</span></span><br><span class="line"><span class="string">      云高: &#123;&#123; .cloudHeight &#125;&#125; 米&#123;&#123; end &#125;&#125;\n  &#123;&#123;- if .cloudForm &#125;&#125;，云状: &#123;&#123; .cloudForm\</span></span><br><span class="line"><span class="string">      \ &#125;&#125;&#123;&#123; end &#125;&#125;\n&#123;&#123;- end &#125;&#125;\n&#123;&#123;- end &#125;&#125;\n&#123;&#123;- end &#125;&#125;\n&#123;&#123;- end &#125;&#125;\n\n### 跑道视程\n\</span></span><br><span class="line"><span class="string">      &#123;&#123;- if .result.rwysight &#125;&#125;\n- **跑道视程**: &#123;&#123; .result.rwysight &#125;&#125; 米\n&#123;&#123;- if .result.rwysightchange\</span></span><br><span class="line"><span class="string">      \ &#125;&#125;\n  - **变化趋势**: &#123;&#123; .result.rwysightchange &#125;&#125;\n&#123;&#123;- end &#125;&#125;\n&#123;&#123;- else &#125;&#125;\n\</span></span><br><span class="line"><span class="string">      - **跑道视程**: 无数据\n&#123;&#123;- end &#125;&#125;\n\n### 天气现象\n&#123;&#123;- if .result.weatherInfoValue &#125;&#125;\n\</span></span><br><span class="line"><span class="string">      &#123;&#123;- range .result.weatherInfoValue &#125;&#125;\n&#123;&#123;- if . &#125;&#125;\n- **天气现象**: &#123;&#123; . &#125;&#125;\n&#123;&#123;-\</span></span><br><span class="line"><span class="string">      \ end &#125;&#125;\n&#123;&#123;- end &#125;&#125;\n&#123;&#123;- end &#125;&#125;\n\n### 预警信息\n&#123;&#123;- if .result.warning &#125;&#125;\n&#123;&#123;-\</span></span><br><span class="line"><span class="string">      \ range .result.warning &#125;&#125;\n&#123;&#123;- if eq .type \&quot;windspeed\&quot; &#125;&#125;\n- **风速预警**: 黄色\</span></span><br><span class="line"><span class="string">      阈值 &#123;&#123; .yellow &#125;&#125; m/s，红色阈值 &#123;&#123; .red &#125;&#125; m/s\n&#123;&#123;- else if eq .type \&quot;RVR\&quot; &#125;&#125;\n\</span></span><br><span class="line"><span class="string">      - **跑道视程预警**: 黄色阈值 &#123;&#123; .yellow &#125;&#125; 米，红色阈值 &#123;&#123; .red &#125;&#125; 米\n&#123;&#123;- else &#125;&#125;\n- **&#123;&#123; .type\</span></span><br><span class="line"><span class="string">      \ &#125;&#125;预警**: 黄色阈值 &#123;&#123; .yellow &#125;&#125;，红色阈值 &#123;&#123; .red &#125;&#125;\n&#123;&#123;- end &#125;&#125;\n&#123;&#123;- end &#125;&#125;\n&#123;&#123;- else\</span></span><br><span class="line"><span class="string">      \ &#125;&#125;\n&gt; 无预警信息\n&#123;&#123;- end &#125;&#125;\n\n### 原始报文\n```\n&#123;&#123; .result.rptcontent &#125;&#125;\n```\n\n\</span></span><br><span class="line"><span class="string">      ---\n&#123;&#123;- else &#125;&#125;\n## 请求失败\n- **状态码**: &#123;&#123;.status&#125;&#125;\n- **错误信息**: &#123;&#123;.message&#125;&#125;\n\</span></span><br><span class="line"><span class="string">      &#123;&#123;- end &#125;&#125;&quot;</span></span><br></pre></td></tr></table></figure>
<p>新配置的功能是获取9小时或者24小时天气数据，url是<a href="http://172.31.70.156:8080/production-service/app/production/weather/getWeatherPrediction，是POST请求，入参有airportCode，是机场三字码，timeInterval，天气类型（FC">http://172.31.70.156:8080/production-service/app/production/weather/getWeatherPrediction，是POST请求，入参有airportCode，是机场三字码，timeInterval，天气类型（FC</a> 9小时； FT 24小时），入参json是这样的：{“entity”: {“airportCode”: “URC”, “timeInterval”: “FT”}}。返回的结果是这样的：</p>
<p>{<br>  “status”: “200”,<br>  “message”: null,<br>  “result”: {<br>    “visibilityColor”: 0,<br>    “avgWindColor”: 0,<br>    “tempColor”: 0,<br>    “lowTempColor”: 0,<br>    “highTempColor”: 0,<br>    “visibilityColorAlertValue”: null,<br>    “avgWindColorAlertValue”: null,<br>    “tempColorAlertValue”: null,<br>    “winddirectionAlertValue”: null,<br>    “phenomenonDescribe”: “无数据”,<br>    “cloudDescribe”: “无重要云”,<br>    “temperatureMap”: {<br>      “min”: “11-06 02时,最低温度为01℃”,<br>      “max”: “11-04 20时,最高温度为09℃”<br>    },<br>    “changeInfoMap”: {<br>      “becmgInfo”: [<br>        “2025-11-04 21时到04日22时  <br/>预期变化： 风向:180 风速:03 “,<br>        “2025-11-05 07时到05日08时  <br/>预期变化： 风向:340 风速:04 最大风速:09 能见度:2500 小雨 多云 阴天 “,<br>        “2025-11-05 12时到05日13时  <br/>预期变化： 小雨加雪 “,<br>        “2025-11-05 16时到05日17时  <br/>预期变化： 小雪 “,<br>        “2025-11-05 17时到05日18时  <br/>预期变化： 能见度:0800 雪 多云 阴天 “<br>      ]<br>    },<br>    “warning”: [<br>      {<br>        “wid”: 1,<br>        “yellow”: “8”,<br>        “red”: “14”,<br>        “type”: “windspeed”,<br>        “airportCode”: “URC”<br>      },<br>      {<br>        “wid”: 2,<br>        “yellow”: “800”,<br>        “red”: “550”,<br>        “type”: “RVR”,<br>        “airportCode”: “URC”<br>      }<br>    ],<br>    “yellowSpeed”: null,<br>    “redSpeed”: null,<br>    “yellowRVR”: null,<br>    “redRVR”: null,<br>    “maxwindspeedcolor”: null,<br>    “windspeedcolor”: “white”,<br>    “temperatureMax”: null,<br>    “temperatureMin”: null,<br>    “cloudPic”: null,<br>    “weatherinfo”: null,<br>    “cloudinfo”: “NSC”,<br>    “cavok”: null,<br>    “otime”: “0902”,<br>    “odate”: “20251104”,<br>    “becmginfo”: “BECMG 0413/0414 18003MPS&amp;BECMG 0423/0424 34004G09MPS 2500 -RA BKN006 OVC020&amp;BECMG 0504/0505 -RASN&amp;BECMG 0508/0509 -SN&amp;BECMG 0509/0510 0800 SN BKN002 OVC011”,<br>    “tempoinfo”: null,<br>    “rptcontent”: “TAF ZWWW 040902Z 0412/0518 36003MPS 6000 NSC TX09/0412Z TN06/0423Z TN01/0518Z BECMG 0413/0414 18003MPS BECMG 0423/0424 34004G09MPS 2500 -RA BKN006 OVC020 BECMG 0504/0505 -RASN BECMG 0508/0509 -SN BECMG 0509/0510 0800 SN BKN002 OVC011= “,<br>    “verticalvisibility”: null,<br>    “winddirection”: “360”,<br>    “inserttime”: “2025-11-04 09:10:05”,<br>    “reftime”: “2025-11-04 17:02:00”,<br>    “vtime”: “(有效期:2025-11-04 20:00:00\t\t2025-11-06 02:00:00)”,<br>    “maxwindspeed”: null,<br>    “windspeed”: “3”,<br>    “receivetime”: “2025-11-04 09:10:04”,<br>    “temperature”: “ TX09/0412Z TN06/0423Z TN01/0518Z”,<br>    “cloudcount”: “1”,<br>    “cccc”: “ZWWW”,<br>    “skcflag”: null,<br>    “nscflag”: “1”,<br>    “becmgcount”: “5”,<br>    “tempocount”: null,<br>    “fmcount”: null,<br>    “fminfo”: null,<br>    “probcount”: null,<br>    “probinfo”: null,<br>    “rptstate”: 0,<br>    “reportid”: “c20251104091201373TXT0028001”,<br>    “tt”: “FT”,<br>    “aa”: “CI”,<br>    “kk”: “39”,<br>    “headdate”: “20251104”,<br>    “headtime”: “0902”,<br>    “bbb”: null,<br>    “obcc”: “ZWWW”,<br>    “forecastperiod”: “2025110412/2025110518”,<br>    “levelvisibility”: “6000”,<br>    “nswflag”: null,<br>    “weathercount”: null<br>  },<br>  “callback”: null<br>}</p>
<p>相关的代码是这样的：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">package com.xjcares.common.dto.weather;</span><br><span class="line"></span><br><span class="line">import com.xjcares.common.vo.security.WeatherColorVo;</span><br><span class="line">import io.swagger.annotations.ApiModelProperty;</span><br><span class="line"></span><br><span class="line">import java.util.List;</span><br><span class="line">import java.util.Map;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 获取天气预报(timeInterval  FC 9小时 FT 24小时)</span><br><span class="line"> * 表ele01_fcft字段</span><br><span class="line"> *</span><br><span class="line"> * @author root</span><br><span class="line"> */</span><br><span class="line">public class WeatherPrediction extends WeatherColorVo &#123;</span><br><span class="line">    /**</span><br><span class="line">     * 公报id</span><br><span class="line">     */</span><br><span class="line">    @ApiModelProperty(value = &quot;公报id&quot;)</span><br><span class="line">    private String REPORTID;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 发布中心代码</span><br><span class="line">     */</span><br><span class="line">    @ApiModelProperty(value = &quot;发布中心代码&quot;)</span><br><span class="line">    private String CCCC;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 收到时间</span><br><span class="line">     */</span><br><span class="line">    @ApiModelProperty(value = &quot;收到时间&quot;)</span><br><span class="line">    private String RECEIVETIME;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 入库时间</span><br><span class="line">     */</span><br><span class="line">    @ApiModelProperty(value = &quot;入库时间&quot;)</span><br><span class="line">    private String INSERTTIME;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 公报报类</span><br><span class="line">     */</span><br><span class="line">    @ApiModelProperty(value = &quot;公报报类&quot;)</span><br><span class="line">    private String TT;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 国家代码</span><br><span class="line">     */</span><br><span class="line">    @ApiModelProperty(value = &quot;国家代码&quot;)</span><br><span class="line">    private String AA;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 区域标识码</span><br><span class="line">     */</span><br><span class="line">    @ApiModelProperty(value = &quot;区域标识码&quot;)</span><br><span class="line">    private String KK;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 转发报日期</span><br><span class="line">     */</span><br><span class="line">    @ApiModelProperty(value = &quot;转发报日期&quot;)</span><br><span class="line">    private String HEADDATE;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 转发报时间</span><br><span class="line">     */</span><br><span class="line">    @ApiModelProperty(value = &quot;转发报时间&quot;)</span><br><span class="line">    private String HEADTIME;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 修订更正标识码</span><br><span class="line">     */</span><br><span class="line">    @ApiModelProperty(value = &quot;修订更正标识码&quot;)</span><br><span class="line">    private String BBB;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 航站码</span><br><span class="line">     */</span><br><span class="line">    private String OBCC;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 资料采集的年月日，报文首行</span><br><span class="line">     */</span><br><span class="line">    private String ODATE;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 资料采集的时分，来字报文首行</span><br><span class="line">     */</span><br><span class="line">    private String OTIME;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 预报时段</span><br><span class="line">     */</span><br><span class="line">    private String FORECASTPERIOD;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 风向</span><br><span class="line">     */</span><br><span class="line">    private String WINDDIRECTION;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 风速</span><br><span class="line">     */</span><br><span class="line">    private String WINDSPEED;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 最大风速，没有值不显示</span><br><span class="line">     */</span><br><span class="line">    private String MAXWINDSPEED;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 无CAVOK 为0，有CAVOK 为1</span><br><span class="line">     */</span><br><span class="line">    private String CAVOK;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 水平能见度</span><br><span class="line">     */</span><br><span class="line">    private String LEVELVISIBILITY;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 无重要天气无NSW 为0，有NSW 为1</span><br><span class="line">     */</span><br><span class="line">    private String NSWFLAG;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 重要天气现象组数</span><br><span class="line">     */</span><br><span class="line">    private String WEATHERCOUNT;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 重要天气现象</span><br><span class="line">     */</span><br><span class="line">    private String WEATHERINFO;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 碧空（无SKC 为0，有SKC 为1）</span><br><span class="line">     */</span><br><span class="line">    private String SKCFLAG;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 无重要云（无NSC 为0，有NSC 为1）</span><br><span class="line">     */</span><br><span class="line">    private String NSCFLAG;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 云要素数目i，与CloudInfo 有关</span><br><span class="line">     */</span><br><span class="line">    private String CLOUDCOUNT;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 云要素</span><br><span class="line">     */</span><br><span class="line">    private String CLOUDINFO;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * VVnnn 中的nnn ，垂直能见度（VV///记-1）</span><br><span class="line">     */</span><br><span class="line">    private String VERTICALVISIBILITY;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 温度要素（按实际报文存放）TX32/20 TN20/11Z 或T32/02 T26/10</span><br><span class="line">     */</span><br><span class="line">    private String TEMPERATURE;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * BECMG 变化组天气数目i，与BECMGInfo 有关</span><br><span class="line">     */</span><br><span class="line">    private String BECMGCOUNT;</span><br><span class="line">    /**</span><br><span class="line">     * BECMG 变化组之间以“&amp;”分割，变化组内部要素以“:” 分割，缺字段填空格如：时段1:风1:能见度1:天气1:云1&amp;...&amp;时段i:风i ): 天气i:云i，i 为变化组要素个数，由BECMGCount 描述</span><br><span class="line">     */</span><br><span class="line">    private String BECMGINFO;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * TEMPO 变化组天气数目i，与TEMPOInfo 有关</span><br><span class="line">     */</span><br><span class="line">    private String TEMPOCOUNT;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * TEMPO 变化组之间以“&amp;”分割。不分解，存原文</span><br><span class="line">     */</span><br><span class="line">    private String TEMPOINFO;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * FM 变化组天气数目i，与FMInfo 有关</span><br><span class="line">     */</span><br><span class="line">    private String FMCOUNT;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * FM 变化组之间以“&amp;”分割。不分解，存原文</span><br><span class="line">     */</span><br><span class="line">    private String FMINFO;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * PROB 变化组天气数目i ，与PROBInfo 有关</span><br><span class="line">     */</span><br><span class="line">    private String PROBCOUNT;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * PROB 变化组之间以“&amp;”分割。不分解，存原文</span><br><span class="line">     */</span><br><span class="line">    private String PROBINFO;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 资料参照时间取自报告表对应记录的RefTime</span><br><span class="line">     */</span><br><span class="line">    @ApiModelProperty(value = &quot;发布时间&quot;)</span><br><span class="line">    private String REFTIME;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 表rpt01_cac 私有字段 有效时间</span><br><span class="line">     */</span><br><span class="line">    @ApiModelProperty(value = &quot;有效时间&quot;)</span><br><span class="line">    private String VTIME;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 报告内容</span><br><span class="line">     */</span><br><span class="line">    @ApiModelProperty(value = &quot;报告内容，一长串内容&quot;)</span><br><span class="line">    private String RPTCONTENT;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 状态标示</span><br><span class="line">     */</span><br><span class="line">    @ApiModelProperty(value = &quot;状态标示&quot;)</span><br><span class="line">    private double RPTSTATE;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 用于包装天气现象描述信息</span><br><span class="line">     * 天气</span><br><span class="line">     */</span><br><span class="line">    private String phenomenonDescribe;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 云信息</span><br><span class="line">     */</span><br><span class="line">    private String cloudDescribe;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 最低最高温度信息</span><br><span class="line">     */</span><br><span class="line">    private Map&lt;String, String&gt; temperatureMap;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 天气变化信息</span><br><span class="line">     */</span><br><span class="line">    private Map&lt;String, String[]&gt; changeInfoMap;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 预警值   (包装查询机场得所有预警值)</span><br><span class="line">     */</span><br><span class="line">    private List&lt;WeatherWarning&gt; warning;</span><br><span class="line"></span><br><span class="line">    //---------------------------------------------------------设置前台使用值---------------------------------------------</span><br><span class="line">    private Integer yellowSpeed;</span><br><span class="line">    private Integer redSpeed;</span><br><span class="line">    private Integer yellowRVR;</span><br><span class="line">    private Integer redRVR;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 最大风速背景色 orange；reed; white</span><br><span class="line">     */</span><br><span class="line">    private String maxwindspeedcolor;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 风速背景色 orange；reed; white</span><br><span class="line">     */</span><br><span class="line">    private String windspeedcolor;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 最高温度</span><br><span class="line">     */</span><br><span class="line">    private String temperatureMax;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 最低温度</span><br><span class="line">     */</span><br><span class="line">    private String temperatureMin;</span><br><span class="line">    /**</span><br><span class="line">     * 天气图标值</span><br><span class="line">     */</span><br><span class="line">    private String cloudPic;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    public String getCloudPic() &#123;</span><br><span class="line">        return cloudPic;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setCloudPic(String cloudPic) &#123;</span><br><span class="line">        this.cloudPic = cloudPic;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getTemperatureMax() &#123;</span><br><span class="line">        return temperatureMax;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setTemperatureMax(String temperatureMax) &#123;</span><br><span class="line">        this.temperatureMax = temperatureMax;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getTemperatureMin() &#123;</span><br><span class="line">        return temperatureMin;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setTemperatureMin(String temperatureMin) &#123;</span><br><span class="line">        this.temperatureMin = temperatureMin;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getWindspeedcolor() &#123;</span><br><span class="line">        return windspeedcolor;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setWindspeedcolor(String windspeedcolor) &#123;</span><br><span class="line">        this.windspeedcolor = windspeedcolor;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getMaxwindspeedcolor() &#123;</span><br><span class="line">        return maxwindspeedcolor;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setMaxwindspeedcolor(String maxwindspeedcolor) &#123;</span><br><span class="line">        this.maxwindspeedcolor = maxwindspeedcolor;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public Integer getYellowSpeed() &#123;</span><br><span class="line">        return yellowSpeed;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setYellowSpeed(Integer yellowSpeed) &#123;</span><br><span class="line">        this.yellowSpeed = yellowSpeed;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public Integer getRedSpeed() &#123;</span><br><span class="line">        return redSpeed;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setRedSpeed(Integer redSpeed) &#123;</span><br><span class="line">        this.redSpeed = redSpeed;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public Integer getYellowRVR() &#123;</span><br><span class="line">        return yellowRVR;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setYellowRVR(Integer yellowRVR) &#123;</span><br><span class="line">        this.yellowRVR = yellowRVR;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public Integer getRedRVR() &#123;</span><br><span class="line">        return redRVR;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setRedRVR(Integer redRVR) &#123;</span><br><span class="line">        this.redRVR = redRVR;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public Map&lt;String, String[]&gt; getChangeInfoMap() &#123;</span><br><span class="line">        return changeInfoMap;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setChangeInfoMap(Map&lt;String, String[]&gt; changeInfoMap) &#123;</span><br><span class="line">        this.changeInfoMap = changeInfoMap;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public Map&lt;String, String&gt; getTemperatureMap() &#123;</span><br><span class="line">        return temperatureMap;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setTemperatureMap(Map&lt;String, String&gt; temperatureMap) &#123;</span><br><span class="line">        this.temperatureMap = temperatureMap;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getPhenomenonDescribe() &#123;</span><br><span class="line">        return phenomenonDescribe;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setPhenomenonDescribe(String phenomenonDescribe) &#123;</span><br><span class="line">        this.phenomenonDescribe = phenomenonDescribe;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getCloudDescribe() &#123;</span><br><span class="line">        return cloudDescribe;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setCloudDescribe(String cloudDescribe) &#123;</span><br><span class="line">        this.cloudDescribe = cloudDescribe;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getREPORTID() &#123;</span><br><span class="line">        return REPORTID;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setREPORTID(String REPORTID) &#123;</span><br><span class="line">        this.REPORTID = REPORTID;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getCCCC() &#123;</span><br><span class="line">        return CCCC;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setCCCC(String CCCC) &#123;</span><br><span class="line">        this.CCCC = CCCC;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getRECEIVETIME() &#123;</span><br><span class="line">        return RECEIVETIME;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setRECEIVETIME(String RECEIVETIME) &#123;</span><br><span class="line">        this.RECEIVETIME = RECEIVETIME;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getINSERTTIME() &#123;</span><br><span class="line">        return INSERTTIME;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setINSERTTIME(String INSERTTIME) &#123;</span><br><span class="line">        this.INSERTTIME = INSERTTIME;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getTT() &#123;</span><br><span class="line">        return TT;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setTT(String TT) &#123;</span><br><span class="line">        this.TT = TT;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getAA() &#123;</span><br><span class="line">        return AA;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setAA(String AA) &#123;</span><br><span class="line">        this.AA = AA;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getKK() &#123;</span><br><span class="line">        return KK;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setKK(String KK) &#123;</span><br><span class="line">        this.KK = KK;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getHEADDATE() &#123;</span><br><span class="line">        return HEADDATE;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setHEADDATE(String HEADDATE) &#123;</span><br><span class="line">        this.HEADDATE = HEADDATE;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getHEADTIME() &#123;</span><br><span class="line">        return HEADTIME;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setHEADTIME(String HEADTIME) &#123;</span><br><span class="line">        this.HEADTIME = HEADTIME;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getBBB() &#123;</span><br><span class="line">        return BBB;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setBBB(String BBB) &#123;</span><br><span class="line">        this.BBB = BBB;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getOBCC() &#123;</span><br><span class="line">        return OBCC;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setOBCC(String OBCC) &#123;</span><br><span class="line">        this.OBCC = OBCC;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getODATE() &#123;</span><br><span class="line">        return ODATE;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setODATE(String ODATE) &#123;</span><br><span class="line">        this.ODATE = ODATE;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getOTIME() &#123;</span><br><span class="line">        return OTIME;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setOTIME(String OTIME) &#123;</span><br><span class="line">        this.OTIME = OTIME;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getFORECASTPERIOD() &#123;</span><br><span class="line">        return FORECASTPERIOD;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setFORECASTPERIOD(String FORECASTPERIOD) &#123;</span><br><span class="line">        this.FORECASTPERIOD = FORECASTPERIOD;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getWINDDIRECTION() &#123;</span><br><span class="line">        return WINDDIRECTION;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setWINDDIRECTION(String WINDDIRECTION) &#123;</span><br><span class="line">        this.WINDDIRECTION = WINDDIRECTION;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getWINDSPEED() &#123;</span><br><span class="line">        return WINDSPEED;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setWINDSPEED(String WINDSPEED) &#123;</span><br><span class="line">        this.WINDSPEED = WINDSPEED;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getMAXWINDSPEED() &#123;</span><br><span class="line">        return MAXWINDSPEED;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setMAXWINDSPEED(String MAXWINDSPEED) &#123;</span><br><span class="line">        this.MAXWINDSPEED = MAXWINDSPEED;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getCAVOK() &#123;</span><br><span class="line">        return CAVOK;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setCAVOK(String CAVOK) &#123;</span><br><span class="line">        this.CAVOK = CAVOK;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getLEVELVISIBILITY() &#123;</span><br><span class="line">        return LEVELVISIBILITY;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setLEVELVISIBILITY(String LEVELVISIBILITY) &#123;</span><br><span class="line">        this.LEVELVISIBILITY = LEVELVISIBILITY;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getNSWFLAG() &#123;</span><br><span class="line">        return NSWFLAG;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setNSWFLAG(String NSWFLAG) &#123;</span><br><span class="line">        this.NSWFLAG = NSWFLAG;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getWEATHERCOUNT() &#123;</span><br><span class="line">        return WEATHERCOUNT;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setWEATHERCOUNT(String WEATHERCOUNT) &#123;</span><br><span class="line">        this.WEATHERCOUNT = WEATHERCOUNT;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getWEATHERINFO() &#123;</span><br><span class="line">        return WEATHERINFO;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setWEATHERINFO(String WEATHERINFO) &#123;</span><br><span class="line">        this.WEATHERINFO = WEATHERINFO;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getSKCFLAG() &#123;</span><br><span class="line">        return SKCFLAG;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setSKCFLAG(String SKCFLAG) &#123;</span><br><span class="line">        this.SKCFLAG = SKCFLAG;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getNSCFLAG() &#123;</span><br><span class="line">        return NSCFLAG;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setNSCFLAG(String NSCFLAG) &#123;</span><br><span class="line">        this.NSCFLAG = NSCFLAG;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getCLOUDCOUNT() &#123;</span><br><span class="line">        return CLOUDCOUNT;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setCLOUDCOUNT(String CLOUDCOUNT) &#123;</span><br><span class="line">        this.CLOUDCOUNT = CLOUDCOUNT;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getCLOUDINFO() &#123;</span><br><span class="line">        return CLOUDINFO;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setCLOUDINFO(String CLOUDINFO) &#123;</span><br><span class="line">        this.CLOUDINFO = CLOUDINFO;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getVERTICALVISIBILITY() &#123;</span><br><span class="line">        return VERTICALVISIBILITY;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setVERTICALVISIBILITY(String VERTICALVISIBILITY) &#123;</span><br><span class="line">        this.VERTICALVISIBILITY = VERTICALVISIBILITY;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getTEMPERATURE() &#123;</span><br><span class="line">        return TEMPERATURE;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setTEMPERATURE(String TEMPERATURE) &#123;</span><br><span class="line">        this.TEMPERATURE = TEMPERATURE;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getBECMGCOUNT() &#123;</span><br><span class="line">        return BECMGCOUNT;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setBECMGCOUNT(String BECMGCOUNT) &#123;</span><br><span class="line">        this.BECMGCOUNT = BECMGCOUNT;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getBECMGINFO() &#123;</span><br><span class="line">        return BECMGINFO;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setBECMGINFO(String BECMGINFO) &#123;</span><br><span class="line">        this.BECMGINFO = BECMGINFO;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getTEMPOCOUNT() &#123;</span><br><span class="line">        return TEMPOCOUNT;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setTEMPOCOUNT(String TEMPOCOUNT) &#123;</span><br><span class="line">        this.TEMPOCOUNT = TEMPOCOUNT;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getTEMPOINFO() &#123;</span><br><span class="line">        return TEMPOINFO;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setTEMPOINFO(String TEMPOINFO) &#123;</span><br><span class="line">        this.TEMPOINFO = TEMPOINFO;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getFMCOUNT() &#123;</span><br><span class="line">        return FMCOUNT;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setFMCOUNT(String FMCOUNT) &#123;</span><br><span class="line">        this.FMCOUNT = FMCOUNT;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getFMINFO() &#123;</span><br><span class="line">        return FMINFO;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setFMINFO(String FMINFO) &#123;</span><br><span class="line">        this.FMINFO = FMINFO;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getPROBCOUNT() &#123;</span><br><span class="line">        return PROBCOUNT;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setPROBCOUNT(String PROBCOUNT) &#123;</span><br><span class="line">        this.PROBCOUNT = PROBCOUNT;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getPROBINFO() &#123;</span><br><span class="line">        return PROBINFO;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setPROBINFO(String PROBINFO) &#123;</span><br><span class="line">        this.PROBINFO = PROBINFO;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getREFTIME() &#123;</span><br><span class="line">        return REFTIME;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setREFTIME(String REFTIME) &#123;</span><br><span class="line">        this.REFTIME = REFTIME;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getVTIME() &#123;</span><br><span class="line">        return VTIME;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setVTIME(String VTIME) &#123;</span><br><span class="line">        this.VTIME = VTIME;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getRPTCONTENT() &#123;</span><br><span class="line">        return RPTCONTENT;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setRPTCONTENT(String RPTCONTENT) &#123;</span><br><span class="line">        this.RPTCONTENT = RPTCONTENT;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public double getRPTSTATE() &#123;</span><br><span class="line">        return RPTSTATE;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setRPTSTATE(double RPTSTATE) &#123;</span><br><span class="line">        this.RPTSTATE = RPTSTATE;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public List&lt;WeatherWarning&gt; getWarning() &#123;</span><br><span class="line">        return warning;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setWarning(List&lt;WeatherWarning&gt; warning) &#123;</span><br><span class="line">        this.warning = warning;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">package com.xjcares.common.vo.security;</span><br><span class="line"></span><br><span class="line">import lombok.Data;</span><br><span class="line"></span><br><span class="line">import javax.persistence.Transient;</span><br><span class="line">import java.util.List;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 能见度和温度的颜色</span><br><span class="line"> */</span><br><span class="line">@Data</span><br><span class="line">public class WeatherColorVo &#123;</span><br><span class="line">    @Transient</span><br><span class="line">    private int visibilityColor;</span><br><span class="line">    @Transient</span><br><span class="line">    private int avgWindColor;</span><br><span class="line">    /**</span><br><span class="line">     * 小时报中的温度警报  0正常 1橙色</span><br><span class="line">     */</span><br><span class="line">    @Transient</span><br><span class="line">    private int tempColor;</span><br><span class="line">    /**</span><br><span class="line">     * 九小时天气中 的低温预警 0正常 1橙色</span><br><span class="line">     */</span><br><span class="line">    @Transient</span><br><span class="line">    private int lowTempColor;</span><br><span class="line">    /**</span><br><span class="line">     * 九小时天气中 的高温预警 0正常 1橙色</span><br><span class="line">     */</span><br><span class="line">    @Transient</span><br><span class="line">    private int highTempColor;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 小时报中的能见度警报颜色对应区间</span><br><span class="line">     */</span><br><span class="line">    @Transient</span><br><span class="line">    private WeatherColorAlertValue visibilityColorAlertValue;</span><br><span class="line">    /**</span><br><span class="line">     * 小时报中的平均风速警报颜色对应区间</span><br><span class="line">     */</span><br><span class="line">    @Transient</span><br><span class="line">    private WeatherColorAlertValue avgWindColorAlertValue;</span><br><span class="line">    /**</span><br><span class="line">     * 小时报中的温度警报颜色对应区间</span><br><span class="line">     */</span><br><span class="line">    @Transient</span><br><span class="line">    private WeatherColorAlertValue tempColorAlertValue;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 风向风速悬浮窗提示</span><br><span class="line">     */</span><br><span class="line">    @Transient</span><br><span class="line">    private WeatherColorAlertValue winddirectionAlertValue;</span><br><span class="line"></span><br><span class="line">    @Data</span><br><span class="line">    public static class WeatherColorAlertValue&#123;</span><br><span class="line">        /**</span><br><span class="line">         * 数值区间</span><br><span class="line">         */</span><br><span class="line">        private String alertValue;</span><br><span class="line"></span><br><span class="line">        /**</span><br><span class="line">         * 区间对应颜色</span><br><span class="line">         */</span><br><span class="line">        private String color;</span><br><span class="line"></span><br><span class="line">        /**</span><br><span class="line">         * 区间对应颜色对应的数字</span><br><span class="line">         */</span><br><span class="line">        private Integer colorId;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public enum TempColorEnum &#123;</span><br><span class="line"></span><br><span class="line">        NORMAL(0,&quot;普通&quot;),</span><br><span class="line">        ORANGE(1,&quot;橙色&quot;);</span><br><span class="line">        /**</span><br><span class="line">         * 颜色id</span><br><span class="line">         */</span><br><span class="line">        private Integer id;</span><br><span class="line">        /**</span><br><span class="line">         * 颜色名称</span><br><span class="line">         */</span><br><span class="line">        private String color;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        TempColorEnum(Integer id, String color) &#123;</span><br><span class="line">            this.id = id;</span><br><span class="line">            this.color = color;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public Integer getId() &#123;</span><br><span class="line">            return id;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public String getColor() &#123;</span><br><span class="line">            return color;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 通用颜色枚举类  1-蓝色 2-黄色 3-橙色 4-红色 5-E类</span><br><span class="line">     */</span><br><span class="line">    public enum CommonColorEnum &#123;</span><br><span class="line"></span><br><span class="line">        BLUE(1,&quot;蓝色&quot;),</span><br><span class="line">        YELLOW(2,&quot;黄色&quot;),</span><br><span class="line">        ORANGE(3,&quot;橙色&quot;),</span><br><span class="line">        RED(4,&quot;红色&quot;),</span><br><span class="line">        E_COLOR(5,&quot;E类&quot;);</span><br><span class="line">        /**</span><br><span class="line">         * 颜色id</span><br><span class="line">         */</span><br><span class="line">        private Integer id;</span><br><span class="line">        /**</span><br><span class="line">         * 颜色名称</span><br><span class="line">         */</span><br><span class="line">        private String color;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        CommonColorEnum(Integer id, String color) &#123;</span><br><span class="line">            this.id = id;</span><br><span class="line">            this.color = color;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public Integer getId() &#123;</span><br><span class="line">            return id;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public String getColor() &#123;</span><br><span class="line">            return color;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public static CommonColorEnum getById(int type) &#123;</span><br><span class="line">            for (CommonColorEnum e : CommonColorEnum.values()) &#123;</span><br><span class="line">                if (type == e.getId()) &#123;</span><br><span class="line">                    return e;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            return BLUE;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>结束</p>
]]></content>
      <categories>
        <category>计算机</category>
      </categories>
  </entry>
  <entry>
    <title>新k8s的nacos部署</title>
    <url>/2025/11/19/%E8%AE%A1%E7%AE%97%E6%9C%BA/%E6%96%B0k8s%E7%9A%84nacos%E9%83%A8%E7%BD%B2/</url>
    <content><![CDATA[<h1 id="新k8s的nacos部署"><a href="#新k8s的nacos部署" class="headerlink" title="新k8s的nacos部署"></a>新k8s的nacos部署</h1><h2 id="部署文件"><a href="#部署文件" class="headerlink" title="部署文件"></a>部署文件</h2><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment"># Namespace</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Namespace</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nacos</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment"># Secret for sensitive data</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Secret</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nacos-secret</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">nacos</span></span><br><span class="line"><span class="attr">type:</span> <span class="string">Opaque</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">mysql.password:</span> <span class="string">&quot;WGpreUBkYl8yMQ==&quot;</span></span><br><span class="line">  <span class="attr">auth.token:</span> <span class="string">&quot;U2VjcmV0S2V5MDkyMzQ1Njc4OTAxMjM0NTY3ODkwMTIzNDU2Nzg5MDEyMzQ1Njc4OTAxMjM0NTY3ODk=&quot;</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment"># ConfigMap for non-sensitive configuration</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nacos-cm</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">nacos</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">mysql.host:</span> <span class="string">&quot;172.31.11.21&quot;</span></span><br><span class="line">  <span class="attr">mysql.db.name:</span> <span class="string">&quot;nacos243&quot;</span></span><br><span class="line">  <span class="attr">mysql.port:</span> <span class="string">&quot;3306&quot;</span></span><br><span class="line">  <span class="attr">mysql.user:</span> <span class="string">&quot;root&quot;</span></span><br><span class="line">  <span class="attr">nacos.replicas:</span> <span class="string">&quot;3&quot;</span></span><br><span class="line">  <span class="attr">nacos.server.port:</span> <span class="string">&quot;8848&quot;</span></span><br><span class="line">  <span class="attr">nacos.application.port:</span> <span class="string">&quot;8848&quot;</span></span><br><span class="line">  <span class="attr">prefer.host.mode:</span> <span class="string">&quot;hostname&quot;</span></span><br><span class="line">  <span class="attr">service.name:</span> <span class="string">&quot;nacos-headless&quot;</span></span><br><span class="line">  <span class="attr">domain.name:</span> <span class="string">&quot;cluster.local&quot;</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment"># Headless Service for internal cluster communication</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nacos-headless</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">nacos</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">nacos</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">publishNotReadyAddresses:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">port:</span> <span class="number">8848</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">server</span></span><br><span class="line">      <span class="attr">targetPort:</span> <span class="number">8848</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">port:</span> <span class="number">9848</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">client-rpc</span></span><br><span class="line">      <span class="attr">targetPort:</span> <span class="number">9848</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">port:</span> <span class="number">9849</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">raft-rpc</span></span><br><span class="line">      <span class="attr">targetPort:</span> <span class="number">9849</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">port:</span> <span class="number">7848</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">old-raft-rpc</span></span><br><span class="line">      <span class="attr">targetPort:</span> <span class="number">7848</span></span><br><span class="line">  <span class="attr">clusterIP:</span> <span class="string">None</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">nacos</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment"># External Service for external access (NodePort)</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nacos-external</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">nacos</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">nacos</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">NodePort</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">port:</span> <span class="number">8848</span></span><br><span class="line">      <span class="attr">targetPort:</span> <span class="number">8848</span></span><br><span class="line">      <span class="attr">nodePort:</span> <span class="number">31848</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">console</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">port:</span> <span class="number">9848</span></span><br><span class="line">      <span class="attr">targetPort:</span> <span class="number">9848</span></span><br><span class="line">      <span class="attr">nodePort:</span> <span class="number">31849</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">client-rpc</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">port:</span> <span class="number">9849</span></span><br><span class="line">      <span class="attr">targetPort:</span> <span class="number">9849</span></span><br><span class="line">      <span class="attr">nodePort:</span> <span class="number">31850</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">server-rpc</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">port:</span> <span class="number">7848</span></span><br><span class="line">      <span class="attr">targetPort:</span> <span class="number">7848</span></span><br><span class="line">      <span class="attr">nodePort:</span> <span class="number">31851</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">old-raft-rpc</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">nacos</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment"># StatefulSet for Nacos cluster</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">StatefulSet</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nacos</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">nacos</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">podManagementPolicy:</span> <span class="string">Parallel</span></span><br><span class="line">  <span class="attr">serviceName:</span> <span class="string">nacos-headless</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">3</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">nacos</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">nacos</span></span><br><span class="line">      <span class="attr">annotations:</span></span><br><span class="line">        <span class="attr">pod.alpha.kubernetes.io/initialized:</span> <span class="string">&quot;true&quot;</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">affinity:</span></span><br><span class="line">        <span class="attr">podAntiAffinity:</span></span><br><span class="line">          <span class="attr">requiredDuringSchedulingIgnoredDuringExecution:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">labelSelector:</span></span><br><span class="line">                <span class="attr">matchExpressions:</span></span><br><span class="line">                  <span class="bullet">-</span> <span class="attr">key:</span> <span class="string">&quot;app&quot;</span></span><br><span class="line">                    <span class="attr">operator:</span> <span class="string">In</span></span><br><span class="line">                    <span class="attr">values:</span></span><br><span class="line">                      <span class="bullet">-</span> <span class="string">nacos</span></span><br><span class="line">              <span class="attr">topologyKey:</span> <span class="string">&quot;kubernetes.io/hostname&quot;</span></span><br><span class="line">      <span class="attr">initContainers:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">peer-finder-plugin-install</span></span><br><span class="line">          <span class="attr">image:</span> <span class="number">172.31</span><span class="number">.10</span><span class="number">.118</span><span class="string">/nacos/nacos-peer-finder-plugin:1.1</span></span><br><span class="line">          <span class="attr">imagePullPolicy:</span> <span class="string">Always</span></span><br><span class="line">          <span class="attr">volumeMounts:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">data</span></span><br><span class="line">              <span class="attr">mountPath:</span> <span class="string">/home/nacos/plugins/peer-finder</span></span><br><span class="line">              <span class="attr">subPath:</span> <span class="string">peer-finder</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nacos</span></span><br><span class="line">          <span class="attr">image:</span> <span class="number">172.31</span><span class="number">.10</span><span class="number">.118</span><span class="string">/nacos/nacos-server:v2.4.3</span></span><br><span class="line">          <span class="attr">imagePullPolicy:</span> <span class="string">Always</span></span><br><span class="line">          <span class="attr">resources:</span></span><br><span class="line">            <span class="attr">requests:</span></span><br><span class="line">              <span class="attr">memory:</span> <span class="string">&quot;2Gi&quot;</span></span><br><span class="line">              <span class="attr">cpu:</span> <span class="string">&quot;500m&quot;</span></span><br><span class="line">            <span class="attr">limits:</span></span><br><span class="line">              <span class="attr">memory:</span> <span class="string">&quot;4Gi&quot;</span></span><br><span class="line">              <span class="attr">cpu:</span> <span class="string">&quot;1000m&quot;</span></span><br><span class="line">          <span class="attr">ports:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">8848</span></span><br><span class="line">              <span class="attr">name:</span> <span class="string">client-port</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">9848</span></span><br><span class="line">              <span class="attr">name:</span> <span class="string">client-rpc</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">9849</span></span><br><span class="line">              <span class="attr">name:</span> <span class="string">raft-rpc</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">7848</span></span><br><span class="line">              <span class="attr">name:</span> <span class="string">old-raft-rpc</span></span><br><span class="line">          <span class="attr">env:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">NACOS_REPLICAS</span></span><br><span class="line">              <span class="attr">valueFrom:</span></span><br><span class="line">                <span class="attr">configMapKeyRef:</span></span><br><span class="line">                  <span class="attr">name:</span> <span class="string">nacos-cm</span></span><br><span class="line">                  <span class="attr">key:</span> <span class="string">nacos.replicas</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">SERVICE_NAME</span></span><br><span class="line">              <span class="attr">valueFrom:</span></span><br><span class="line">                <span class="attr">configMapKeyRef:</span></span><br><span class="line">                  <span class="attr">name:</span> <span class="string">nacos-cm</span></span><br><span class="line">                  <span class="attr">key:</span> <span class="string">service.name</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">DOMAIN_NAME</span></span><br><span class="line">              <span class="attr">valueFrom:</span></span><br><span class="line">                <span class="attr">configMapKeyRef:</span></span><br><span class="line">                  <span class="attr">name:</span> <span class="string">nacos-cm</span></span><br><span class="line">                  <span class="attr">key:</span> <span class="string">domain.name</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">POD_NAMESPACE</span></span><br><span class="line">              <span class="attr">valueFrom:</span></span><br><span class="line">                <span class="attr">fieldRef:</span></span><br><span class="line">                  <span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line">                  <span class="attr">fieldPath:</span> <span class="string">metadata.namespace</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">MYSQL_SERVICE_HOST</span></span><br><span class="line">              <span class="attr">valueFrom:</span></span><br><span class="line">                <span class="attr">configMapKeyRef:</span></span><br><span class="line">                  <span class="attr">name:</span> <span class="string">nacos-cm</span></span><br><span class="line">                  <span class="attr">key:</span> <span class="string">mysql.host</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">MYSQL_SERVICE_DB_NAME</span></span><br><span class="line">              <span class="attr">valueFrom:</span></span><br><span class="line">                <span class="attr">configMapKeyRef:</span></span><br><span class="line">                  <span class="attr">name:</span> <span class="string">nacos-cm</span></span><br><span class="line">                  <span class="attr">key:</span> <span class="string">mysql.db.name</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">MYSQL_SERVICE_PORT</span></span><br><span class="line">              <span class="attr">valueFrom:</span></span><br><span class="line">                <span class="attr">configMapKeyRef:</span></span><br><span class="line">                  <span class="attr">name:</span> <span class="string">nacos-cm</span></span><br><span class="line">                  <span class="attr">key:</span> <span class="string">mysql.port</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">MYSQL_SERVICE_USER</span></span><br><span class="line">              <span class="attr">valueFrom:</span></span><br><span class="line">                <span class="attr">configMapKeyRef:</span></span><br><span class="line">                  <span class="attr">name:</span> <span class="string">nacos-cm</span></span><br><span class="line">                  <span class="attr">key:</span> <span class="string">mysql.user</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">MYSQL_SERVICE_PASSWORD</span></span><br><span class="line">              <span class="attr">valueFrom:</span></span><br><span class="line">                <span class="attr">secretKeyRef:</span></span><br><span class="line">                  <span class="attr">name:</span> <span class="string">nacos-secret</span></span><br><span class="line">                  <span class="attr">key:</span> <span class="string">mysql.password</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">SPRING_DATASOURCE_PLATFORM</span></span><br><span class="line">              <span class="attr">value:</span> <span class="string">&quot;mysql&quot;</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">NACOS_SERVER_PORT</span></span><br><span class="line">              <span class="attr">valueFrom:</span></span><br><span class="line">                <span class="attr">configMapKeyRef:</span></span><br><span class="line">                  <span class="attr">name:</span> <span class="string">nacos-cm</span></span><br><span class="line">                  <span class="attr">key:</span> <span class="string">nacos.server.port</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">NACOS_APPLICATION_PORT</span></span><br><span class="line">              <span class="attr">valueFrom:</span></span><br><span class="line">                <span class="attr">configMapKeyRef:</span></span><br><span class="line">                  <span class="attr">name:</span> <span class="string">nacos-cm</span></span><br><span class="line">                  <span class="attr">key:</span> <span class="string">nacos.application.port</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">PREFER_HOST_MODE</span></span><br><span class="line">              <span class="attr">valueFrom:</span></span><br><span class="line">                <span class="attr">configMapKeyRef:</span></span><br><span class="line">                  <span class="attr">name:</span> <span class="string">nacos-cm</span></span><br><span class="line">                  <span class="attr">key:</span> <span class="string">prefer.host.mode</span></span><br><span class="line">            <span class="comment"># 鉴权配置</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">NACOS_AUTH_ENABLE</span></span><br><span class="line">              <span class="attr">value:</span> <span class="string">&quot;true&quot;</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">NACOS_AUTH_TOKEN_EXPIRE_SECONDS</span></span><br><span class="line">              <span class="attr">value:</span> <span class="string">&quot;18000&quot;</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">NACOS_AUTH_TOKEN</span></span><br><span class="line">              <span class="attr">valueFrom:</span></span><br><span class="line">                <span class="attr">secretKeyRef:</span></span><br><span class="line">                  <span class="attr">name:</span> <span class="string">nacos-secret</span></span><br><span class="line">                  <span class="attr">key:</span> <span class="string">auth.token</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">NACOS_AUTH_CACHE_ENABLE</span></span><br><span class="line">              <span class="attr">value:</span> <span class="string">&quot;true&quot;</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">NACOS_AUTH_IDENTITY_KEY</span></span><br><span class="line">              <span class="attr">value:</span> <span class="string">&quot;serverIdentity&quot;</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">NACOS_AUTH_IDENTITY_VALUE</span></span><br><span class="line">              <span class="attr">value:</span> <span class="string">&quot;security&quot;</span></span><br><span class="line">            <span class="comment"># JVM参数优化</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">JVM_XMS</span></span><br><span class="line">              <span class="attr">value:</span> <span class="string">&quot;1g&quot;</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">JVM_XMX</span></span><br><span class="line">              <span class="attr">value:</span> <span class="string">&quot;1g&quot;</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">JVM_XMN</span></span><br><span class="line">              <span class="attr">value:</span> <span class="string">&quot;512m&quot;</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">JVM_MS</span></span><br><span class="line">              <span class="attr">value:</span> <span class="string">&quot;128m&quot;</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">JVM_MMS</span></span><br><span class="line">              <span class="attr">value:</span> <span class="string">&quot;320m&quot;</span></span><br><span class="line">          <span class="attr">volumeMounts:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">data</span></span><br><span class="line">              <span class="attr">mountPath:</span> <span class="string">/home/nacos/plugins/peer-finder</span></span><br><span class="line">              <span class="attr">subPath:</span> <span class="string">peer-finder</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">data</span></span><br><span class="line">              <span class="attr">mountPath:</span> <span class="string">/home/nacos/data</span></span><br><span class="line">              <span class="attr">subPath:</span> <span class="string">data</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">data</span></span><br><span class="line">              <span class="attr">mountPath:</span> <span class="string">/home/nacos/logs</span></span><br><span class="line">              <span class="attr">subPath:</span> <span class="string">logs</span></span><br><span class="line">  <span class="attr">volumeClaimTemplates:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">metadata:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">data</span></span><br><span class="line">      <span class="attr">spec:</span></span><br><span class="line">        <span class="attr">accessModes:</span> [ <span class="string">&quot;ReadWriteOnce&quot;</span> ]</span><br><span class="line">        <span class="attr">storageClassName:</span> <span class="string">&quot;longhorn&quot;</span></span><br><span class="line">        <span class="attr">resources:</span></span><br><span class="line">          <span class="attr">requests:</span></span><br><span class="line">            <span class="attr">storage:</span> <span class="string">20Gi</span></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>计算机</category>
      </categories>
  </entry>
  <entry>
    <title>新k8s的skywalking部署</title>
    <url>/2025/11/20/%E8%AE%A1%E7%AE%97%E6%9C%BA/%E6%96%B0k8s%E7%9A%84skywalking%E9%83%A8%E7%BD%B2/</url>
    <content><![CDATA[<h1 id="新k8s的skywalking部署"><a href="#新k8s的skywalking部署" class="headerlink" title="新k8s的skywalking部署"></a>新k8s的skywalking部署</h1><h2 id="oap的部署文件"><a href="#oap的部署文件" class="headerlink" title="oap的部署文件"></a>oap的部署文件</h2><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">oap</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">skywalking</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">oap</span></span><br><span class="line">    <span class="attr">release:</span> <span class="string">skywalking</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">oap</span></span><br><span class="line">      <span class="attr">release:</span> <span class="string">skywalking</span></span><br><span class="line">  <span class="attr">strategy:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">RollingUpdate</span></span><br><span class="line">    <span class="attr">rollingUpdate:</span></span><br><span class="line">      <span class="attr">maxUnavailable:</span> <span class="number">25</span><span class="string">%</span></span><br><span class="line">      <span class="attr">maxSurge:</span> <span class="number">25</span><span class="string">%</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">oap</span></span><br><span class="line">        <span class="attr">release:</span> <span class="string">skywalking</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">oap</span></span><br><span class="line">        <span class="attr">image:</span> <span class="number">172.31</span><span class="number">.10</span><span class="number">.118</span><span class="string">/apache/skywalking-oap-server:8.3.0-es7</span></span><br><span class="line">        <span class="attr">imagePullPolicy:</span> <span class="string">IfNotPresent</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">11800</span></span><br><span class="line">          <span class="attr">name:</span> <span class="string">grpc</span></span><br><span class="line">          <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">12800</span></span><br><span class="line">          <span class="attr">name:</span> <span class="string">rest</span></span><br><span class="line">          <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">        <span class="attr">env:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">SW_STORAGE</span></span><br><span class="line">          <span class="attr">value:</span> <span class="string">elasticsearch7</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">SW_STORAGE_ES_CLUSTER_NODES</span></span><br><span class="line">          <span class="attr">value:</span> <span class="number">172.31</span><span class="number">.10</span><span class="number">.119</span><span class="string">:9200</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">SW_NAMESPACE</span></span><br><span class="line">          <span class="attr">value:</span> <span class="string">skywalking</span></span><br><span class="line">        <span class="attr">resources:</span> &#123;&#125;</span><br></pre></td></tr></table></figure>
<h2 id="ui的部署文件"><a href="#ui的部署文件" class="headerlink" title="ui的部署文件"></a>ui的部署文件</h2><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">ui-deployment</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">skywalking</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">ui</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">ui</span></span><br><span class="line">  <span class="attr">strategy:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">RollingUpdate</span></span><br><span class="line">    <span class="attr">rollingUpdate:</span></span><br><span class="line">      <span class="attr">maxUnavailable:</span> <span class="number">25</span><span class="string">%</span></span><br><span class="line">      <span class="attr">maxSurge:</span> <span class="number">25</span><span class="string">%</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">ui</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">ui</span></span><br><span class="line">        <span class="attr">image:</span> <span class="number">172.31</span><span class="number">.10</span><span class="number">.118</span><span class="string">/apache/skywalking-ui:8.3.0</span></span><br><span class="line">        <span class="attr">imagePullPolicy:</span> <span class="string">IfNotPresent</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">8080</span></span><br><span class="line">          <span class="attr">name:</span> <span class="string">page</span></span><br><span class="line">          <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">        <span class="attr">env:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">SW_OAP_ADDRESS</span></span><br><span class="line">          <span class="attr">value:</span> <span class="string">oap:12800</span></span><br><span class="line">        <span class="attr">resources:</span> &#123;&#125;</span><br></pre></td></tr></table></figure>
<h2 id="svc的部署文件"><a href="#svc的部署文件" class="headerlink" title="svc的部署文件"></a>svc的部署文件</h2><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">oap</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">skywalking</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">skywalking</span></span><br><span class="line">    <span class="attr">component:</span> <span class="string">oap</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">ClusterIP</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">http</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">12800</span></span><br><span class="line">    <span class="attr">targetPort:</span> <span class="number">12800</span></span><br><span class="line">    <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">grpc</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">11800</span></span><br><span class="line">    <span class="attr">targetPort:</span> <span class="number">11800</span></span><br><span class="line">    <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">oap</span></span><br><span class="line">    <span class="attr">release:</span> <span class="string">skywalking</span> </span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">ui</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">skywalking</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">skywalking</span></span><br><span class="line">    <span class="attr">component:</span> <span class="string">ui</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">NodePort</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">http</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">8080</span></span><br><span class="line">    <span class="attr">targetPort:</span> <span class="number">8080</span></span><br><span class="line">    <span class="attr">nodePort:</span> <span class="number">31234</span></span><br><span class="line">    <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">ui</span> </span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>计算机</category>
      </categories>
  </entry>
  <entry>
    <title>本地部署deepseek</title>
    <url>/2025/03/10/%E8%AE%A1%E7%AE%97%E6%9C%BA/%E6%9C%AC%E5%9C%B0%E9%83%A8%E7%BD%B2deepseek/</url>
    <content><![CDATA[<h1 id="本地部署deepseek"><a href="#本地部署deepseek" class="headerlink" title="本地部署deepseek"></a>本地部署deepseek</h1><p>参考文档：<a href="https://zhuanlan.zhihu.com/p/23369668872">DeepSeek R1本地部署+知识库+联网搜索，终极版方案 - 知乎</a></p>
<h2 id="运行deepseek"><a href="#运行deepseek" class="headerlink" title="运行deepseek"></a>运行deepseek</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">ollama run deepseek-r1:8b</span><br></pre></td></tr></table></figure>
<p>以下是 <strong>Ollama</strong> 的常用命令及其功能的详细列表：</p>
<h3 id="1-服务管理"><a href="#1-服务管理" class="headerlink" title="1. 服务管理"></a>1. 服务管理</h3><ul>
<li><p><strong>启动 Ollama 服务</strong>：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ollama serve</span><br></pre></td></tr></table></figure>
<p>用于启动 Ollama 服务，以便运行模型和处理请求。</p>
</li>
<li><p><strong>停止 Ollama 服务</strong>：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ollama stop</span><br></pre></td></tr></table></figure>
<p>停止正在运行的 Ollama 服务。</p>
</li>
<li><p><strong>重启 Ollama 服务</strong>：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ollama restart</span><br></pre></td></tr></table></figure>
<p>重启 Ollama 服务。</p>
</li>
</ul>
<h3 id="2-模型管理"><a href="#2-模型管理" class="headerlink" title="2. 模型管理"></a>2. 模型管理</h3><ul>
<li><p><strong>拉取模型</strong>：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ollama pull &lt;model-name&gt;</span><br></pre></td></tr></table></figure>
<p>从模型库中下载模型。</p>
</li>
<li><p><strong>运行模型</strong>：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ollama run &lt;model-name&gt;</span><br></pre></td></tr></table></figure>
<p>运行已下载的模型。</p>
</li>
<li><p><strong>列出本地模型</strong>：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ollama list</span><br><span class="line">ollama <span class="built_in">ls</span></span><br></pre></td></tr></table></figure>
<p>查看已下载的模型列表。</p>
</li>
<li><p><strong>删除模型</strong>：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ollama <span class="built_in">rm</span> &lt;model-name&gt;</span><br></pre></td></tr></table></figure>
<p>删除本地模型。</p>
</li>
<li><p><strong>复制模型</strong>：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ollama <span class="built_in">cp</span> &lt;source-model-name&gt; &lt;new-model-name&gt;</span><br></pre></td></tr></table></figure>
<p>复制一个已存在的模型。</p>
</li>
<li><p><strong>推送模型到注册表</strong>：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ollama push &lt;model-name&gt;</span><br></pre></td></tr></table></figure>
<p>将本地模型推送到模型注册表。</p>
</li>
</ul>
<h3 id="3-模型信息"><a href="#3-模型信息" class="headerlink" title="3. 模型信息"></a>3. 模型信息</h3><ul>
<li><p><strong>显示模型信息</strong>：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ollama show &lt;model-name&gt;</span><br></pre></td></tr></table></figure>
<p>查看特定模型的详细信息，例如模型名称、版本等。</p>
</li>
<li><p><strong>查看模型的 Modelfile</strong>：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ollama show &lt;model-name&gt; --modelfile</span><br></pre></td></tr></table></figure>
<p>显示模型的 Modelfile。</p>
</li>
<li><p><strong>查看模型的参数</strong>：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ollama show &lt;model-name&gt; --parameters</span><br></pre></td></tr></table></figure>
<p>显示模型的配置参数。</p>
</li>
</ul>
<h3 id="4-其他命令"><a href="#4-其他命令" class="headerlink" title="4. 其他命令"></a>4. 其他命令</h3><ul>
<li><p><strong>查看版本信息</strong>：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ollama -v</span><br><span class="line">ollama --version</span><br></pre></td></tr></table></figure>
<p>显示当前 Ollama 工具的版本信息。</p>
</li>
<li><p><strong>更新 Ollama</strong>：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ollama update</span><br></pre></td></tr></table></figure>
<p>更新 Ollama 到最新版本。</p>
</li>
<li><p><strong>查看日志</strong>：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ollama logs</span><br></pre></td></tr></table></figure>
<p>查看 Ollama 的日志信息。</p>
</li>
<li><p><strong>清理缓存</strong>：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ollama clean</span><br></pre></td></tr></table></figure>
<p>清理 Ollama 的缓存。</p>
</li>
<li><p><strong>帮助信息</strong>：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ollama --<span class="built_in">help</span></span><br></pre></td></tr></table></figure>
<p>查看所有可用命令。</p>
</li>
</ul>
<p>这些命令可以帮助你更好地管理和使用 Ollama 的功能。</p>
]]></content>
      <categories>
        <category>计算机</category>
      </categories>
  </entry>
  <entry>
    <title>本地部署文生视频模型</title>
    <url>/2025/03/20/%E8%AE%A1%E7%AE%97%E6%9C%BA/%E6%9C%AC%E5%9C%B0%E9%83%A8%E7%BD%B2%E9%98%BF%E9%87%8C%E7%9A%84%E4%B8%87%E8%B1%A12.1%E6%96%87%E7%94%9F%E8%A7%86%E9%A2%91%EF%BC%88Wan2.1-T2V-1.3B%EF%BC%89%E6%A8%A1%E5%9E%8B(1)/</url>
    <content><![CDATA[<h1 id="本地部署阿里的万象2-1文生视频（Wan2-1-T2V-1-3B）模型"><a href="#本地部署阿里的万象2-1文生视频（Wan2-1-T2V-1-3B）模型" class="headerlink" title="本地部署阿里的万象2.1文生视频（Wan2.1-T2V-1.3B）模型"></a>本地部署阿里的万象2.1文生视频（Wan2.1-T2V-1.3B）模型</h1><p>本地环境i5-13490 32g内存 4060 8g显存</p>
<p>官网地址：<a href="https://hf-mirror.com/Wan-AI/Wan2.1-T2V-1.3B">Wan-AI/Wan2.1-T2V-1.3B · HF Mirror (hf-mirror.com)</a></p>
<p>参考文档：<a href="https://blog.csdn.net/ddrfan/article/details/145887466">本地部署阿里的万象2.1文生视频（Wan2.1-T2V-1.3B）模型-CSDN博客</a></p>
<h2 id="换源"><a href="#换源" class="headerlink" title="换源"></a>换源</h2><p>pip换阿里源</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">pip config <span class="built_in">set</span> global.index-url https://mirrors.aliyun.com/pypi/simple/</span><br><span class="line">pip config <span class="built_in">set</span> global.trusted-host mirrors.aliyun.com</span><br><span class="line">pip config list</span><br></pre></td></tr></table></figure>
<h2 id="安装cuda"><a href="#安装cuda" class="headerlink" title="安装cuda"></a>安装cuda</h2><p>版本选择12.6.0</p>
<p><a href="https://developer.nvidia.com/cuda-toolkit-archive/">CUDA Toolkit Archive | NVIDIA Developer</a></p>
<p>cuda默认安装位置：</p>
<p>C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v12.6</p>
<h2 id="安装cudnn"><a href="#安装cudnn" class="headerlink" title="安装cudnn"></a>安装cudnn</h2><p>版本选择8.9.7</p>
<p><a href="https://developer.nvidia.com/rdp/cudnn-archive">cuDNN Archive | NVIDIA Developer</a></p>
<p>（2）CUDNN的安装与配置<br>1.下载好CUDNN的压缩包后进行解压</p>
<p>2.打开\NVIDIA Computing Toolkit\CUDA\v12.2，将CUDNN对应bin、lib、include三个文件与CUDA对应的bin、lib、include进行合并，将CUDNN内文件全部复制到CUDA对应文件夹内</p>
<p>将CUDNN\lib\x64的文件全部复制到CUDA\v12.2\lib\x64中</p>
<p>3.打开“编辑系统环境变量”，点击“环境变量”，点击“系统变量”中Path添加C:\Program Files\NVIDIA Computing Toolkit\CUDA\v12.2\lib和v12.2\libnvvp以及v12.2\include，点击“确定”完成配置</p>
<p>（3）检查CUDNN是否安装成功<br>打开C:\Program Files\NVIDIA Computing Toolkit\CUDA\v12.2\extras\demo_suite，查看是否有文件bandwidthTest.exe以及deviceQuery.exe，若存在则在该文件中打开cmd运行两.exe文件</p>
<p>运行bandwidthTest.exe</p>
<p>运行deviceQuery.exe</p>
<p>若都能成功运行，CUDNN安装成功</p>
<h2 id="克隆仓库"><a href="#克隆仓库" class="headerlink" title="克隆仓库"></a>克隆仓库</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/Wan-Video/Wan2.1.git</span><br><span class="line"><span class="built_in">cd</span> Wan2.1</span><br></pre></td></tr></table></figure>
<h2 id="创建虚拟环境"><a href="#创建虚拟环境" class="headerlink" title="创建虚拟环境"></a>创建虚拟环境</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">conda create --name wanxiang python=3.10</span><br><span class="line"><span class="comment">#查看虚拟环境列表</span></span><br><span class="line">conda <span class="built_in">env</span> list</span><br><span class="line"><span class="comment">#进入虚拟环境</span></span><br><span class="line">conda activate wanxiang</span><br><span class="line"><span class="comment">#退出环境</span></span><br><span class="line">conda deactivate</span><br><span class="line"><span class="comment">#删除环境</span></span><br><span class="line">conda remove --name wanxiang --all</span><br><span class="line"><span class="comment">#查看当前环境的所有依赖</span></span><br><span class="line">conda list</span><br></pre></td></tr></table></figure>
<h2 id="手动下载flash-attn"><a href="#手动下载flash-attn" class="headerlink" title="手动下载flash_attn"></a>手动下载flash_attn</h2><p>地址：<a href="https://github.com/kingbri1/flash-attention/releases">https://github.com/kingbri1/flash-attention/releases</a></p>
<p>安装：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">pip install C:\Users\mx\Downloads\flash_attn-2.7.4.post1+cu124torch2.6.0cxx11abiFALSE-cp310-cp310-win_amd64.whl</span><br></pre></td></tr></table></figure>
<p>查看当前虚拟环境的依赖</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">(wanxiang) C:\Users\mx&gt;conda list</span><br><span class="line"><span class="comment"># packages in environment at C:\Users\mx\anaconda3\envs\wanxiang:</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Name                    Version                   Build  Channel</span></span><br><span class="line">bzip2                     1.0.8                h2bbff1b_6</span><br><span class="line">ca-certificates           2025.2.25            haa95532_0</span><br><span class="line">einops                    0.8.1                    pypi_0    pypi</span><br><span class="line">filelock                  3.18.0                   pypi_0    pypi</span><br><span class="line">flash-attn                2.7.4.post1              pypi_0    pypi</span><br><span class="line">fsspec                    2025.3.0                 pypi_0    pypi</span><br><span class="line">jinja2                    3.1.6                    pypi_0    pypi</span><br><span class="line">libffi                    3.4.4                hd77b12b_1</span><br><span class="line">markupsafe                3.0.2                    pypi_0    pypi</span><br><span class="line">mpmath                    1.3.0                    pypi_0    pypi</span><br><span class="line">networkx                  3.4.2                    pypi_0    pypi</span><br><span class="line">openssl                   3.0.16               h3f729d1_0</span><br><span class="line">pip                       25.0            py310haa95532_0</span><br><span class="line">python                    3.10.16              h4607a30_1</span><br><span class="line">setuptools                75.8.0          py310haa95532_0</span><br><span class="line">sqlite                    3.45.3               h2bbff1b_0</span><br><span class="line">sympy                     1.13.1                   pypi_0    pypi</span><br><span class="line">tk                        8.6.14               h0416ee5_0</span><br><span class="line">torch                     2.6.0                    pypi_0    pypi</span><br><span class="line">typing-extensions         4.12.2                   pypi_0    pypi</span><br><span class="line">tzdata                    2025a                h04d1e81_0</span><br><span class="line">vc                        14.42                haa95532_4</span><br><span class="line">vs2015_runtime            14.42.34433          he0abc0d_4</span><br><span class="line">wheel                     0.45.1          py310haa95532_0</span><br><span class="line">xz                        5.6.4                h4754444_1</span><br><span class="line">zlib                      1.2.13               h8cc25b3_1</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="手动下载pytorch"><a href="#手动下载pytorch" class="headerlink" title="手动下载pytorch"></a>手动下载pytorch</h2><p>官网：<a href="https://download.pytorch.org/whl/torch/">download.pytorch.org/whl/torch/</a></p>
<p>torch安装踩坑：<a href="https://zhuanlan.zhihu.com/p/18188000858">使用国内镜像解决torch-cuda太慢问题 - 知乎 (zhihu.com)</a></p>
<p><a href="https://blog.csdn.net/dangranshizhe/article/details/143920339">记一次torch和torchvision安装历程_镜像安装 mkl-2021.4.0-CSDN博客</a></p>
<p><a href="https://blog.csdn.net/YY007H/article/details/141962724">pytorch gpu国内镜像下载，目前最快下载_pytorch镜像下载-CSDN博客</a></p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">pip install torch torchvision --index-url https://mirrors.aliyun.com/pypi/simple</span><br><span class="line">pip install torch torchvision --index-url https://download.pytorch.org/whl/cu126</span><br><span class="line"></span><br><span class="line">pip install torch==2.1.1+cu121 --use-deprecated=legacy-resolver  --no-cache-dir -f https:/</span><br><span class="line">/mirrors.aliyun.com/pytorch-wheels/cu121</span><br><span class="line"></span><br><span class="line">pip install torch-2.3.1+cu121-cp310-cp310-win_amd64.whl</span><br><span class="line">pip install torchvision-0.18.1+cu121-cp310-cp310-win_amd64.whl</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>使用的版本：torch2.6</p>
<p>版本对应关系：<a href="https://blog.csdn.net/shiwanghualuo/article/details/122860521">PyTorch中torch、torchvision、torchaudio、torchtext版本对应关系_torch2.0.1对应的torchvision-CSDN博客</a></p>
<p>手动下载链接：</p>
<p><a href="https://download.pytorch.org/whl/cu124/torch-2.6.0%2Bcu124-cp310-cp310-win_amd64.whl#sha256=7cc45c5b39d74875cfafe908b7f55c544147cc16b01e795feb2fe766583efe78">https://download.pytorch.org/whl/cu124/torch-2.6.0%2Bcu124-cp310-cp310-win_amd64.whl#sha256=7cc45c5b39d74875cfafe908b7f55c544147cc16b01e795feb2fe766583efe78</a></p>
<p>检查是否成功</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查 PyTorch 版本</span></span><br><span class="line"><span class="built_in">print</span>(torch.__version__)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查 CUDA 是否可用</span></span><br><span class="line"><span class="built_in">print</span>(torch.cuda.is_available())</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看当前 GPU 设备</span></span><br><span class="line"><span class="built_in">print</span>(torch.cuda.current_device())</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看 GPU 名称</span></span><br><span class="line"><span class="built_in">print</span>(torch.cuda.get_device_name(<span class="number">0</span>))</span><br></pre></td></tr></table></figure>
<p><img src="C:\Users\mx\AppData\Roaming\Typora\typora-user-images\image-20250322211014441.png" alt="image-20250322211014441"></p>
<h2 id="下载项目依赖"><a href="#下载项目依赖" class="headerlink" title="下载项目依赖"></a>下载项目依赖</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">pip install -r requirements.txt</span><br></pre></td></tr></table></figure>
<h2 id="安装魔搭"><a href="#安装魔搭" class="headerlink" title="安装魔搭"></a>安装魔搭</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">pip install modelscope</span><br></pre></td></tr></table></figure>
<h2 id="安装模型"><a href="#安装模型" class="headerlink" title="安装模型"></a>安装模型</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">modelscope download Wan-AI/Wan2.1-T2V-1.3B --local_dir ./Wan2.1-T2V-1.3B</span><br></pre></td></tr></table></figure>
<h2 id="生成视频"><a href="#生成视频" class="headerlink" title="生成视频"></a>生成视频</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">python generate.py  --task t2v-1.3B --size 640x360 --ckpt_dir ./Wan2.1-T2V-1.3B --offload_model True --t5_cpu --sample_shift 6 --sample_guide_scale 7 --prompt <span class="string">&quot;Two anthropomorphic cats in comfy boxing gear and bright gloves fight intensely on a spotlighted stage.&quot;</span>  --save_file test.mp4</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="阿里提示词指南"><a href="#阿里提示词指南" class="headerlink" title="阿里提示词指南"></a>阿里提示词指南</h2><p><a href="https://alidocs.dingtalk.com/i/nodes/jb9Y4gmKWrx9eo4dCql9LlbYJGXn6lpz?spm=5176.29623064.0.0.41ed1eceESoez3&amp;utm_scene=person_space">通义万相AI生视频—使用指南 · 钉钉文档 (dingtalk.com)</a></p>
<p>提示词公式<br>提示词用来描述视频中所包含的内容和运动过程，它是控制视频画面内容与效果的关键因素。提示词描述越完整、精确和丰富，生成视<br>频的品质越高，且越贴近期望生成的内容。为了帮助你更快上手，我们针对不同的使用需求提供了四种提示词使用公式：<br>基础公式适用于初次尝试AI视频的新用户，及将AI视频作为灵感启发的用户，简单自由的提示词可生成更具有想象力的视频。<br>提示词＝主体+场景 +运动<br>主体：主体是视频内容的主要表现对象，可以是人、动物、植物、物品或非物理真实存在的想象物体。<br>场景：场景是主体所处的环境，包含背景、前景，可以是物理存在的真实空间或想象出来的虚构场景。<br>运动：运动包含主体的具体运动和非主体的运动状态，可以是静止、小幅度运动、大幅度运动、局部运动或整体动势。<br>进阶公式适用于有一定AI视频使用经验的用户，在基础公式之上添加更丰富细致的描述可有效提升视频质感、生动性与故事性。<br>提示词＝主体（主体描述）+场景（场景描述）+运动（运动描述）+镜头语言+氛围词+风格化<br>主体描述：主体描述是对主体外观特征细节的描述，可通过形容词或短句列举，例如“一位身着少数民族服饰的黑发苗族少女”、“一位来自异世界的飞天仙<br>子，身着破日却华丽的服饰，背后展开一对由废墟碎片构成的奇异翅膀”。<br>场景描述：场景描述是对主体所处环境特征细节的描述，可通过形容词或短句列举。<br>运动描述：运动描述是对运动特征细节的描述，包含运动的幅度、速率和运动作用的效果，例如“猛烈地摇摆”、“缓慢地移动”、“打碎了玻璃”。<br>镜头语言：镜头语言包含景别、视角、镜头、运镜等，常见镜头语言详见下方提示词词典。<br>氛围词：氛围词是对预期画面氛围的描述，例如“梦幻”、“孤独”、“宏伟”，常见氛围词详见下方提示词词典。<br>风格化：风格化是对画面风格语言的描述，例如“赛博朋克”、“勾线插画”、“废土风格”，常见风格化详见下方提示词词典。</p>
<p>运镜公式适用于对镜头运动有明确要求、面对专业视频输出场景的用户，在基础公式/丰富公式之上添加更具体的运镜描述可以有效提<br>升视频的动态感和叙事性。<br>提示词=运镜描述+主体（主体描述）+场景（场景描述）+运动（运动描述）+镜头语言+氛围词+风格化<br>运镜描述：运镜描述是对镜头运动的具体描述，在时间线上，将镜头运动和画面内容的变化有效结合可以有效提升视频叙事的丰富性和专业度。用户可以通<br>过代入导演的视角来想象和书写运镜过程。时间上，需要注意将镜头运动的时长合理控制在5s内，避免过于复杂的运镜。</p>
<p>形变公式适用于有明确该类创意需求的用户，在基础公式/进阶公式的基础上添加形变描述可以有效提升视频的趣味性，带来意想不到<br>的视觉效果。<br>提示词＝主体A（主体描述）+形变过程+主体B（主体描述）+场景（场景描述）+运动（运动描述）+镜头语言+氛围词+<br>风格化<br>主体A：主体A指主体形变前的特征和状态。<br>形变过程：形变过程是对主体从A形态变为B形态的过程描述。详细的过程描述可以有效提升形变的自然度和生动性。<br>主体B：主体B指主体形变后的特征和状态。</p>
<p>提示词示例<br>日漫风格。在城市的街道一角，一只黑猫蹲伏在路灯下，注视着远处的霓<br>虹灯光。突然一道蓝色光芒从天而降，迅速包裹住他的身体。黑猫在光芒<br>中腾空而起，黑色的毛发逐渐消散在空气中，身体迅速变长。他的皮毛变<br>为一件黑色的修身西服，勾勒出修长的轮廓。猫耳消失，脸部轮廓逐渐清<br>晰，最终化为一张帅气而冷峻的少年面孔。他轻巧地落在地上，西服在夜<br>风中微微飘动，蓝光渐渐褪去，宛如一位从未来世界中走出的神秘少年，<br>优雅而自信。</p>
<p>通过撰写不同维度的提示词，能够提升生成视频在指定维度的可控性与表现力。我们精心准备了常用维度及提示词示例作为参考，同时<br>也欢迎大家挖掘更多使用妙招。</p>
<p>特写镜头|视频中，镜头特写一位古风女子的脸庞，柔和的光线<br>洒在她的皮肤上，勾勒出细腻的轮廓。</p>
<p>近景镜头|视频中，镜头近景显示一位古风女子捧着一把青色折<br>扇，指尖轻轻划过扇面上的精美花纹，仿佛在细细品味其中的韵<br>味。</p>
<p>中景镜头|视频中，镜头中景展示一位古风女子袅袅婷婷地走在<br>花从中，长裙随风飘荡，仿佛在与自然交融。</p>
<p>远景镜头|视频中，镜头远景展示了繁华的城市街道，宽阔的人<br>行道上人来人往，形成了一个生动而热闹的画面。</p>
<p>鸟瞰镜头丨视频中，镜头采用鸟瞰视角，俯瞰整个城市的全貌，<br>展现出互相交织的街道与建筑。</p>
<p>视频从一双行走的腿开始，镜头采用低角度拍摄，聚焦于脚步的<br>移动。画面中，鞋子踩踏在粗糙的废弃地面上，周围是破碎的混<br>凝土和零散的杂草，展现出废土风格的荒凉与颓废。</p>
<p>视频展示了一个在末世中行走的人的场景，镜头从高处俯拍一个<br>人在废土风格的场景中随着阳光缓缓前行。</p>
<p>视频中展示了一块巨大的立方体石块，伫立在广场中央，周围宁<br>静。镜头缓缓推进，逐渐靠近石块，粗犷的纹理和岁月的痕迹逐<br>渐清晰。</p>
<p>视频中展示了一块巨大的立方体石块，稳稳伫立在广场中央。镜<br>头缓缓拉远，石块的宏伟轮廓逐渐显现，广场的石砖和周围的草<br>坪逐渐展露。最终，整个广场的景色展现在眼前。</p>
<p>视频中展示了一块立方体石块，镜头聚焦在立方体石块上，阳光<br>透过，散发出温暖的光泽。随着镜头轻轻移动，石块的细节在视<br>野中渐渐变化，周围环境模糊成背景。随即，镜头自然地切换到<br>旁边的立方体铁块，光滑的金属表面在阳光下闪烁。焦点流畅地<br>转移，铁块的冷列与石块的厚重形成鲜明对比。镜头在两者之间<br>游走，展现出各自的独特魅力。</p>
<p>视频中展示了一个立方体石块在广场中央滚动，镜头跟随运动。<br>随着砾石的移动，周围的绿草如茵。镜头灵活地紧贴着砾石，捕<br>捉到地面上细微的纹路和春风掠过的动感。</p>
<p>视频中展示了一块巨大的立方体石块，伫立在广场中央。镜头旋<br>转延展，围绕这块石块延伸，捕捉到表面粗犷的纹理和阳光下闪<br>烁的细微光泽。</p>
<p>以上是文生视频的提示词指南，按照以上的提示词指南优化这句话（我需要偏写实，偏真实的画风，似乎是真实的画面）：</p>
<h2 id="Gradio-空间可视化"><a href="#Gradio-空间可视化" class="headerlink" title="Gradio 空间可视化"></a>Gradio 空间可视化</h2>]]></content>
      <categories>
        <category>计算机</category>
      </categories>
  </entry>
  <entry>
    <title>表类别管理</title>
    <url>/2023/04/30/%E8%AE%A1%E7%AE%97%E6%9C%BA/%E8%A1%A8%E7%B1%BB%E5%88%AB%E7%AE%A1%E7%90%86%E5%BC%80%E5%8F%91%E6%96%87%E6%A1%A3/</url>
    <content><![CDATA[<h1 id="表类别管理"><a href="#表类别管理" class="headerlink" title="表类别管理"></a>表类别管理</h1><p>1.查询所有主题</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">listDomains(input<span class="punctuation">:</span><span class="punctuation">&#123;</span>start<span class="punctuation">:</span><span class="number">0</span><span class="punctuation">,</span>count<span class="punctuation">:</span><span class="number">100</span><span class="punctuation">&#125;</span>)<span class="punctuation">&#123;</span></span><br><span class="line">   domains<span class="punctuation">&#123;</span></span><br><span class="line">     urn</span><br><span class="line">     type</span><br><span class="line">     id</span><br><span class="line">     properties<span class="punctuation">&#123;</span></span><br><span class="line">       name</span><br><span class="line">       description</span><br><span class="line">     <span class="punctuation">&#125;</span></span><br><span class="line">   <span class="punctuation">&#125;</span></span><br><span class="line"> <span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<p>2.查询所有数据源</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  listIngestionSources(input:&#123;start:0,count:100&#125;)&#123;</span><br><span class="line">    total</span><br><span class="line">    ingestionSources&#123;</span><br><span class="line">      urn</span><br><span class="line">      name</span><br><span class="line">      <span class="built_in">type</span></span><br><span class="line">       config&#123;</span><br><span class="line">      recipe</span><br><span class="line">      executorId</span><br><span class="line">      version</span><br><span class="line">    &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>3.添加删除编辑表</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">create table</span> aamx_test</span><br><span class="line">(</span><br><span class="line">   son_id               <span class="type">bigint</span> <span class="keyword">not null</span>  comment <span class="string">&#x27;子id&#x27;</span>,</span><br><span class="line">   parent_id            <span class="type">bigint</span> <span class="keyword">not null</span>  comment <span class="string">&#x27;父id&#x27;</span>,</span><br><span class="line">   create_time          datetime <span class="keyword">default</span> <span class="keyword">NULL</span>  comment <span class="string">&#x27;创建时间&#x27;</span>,</span><br><span class="line">   update_time          datetime <span class="keyword">default</span> <span class="keyword">NULL</span>  comment <span class="string">&#x27;更新时间&#x27;</span>,</span><br><span class="line">   <span class="keyword">primary key</span> (son_id)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">alter table</span> aamx_test comment <span class="string">&#x27;分解关系&#x27;</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>计算机</category>
      </categories>
  </entry>
  <entry>
    <title>离线安装docker</title>
    <url>/2023/04/30/%E8%AE%A1%E7%AE%97%E6%9C%BA/%E7%A6%BB%E7%BA%BF%E5%AE%89%E8%A3%85docker%E6%96%87%E6%A1%A3/</url>
    <content><![CDATA[<h1 id="离线安装docker"><a href="#离线安装docker" class="headerlink" title="离线安装docker"></a>离线安装docker</h1><h2 id="1-软件环境"><a href="#1-软件环境" class="headerlink" title="1.软件环境"></a>1.软件环境</h2><div class="table-container">
<table>
<thead>
<tr>
<th>软件</th>
<th>版本</th>
</tr>
</thead>
<tbody>
<tr>
<td>centos</td>
<td>7.6</td>
</tr>
<tr>
<td>docker</td>
<td>19</td>
</tr>
</tbody>
</table>
</div>
<h2 id="2-下载docker安装包"><a href="#2-下载docker安装包" class="headerlink" title="2.下载docker安装包"></a>2.下载docker安装包</h2><p>官方地址：<a href="https://download.docker.com/linux/static/stable/x86_64/docker-19.03.9.tgz">https://download.docker.com/linux/static/stable/x86_64/docker-19.03.9.tgz</a></p>
<h2 id="3-解压缩"><a href="#3-解压缩" class="headerlink" title="3.解压缩"></a>3.解压缩</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">tar -zxvf docker-19.03.9.tgz</span><br></pre></td></tr></table></figure>
<h2 id="4-解压的docker文件夹全部移动至-usr-bin目录"><a href="#4-解压的docker文件夹全部移动至-usr-bin目录" class="headerlink" title="4.解压的docker文件夹全部移动至/usr/bin目录"></a>4.解压的docker文件夹全部移动至/usr/bin目录</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cp</span> -p docker/* /usr/bin</span><br></pre></td></tr></table></figure>
<h2 id="5-将docker注册为系统服务"><a href="#5-将docker注册为系统服务" class="headerlink" title="5.将docker注册为系统服务"></a>5.将docker注册为系统服务</h2><p>创建并编辑docker.service文件</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">vi /usr/lib/systemd/system/docker.service</span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">Description=Docker Application Container Engine</span><br><span class="line">Documentation=http://docs.docker.com</span><br><span class="line">After=network.target docker.socket</span><br><span class="line">[Service]</span><br><span class="line">Type=notify</span><br><span class="line">EnvironmentFile=-/run/flannel/docker</span><br><span class="line">WorkingDirectory=/usr/local/bin</span><br><span class="line">ExecStart=/usr/bin/dockerd \</span><br><span class="line">                -H tcp://0.0.0.0:4243 \</span><br><span class="line">                -H unix:///var/run/docker.sock \</span><br><span class="line">                --selinux-enabled=<span class="literal">false</span> \</span><br><span class="line">                --log-opt max-size=1g</span><br><span class="line">ExecReload=/bin/kill -s HUP <span class="variable">$MAINPID</span></span><br><span class="line"><span class="comment"># Having non-zero Limit*s causes performance problems due to accounting overhead</span></span><br><span class="line"><span class="comment"># in the kernel. We recommend using cgroups to do container-local accounting.</span></span><br><span class="line">LimitNOFILE=infinity</span><br><span class="line">LimitNPROC=infinity</span><br><span class="line">LimitCORE=infinity</span><br><span class="line"><span class="comment"># Uncomment TasksMax if your systemd version supports it.</span></span><br><span class="line"><span class="comment"># Only systemd 226 and above support this version.</span></span><br><span class="line"><span class="comment">#TasksMax=infinity</span></span><br><span class="line">TimeoutStartSec=0</span><br><span class="line"><span class="comment"># set delegate yes so that systemd does not reset the cgroups of docker containers</span></span><br><span class="line">Delegate=<span class="built_in">yes</span></span><br><span class="line"><span class="comment"># kill only the docker process, not all processes in the cgroup</span></span><br><span class="line">KillMode=process</span><br><span class="line">Restart=on-failure</span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure>
<h2 id="6-配置日志文件最大大小和镜像下载地址"><a href="#6-配置日志文件最大大小和镜像下载地址" class="headerlink" title="6.配置日志文件最大大小和镜像下载地址"></a>6.配置日志文件最大大小和镜像下载地址</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">more /etc/docker/daemon.json</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;registry-mirrors&quot;</span>: [<span class="string">&quot;https://hmp3678i.mirror.aliyuncs.com&quot;</span>],<span class="string">&quot;insecure-registries&quot;</span>: [<span class="string">&quot;172.31.10.118&quot;</span>],</span><br><span class="line">  <span class="string">&quot;log-driver&quot;</span>:<span class="string">&quot;json-file&quot;</span>,</span><br><span class="line">  <span class="string">&quot;log-opts&quot;</span>: &#123;<span class="string">&quot;max-size&quot;</span>:<span class="string">&quot;100m&quot;</span>, <span class="string">&quot;max-file&quot;</span>:<span class="string">&quot;3&quot;</span>&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="7-重启生效"><a href="#7-重启生效" class="headerlink" title="7.重启生效"></a>7.重启生效</h2><p>重启守护进程</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">systemctl daemon-reload</span><br><span class="line"></span><br><span class="line">systemctl start docker</span><br><span class="line"></span><br><span class="line">systemctl status docker</span><br><span class="line"><span class="comment">#设置开机启动</span></span><br><span class="line">systemctl <span class="built_in">enable</span> docker</span><br><span class="line"></span><br><span class="line">docker version</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>计算机</category>
      </categories>
  </entry>
  <entry>
    <title>k8s证书升级文档</title>
    <url>/2023/04/30/%E8%AE%A1%E7%AE%97%E6%9C%BA/%E8%AF%81%E4%B9%A6%E5%8D%87%E7%BA%A7/</url>
    <content><![CDATA[<h1 id="k8s证书升级文档"><a href="#k8s证书升级文档" class="headerlink" title="k8s证书升级文档"></a>k8s证书升级文档</h1><h1 id="1-kubeadm安装的k8s证书升级"><a href="#1-kubeadm安装的k8s证书升级" class="headerlink" title="1.kubeadm安装的k8s证书升级"></a>1.kubeadm安装的k8s证书升级</h1><p>查看证书</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">kubeadm alpha certs check-expiration</span><br></pre></td></tr></table></figure>
<p> 生成新的证书之前最好备份一下数据：</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cp</span> -rp /etc/kubernetes /etc/kubernetes.bak</span><br><span class="line"><span class="built_in">cp</span> -rp /var/lib/etcd /var/lib/etcd.bak</span><br></pre></td></tr></table></figure>
<p>生成新的证书：</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">kubeadm alpha certs renew all</span><br></pre></td></tr></table></figure>
<p>再次查看证书</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">kubeadm alpha certs check-expiration</span><br></pre></td></tr></table></figure>
<h1 id="2-二进制安装的k8s证书升级"><a href="#2-二进制安装的k8s证书升级" class="headerlink" title="2.二进制安装的k8s证书升级"></a>2.二进制安装的k8s证书升级</h1><p>本机版：</p>
<h2 id="1-备份"><a href="#1-备份" class="headerlink" title="1.备份"></a>1.备份</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment">#先备份</span></span><br><span class="line"><span class="built_in">cp</span> -r /root/TLS /root/TLS.bak</span><br></pre></td></tr></table></figure>
<h2 id="2-etcd证书升级"><a href="#2-etcd证书升级" class="headerlink" title="2.etcd证书升级"></a>2.etcd证书升级</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment">#etcd证书 </span></span><br><span class="line"><span class="built_in">cd</span> /root/TLS/etcd</span><br><span class="line"><span class="comment">#etcd的ca证书</span></span><br><span class="line">openssl x509 -<span class="keyword">in</span> ca.pem -noout -text |grep <span class="string">&#x27; Not &#x27;</span></span><br><span class="line"><span class="comment">#etcd的server证书</span></span><br><span class="line">openssl x509 -<span class="keyword">in</span> server.pem -noout -text |grep <span class="string">&#x27; Not &#x27;</span></span><br><span class="line"><span class="comment">#重新生成ca证书</span></span><br><span class="line">cfssl gencert -initca ca-csr.json | cfssljson -bare ca -</span><br><span class="line"><span class="comment">#重新生成Etcd HTTPS证书</span></span><br><span class="line">cfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=www server-csr.json | cfssljson -bare server</span><br><span class="line"><span class="comment">#确认etcd配置文件位置</span></span><br><span class="line"><span class="built_in">cat</span> /usr/lib/systemd/system/etcd.service</span><br><span class="line"><span class="comment">#拷贝刚才生成的证书</span></span><br><span class="line"><span class="built_in">cp</span> ~/TLS/etcd/ca*pem ~/TLS/etcd/server*pem /opt/etcd/ssl/</span><br><span class="line"><span class="comment">#将上面节点1所有生成的文件拷贝到节点2和节点3</span></span><br><span class="line">scp -r /opt/etcd/ root@192.168.188.129:/opt/</span><br><span class="line">scp -r /opt/etcd/ root@192.168.188.130:/opt/</span><br><span class="line"><span class="comment">#重新启动etcd</span></span><br><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl start etcd</span><br><span class="line"><span class="comment">#检查etcd状态</span></span><br><span class="line">ETCDCTL_API=3 /opt/etcd/bin/etcdctl --cacert=/opt/etcd/ssl/ca.pem --cert=/opt/etcd/ssl/server.pem --key=/opt/etcd/ssl/server-key.pem --endpoints=<span class="string">&quot;https://192.168.188.128:2379,https://192.168.188.129:2379,https://192.168.188.130:2379&quot;</span> endpoint health</span><br></pre></td></tr></table></figure>
<h2 id="3-k8s证书升级"><a href="#3-k8s证书升级" class="headerlink" title="3.k8s证书升级"></a>3.k8s证书升级</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> /root/TLS/k8s</span><br><span class="line"><span class="comment">#生成证书</span></span><br><span class="line">cfssl gencert -initca ca-csr.json | cfssljson -bare ca -</span><br><span class="line"><span class="built_in">ls</span> *pem</span><br><span class="line"><span class="comment">#查看证书</span></span><br><span class="line">openssl x509 -<span class="keyword">in</span> ca.pem -noout -text |grep <span class="string">&#x27; Not &#x27;</span></span><br><span class="line"><span class="comment">#使用自签CA签发kube-apiserver HTTPS证书</span></span><br><span class="line">cfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=kubernetes server-csr.json | cfssljson -bare server</span><br><span class="line"><span class="comment">#生成kube-proxy证书</span></span><br><span class="line">cfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=kubernetes kube-proxy-csr.json | cfssljson -bare kube-proxy</span><br><span class="line"><span class="comment">#查看证书</span></span><br><span class="line">openssl x509 -<span class="keyword">in</span> server.pem -noout -text |grep <span class="string">&#x27; Not &#x27;</span></span><br><span class="line">openssl x509 -<span class="keyword">in</span> kube-proxy.pem -noout -text |grep <span class="string">&#x27; Not &#x27;</span></span><br><span class="line"><span class="comment">#拷贝刚才生成的证书</span></span><br><span class="line"><span class="built_in">cp</span> ~/TLS/k8s/ca*pem ~/TLS/k8s/server*pem /opt/kubernetes/ssl/</span><br><span class="line"><span class="comment">#生成bootstrap.kubeconfig文件</span></span><br><span class="line">KUBE_APISERVER=<span class="string">&quot;https://192.168.188.128:6443&quot;</span> <span class="comment"># apiserver IP:PORT</span></span><br><span class="line">TOKEN=<span class="string">&quot;c47ffb939f5ca36231d9e3121a252940&quot;</span> <span class="comment"># 与token.csv里保持一致</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 生成 kubelet bootstrap kubeconfig 配置文件</span></span><br><span class="line">kubectl config set-cluster kubernetes \</span><br><span class="line">  --certificate-authority=/opt/kubernetes/ssl/ca.pem \</span><br><span class="line">  --embed-certs=<span class="literal">true</span> \</span><br><span class="line">  --server=<span class="variable">$&#123;KUBE_APISERVER&#125;</span> \</span><br><span class="line">  --kubeconfig=bootstrap.kubeconfig</span><br><span class="line">kubectl config set-credentials <span class="string">&quot;kubelet-bootstrap&quot;</span> \</span><br><span class="line">  --token=<span class="variable">$&#123;TOKEN&#125;</span> \</span><br><span class="line">  --kubeconfig=bootstrap.kubeconfig</span><br><span class="line">kubectl config set-context default \</span><br><span class="line">  --cluster=kubernetes \</span><br><span class="line">  --user=<span class="string">&quot;kubelet-bootstrap&quot;</span> \</span><br><span class="line">  --kubeconfig=bootstrap.kubeconfig</span><br><span class="line">kubectl config use-context default --kubeconfig=bootstrap.kubeconfig</span><br><span class="line"></span><br><span class="line"><span class="comment">#生成kube-proxy.kubeconfig文件</span></span><br><span class="line">KUBE_APISERVER=<span class="string">&quot;https://192.168.188.128:6443&quot;</span></span><br><span class="line"></span><br><span class="line">kubectl config set-cluster kubernetes \</span><br><span class="line">  --certificate-authority=/opt/kubernetes/ssl/ca.pem \</span><br><span class="line">  --embed-certs=<span class="literal">true</span> \</span><br><span class="line">  --server=<span class="variable">$&#123;KUBE_APISERVER&#125;</span> \</span><br><span class="line">  --kubeconfig=kube-proxy.kubeconfig</span><br><span class="line">kubectl config set-credentials kube-proxy \</span><br><span class="line">  --client-certificate=./kube-proxy.pem \</span><br><span class="line">  --client-key=./kube-proxy-key.pem \</span><br><span class="line">  --embed-certs=<span class="literal">true</span> \</span><br><span class="line">  --kubeconfig=kube-proxy.kubeconfig</span><br><span class="line">kubectl config set-context default \</span><br><span class="line">  --cluster=kubernetes \</span><br><span class="line">  --user=kube-proxy \</span><br><span class="line">  --kubeconfig=kube-proxy.kubeconfig</span><br><span class="line">kubectl config use-context default --kubeconfig=kube-proxy.kubeconfig</span><br><span class="line"></span><br><span class="line"><span class="built_in">cp</span> kube-proxy.kubeconfig /opt/kubernetes/cfg/</span><br><span class="line"><span class="comment">#重启加载</span></span><br><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl restart kube-apiserver</span><br><span class="line">systemctl restart kube-controller-manager</span><br><span class="line">systemctl restart kube-scheduler</span><br><span class="line">systemctl restart kubelet</span><br></pre></td></tr></table></figure>
<p>生产版：</p>
<p>​    生产版和本机版就是证书位置，配置文件位置和本地版不一样，需要先查证书，配置文件的位置，所以生产版就写了查文件位置的命令。</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">find / -name <span class="string">&quot;*pem&quot;</span></span><br><span class="line"><span class="comment">#原证书位置</span></span><br><span class="line"><span class="built_in">cd</span> root/TLS</span><br><span class="line"><span class="built_in">cd</span> etcd</span><br><span class="line">openssl x509 -<span class="keyword">in</span> ca.pem -noout -text |grep <span class="string">&#x27; Not &#x27;</span></span><br><span class="line"><span class="comment">#存的位置</span></span><br><span class="line"><span class="built_in">cd</span> /opt/master</span><br><span class="line"><span class="built_in">cd</span> /opt/app/kubernetes/ssl</span><br><span class="line"><span class="comment">#查服务的配置文件位置</span></span><br><span class="line"><span class="built_in">cd</span> /usr/lib/systemd/system</span><br><span class="line"><span class="comment">#查这些服务</span></span><br><span class="line">etcd.service</span><br><span class="line">kube-apiserver.service</span><br><span class="line">kube-controller-manager.service</span><br><span class="line">kube-scheduler.service</span><br><span class="line">kubelet.service</span><br><span class="line">kube-proxy.service</span><br></pre></td></tr></table></figure>
<h2 id="4-回滚方案："><a href="#4-回滚方案：" class="headerlink" title="4.回滚方案："></a>4.回滚方案：</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cp</span> -r /root/TLS.bak /root/TLS</span><br><span class="line"><span class="comment">#拷贝刚才生成的证书</span></span><br><span class="line"><span class="built_in">cp</span> ~/TLS/etcd/ca*pem ~/TLS/etcd/server*pem /opt/etcd/ssl/</span><br><span class="line"><span class="comment">#将上面节点1所有生成的文件拷贝到节点2和节点3</span></span><br><span class="line">scp -r /opt/etcd/ root@192.168.188.129:/opt/</span><br><span class="line">scp -r /opt/etcd/ root@192.168.188.130:/opt/</span><br><span class="line"><span class="comment">#然后在节点2和节点3分别修改etcd.conf配置文件中的节点名称和当前服务器IP：</span></span><br><span class="line">vi /opt/etcd/cfg/etcd.conf</span><br><span class="line"><span class="comment">#[Member]</span></span><br><span class="line">ETCD_NAME=<span class="string">&quot;etcd-1&quot;</span>   <span class="comment"># 修改此处，节点2改为etcd-2，节点3改为etcd-3</span></span><br><span class="line">ETCD_DATA_DIR=<span class="string">&quot;/var/lib/etcd/default.etcd&quot;</span></span><br><span class="line">ETCD_LISTEN_PEER_URLS=<span class="string">&quot;https://192.168.31.71:2380&quot;</span>   <span class="comment"># 修改此处为当前服务器IP</span></span><br><span class="line">ETCD_LISTEN_CLIENT_URLS=<span class="string">&quot;https://192.168.31.71:2379&quot;</span> <span class="comment"># 修改此处为当前服务器IP</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#[Clustering]</span></span><br><span class="line">ETCD_INITIAL_ADVERTISE_PEER_URLS=<span class="string">&quot;https://192.168.31.71:2380&quot;</span> <span class="comment"># 修改此处为当前服务器IP</span></span><br><span class="line">ETCD_ADVERTISE_CLIENT_URLS=<span class="string">&quot;https://192.168.31.71:2379&quot;</span> <span class="comment"># 修改此处为当前服务器IP</span></span><br><span class="line">ETCD_INITIAL_CLUSTER=<span class="string">&quot;etcd-1=https://192.168.31.71:2380,etcd-2=https://192.168.31.72:2380,etcd-3=https://192.168.31.73:2380&quot;</span></span><br><span class="line">ETCD_INITIAL_CLUSTER_TOKEN=<span class="string">&quot;etcd-cluster&quot;</span></span><br><span class="line">ETCD_INITIAL_CLUSTER_STATE=<span class="string">&quot;new&quot;</span></span><br><span class="line"><span class="comment">#重新启动etcd</span></span><br><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl restart etcd</span><br><span class="line"><span class="comment">#检查etcd状态</span></span><br><span class="line">ETCDCTL_API=3 /opt/etcd/bin/etcdctl --cacert=/opt/etcd/ssl/ca.pem --cert=/opt/etcd/ssl/server.pem --key=/opt/etcd/ssl/server-key.pem --endpoints=<span class="string">&quot;https://192.168.188.128:2379,https://192.168.188.129:2379,https://192.168.188.130:2379&quot;</span> endpoint health</span><br><span class="line">kubectl get cs</span><br><span class="line"><span class="comment">#apiserver</span></span><br><span class="line"><span class="built_in">cp</span> ~/TLS/k8s/ca*pem ~/TLS/k8s/server*pem /opt/kubernetes/ssl/</span><br><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl restart kube-apiserver</span><br><span class="line">systemctl restart kube-controller-manager</span><br><span class="line">systemctl restart kube-scheduler</span><br><span class="line"><span class="comment">#workerNode</span></span><br><span class="line">KUBE_APISERVER=<span class="string">&quot;https://192.168.188.128:6443&quot;</span> <span class="comment"># apiserver IP:PORT</span></span><br><span class="line">TOKEN=<span class="string">&quot;c47ffb939f5ca36231d9e3121a252940&quot;</span> <span class="comment"># 与token.csv里保持一致</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 生成 kubelet bootstrap kubeconfig 配置文件</span></span><br><span class="line">kubectl config set-cluster kubernetes \</span><br><span class="line">  --certificate-authority=/opt/kubernetes/ssl/ca.pem \</span><br><span class="line">  --embed-certs=<span class="literal">true</span> \</span><br><span class="line">  --server=<span class="variable">$&#123;KUBE_APISERVER&#125;</span> \</span><br><span class="line">  --kubeconfig=bootstrap.kubeconfig</span><br><span class="line">kubectl config set-credentials <span class="string">&quot;kubelet-bootstrap&quot;</span> \</span><br><span class="line">  --token=<span class="variable">$&#123;TOKEN&#125;</span> \</span><br><span class="line">  --kubeconfig=bootstrap.kubeconfig</span><br><span class="line">kubectl config set-context default \</span><br><span class="line">  --cluster=kubernetes \</span><br><span class="line">  --user=<span class="string">&quot;kubelet-bootstrap&quot;</span> \</span><br><span class="line">  --kubeconfig=bootstrap.kubeconfig</span><br><span class="line">kubectl config use-context default --kubeconfig=bootstrap.kubeconfig</span><br><span class="line"><span class="built_in">cp</span> bootstrap.kubeconfig /opt/kubernetes/cfg</span><br><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl restart kubelet</span><br><span class="line"></span><br><span class="line">KUBE_APISERVER=<span class="string">&quot;https://192.168.188.128:6443&quot;</span></span><br><span class="line"></span><br><span class="line">kubectl config set-cluster kubernetes \</span><br><span class="line">  --certificate-authority=/opt/kubernetes/ssl/ca.pem \</span><br><span class="line">  --embed-certs=<span class="literal">true</span> \</span><br><span class="line">  --server=<span class="variable">$&#123;KUBE_APISERVER&#125;</span> \</span><br><span class="line">  --kubeconfig=kube-proxy.kubeconfig</span><br><span class="line">kubectl config set-credentials kube-proxy \</span><br><span class="line">  --client-certificate=./kube-proxy.pem \</span><br><span class="line">  --client-key=./kube-proxy-key.pem \</span><br><span class="line">  --embed-certs=<span class="literal">true</span> \</span><br><span class="line">  --kubeconfig=kube-proxy.kubeconfig</span><br><span class="line">kubectl config set-context default \</span><br><span class="line">  --cluster=kubernetes \</span><br><span class="line">  --user=kube-proxy \</span><br><span class="line">  --kubeconfig=kube-proxy.kubeconfig</span><br><span class="line">kubectl config use-context default --kubeconfig=kube-proxy.kubeconfig</span><br><span class="line"><span class="built_in">cp</span> kube-proxy.kubeconfig /opt/kubernetes/cfg/</span><br><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl start kube-proxy</span><br><span class="line">systemctl <span class="built_in">enable</span> kube-proxy</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>计算机</category>
      </categories>
  </entry>
  <entry>
    <title>创建文明6mod</title>
    <url>/2025/01/30/%E6%B8%B8%E6%88%8F/%E6%96%87%E6%98%8E6/%E5%88%9B%E5%BB%BA%E6%96%87%E6%98%8E6mod/</url>
    <content><![CDATA[<h1 id="创建文明6mod"><a href="#创建文明6mod" class="headerlink" title="创建文明6mod"></a>创建文明6mod</h1><p>创建一个《文明6》（Civilization VI）游戏的汉语展示旅游业绩数据的Mod，可以按照以下步骤进行。这个过程包括设置开发环境、编写代码、测试和发布Mod。</p>
<h3 id="第一步：准备工作"><a href="#第一步：准备工作" class="headerlink" title="第一步：准备工作"></a>第一步：准备工作</h3><ol>
<li><p><strong>安装工具</strong></p>
<ul>
<li>确保你已经安装了《文明6》游戏。</li>
<li>安装ModBuddy，这是Firaxis提供的用于创建《文明6》Mod的官方工具。</li>
<li>安装文本编辑器，例如Visual Studio Code，便于编辑XML和Lua文件。</li>
</ul>
</li>
<li><p><strong>设置开发环境</strong></p>
<ul>
<li>启动ModBuddy，创建一个新的Mod项目。</li>
<li>选择合适的模板，例如“Empty Mod”或“Basic Mod”。</li>
</ul>
</li>
</ol>
<h3 id="第二步：创建Mod基础结构"><a href="#第二步：创建Mod基础结构" class="headerlink" title="第二步：创建Mod基础结构"></a>第二步：创建Mod基础结构</h3><ol>
<li><p><strong>定义Mod的基本信息</strong></p>
<ul>
<li>在ModBuddy中，编辑<code>ModInfo.xml</code>文件，填写Mod的基本信息，如名称、描述、作者等。<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Mod</span> <span class="attr">id</span>=<span class="string">&quot;YOUR_MOD_ID&quot;</span> <span class="attr">version</span>=<span class="string">&quot;1&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">Properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Name</span>&gt;</span>汉语旅游业绩展示Mod<span class="tag">&lt;/<span class="name">Name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Description</span>&gt;</span>这个Mod用汉语展示文明6中的旅游业绩数据。<span class="tag">&lt;/<span class="name">Description</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Authors</span>&gt;</span>你的名字<span class="tag">&lt;/<span class="name">Authors</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">Properties</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">Dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 列出任何所需的依赖项 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">Dependencies</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">Components</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 列出Mod的组件 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">Components</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Mod</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p><strong>创建必要的文件结构</strong></p>
<ul>
<li>在Mod项目目录下创建以下文件夹：<ul>
<li><code>Assets</code>：存放图像资源。</li>
<li><code>Localization</code>：存放本地化文件。</li>
<li><code>Scripts</code>：存放Lua脚本。</li>
<li><code>UI</code>：存放用户界面相关文件。</li>
</ul>
</li>
</ul>
</li>
</ol>
<h3 id="第三步：编写代码"><a href="#第三步：编写代码" class="headerlink" title="第三步：编写代码"></a>第三步：编写代码</h3><ol>
<li><p><strong>编写本地化文件</strong></p>
<ul>
<li>在<code>Localization</code>文件夹下创建一个本地化文件，例如<code>Chinese_Text.xml</code>，用来定义汉语文本。<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">GameData</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">LocalizedText</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Row</span> <span class="attr">Tag</span>=<span class="string">&quot;LOC_TOURISM_PERFORMANCE&quot;</span> <span class="attr">Language</span>=<span class="string">&quot;zh_Hans_CN&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">Text</span>&gt;</span>旅游业绩：&#123;1: number&#125;<span class="tag">&lt;/<span class="name">Text</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">Row</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">LocalizedText</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">GameData</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p><strong>编写Lua脚本</strong></p>
<ul>
<li>在<code>Scripts</code>文件夹下创建一个Lua文件，例如<code>TourismPerformance.lua</code>，用来获取和展示旅游业绩数据。<figure class="highlight lua"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">UpdateTourismPerformance</span><span class="params">()</span></span></span><br><span class="line">  <span class="keyword">local</span> playerID = Game.GetLocalPlayer()</span><br><span class="line">  <span class="keyword">if</span> playerID == <span class="number">-1</span> <span class="keyword">then</span></span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">local</span> player = Players[playerID]</span><br><span class="line">  <span class="keyword">local</span> tourism = player:GetStats():GetTourism()</span><br><span class="line">  </span><br><span class="line">  <span class="comment">-- 更新UI文本</span></span><br><span class="line">  ContextPtr:LookUpControl(<span class="string">&quot;/InGame/TourismPerformance&quot;</span>):SetText(Locale.Lookup(<span class="string">&quot;LOC_TOURISM_PERFORMANCE&quot;</span>, tourism))</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">Events.TurnBegin.Add(UpdateTourismPerformance)</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p><strong>更新用户界面</strong></p>
<ul>
<li>在<code>UI</code>文件夹下创建一个XML文件，例如<code>TourismUI.xml</code>，定义新的UI控件。<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Context</span> <span class="attr">id</span>=<span class="string">&quot;TourismPerformanceContext&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">Label</span> <span class="attr">id</span>=<span class="string">&quot;TourismPerformance&quot;</span> <span class="attr">Anchor</span>=<span class="string">&quot;L,T&quot;</span> <span class="attr">Offset</span>=<span class="string">&quot;10,10&quot;</span> <span class="attr">String</span>=<span class="string">&quot;LOC_TOURISM_PERFORMANCE&quot;</span> <span class="attr">Style</span>=<span class="string">&quot;TourismPerformanceLabel&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Context</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>在<code>UI</code>文件夹下创建一个Lua文件，例如<code>TourismUI.lua</code>，加载并初始化UI控件。<figure class="highlight lua"><table><tr><td class="code"><pre><span class="line">include(<span class="string">&quot;TourismPerformance&quot;</span>)</span><br><span class="line">   </span><br><span class="line">   <span class="function"><span class="keyword">function</span> <span class="title">Initialize</span><span class="params">()</span></span></span><br><span class="line">     ContextPtr:SetHide(<span class="literal">false</span>)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line">   </span><br><span class="line">   Initialize()</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ol>
<h3 id="第四步：测试和调试"><a href="#第四步：测试和调试" class="headerlink" title="第四步：测试和调试"></a>第四步：测试和调试</h3><ol>
<li><p><strong>测试Mod</strong></p>
<ul>
<li>在ModBuddy中编译并部署你的Mod。</li>
<li>启动《文明6》游戏，启用你的Mod，开始新游戏或加载已有游戏，验证Mod是否正常工作。</li>
</ul>
</li>
<li><p><strong>调试</strong></p>
<ul>
<li>检查游戏日志文件（位于<code>Documents\My Games\Sid Meier&#39;s Civilization VI\Logs</code>）以获取错误信息。</li>
<li>根据日志中的错误信息修复代码。</li>
</ul>
</li>
</ol>
<h3 id="第五步：发布Mod"><a href="#第五步：发布Mod" class="headerlink" title="第五步：发布Mod"></a>第五步：发布Mod</h3><ol>
<li><p><strong>打包Mod</strong></p>
<ul>
<li>在ModBuddy中选择“Build Solution”来打包你的Mod。</li>
<li>打包后的Mod文件通常位于<code>Documents\My Games\Sid Meier&#39;s Civilization VI\Mods</code>文件夹中。</li>
</ul>
</li>
<li><p><strong>发布Mod</strong></p>
<ul>
<li>将打包好的Mod文件上传到Steam创意工坊或其他Mod发布平台，方便其他玩家下载和使用。</li>
</ul>
</li>
</ol>
<p>按照这些步骤，你就可以创建一个汉语展示旅游业绩数据的《文明6》Mod。如果你在开发过程中遇到问题，可以参考Firaxis提供的Mod开发文档或在社区论坛寻求帮助。</p>
]]></content>
      <categories>
        <category>游戏</category>
      </categories>
  </entry>
  <entry>
    <title>文明6-拜占庭</title>
    <url>/2023/04/30/%E6%B8%B8%E6%88%8F/%E6%96%87%E6%98%8E6/%E6%8B%9C%E5%8D%A0%E5%BA%AD/</url>
    <content><![CDATA[<h1 id="拜占庭"><a href="#拜占庭" class="headerlink" title="拜占庭"></a>拜占庭</h1><h1 id="能力解析："><a href="#能力解析：" class="headerlink" title="能力解析："></a>能力解析：</h1><p>拜占庭属于极端战狂，只要发了教，选择了核心[十字军]信条，配合[天授神权]从古典时期一直可以打到原子能，当然很少有电脑能够在拜占庭的威压下活过文艺复兴。</p>
<p>与此同时，拜占庭的特性也意味着拜占庭拥有极强的宗教能力，除了征服之外，宗教胜利也是拜占庭的获胜方式之一。</p>
<h1 id="征服原理"><a href="#征服原理" class="headerlink" title="征服原理:"></a>征服原理:</h1><p>拜占庭的特性[生于紫室]给拜占庭提供了独特的取胜方式，<br>可以使此文明放弃一切工程单位，只需要骑兵即可击溃城墙，<br>提前了该文明的进攻时间，并且使防守方非常头疼。除此之外，<br>拜占庭的特殊区域[跑马场]也给拜占庭提供了极强的爆发力，<br>赠送免费的重骑兵且无需维护费与资源，并且能够随着科技的<br>提升给最高级的单位，通常当我们解锁[王权神授]后可以利<br>用砍跑马场、卡跑马场的方式在两个回合内获得多个特色单位，<br>给予敌方致命一击。</p>
<p>另外需要注意，拜占庭的骑士(甲胄)是在市政中解锁的，<br>所以对于科技的要求并不高，所以我们的注意力应该放在冲文<br>化上，科技方面通过劫掠即可进行过渡</p>
<h1 id="本玩儿法优缺点分析"><a href="#本玩儿法优缺点分析" class="headerlink" title="本玩儿法优缺点分析"></a>本玩儿法优缺点分析</h1><h2 id="优点"><a href="#优点" class="headerlink" title="优点:"></a>优点:</h2><ul>
<li>每一个文明玩家都有一个过神的愿望，尤其是新手，觉得扔核弹虽然很爽，但是远远没有从一开始就打仗来的好玩儿，而拜占庭最大的优点就是很早就可以开战让玩家有很强的成就感。</li>
<li>此玩儿法对于运营的要求不高，区域规划的要求不高，操作的要求不高，新手玩家很容易上手。</li>
<li>由于文明特性原因，拜占庭不惧怕后期，所以即使前期没有一波都推掉，通过自己收拾的几个文明所拥有的城市，也能够在后期有着不俗的战斗力。</li>
<li>由于文明的特性原因，单位攻击力普遍很高，玩家玩儿起来会觉得很过瘾，很有打击感。</li>
</ul>
<h2 id="缺点"><a href="#缺点" class="headerlink" title="缺点:"></a>缺点:</h2><ul>
<li>惧怕远古被宣战，拜占庭在发教之前是很怕神级电脑的攻击的，因为电脑一旦远古棒子宣战，会影响你整体的发力时间，同时有可能会发不出来宗教，这样这个文明的实力就会大大削减。</li>
<li>拜占庭的特性是杀人传教，如果对面没人给你杀你就无法传教，无法传教就会导致单位无法对于城墙造成全额伤害 ， 部分情况下会比较难受。</li>
<li>吃地图，这里指的吃地图怕的是山非常多的图，如果进攻敌方的渠道只有一个小小的碍口，或是有众多丘陵，骑兵的机动性会大大受到限制，玩儿起来不爽。</li>
<li>吃信条，拜占庭如果选不到自己重要的信条[十字军]玩 儿起来的快感会大大减少</li>
<li>需要新手大致了解宗教是什么，有一定学习成本。</li>
</ul>
<h2 id="个人对于文明的看法"><a href="#个人对于文明的看法" class="headerlink" title="个人对于文明的看法"></a>个人对于文明的看法</h2><p>对于新手玩家来说，拜占庭是一个比较适合征服胜利的文明，由于自身特性原因，拜占庭只要发教，走到骑马就天不怕地不怕了，并且运营难度较低，学会套路过神并不难。</p>
<h1 id="重要问题解析"><a href="#重要问题解析" class="headerlink" title="重要问题解析:"></a>重要问题解析:</h1><h2 id="1-开始游戏前需要做的事儿"><a href="#1-开始游戏前需要做的事儿" class="headerlink" title="(1)开始游戏前需要做的事儿"></a>(1)开始游戏前需要做的事儿</h2><ul>
<li>设置地图为盘古，纪元选择[普通]，资源选择[普通]，城邦方面设置方面比较随意，科技城邦方面可以考虑[菲斯]能够帮<br>助提速，文化城邦看情况把神邦如[南马]放上，军邦考虑喀布尔]</li>
<li>速度要玩儿标速，联机速会稍微困难一些。</li>
<li>自然奇观可以选择一些补文化的，如[帕依提提] 等</li>
<li>需要注意，虽然拜占庭的海上单位也很强，但是明显没有小马踢人快，且需要走上线科技，所以不建议选择海图</li>
</ul>
<h2 id="2-关于文明的实战中的基本思路"><a href="#2-关于文明的实战中的基本思路" class="headerlink" title="(2)关于文明的实战中的基本思路"></a>(2)关于文明的实战中的基本思路</h2><ul>
<li>一定要探图探好，尽量保证探出地方城市位置，消除迷雾，方便拉商路;</li>
<li>科技走到骑马，随后玛格努斯砍树爆出第一波小马，对于附近两个文明进行攻击，并消灭他们;</li>
<li>老马换城市砍树爆出第二波小马，继续攻击后面的文明，同时进行劫掠;</li>
<li>王权神授之前建造几辆战车，卡几个跑马场，王权神授后战车升级为甲胄骑兵，卡的跑马场修建完毕，新的城市利用[雄伟壮丽]买工人砍跑马场，完成一波爆发</li>
<li>区域方面，PVE前两个城选择[圣地]也可以单城 [圣地]转项目， -定要确保发教，随后第二个区域两城之一选择市政厅[要总督点]另 外一个选择军营，其余城市无脑跑马场。</li>
<li>万神殿选择方面，可以根据情况选择天空[牧场+1文化]节庆[种植园+1文化]帮助我们增加文化，这里强烈推荐天空之神，在有牧场的情况下是征服胜利的不二之选，因为天空只需要[畜牧业]节庆需要[灌溉]需要跑单独科技，会减慢我们的进攻速度。宗教移民看情况而选择，一般是看不到的，如果你有2马，宗教移民、天空之神之间我也建议选择天空，能帮我们顺利走完两个核心市政：军事传统，政治哲学</li>
<li>前期圣地发教，前中期小马征服，配合总督玛格努斯[黑市商人]完成古典小马一波推进，随后生产战车;中期[王权神授]解锁之 后战车升级，配合跑马场[甲青骑兵]完成征服。</li>
</ul>
<h2 id="3-关于整体发育思路"><a href="#3-关于整体发育思路" class="headerlink" title="(3)关于整体发育思路"></a>(3)关于整体发育思路</h2><h3 id="远古时期"><a href="#远古时期" class="headerlink" title="远古时期:"></a>远古时期:</h3><ul>
<li>建议2城开，主城双狗一一单拓者一一圣地一-建造者。注意此处建造者也可以攒钱买，城市生产商人。</li>
<li>坐分城需要注意定要树多，越多越好，如果老家没有也要找马，方便老马巡回砍树。</li>
<li>前两个总督点[帝国初期][国家劳动力]都给到老马，升级右边的两个技能。</li>
<li>分城可以选择圣地/纪念碑/建造者，双圣地发教快一些，且能够吃市政厅六折，纪念碑文化快一些，建造者到时候砍马快一些，例如你首发了两个文邦，那可以考虑直接起建造者，一个文邦都没有，考虑纪念碑，首都产能极为充足考虑走建造者(首都转项目拿大预言家)宗教信条选择[合唱圣歌][十字军]</li>
<li>注意，远古时期一定要用商人踩路，通向你想攻击的城市，方便一会小马进攻。</li>
<li>一定要开马!可以卖奢侈，买建造者开马合唱圣歌</li>
</ul>
<h3 id="古典时期"><a href="#古典时期" class="headerlink" title="古典时期:"></a>古典时期:</h3><ul>
<li>第一时代进黄金选择[雄伟壮丽]没有进黄金选择[ 布道者远行]下个时代进黄金;</li>
<li>远古/古典时代一定要拍下市政厅，建造完成后开始一波爆发;骑马研究好后，挂政策卡演习]，老马黑市商人，利用建造出来的建造者/购买出来的建造者砍树爆出来一波小马[5匹左右]</li>
<li>用小马进攻踩好路的文明，老马巡回砍马，继续补充战斗力。</li>
<li>进攻的同时不要忘记进行劫掠，回复血量，掠夺金钱、文化、科技等。</li>
</ul>
<h3 id="中世纪"><a href="#中世纪" class="headerlink" title="中世纪:"></a>中世纪:</h3><ul>
<li>利用古典时期的马推下23文电脑，老马继续砍马，全线卡跑马场，要有两个寺庙帮<br>助触发鼓舞;</li>
<li>有空砍5辆左右 的战车，方便后续升级[甲胄骑兵]</li>
<li>王权神授解锁后，配合(雄伟壮丽]，建造/砍出跑马场，甲胄骑兵爆发，一波带走。</li>
<li>神学解锁后立即买使徒，传道信仰，[拾一税]</li>
<li>文艺复兴同理，如果还有后期就走内烧机，坦克一波。</li>
</ul>
<h1 id="关于本玩儿法需要注意的要点"><a href="#关于本玩儿法需要注意的要点" class="headerlink" title="关于本玩儿法需要注意的要点"></a>关于本玩儿法需要注意的要点</h1><h2 id="科技树、市政树的走法"><a href="#科技树、市政树的走法" class="headerlink" title="科技树、市政树的走法"></a>科技树、市政树的走法</h2><h3 id="科技树"><a href="#科技树" class="headerlink" title="科技树"></a>科技树</h3><ol>
<li>占星术</li>
<li>畜牧业</li>
<li>采矿业</li>
<li>骑马</li>
<li>铸铜</li>
<li>学徒</li>
<li>城堡</li>
<li>印刷术</li>
<li>军事学</li>
<li>内燃机</li>
</ol>
<h3 id="市政树"><a href="#市政树" class="headerlink" title="市政树"></a>市政树</h3><ol>
<li>国家劳动力</li>
<li>军事传统</li>
<li>政治哲学</li>
<li>军事训练</li>
<li>王权神授</li>
<li>民族主义</li>
<li>集权主义</li>
</ol>
<h2 id="关于总督的选择"><a href="#关于总督的选择" class="headerlink" title="关于总督的选择:"></a>关于总督的选择:</h2><p>核心总督2个:老马、老平<br>配合总督2个:瑞纳、维克托<br>A.前三点直接给老马点出黑市商人;<br>B.后续老平在人口最多的城市点出鉴赏家补文化;<br>C.瑞纳可以帮助补点经济; [ 拾一税]<br>D.没进黄金维克托压忠诚度。</p>
<h2 id="核心信条"><a href="#核心信条" class="headerlink" title="核心信条"></a>核心信条</h2><ul>
<li>合唱圣歌</li>
<li>十字军</li>
<li>什一税</li>
</ul>
<h2 id="地形影响"><a href="#地形影响" class="headerlink" title="地形影响:"></a>地形影响:</h2><ol>
<li>树林、雨林、丘陵、跨河流增加防御力;</li>
<li>沼泽、各种泛滥平原减少防御力;</li>
<li>驻扎增加防御力;</li>
</ol>
]]></content>
      <categories>
        <category>游戏</category>
      </categories>
      <tags>
        <tag>文明6</tag>
      </tags>
  </entry>
  <entry>
    <title>文明6-朝鲜</title>
    <url>/2023/04/30/%E6%B8%B8%E6%88%8F/%E6%96%87%E6%98%8E6/%E6%9C%9D%E9%B2%9C/</url>
    <content><![CDATA[<h2 id="关于整体发育思路"><a href="#关于整体发育思路" class="headerlink" title="关于整体发育思路"></a>关于整体发育思路</h2><h3 id="①远古时期"><a href="#①远古时期" class="headerlink" title="①远古时期:"></a>①远古时期:</h3><p>A.建议3城开，主城双狗一一双开拓者一一书院—建造者，这里需要注意一点，如果<br>玩儿千湖或高地，地图较大，可以在攒钱买条狗帮助探路;另外由于朝鲜书院便宜，如<br>果第一个大科是西帕，我们也可以转1项目拿西帕，一切根据节奏决定[ 没有也没事<br>儿]<br>    B.坐分城需要注意二环的丘陵地块，不要坐在大平地上，另外要考虑到雨林，铸铜后才<br>能在上面铺区域，如果雨林太多没有合适的区域位会耽误节奏。<br>    C.第一个总督点看情况给阿玛尼，反复横跳宗主首发的城邦获得时代分，如果对黄金有<br>信心就发老平。<br>    D.分城纪念碑后建造书院，如书院上有森林，可以考虑先做建造者砍树后建造书院，航<br>天城的树最好留一点，方便飞天提速。<br>    E.注意，如果要是再远古时期有时间建造商人，拉上路要考虑一下自己接下来的铺成位<br>置，尽量拉自己能走的商路，减少开拓者的步行时间。</p>
<p>关于整体发育思路</p>
<h3 id="②古典时期"><a href="#②古典时期" class="headerlink" title="②古典时期:"></a>②古典时期:</h3><p>A.第一时代进黄金，选择[百花齐放]上面数第二个，每个特色区域提供文化值，这里<br>的特色区域指的是书院、商业中心等，帮助我们提升文化;<br>“百花齐放”:每次触发电鼓舞+1时代得分。 建成拥有巨作槽位的建筑+1时代得分。在黄<br>金时代开始时选择此着力点后，售 鼓舞提供额外10%的市政开销。城市每拥有1处特色区域<br>, 则+1图文化值。可在古典和中世纪时代中选择。<br>    B.阿玛尼继续反复横跳帮助我们控城邦获得时代分;<br>    可派造至城邦，效力等同于2名盐a使者。<br>    阿玛妮<br>    外交官<br>    C.祠堂后老马砍树铺城，达到8~10城;<br>    D.多数城市按照书院、港口/商业中心完成相关建筑，配合祠堂的建造者可以适当砍树)<br>    E.主力航天城完成初步的工业区建筑，不要把时间浪费在奇观上，除了猎弓庙/罗斗捡<br>漏外，其他奇观暂不考虑;<br>箭才<br>游戏和娱乐<br>    F.本时代完成大致战略规划<br>记得倒各种卖物资，本时代不需要过多存钱，尽量用金钱<br>提速，如购买建造者等<br>30回合<br>成交<br>@57<br>    G.本时代要进黄金，遇到抢分的情况可以考虑桨帆船下水、第一次控制没被宗主的坊邦、<br>城邦征兵、改良自然灾害地形、建造奇观、贴脸拍城、建造特殊单位(火车注意科技解<br>锁)</p>
<h2 id="2-科技树"><a href="#2-科技树" class="headerlink" title="2.科技树"></a>2.科技树</h2><h4 id="科技树"><a href="#科技树" class="headerlink" title="科技树"></a>科技树</h4><p>写作<br>骑马<br>学徒<br>教育<br>机械<br>工业化<br>化学<br>火箭研究</p>
<p>卫星发射</p>
<p>火星殖民</p>
<p>地外行星<br>    拉格朗日</p>
<h4 id="市政树"><a href="#市政树" class="headerlink" title="市政树"></a>市政树</h4><p>​    政治哲学</p>
<p>历史记录 [非常重要]</p>
<p>封建主义<br>    王权神授<br>    外交部门</p>
<p>选举权<br>    太空竞赛<br>    合成专家</p>
<h2 id="3-关于总督的选择"><a href="#3-关于总督的选择" class="headerlink" title="3.关于总督的选择:"></a>3.关于总督的选择:</h2><p>平伽拉<br>马格努斯<br>核心总督3个:老马、老平、瑞纳<br>教育家<br>瑞娜<br>配合总督2个:阿玛尼、梁<br>A.首发城邦则直接先出阿玛尼宗主，帮助进黄金<br>B.老马，砍树出移民<br>C.平珈拉，<br>加文加科加伟人加太空项目<br>D.瑞纳看情况升，但是字航中心出来前需要点到发包人<br>E.如有火山城可以考虑梁</p>
]]></content>
      <categories>
        <category>游戏</category>
      </categories>
      <tags>
        <tag>文明6</tag>
      </tags>
  </entry>
  <entry>
    <title>文明6-秦始皇</title>
    <url>/2023/04/30/%E6%B8%B8%E6%88%8F/%E6%96%87%E6%98%8E6/%E7%A7%A6%E5%A7%8B%E7%9A%87/</url>
    <content><![CDATA[<h1 id="优势"><a href="#优势" class="headerlink" title="优势:"></a>优势:</h1><p>①建造者多一锤，方便抢奇观种地<br>    ②对于远古古典奇观的建造可以加速，7个建造者必出一-奇观15% ,    ③尤里卡鼓舞50%而非40%,且完成奇观后能够给当时代的两个尤里卡，鼓舞提速，整体科技市政速度较快<br>    ④联机速60T左右开始补文化，建长城，文化、经济提速非常快, 80T的文化可以比较轻松的达到400左右，飞行文胜相对难度不大。</p>
<h1 id="劣势"><a href="#劣势" class="headerlink" title="劣势:"></a>劣势:</h1><p>①新手不容易上手,对于局面的把控需要斟酌,圣地的数量需要考虑,如果前期建造大量圣地则会出现拿不到书且科技跟不上的情况,如果<br>前期建造少量圣地则面临信仰不够用的情况,因为建造奇观的节奏和城市发育的节奏需要通过游戏经验来去判断,不能够一成不变的公式<br>化;<br>    ②对抗神级电脑前期的奇观不容易抢,尤其在联机速下很多奇观25T左右就没有了，所以出生点很重要需要跳水;</p>
<p>③文明整体的进攻性较差,特殊兵种“虎蹲炮”防守还可以但是进攻方面确实一般;<br>    ④由于文明需要连黄金，且正常情况下第一个时代超分很正常,所以第二、第三个时代应当如何进黄金也比较考验新手的基本功;</p>
<h1 id="无战文胜科技树点法"><a href="#无战文胜科技树点法" class="headerlink" title="无战文胜科技树点法"></a>无战文胜科技树点法</h1><p>采矿一一砌砖—占星术<br>学徒<br>-机械-<br>城堡<br>教育一-<br>天文学一一印刷术一一工 业化- - -一飞行一一 电脑一一钢铁一一复合<br>材料</p>
<h1 id="无战文胜市政树点法"><a href="#无战文胜市政树点法" class="headerlink" title="无战文胜市政树点法"></a>无战文胜市政树点法</h1><p>法典一一对外贸易一一帝国初期一-一神秘主义一一国家 劳动力一一政治哲学-神学-封建主义一-王权神授一—归正会—保护地球一一冷战一一文化遗产一- 太空竞赛-一职业体育一 -环境保护主义-分散式主权一 文化霸权—必要远征</p>
<h1 id="整体运营思路"><a href="#整体运营思路" class="headerlink" title="整体运营思路"></a>整体运营思路</h1><h2 id="远古时期"><a href="#远古时期" class="headerlink" title="远古时期:"></a>远古时期:</h2><p>①出生地要满足以下条件:<br>A.二环之内有可改良采石场的资源，如石头、石膏、大理石<br>B.三环之内有至少1格沙漠(非丘陵)最好就只有一格<br>C.三环之内有- -格丘陵，且无雨林覆盖<br>    ②建造顺序:<br>侦察兵一_工人一侦察兵(可单狗)一一工人一移民(视情况前置)一-工人 远古至少要两城，单城不好运营<br>    ③奇观优先级<br>    最优先:金字塔、神谕、阿帕</p>
<p>次级[看地]:大浴场、烂地庙、石阵、小弓庙(看地，可以下个时代补，营地多可以放在最优先里)<br>    收集级:空花<br>    ④远古时期注意事项<br>A.建造奇观时，可以多个奇观同时建造，把地基拍下去，然后每个回合不停切换，让工人加速<br>B.对于最优先中的奇观，我个人建议一边加速-边建造，同时进行,否则很容易被抢<br>C.时间充裕可以算补锤.假设建造大浴场需要180生产力，城市生产力30，要6个回合能够完成，一 一个工人提速27锤，2个工人54锤，三个工人81锤，4个工人108锤，这样我们可以建造大浴场3个回合，完成90锤，然后用4个工人把它加速完即可，但是于此同时我们可以思考一下，如果你这个城市建造一个工人也是3个回合,那么与其用三个回合补锤不如三个回合弄一个工人出来，还能多用几次。</p>
<p>⑤万神殿的选择:<br>A.宗教移民可以帮助抢节奏<br>B.河神能够保证宜居度，<br>C.天空、牧场可以保证文化更顺<br>D.沙漠民俗/丰产特殊情况下也能用<br>    ⑥关于宗教信条:神灵的启示是很不错的信条，能够保证信仰比较充足，同时分城可以优先补学院和剧院,但是特殊情况下我们也可以选择其他的万神殿，如合唱圣歌、职业道德等</p>
<p>A.如果选神灵的启示需要注意奇观一定要多抢，否则供不上信仰</p>
<p>B.如果在前三个城都能有+3、+4的圣地是完全可以考虑职业道德的，<br>能够给你最核心的两座城比较高的前期产能，在补区域、砍移民的时候能有很好的效果，但是需要注意职业道德的话需要多做几个圣地，<br>—两个是不够的。<br>    C.合唱圣歌有时候抢不到，我个人认为老秦不太缺文化所以我个人优先会选择其他的信条</p>
<h2 id="古典时期思路"><a href="#古典时期思路" class="headerlink" title="古典时期思路:"></a>古典时期思路:</h2><p>①第一个学院，市政广场/祠堂<br>    ②开分城,注意老马放到可收割资源多的城市,老家和一分比较一下,一般我认为分矿会好一-些,注意开矿的时候不要光用信仰买，一-定要.学会信仰买工人，工人砍树出移民，- -边买一边砍,迅速做出8个左右的开拓者，保证- -局10城，这样才能够保证后面有地方放书<br>    ③注意种地,我们可以仗着工人多次使用次数完成一封建主义的鼓舞，同时长城是秦始皇提升文化的重要方式，但是要注意，只有上人口才能够提升文化值，所以个人建议古典时期多去做- -些农场,让城市累计大量人口，为后续打下基础</p>
<p>④古典时代奇观<br>    最优先:菩提寺、罗斗(老家三个区域:圣地、学院、娱乐中心早出罗斗早占优势)<br>    次级[看地]:铁山、佩特拉(可以专门开佩特拉城，多找沙漠丘陵)、巨像(可以下个时代捡漏)</p>
<h2 id="中世纪、文艺复兴思路"><a href="#中世纪、文艺复兴思路" class="headerlink" title="中世纪、文艺复兴思路:"></a>中世纪、文艺复兴思路:</h2><p>捡漏奇观，全线剧院，3个学院，2个港口，2工业区，全线补人口,种田，继续铺城,解锁城堡科技后开始建造长城，注意只能建造边界上，建造JN，莫索拉斯亡灵墓买AI巨作</p>
<h2 id="工业时代"><a href="#工业时代" class="headerlink" title="工业时代"></a>工业时代</h2><p>80T文化达到300-400左右即可，手动调工人工作位置，后期奇观看情况拿，不要强行拿，工业区发电，确保电力覆盖即可，不用每座城市都做工业区，2-3个覆盖发电，全线做广播中心，买摇滚乐队，临门一脚取得胜利</p>
<h2 id="总督任命"><a href="#总督任命" class="headerlink" title="总督任命:"></a>总督任命:</h2><p>玛格努斯一-给养保障<br>    平珈拉-除了航空之外全点.<br>    梁-自然灾害城<br>    大主教一人口多的前线城<br>    剩余总督看情况指认</p>
]]></content>
      <categories>
        <category>游戏</category>
      </categories>
      <tags>
        <tag>文明6</tag>
      </tags>
  </entry>
  <entry>
    <title>一块牛排</title>
    <url>/2024/09/25/%E8%AF%BB%E5%90%8E%E6%84%9F/%E5%B0%8F%E8%AF%B4/%E4%B8%80%E5%9D%97%E7%89%9B%E6%8E%92/</url>
    <content><![CDATA[<p>​        当他坐在他的角落里，朝他对手看去的时候，他想到了一个念头，这就是，如果把他的智慧和桑德尔的青春加在一起的话，就可构成一个世界重量级冠军了。可是问题在这里，桑德尔决不会成为世界冠军。他缺少智慧，他得到智慧的惟一方法是以青春来换取；而当他有了智慧时，青春也就消耗尽了。</p>
<p>​        年少轻狂是由生命力决定的，有些事情，真的要（感到）老了以后，才能体会其中的无奈。人生如果先老，再年轻，可能很不一样。人生的糖果发放的总是那么早，早的人们不懂珍惜。</p>
<p>​        纵酒狂歌百年身，一半生涯咎悔嗔</p>
<p>原文：</p>
<p>汤姆·金用最后一小块面包，揩干净了盆子里的最后一点汤汁之后，若有所思地慢慢嚼着。等到他从桌子旁边站起来的时候，他还是觉得饿得非常难受。可是，只有他一个人吃过东西。隔壁房里的两个孩子早就给送上床了，因为一睡他们就会忘了没吃晚饭。他老婆什么也没吃过，默默地坐着，担心地瞧着他。她是一个瘦削憔悴的工人阶级的妇女，可是在她的脸上还留着年轻时代漂亮的痕迹。做汤汁的面粉是她跟走廊对面的邻居借来的。面包是她用最后两个小钱买的。</p>
<p>他坐在窗旁一张经不住他的重量的东倒西歪的椅子上，机械地把烟斗塞在嘴里，把手伸到上衣口袋里。口袋里一点烟草也没有，这才使他惊觉过来，不由皱起眉头，怪自己健忘，然后把烟斗放在一边。他的动作缓慢，简直有点笨拙，仿佛不胜肌肉沉重的负担。他是个身体结实、看起来呆头呆脑的人，相貌也并不十分讨人喜欢。他的粗料子的衣服又旧又邋遢。他那双鞋还是很久以前换过底的，鞋面已经坏得支不住沉重的鞋底了。他的布衬衫是两个先令的廉价品，领口已经磨破，还有很多去不掉的油漆斑点。</p>
<p>不过，只有他那张脸才一丝不差地说明了他是什么人。那是一张典型的职业拳击家的脸，一张在拳击场上混了很多年的脸，因此好斗的野兽的一切标志，在他脸上都非常显著突出。这分明是一张皱眉蹙额的脸，而且，他脸上的特色一点儿也瞒不过人们的眼目，两片嘴唇破了相，合成一张极难看的嘴巴，好像脸上的一条伤疤。他的下巴显得咄咄逼人，粗壮而残忍。他的眼睛转动得很慢，眼皮很厚，在紧扣的浓眉下面，几乎毫无表情。他简直是个野兽，而最像野兽的部分就是他那双眼睛。这双眼睛看上去昏昏欲睡，跟狮子的一样——</p>
<p>是好斗的野兽的眼睛。他的额头向头发根下面斜着塌下去，头发剪得很短，可以看见他那个相貌凶恶的脑袋上的每一个隆起部分。他那断过两次的鼻子，因为挨了无数次打击，变得奇形怪状，他的耳朵跟卷心菜一样，老是肿的，已经比原来大了一倍。这些就是他脸上的全部装饰品。此外，他的胡子虽然才刮过，皮肤里的胡子茬儿却长出来，在他的脸上涂上了蓝黑的颜色。</p>
<p>总之，这是一张在黑胡同里，或者在偏僻地方见了叫人害怕的脸。不过，汤姆·金既不是罪犯，也没有干过犯罪的事。他除了在职业上经常打架以外，没有伤过任何人。也从来没有听说他跟人吵过嘴。他是以拳击为职业的人，他的好斗的野蛮行为，全留到拳击场上表现出来。在拳击场外面，他是一个行动迟缓、性情随和的人，而且在他年轻时，钱来得容易，他对人非常慷慨，不为自己打算。他不记旧恨，也很少有仇人。对他来说，拳击就等于谋生。在拳击场里，他把人打伤，打成残废，甚至打死人，可是并无恶意。</p>
<p>这不过是很普通的业务。观众花钱到场子里来，就是为了看人们互相打倒在地。赢的人可以拿到一大笔钱。二十年前，当他要跟乌鲁木鲁·高杰拳击的时候，他知道高杰的下巴曾经在新堡的比赛里给人打坏，好了还不到四个月。因此，他就专门去攻那个下巴，终于在第九个回合里，又把它打坏。这并不是因为他对高杰怀着什么恶意，这不过因为要打倒高杰，赢得那一大笔钱，只有这个办法最可靠。高杰也没有因此而记仇。比赛就是这么回事，他们都明白，而且都是这么干的。</p>
<p>汤姆·金从来不多说话，他常常沉闷地坐在窗户旁边，盯着他那双手。手背上的血管隆起来，又粗又肿，一看那些打伤、击碎、变了形的指节，就知道他是怎样用拳的。他从来没听说过，一个人的生命，就等于他的动脉的生命，可是他完全懂得这些肿大的青筋的意义。他的心脏以最大的压力通过血管，曾经输送过太多的血液。现在，这些动脉已经不中用了。它们已经胀得失去了弹性，同时，由于血管肿胀起来，他的耐力也不行了。现在，他很容易疲倦。他再也不能很快地斗上二十个回合，拼命地斗呀，斗呀，斗呀，从一次锣声到又一次锣声，越斗越猛，一会儿给打得靠着绳子，一会儿又打得他的对手靠着绳子，而且一次比一次猛烈，终于在第二十个回合里，引得全场的观众站起来狂呼，而他自己却用冲、打、闪的方法，用暴雨般的拳头一阵阵打击对方，同时也挨对方一阵阵的拳头，而他的心脏总是忠实地把汹涌的血液送到适当的血管里。那些血管虽然当时胀得很大，可是总是缩回原状，不过，也并不完全如此——</p>
<p>每一次拳击完后，它们总要比原来胀大了一点，只是起初看不出而已。他盯着这些血管和打伤了的指节，霎时仿佛看到了这双手年轻优美的形象。不过，那是这双手在绰号“威尔斯的凶神”的本尼·琼斯的脑袋上击碎第一个指节之前的事了。</p>
<p>现在，他又觉得饿了。</p>
<p>“唉！难道我连一块牛排也吃不到吗！”他高声地嘟囔着，一面捏紧他的大拳头，吐出了一句抑制着的骂人话。</p>
<p>“我已经到勃克同索雷那儿去过了。”他的妻子有点儿抱歉地说。</p>
<p>“他们不肯？”他问道。</p>
<p>“半个小钱也不肯。勃克说……”她吞吞吐吐地没有说下去。</p>
<p>“说下去！他说什么？”</p>
<p>“他说，他觉得今天晚上桑德尔一定会打败你，而且你欠他的账已经够多了。”</p>
<p>汤姆·金哼了一声，可是没有回答。他正在一心想着年轻的时候他养的那条猎狗，他不断地喂它牛排。那时候，就是他要赊一千块牛排，勃克也会答应的。可是时代变了。汤姆·金上了年纪啦。一个在二等俱乐部拳击的老头子，是不能指望商人赊给他多少账的。</p>
<p>这天早晨，他一起来就想吃一块牛排，这个心思一直没散。这一次拳击，他没有事先好好锻炼过。这一年，澳大利亚大旱，生活很艰难，连临时工作都不容易找到。他没有陪他练拳的人，他吃的伙食，非但不是最好的，而且有时还吃不饱。他有时即使找得到工作，也是临时当几天苦力。每天一早，他都要在陶门公园周围跑几圈，练练腿。可是这样也很难练好，他既没有伙伴，又得养活他的老婆同两个孩子。自从他得到跟桑德尔比赛的机会之后，商人们才稍微对他放宽了一点赊账。快活俱乐部的秘书也只肯预支三个金镑给他——这是失败的人可能得到的酬劳——</p>
<p>除此之外，他就不肯再借了。有时他设法从他的老朋友那儿借到几个<a href="https://zhida.zhihu.com/search?content_id=168097714&amp;content_type=Article&amp;match_order=2&amp;q=先令&amp;zhida_source=entity">先令</a>，他们本愿意多借几个给他，可是遇到这样的大旱年，他们自己也很困难。得啦——掩饰事实是没有用的——</p>
<p>比赛前他锻炼得很不够。他应当吃得好一点儿，心里没有牵挂。此外，一个四十岁的人练起来，当然要比二十岁的时候难得见效。</p>
<p>“什么时候啦，丽芝？”他问道。</p>
<p>他的妻子到走廊对面问了一下，回来说：</p>
<p>“八点差一刻。”</p>
<p>“再过几分钟，他们就要开始第一场比赛了，”他说，“那不过是试试拳头。接下来是狄勒·威尔士同格列德雷的四个回合的比赛，然后斯塔莱特还要同一个水手斗上十个回合，一个钟头以后我才上场。”</p>
<p>又默默地过了十分钟，他才站起来。</p>
<p>“老实说，丽芝，我简直没有好好地练过功。”</p>
<p>他伸手拿起帽子，就向门口走去。他并没有去跟她接吻——他出去时从不跟她接吻道别——可是这天晚上，她却主动地去吻他，用胳膊搂住他，强迫他低下头来跟她亲嘴。他的身体那么魁伟，相形之下，她就显得更小了。</p>
<p>“希望你交上好运，汤姆，”她说，“你一定要打败他。”</p>
<p>“对，我一定要打败他，”他照样说，“反正非这样不可。我一定得打败他。”</p>
<p>他笑了起来，装得很痛快，这时候，她跟他贴得更紧了。他从她的肩膀上瞧了瞧这个空荡荡的房间。这就是他在世界上所有的一切：欠了很久的房租、老婆与孩子。现在，他正在离开家，在黑夜里到外面去为他的老伴和小家伙弄点儿吃的东西——</p>
<p>不过，他并不是像现代的工人一样到车床上去耐心工作，而是用古老的、原始的、威武的、禽兽一样的方式去角斗。</p>
<p>“我一定要打败他，”他重复道，这一次，稍微带着一点儿拼命的口气，“如果打赢了，那就是三十金镑——我就可以付清全部的账，还剩下一大笔钱。如果打败了，我就什么也得不到——连坐电车回家的一个便士也得不到。秘书已经把输家的那一份全给我了。再会吧，老太婆。要是打赢了，我就马上回来。”</p>
<p>“我等着你。”她在走廊里对他喊道。</p>
<p>到快活俱乐部，足足有两英里路，他一边走，一边想起他当初的<a href="https://zhida.zhihu.com/search?content_id=168097714&amp;content_type=Article&amp;match_order=1&amp;q=黄金时代&amp;zhida_source=entity">黄金时代</a>——他曾经当过新南威尔士的重量级选手——</p>
<p>那时候，他常常坐着马车去拳击，而且常有个在他身上押大注的人跟他同路，替他付车钱。就拿汤米·彭斯同那个美国黑人杰克·<a href="https://zhida.zhihu.com/search?content_id=168097714&amp;content_type=Article&amp;match_order=1&amp;q=约翰逊&amp;zhida_source=entity">约翰逊</a>来说吧——</p>
<p>他们都是汽车来往。可是他只好走路！同时，人人都知道，在拳击之前，辛苦地走两英里路不是个最好的办法。他老了，如今的世界对上了年纪的人真是不好。除了做苦工以外，他简直毫无用处，即使这样，他的坏鼻子和肿耳朵还要跟他作对。他真希望当初他学会一样手艺。从长远来看，那总要好一点。可是从来没有人对他这样说过，再者，他心里也明白，即使有人跟他说过，当时他也不会听的。那时候，生活太轻松了。大笔的进款——</p>
<p>激烈、光彩的战斗——中间还有一段段休养和闲游的时间——</p>
<p>一大串拼命奉承他的人总是跟在他后面，拍拍他的背，握握他的手，那些阔少也都乐于请他喝酒，借此可以跟他谈五分钟的话，以为莫大的荣幸——</p>
<p>那种情形的确光彩：全场观众狂呼起来，他用暴风雨一样的拳法来收场，评判员总是宣布：“汤姆·金胜利！”而第二天报纸的体育栏里就会登出他的名字。</p>
<p>那才是黄金时代！但是现在经过他慢慢地回想，他才明白，给他打倒的都是些老头子。那时候，他是青年，正在成长；而他们都是老年，正在没落。怪不得他赢起来这么容易——</p>
<p>原来他们的血管都已肿胀，指节已经打伤，由于长期的拳击比赛，筋骨也已经疲乏。他记起那一次在拉希卡特斯湾，在第十八个回合里，他怎样打垮了老斯托什尔·比尔，后来老比尔在更衣室里像小孩子一样哭起来的情形。也许老比尔当时也是拖欠了房租；也许他家里也有一个老婆同两个孩子；也许在拳击的那天，比尔也是渴望吃一块牛排：当时，比尔斗得很勇，因此挨了他无比凶狠的还击。现在，在他自己也受到了这种折磨之后，他才明白在二十年前的那天晚上，斯托什尔·比尔是为了更大的赌注去斗拳的，而他，年轻的汤姆·金，不过是为了荣誉和得来容易的钱罢了。难怪斯托什尔·比尔后来要在更衣室里那样痛哭了。</p>
<p>总之，看起来，一个人一生只能斗那么多次。这是拳击比赛的铁的规律。有的人的精力，也许能够狠狠地斗一百次，有的人也许只能斗二十次；每一个人，根据他的体格和气质，都有一定的数字，等到他斗完了这个数字，他就完了。不错，他斗的次数比大多数同行都多，他所经历的艰苦奋战已经远远超过了他的本分——</p>
<p>而这种比赛，总是使心脏同肺仿佛要破裂一样，使动脉失去弹性，使年轻的灵活柔软的肌肉结成硬块，使他神经麻木、精力衰退，而且由于过分用劲儿与过分忍受使他的头脑同筋骨疲乏不堪。是的，他比他们干得都好。他的老搭档已经一个也没有了。在老一辈的拳师里，他是最后一个。他看见他们一个个完蛋，其中有几个人的完结跟他也有关系。</p>
<p>过去，他们总是拿他来对付那些老家伙，他一个一个地打倒了他们——</p>
<p>每逢他们像老斯托什尔·比尔一样，在更衣室里痛哭的时候，他总是觉得可笑。如今，他自己老了，他们又拿那些小伙子来对付他。拿桑德尔这个小家伙来说吧。他是从新西兰来的，运动的成绩留在那儿。可是在澳大利亚，谁也不了解他的情形，所以他们让他跟汤姆·金比赛。如果桑德尔干得出色，他们会让他跟更好的人比赛，赢得更多奖金。因此，不用说，这一场，他一定会斗得非常凶猛。凭着这场比赛，他会赢到一切东西——</p>
<p>金钱、荣誉和前途；汤姆·金则是阻碍他走向名利大道的一个头发斑白的老砧板。他什么也赢不到，最多也只有那三十个金镑，让他还清房东和商人的账。就在汤姆·金这样回想的时候，在他的迟钝的头脑里出现了青年的形象——</p>
<p>趾高气扬，不可一世的光辉的青年形象，肌肉柔软，皮肤滑润，不知疲倦的健康的心肺，嘲笑力量有限那种论调的青年。是的，青年是涅米塞斯[42]。他毁掉了老一辈的人，根本不考虑，这样做就等于毁掉他自己。这样扩大了他的动脉，击碎了他的指节，结果给下一辈的青年毁掉。因为青年总是年轻的。只有老年才会变老。</p>
<p>走到<a href="https://zhida.zhihu.com/search?content_id=168097714&amp;content_type=Article&amp;match_order=1&amp;q=卡斯尔雷&amp;zhida_source=entity">卡斯尔雷</a>街的时候，他向左转弯，走过三条横马路，就到了快活俱乐部。门外有一群无赖少年，恭恭敬敬地给他让开了一条路，他只听见有一个人对另外一个人说：“那就是他！那就是汤姆·金！”</p>
<p>进去之后，他在去更衣室的路上，碰见了俱乐部的秘书，这个年轻人有一双锐利的眼睛，一张机灵的脸。他跟他握了握手。</p>
<p>“你觉得怎么样，汤姆？”他问道。</p>
<p>“好得很。”汤姆·金回答道。当然，他知道这是撒谎，如果他有一镑钱的话，他会马上买一块上好的牛排。</p>
<p>等到他从更衣室出来，带着他的助手，沿着过道向大厅中央用绳子圈起来的拳击场走去的时候，正在等候演出的观众立刻发出了一片欢迎和喝彩的声音。他向左右的观众还了还礼，可是，没有几张面孔是他认识的。大多数的观众他在拳击场里第一次赢得荣誉的时候还没出世。他轻快地跳到台上，低下头从绳子下面钻到他那一角，坐在一张折叠凳子上面。评判员<a href="https://zhida.zhihu.com/search?content_id=168097714&amp;content_type=Article&amp;match_order=1&amp;q=杰克·鲍尔&amp;zhida_source=entity">杰克·鲍尔</a>过来，跟他握了握手。鲍尔是个垮了台的拳击家，他已经有十多年没有在台上当过主角了。汤姆看到他来当评判员，心里很高兴。他们都是老一辈的人。如果他稍微犯了一点儿规，对桑德尔稍微过分一点儿的时候，他知道鲍尔一定会马虎过去的。</p>
<p>年轻的、雄心勃勃的重量级拳击选手，一个接着一个地爬到圈子里面，由评判员介绍给观众。同时，他还宣布了他们提出来的挑战。</p>
<p>“年轻的普隆托，”鲍尔宣布着，“是北悉尼人，他愿意另外加五十镑，向赢家挑战。”</p>
<p>观众喝彩之后，等到桑德尔跳到圈子里，坐在他那一角的时候，又喝了一遍彩。汤姆·金好奇地瞧着对面的桑德尔，因为几分钟之内，他们就要在无情的战斗里扭到一块儿，使出全部力量来把对方打昏过去。可是他看不出什么，因为桑德尔跟他一样，也在拳击衣外面套着长裤子同绒线衫。他的脸长得非常英俊，头上一蓬鬈曲的黄发，从他那结实的、肌肉发达的脖子上，可以看出他的身体一定非常雄壮。</p>
<p>年轻的普隆托从这个角落走到那个角落，跟台上的主角握过手以后，就下去了。挑战继续进行。青年人不断地爬到圈子里——没有名的，然而不能满足的年轻人——</p>
<p>总是向大家喊着，他们要凭自己的力气和本事，向赢家比一比高下。要是几年之前，在他所向无敌的黄金时代，汤姆·金看到这种举动，也许会觉得又好笑，又讨厌。可是现在，他坐在那儿，好像着迷一样，怎么也摆脱不掉他眼睛里的青年的幻象。这些小伙子总是在拳击比赛里占上风，总是从圈子旁跳进来，大声地挑战；而在他们面前倒下来的，总是老一辈的人。他们都是从老一辈的人身上爬到成功之路上的。他们源源不绝而来，越来越多——难以抑制的、不可阻挡的青年——</p>
<p>他们总是打倒了老一辈的人，然后自己变得老起来，走着同样的下坡路，而他们后面那些不断拥上来的人，永远是青年——</p>
<p>这些新生的婴儿，长得雄壮起来之后，总是打倒他们的长辈，同时，他们后面又会出现更多新生的婴儿，直到永远——青年一定要实现他们的意志，永远不会死亡。</p>
<p>汤姆向记者席瞧了一眼，跟《体育报》的<a href="https://zhida.zhihu.com/search?content_id=168097714&amp;content_type=Article&amp;match_order=1&amp;q=摩根&amp;zhida_source=entity">摩根</a>和《公正报》的考尔柏特点了点头。然后他伸出手来，由桑德尔的一个助手严格地检查绕在他指节上的<a href="https://zhida.zhihu.com/search?content_id=168097714&amp;content_type=Article&amp;match_order=1&amp;q=细带&amp;zhida_source=entity">细带</a>，并且在这个人的严密监视之下，由他自己的助手们——</p>
<p>锡德·<a href="https://zhida.zhihu.com/search?content_id=168097714&amp;content_type=Article&amp;match_order=1&amp;q=沙利文&amp;zhida_source=entity">沙利文</a>和查利·贝茨给他套上手套，把手套扎紧。同时，在桑德尔那一角，也有汤姆的一个助手，干着同样的事。这时候，桑德尔的裤子已经给脱下来了，他一站起来，他的绒线衫也从头上给脱掉了。汤姆·金望过去，看到了青年的具体形象，厚厚的胸脯，强壮的筋肉，一身的肌肉就像活的东西在缎子似的白皮肤下面滚动。全身充满了活跃的生命，汤姆·金知道，这是从来没有失去过朝气的生命，等到在长期的战斗里，这股朝气从发痛的毛孔里泄了出去，青年付出了经过这一关的代价，他就不会再像以前那样年轻了。</p>
<p>这两个人走拢了，锣声一响，那些助手就噼噼啪啪地折起折叠凳子爬到圈子外面去了，他们握过手以后，立刻摆出了斗拳的姿势。而桑德尔，立刻就像一个由钢铁同弹簧组成的机件，在灵巧的扳机操纵之下，来往不停，一会儿用左拳打汤姆的眼睛，一会儿用右拳打他的肋骨，然后避开对方还来的一拳，轻轻跳开，接着又声势逼人地跳了回来。他的动作很敏捷，很灵巧。这是一种使人眼花缭乱的表演。全场观众都大声喝彩。可是汤姆并没有眼花。他参加过的比赛和遇到的青年对手实在太多了。他知道这种拳法是怎么回事——</p>
<p>来势太快太灵活了，不会有危险的。很清楚，桑德尔一开头就想速战速决。这是料想得到的。年轻人总是如此——逞凶撒野，猛攻猛打，肆意消耗自己的光彩和优越性，凭着无限的辉煌的精力和必胜的愿望来压倒对方。</p>
<p>桑德尔一进一退，一会这儿，一会那儿，满场跳来跳去，步伐轻快，心情急切，就像一个由雪白的皮肤和坚实的筋肉构成的活的奇迹，用身体组成了一个令人眼花缭乱的进攻网，溜过来，跳过去，像飞梭似的一个动作接着一个动作，片刻不停。而这千百个动作针对着一个目的，就是要消灭汤姆·金。因为汤姆·金妨碍他飞黄腾达。可是汤姆·金却耐心地忍受着。他知道该怎么办，他自己虽然不再是青年了，可是他懂得青年。他的想法是，在对方没有丧失一部分精力之前，是没有办法的。于是，他就暗自狞笑了一下，故意地把头一低，挨了重重的一拳。这是个恶毒的办法，不过按照拳击的规则来说，倒是很正当的。一个人照理是应当保护自己的指节的，因此，如果他一定要打中对手的头顶，那就只能说他是自讨苦吃。金本来可以把头躲得更低一点，让这一拳毫不伤人地落空，可是他想起了在当初的比赛里，他怎样在威尔斯凶神头上打坏了自己的第一个指节的情形。现在，他不过是想取胜。这一低头使桑德尔付出了一个指节的代价。就目前来说，桑德尔是不会在乎的。在这场比赛里，他会毫不介意地继续狠狠地打到底的。不过，以后等到他在拳场上斗得久了，对他开始产生影响的时候，他就会痛惜这个指节，回想起来，记得他怎样在汤姆·金的头上把指节打碎的情形了。</p>
<p>第一个回合完全是桑德尔的天下，他的旋风式的猛攻引起了全场的喝彩声。他的排山倒海的拳法压倒了汤姆，汤姆什么也没有施展。他从来没有回过一拳，他只求掩护、抵挡、躲闪，或者跟对方扭抱起来以免遭到痛击。有时候，他佯攻一下，在拳头落下去的时候摇摇头，然后迟钝地兜来兜去。他从来不跳来跳去，或者浪费一丝精力，一定要等到桑德尔泄掉了青年的锐气，这个谨慎的老年人才敢还手。金的一切动作都是慢腾腾、一板一眼的，他那双眼皮很厚、转动得很慢的眼睛，使他带着一种半睡半醒、茫然若失的神气。可是，这是一双无所不见的眼睛，在二十多年的拳场生活里，他的眼力早就锻炼出来了。即使一拳打到了眼前，它们也不会眨一眨、动一动，却能够冷静地观测出来拳的距离。</p>
<p>在第一个回合结束，休息一分钟的时候，他坐在他那个角落里，伸开两条腿仰面躺着，把胳膊搭在两旁的绳子上；当他吸进去他的助手们用毛巾扇过来的空气时，看得出他的胸膛在深深地起伏着。他闭着眼睛，听到场子里的喊声。“你为什么不斗，汤姆？”很多人都在这样喊，“你并不怕他，是吗？”</p>
<p>“肌肉硬了，”他听见一个坐在前排的人这样议论，“他的动作快不了啦。桑德尔要是输了，我赔双倍，照金镑算。”</p>
<p>锣声一响，两个人都从各自的角落向前走过去。桑德尔急于再战，足足跑到全场四分之三的地方；可是汤姆却情愿少走几步。这完全符合他的节省精力的策略。他既没有锻炼好，又没有吃饱，每一步路都很要紧。再者，他到拳场已经走了两英里路。这一回合跟第一回合一样，桑德尔仍旧像旋风一样地猛攻，观众都愤愤地质问汤姆·金为什么不打。他假装进攻，不起作用地慢慢挥了几拳，除此之外，他就只采取抵挡、拖延和扭抱的办法。桑德尔要速战速决，可是汤姆很聪明，不肯去迎合桑德尔。他露齿一笑，那张在拳场上击伤了的脸，露出一种沉思悲愤的神气，继续怀着老年人才有的谨慎，保存着实力。桑德尔是青年，他总是以青年人慷慨放纵的气派，浪费他的精力。汤姆是拳场上的一位将才，他有着由长期的痛苦战斗里得来的智慧。他用冷静的眼光和头脑注视对方，他行动迟缓，等待着桑德尔泄去锐气。在大多数观众看起来，汤姆似乎已经毫无希望地给压倒了，他们表示愿意在桑德尔身上押下三对一的赌注。可是也有几个聪明人，他们知道汤姆过去的情形，因此，他们就接受了他们认为容易赢钱的挑战。</p>
<p>第三个回合开始的时候，仍旧是一面倒，桑德尔仍旧掌握着全部主动权，尽量痛击。半分钟之后，桑德尔由于过分自信，露出了一个破绽。在这刹那间，汤姆眼到手到，他两眼发光，右手像闪电一样打了过去。这是他第一次真正的一击——</p>
<p>使了一个勾拳，他把胳膊扭成拱形，使拳头更坚实，同时把旋转一半的身体的全部重量加在拳头上。这就像一头仿佛沉睡的狮子，突然像闪电似的伸出一只爪子来。下巴旁边挨了这一下的桑德尔，立刻像一头<a href="https://zhida.zhihu.com/search?content_id=168097714&amp;content_type=Article&amp;match_order=1&amp;q=阉牛&amp;zhida_source=entity">阉牛</a>似的倒了下去。观众倒抽了一口气，喃喃发出了一种敬畏的喝彩声。这个人的肌肉不曾变僵硬，他能够把拳头像大铁锤一样打出去。</p>
<p>桑德尔心惊胆战。他翻了个身，打算爬起来，可是他的助手喝住了他，要他等着计数。他单膝跪着，准备起来，可是仍旧等着，这时候，裁判监视着他，正在大声对着他的耳朵计数。数到九的时候，他站起来摆出了战斗的姿态；这时候，面对着他的汤姆·金不由懊悔起来，这一拳要是离桑德尔的下巴尖再近一英寸就好了。那样，他就能把他打昏过去，而他就可以带着三十镑回家去见自己的老婆孩子了。</p>
<p>这一回合一直打完了规定的三分钟，桑德尔这才初次敬重起他的对手来，可是汤姆的动作仍旧很慢，眼睛仍旧那么昏昏欲睡。汤姆·金看到他的助手们在绳子外面蹲下来，准备跳进来时，就警觉到这个回合快要结束了，于是他就把战斗向他自己的那一角引过去。锣声一响，他立刻坐在那张等着他坐的凳子上，而桑德尔却只好走完这个正方形的对角线，回到他那一角。这是一件小事，不过把很多小事累积起来就是一件大事。桑德尔不得不多走许多路，多消耗许多精力，而且要在这宝贵的一分钟休息里损失一部分时间。在每一回合开始的时候，<a href="https://zhida.zhihu.com/search?content_id=168097714&amp;content_type=Article&amp;match_order=24&amp;q=汤姆·金&amp;zhida_source=entity">汤姆·金</a>总是慢腾腾地从他那一角走过去，逼着他的对手要比他走更长的路。而在每一回合结束之前，汤姆总是把战斗引到自己的一角，那么他自己可以立刻坐下。</p>
<p>在接下来的两个回合里，汤姆·金一直节省着气力，而桑德尔则尽量浪费。桑德尔力求速战速决的攻势弄得他很不舒服。因为那些像雨点似的拳头大部分都打中了。可是汤姆坚持着他的顽固的拖延战略，无论那些急性子的年轻人怎样催他斗，他也不理。后来，在第六个回合里，桑德尔又大意了一次，汤姆的可怕的右拳又像闪电似的打中了他的下巴，桑德尔于是又等到裁判数到九才起来。</p>
<p>打到第七个回合，桑德尔的优势完了，他于是安定下来，应付他知道这是他有生以来最艰苦的一场比赛。汤姆·金是个老家伙，可是比他碰到的那些老家伙要厉害得多——</p>
<p>这个老家伙从来不失去理智，他的防守本领非常强，他的拳头就像一根有节的棍子，而且他两只手都能把人打倒。然而，汤姆·金仍旧不敢时常攻打。他从来没有忘记他那些打坏了的指节，他知道，如果要他的指节能够支持到底，他就必须次次打中。当他坐在自己的角落里，瞟着他的对手的时候，他忽然想到了一个念头，如果把他的智慧跟桑德尔的青春结合在一起，那就会成为一个闻名世界的重量级锦标选手。可是困难就在这里。桑德尔绝不会变成世界选手。他缺乏智慧，而得到智慧的唯一办法，就是用青春去买；等到他有了智慧，他的青春也就虚度了。</p>
<p>汤姆·金利用一切他所知道的有利的手法。他从来没有放过一次扭抱的机会，每逢扭抱起来，他总是用肩膀硬撞对方的肋骨。按照拳击的理论，就肩膀跟拳头造成的损伤来说是一样的，就消耗体力来说，那简直要好得多。而且，一扭抱起来，汤姆总是把自己的重量压在对方身上，不肯松开。这样就逼得裁判来干涉，把他们拉开，而没有学会休息的桑德尔还帮着裁判来松开。他忍不住，他总是运用他那威风凛凛的飞舞的胳膊和他的扭动不停的肌肉。每逢对方冲过来扭抱，用肩膀抵住他的肋下，而把头靠在桑德尔的左臂上的时候，桑德尔几乎总是把右拳从自己背后挥过去，打那个突出的脸。这一手打得很巧妙，观众非常钦佩，然而并不危险，因此，只好算是浪费气力。不过，桑德尔既不知疲倦，也不知节制，而汤姆总是露齿笑着，顽强地忍受着。</p>
<p>后来，桑德尔使出了一种用右拳猛击汤姆的身体的拳法，看起来就像汤姆挨了一顿饱打似的。不过，只有老看拳击的人才佩服汤姆那种在拳头打到之前的一刹那，用左面的手套碰一碰对方的二头肌的巧妙手法。当然，次次都打中了；可是每一次都因二头肌给碰了一下，使拳头失去了力量。在第九个回合里，一分钟里一连三次，汤姆都弯着胳膊，用右拳一钩，打中了对方的下巴；一连三次，桑德尔的沉重身体，都给打倒在垫子上。每一次他都在休息了应有的九秒钟之后，才站起来，他虽然摇摇晃晃，有点头昏，不过体力还是很强。他的速度比以前慢多了，可是他浪费的气力也少了。他斗得很苦，可是他会继续利用他的本钱——</p>
<p>青春。汤姆的本钱是经验。现在，他的精力衰退了，气力也小了，可是他用策略代替了它们，他会利用他在长期比赛里得来的智慧，他会谨慎地积蓄他的力量。他不仅懂得绝不能有一个多余的动作，他还懂得怎样引诱对方消耗精力。他一再地用手、脚同身体，装作要攻击的样子，引得桑德尔一时向后跳，一时闪避，一时还击。汤姆·金休息着，可是他绝不肯让桑德尔休息。这是老年人的战略。</p>
<p>第十个回合才打起来，汤姆·金就开始用左直拳攻对方的脸，来阻挡对方的猛攻；这时候，桑德尔已经变得谨慎了，他立刻收回左臂，低头一闪，把右拳向上一钩，向汤姆的头旁边打过去。这一拳打得太高，没有真正收效；可是汤姆一挨到拳头，立刻就产生了过去他很熟悉的那种面前一片漆黑、一时昏迷的感觉。一刹那间，或者不如说，在一刹那的万分之一的时间里，他的生命停止了。在这瞬刻之前，他看见桑德尔闪出他的视野，后面背景上的一片注视着的白面孔也不见了；而一瞬之后，他又看到了桑德尔和背景上的那些面孔。他好像睡了一会儿，才睁开眼睛；不过，不省人事这一刹那间非常短暂，他没有来得及倒下去。观众只看到他摇晃了一下，膝盖一弯，然后又看见他恢复过来，用左肩紧紧地护住下巴。</p>
<p>桑德尔照这样连打了几次，让汤姆一直保持着半昏迷状态，可是汤姆终于想出了一个以攻为守的办法。他假装用左拳进攻，可是马上退后半步，把右拳用全力向上猛攻。他把时间计算得非常准确，趁着桑德尔正在低头闪避时，把拳头端端正正地打到了他的脸上，打得桑德尔两脚腾空，缩成一团向后一仰，把脑袋和肩膀同时撞倒在垫子上面。汤姆·金照这样连打中了两次，然后他就放手痛击他的对手，把他逼到绳子上面。他不让桑德尔有一点儿休息或者振作起来的机会，只顾一拳接一拳地捣下去，直到全场的观众都站起来，空气中充满了狂吼的喝彩声。可是桑德尔的气力和耐力是超群出众的，他仍旧站着。看起来，桑德尔肯定要给击昏过去，场子旁边的一个警官给这种可怕的狠打吓坏了，连忙站起来阻止这场拳击。等到锣声一响，这一个回合宣告结束的时候，桑德尔一面摇摇晃晃地回到他的角落，一面对警官声明，说他仍旧很好，很有劲儿。为了证明这一点，他向后连跳了两下，那个警官就退让了。</p>
<p>这时候，靠在自己的角落里喘得很厉害的汤姆·金非常失望。如果这场拳击给阻止了，那么裁判就会迫不得已作出结论，那三十个金镑就会归他了。他跟桑德尔不一样，他不是为了争荣誉或者前程而来斗拳的，他只为了那三十个金镑。现在，桑德尔只要休息一分钟就会恢复过来。</p>
<p>青年总有办法——</p>
<p>这句话忽然在汤姆·金脑子里一闪，他想起了他头一次听到这句话，是在他打垮斯托什尔·比尔那天晚上。这是那个在拳击之后请他喝酒的家伙，拍着他的肩膀对他说的。青年总有办法！那个家伙说得对。在很久之前的那个晚上，他的确是青年。然而今天晚上，青年却坐在对面的一角。至于他自己呢，他已经斗了半个钟头，他已经是个老头儿了。如果他像桑德尔那样斗，他连十五分钟也支持不了。不过，问题在于：他的气力不能恢复。那些突出的动脉和那颗疲劳已极的心脏使他不能在两个回合之间的休息里重振威力。而且，一开头他的气力就不充沛。他的腿很沉重，正在开始抽筋。他不应该在斗拳之前走那两英里路。还有他早上一起来就非常想念的那块牛排。他恨透了那个不肯赊账给他的肉店老板。一个没有吃饱的老年人是很难斗胜的。区区一块牛排，最多不过值几个便士，然而对他来说，却等于三十金镑。</p>
<p>第十一个回合的锣声响过之后，桑德尔为了显示他实际上并没有的锐气，发动猛攻。汤姆知道这是怎么回事——</p>
<p>这种虚张声势的把戏跟拳击本身一样古老。为了挽救自己，他扭抱起来，然后松开，让桑德尔摆开阵式。这正是他求之不得的事。他先装作用左拳进攻，引得桑德尔低头一闪，然后退半步，用右拳向上猛地一钩，迎面击中脸部，打得桑德尔摔倒在垫子上。后来，他一直不让桑德尔休息，尽管他自己也受到痛击，但是他打中的次数要多得多，他打得桑德尔靠在绳子上，上下左右地用各种拳法擂过去，然后挣脱开对方的扭抱，或者用重拳打得对方不能来扭抱，每逢桑德尔快要倒下去的时候，他就用举起的一只手撑住他，而立刻用另一只手打得他靠在绳子上，不摔下去。</p>
<p>这时候，全场都疯狂了，成了汤姆·金的天下，几乎每一个人都在喊“加油，汤姆！”“打垮他！打垮他！”“你已经胜了，汤姆！你已经胜了！”比赛就要在旋风式的攻击之下结束了，而观众花钱到这儿看的，也正是这个。</p>
<p>半小时以来一直保存着实力的汤姆·金，现在一下子把他所有的力气全使出来了。这是他的唯一的机会——要是现在不赢，就根本赢不了。他的气力消耗得很快，他只希望在最后一点气力用完之前，能够打得对方爬不起来。因此，他一面继续猛攻，一面冷静地估计他的拳头的分量和它们造成的损伤，这才看出桑德尔是一个很难打垮的人。他的体力和耐力简直大到了极点，这是青年的原封未动的体力和耐力。桑德尔一定是个蒸蒸日上的好手。他是一个天生的拳击家。只有这样坚韧的材料，才能创造出成功的斗士。</p>
<p>桑德尔已经摇摇晃晃，站不稳了，可是汤姆的腿也在抽搐，他的指节也痛起来了。不过他还是咬紧牙关，猛捶狠打，每一次都打得自己的手疼得不得了。现在，他虽然实际上一拳也没有挨到，可是他的气力也在跟对方一样迅速地衰弱下去。他次次都打中要害，可是再也没有以前那种分量了，而且每一拳都要经过极大的努力。他的腿跟铅一样重，看得出在拖来拖去；因此，把赌注压在桑德尔身上的人，看到这种情形都很高兴，就大声地鼓励着桑德尔。</p>
<p>这种情景刺激得汤姆产生了一股劲儿。他一连打了两拳——左拳打在腹腔神经丛上，稍微高了一点，右拳横击在下巴上。这两拳打得并不重，可是本来就昏迷无力的桑德尔，已经倒下去，躺在垫子上直哆嗦。裁判监视着他，对着他的耳朵，大声数着有关生死的秒数。如果在数到十秒之前他还没有起来，他就输了。全场的观众都肃静无声地站着。汤姆·金两腿发抖，勉强支持着。他感到一阵剧烈的眩晕，观众的脸好像一片大海，在他眼前波澜起伏，裁判数数的声音，好像是从很远的地方传到他耳朵里的。可是他认为自己是赢定了。一个挨了这么多重拳的人是不可能站起来的。</p>
<p>只有青年人能够站起来，桑德尔终于站起来了。数到四的时候，他翻了个身，面孔朝下，盲目地摸索那些绳子。数到七的时候，他把身子拖了起来，用一条腿跪着，一面休息，一面像喝醉了似的摇晃着脑袋。等到裁判喊了一声“九”的时候，桑德尔已经笔直地站了起来。摆出适当的招架姿势，用左臂护着脸，右臂护着胃部。他护住要害以后，就摇摇摆摆地向汤姆走过去，希望能跟对方扭抱在一块儿，以便争取时间。</p>
<p>桑德尔一起来，汤姆·金就开始进攻，不料打出去的两拳都给招架的胳膊挡住了，接着，桑德尔就跟他扭在一块儿，拼命地抵住他，裁判费了很大力气才把他们拉开。汤姆也帮着摆脱自己。他知道青年人恢复得很快，而且知道，只要他能不让桑德尔恢复，桑德尔就会败在他的手下。只要狠狠的一拳就够了。桑德尔已经败在他的手下，这已经是无疑的了。他已经在战略和战术上胜过他，占了上风。汤姆·金从扭抱中摆脱出来，摇摇晃晃，他的成败得失，就在毫发之间。只要好好的一拳，就能把他打倒，叫他完蛋。汤姆·金忽然一阵悲痛，想到了那块牛排，来支撑他这必要的一击，那有多好啊！他鼓足力气，打了一拳，可是分量不够重，出手也不够快。桑德尔摇摆了一下，没有摔倒，蹒跚地退到绳子旁边就支撑住了。汤姆·金蹒跚地追过去，忍受着好像要瓦解一样的剧痛，又打了一拳。可是他的身体已经不听指挥了。他只剩下了一种要斗下去的意识，然而由于疲劳过度，连这一点意识也很模糊。这一拳他是对着下巴打过去的，可是只打到肩膀上。他本来想打得高一点的，可是疲劳的肌肉不服从指挥。同时，他自己却受了这一拳回冲力的影响，踉跄地倒退回来，几乎栽倒。后来他又勉强打出了一拳。这一次简直完全落空，他因为身体衰弱到了极点，就倒在桑德尔身上，跟他扭抱在一块儿，以免自己摔倒。</p>
<p>汤姆一点不想挣脱开来。他的力气已经用光了。他垮了。青年总有办法。即使在扭抱的时候，他也觉得桑德尔的体力变得比他强起来。等到裁判把他们拉开的时候，他所看到的，已经是一个身体复原的青年。桑德尔变得一刻比一刻强壮。他的拳头，起初还是软绵绵，不起作用。现在已经变得又硬又准了。汤姆昏花的眼睛看见他的戴手套的拳头正在向自己的下巴打来，他打算抬起胳膊来保护。他看到了这个危险，而且准备这样做，可是他的胳膊太重了。它好像一百多磅的铅块那么重。它不能自动地举起来，因此他就拼命集中意志要抬起这只胳膊。这时候，那只戴手套的拳头已经打中他了。他好像给电火击中一样，感到了一种剧烈的痛苦，同时，眼前一黑，他就什么都不知道了。</p>
<p>等到他再睁开眼睛的时候，他已经坐在自己的一角，只听见观众的喊声像邦狄海滨的惊涛骇浪一样。他的后脑压在一块潮湿的海绵上，锡德·沙利文正在向他脸上和胸口上喷冷水，让他苏醒过来。他的手套已经给脱下了，桑德尔正弯下腰来，跟他握手。他一点儿也不恨这个打昏了他的人，因此，他热诚地跟他握手，一直握得自己的破指节疼得受不了。然后，桑德尔就走到斗拳场当中，观众停止了喧噪，听他讲话。他接受了年轻的普隆托的挑战，而且建议把超过一般赌注的赌注增加到一百镑。汤姆无动于衷地听着，这时他的助手们拭去他身上的热汗，揩干他的脸，以便他可以出场。他觉得很饿。这不是那种寻常的、胃很疼的饥饿感觉，而是一种极度的衰弱，一种心口悸动、传遍全身的感觉。他回想起刚才比赛时，桑德尔摇摇欲坠，快要失败的那一刻。唉，一块牛排就顶用了！决定胜负的那一拳，就缺少这块牛排，现在他输了。这全因为那块牛排。</p>
<p>他的助手们扶着他，帮助他钻过绳子。他挣脱他们的手，自个儿低头钻过绳子，沉重地跳到地板上，跟在替他从拥塞的中央过道挤出一条路的助手们后面。当他离开更衣室到街上去的时候，有一个年轻人在大厅的人口对他说了几句话。</p>
<p>“刚才他在你手掌之中的时候，你为什么不把他打倒呢？”这个小伙子问道。</p>
<p>“去你妈的！”汤姆·金一面说，一面走下台阶，到了人行道上。</p>
<p>街角上酒店的门开得大大的，他看到那些灯光和含笑的女侍者，听到很多人都在谈论这次比赛，他还听到了柜台上生意兴隆的叮当直响的钱声。有人喊他喝一杯。看得出来他犹豫了一下，就谢绝了，继续走路。</p>
<p>他口袋里连一个铜板也没有，回家的两英里路好像特别长。他的确老了。走过陶门公园的时候，他突然在一张凳子上垂头丧气地坐下来，因为他想起了他的老婆正坐着等他，等着听拳击的结果。这比任何致命的拳头都沉重，简直无法承受。</p>
<p>他觉得人很衰弱，身上处处酸疼，那些打碎了的指节也很疼，它们在警告他，即使他找到了一种粗活儿，也要等一个星期，他才能握得住一把锄头或者铲子。饿得心口悸动的感觉使他要呕吐。悲惨的心情压倒了他，他眼睛里涌出了不常有的泪水，他用手蒙住脸，一面哭，一面想起了很久之前那天晚上，他对待斯托什尔·比尔的情形。可怜的老斯托什尔·比尔！现在他才明白了比尔为什么在更衣室里痛哭。</p>
]]></content>
      <categories>
        <category>读后感</category>
      </categories>
  </entry>
  <entry>
    <title>在细雨中呼喊</title>
    <url>/2024/09/19/%E8%AF%BB%E5%90%8E%E6%84%9F/%E5%B0%8F%E8%AF%B4/%E5%9C%A8%E7%BB%86%E9%9B%A8%E4%B8%AD%E5%91%BC%E5%96%8A/</url>
    <content><![CDATA[<p>前几天一直很焦躁。究其原因，虽难以言清，也未必愿意言于出口，倒也不是不能分析出来。大概与人类似，也是出于成长的寂寞和对未来的迷惘，其中也参杂一些以前便不愿想的无答案的话题，譬如孤独本质，生之意义之类。        </p>
<p>余华的作品以前看过他的活着和许三观卖血记，其中情节差不多都忘掉了，但他对生活和苦难下人物貌似轻描淡写的白描很是入木三分，让观者代入其中，恍如自己的记忆。低劣和不凡的人性通过他异常简单和冷静的带有回忆性质的淡然的笔触写出来，直指内心。《在细雨中呼喊》亦是如此，余华在这本带自传性质的书里（我说的自传性质只指主人公的心理成长历程，个人强烈的感觉其中有余华的影子）通过描述“我”在各种畸形压抑下的成长历程来颠覆了，或者残酷点明了人类之间薄若蝉翼的关系，其中既包括朋友，兄弟，和父母，也涵括亲情友情和爱情。</p>
<p>   首先，但在生存和苦难面前，这些虚饰的情感变得不堪一击。首当其冲的是亲情在生存面前的破裂，主人公的祖父的遭遇自不必说，成了家里无用的累赘，其弟死后也只是成为一家人改变命运的筹码。就连主人公自身，也得出了继父比他生父更像父亲的结论。</p>
<p>   其次，这本书的时间线索是主人公的成长历程。成长伴随的便是人性的觉醒，人性之中，出于繁殖目的的性欲为最强，这同叔本华的“生命意志”之论合一。这是导致许多悲剧的根源之一，主人公的生父继父甚至哥哥莫不沉沦。这种力量是无可排斥的，即便是主人公见到图片上的女人胴体后美好想象的破灭（众君有同样经历和感受否？嘿嘿），即便对自身性特征（腿毛）的排斥，但始终难以抵挡这种力量（暗恋对象对腿毛最浓男生的倾心，主人公屡次手淫后的自责和再犯），所谓爱情也只是为生存延续的表象而已。</p>
<p>   但是，除开苦难和性欲以外的关系呢？比如友情？即便我和苏宇如何惺惺相惜，无论我和哥哥因为同一战线而冰释前嫌，即使我和鲁鲁超越郑？和他们朋友那样世俗的关系成为忘年交，但这种关系始终是如薄冰一样太容易破碎的。无一例外地，他们终究是因为或这或那的寂寞而相聚，而推心置腹，但始终被生活的波浪击开而无暇相互顾及。（我们身旁的关系也超越不了。）</p>
<p>   但对于低劣的人性支配下的人类关系，余华真的是个彻头彻尾的悲观主义者吗？越是平淡的叙述，越显灰暗人性，越是灰暗的语调，便越显的人性中的真善美变得弥足珍贵。这本书曾有几次感动了我，细细想来，就有两处。一处是鲁鲁为了去看因卖淫被抓去劳教的母亲，九岁的孩童带着铺盖，不辞劳苦地赶到劳教处的情形。二处是主人公为了阻止继父对继母的性虐待而被打得鼻青脸肿，继而绝食抗争，最后还是在愧疚的继父的带领下去吃面的情形（这个场景似乎在许三观卖血记中看过，亦是感动不已）。而且，“我”在成长过程中一直与世俗保持距离，哪怕换取是家庭，学校的排挤隔离，也曾试图学习过伤害别人（溅脏女孩的裙子），但却内疚在心，以诚待人（标语事件）却被人背叛亦不改变自己（抗争到底），因为这世间不全是黑暗的（尚有继母的信任），最终呢？练成的大概是自己若即若离的处世之道（继父的叹息：你是个聪明的小孩）</p>
<p>“当我们凶狠地对待这个世界时，这个世界突然变得温文尔雅了。” - 这世界无非是你强我弱，你弱我强。但是最终占上风的未必是强的那方，有时候示弱也是一种姿态。 “她只是沉浸在我当时年龄还无法理解的自我与孤独之中，她站在生与死的界线上，同时被两者抛弃。”她已经那么老老的快要死去了，但是她还是在孤独地活着。死亡也许明天降临，也许明天她依旧被人忘记无人惦记孤独活着，无所依无所恋，就那样活着，孤独地活着，等待死亡来的那一天。 找不到活着的意义，却又迟迟等不到何时死去的讯息</p>
]]></content>
      <categories>
        <category>读后感</category>
      </categories>
  </entry>
  <entry>
    <title>卡夫卡-衣服</title>
    <url>/2024/02/09/%E8%AF%BB%E5%90%8E%E6%84%9F/%E5%B0%8F%E8%AF%B4/%E5%8D%A1%E5%A4%AB%E5%8D%A1-%E8%A1%A3%E6%9C%8D/</url>
    <content><![CDATA[<p>我看见满是皱褶、花边和流苏的衣服套在美丽的身体上，十分漂亮，我就常想，这些衣服好看不了多久，然后就会起皱，再也熨不平，就会沾上灰尘，灰尘厚厚地积在褶子里，再也除不去，我想，每天把同一件珍贵的衣服清早穿上，晚上脱掉，谁也不愿使自己显得这样悲哀可笑。但我看见一些女孩，她们长得相当漂亮，显露出风情万种的肌肉和骨节、富于弹性的皮肤和如云的秀发，她们日复一日，总是穿着这套天生的面具服，总是把同一张脸放进同一双手掌中，在镜子里映照同一张面孔。</p>
<p>只是偶尔在晚上，当她们从宴会很晚归来时，镜子里的脸看上去憔悴、浮肿，布满灰尘，已被所有人看见，这套面具服就很难再穿了。</p>
<p>随感:</p>
<p>卡夫卡把姑娘的身体比喻成了漂亮的衣服。衣服穿久了会破旧，而姑娘们的青春也会很容易挥霍殆尽。在美妙的时光过后，在尽力欢笑过后，剩下的只是“破旧”的青春容颜了。姑娘们可以变换很多件衣服来保持她们的美丽，但是青春的衣服只有一件。而且，人们会厌倦一件贵重的长袍，却永远不会厌倦自己的青春。问题就在这里。</p>
<p>人们总是自恋的，不仅仅是女性，每个人都愿意陶醉在自我欣赏里，而对于自我的兴趣和热爱，让他们进一步去热爱生活，去渴望得到别人的观看和欣赏。在最美好的青春年华里，人们总乐此不疲地把自己展示出去，这就是为什么年轻人总是积极的，渴望价值认同的。不论是美貌还是其他值得骄傲的特点，人们都把它们当作一件好衣服穿在外面炫耀，即使这件衣服有那么些制作不精良的小地方，也要把它妥妥帖帖地隐藏在不起眼之处。在“人生”这个互相展示的盛会上，人们得到了心理满足。可卡夫卡不是这样。从他的传记看，他是一个羞涩的、不自信的人，穿着华丽的晚礼服参加舞会对他来说是一件避之不及的可怕的事。他对那些漂亮的衣服有一种天性里的躲避。因此他对年轻人的这种炫耀有自己独到的看法。他充满洞见的目光看到了舞会之后的情况： 衣服“已经被太多的人所观看，而且几乎再也不能穿用了”。于是人们露出了本相，变得空虚、干枯、疲倦。这时候我们还能给自己剩下什么呢?只是虚无而已。何况，在卡夫卡看来，整日穿着同一件衣服到处展览而不厌倦，又是多么“倒霉而愚蠢”的事啊。</p>
<p>但是，不穿着它，我们又能怎样呢?尽管我们了解到它是虚无的，但是还是得继续穿下去。不管是无意识还是有意识，不管是兴高采烈还是心灰意冷，那件衣服成了我们的生存方式，我们必须穿着。这也许是卡夫卡没有说出来的话。哪怕人整个的存在就是一个错误，对于我们大部分平常人来说，生存的痛苦和欢乐都是真真切切的。正因如此，这篇短文中姑娘深夜照镜时“显得疲乏、浮肿、布满灰尘”的衣服所引致的冷落感，才深深刺痛了人心。</p>
<p>有的时候想想，人的一生真的好无趣，每个人都好像一台带着面具的信号接收器，奔波一辈子，只是为了接收其他人对这幅面具的评价，好让真实的自己从这些评价中得到生存的满足感，多可笑。</p>
<p>衣服是面具，身体是面具，金钱是面具，可爱情信仰梦想这些我们认为高贵圣洁的一切，又何尝不是呢。</p>
]]></content>
      <categories>
        <category>读后感</category>
      </categories>
  </entry>
  <entry>
    <title>枪炮细菌与钢铁</title>
    <url>/2024/09/05/%E8%AF%BB%E5%90%8E%E6%84%9F/%E5%B0%8F%E8%AF%B4/%E6%9E%AA%E7%82%AE%E7%BB%86%E8%8F%8C%E4%B8%8E%E9%92%A2%E9%93%81/</url>
    <content><![CDATA[<p>作者知识面广泛，从史前开始粗略描述了人类进化发展史的全过程，解释了各种反常现象的原因，比如非洲是智人的起源地，但非洲人在现代却远远落后，欧洲在最近几万年作为新月沃地的次生地为什么后来居上，远远领先最近几万年世界的两大农业和文明发源地：新月沃土和中国等等。</p>
<p>作者假设了这样一个场景：外星人在几万年前来到地球时会认为地球的主导者将是非洲人，欧洲人亚洲人等其他地区的人都将是附庸，因为非洲人的起步比其他大洲的人早的多，且非洲自然环境多样，动植物种类和数量都非常多。但现实却相反。作者从非常多的细节上阐释了原因，让我想到两句话：“细节决定成败”和“蝴蝶效应”。</p>
<p>作者梳理了新月沃地作为北非，埃及，中东，欧洲的文明发源地的原因和历史，以及中国为什么在最近几千年领先于世界但近代又落后了：</p>
<p><strong>“为什么新月沃地和中国把它们几千年的巨大的领先优势最后让给了起步晚的欧洲？”</strong></p>
<p>“<strong>新月沃地</strong>由于当地集中了可以驯化的动植物而拥有了领先优势。如果它一旦失去了这种优势，它就不再有任何引人注目的地理优势可言。这种领先优势在一些强大帝国西移的过程中消失了……新月沃地和东地中海社会不幸在一个生态脆弱的环境中兴起。它们破坏了自己的资源基础，无异于生态自杀。从东方(新月沃地)最古老的社会开始，每一个东地中海社会都在轮流地自挖墙脚，而就在这个过程中，权力西移了。”</p>
<p>“地理上的四通八达和非常一般的内部障碍，使<strong>中国</strong>获得了一种初始的有利条件。华北、华南、沿海地区和内陆的不同作物、牲畜、技术和文化特点，为中国的最后统一作出了贡献。例如，黍的栽培、青铜技术和文字出现在华北，而水稻的栽培和铸铁技术则出现在华南。我用本书的很大篇幅着重讨论了在没有难以克服的障碍的情况下技术的传播问题。但中国在地理上的四通八达最后却成了一个不利条件，某个专制君主的一个决定就能使改革创新半途而废，而且不止一次地这样做了。相比之下，欧洲在地理上的分割形成了几十个或几百个独立的、相互竞争的小国和发明创造的中心。如果某个国家没有去追求某种改革创新，另一个国家会去那样做的，从而迫使邻国也这样去做，否则就会被征服或在经济上处于落后地位。欧洲的地理障碍足以妨碍政治上的统一，但还不足以使技术和思想的传播停止下来。欧洲还从来没有哪一个专制君王能够像在中国那样切断整个欧洲的创造源泉。……环境因素还包括：新月沃地的居间的地理位置，控制了把中国和印度与欧洲连接起来的贸易路线，以及中国距离欧亚大陆其他先进的文明国家路途遥远，使中国实际上成为一个大陆内的一个巨大的孤岛。”</p>
<p>这里讲到交通的便利不仅是优点，也是缺点。最好不要太便利或太不便利。太不便利：停留在原始社会，太便利，会扼杀创新。</p>
<p>从历史来看这是很有道理的，但是有句话叫祸兮福之所倚 福兮祸之所伏。虽然近代集权扼杀了创新，但在大国竞争的世界格局下，集权很有可能是好处，只有在世界格局发生极大的变化后，集权才会重新成为坏处。</p>
<p>书的结尾看到的这句话有种世界线收束的感觉，前面铺垫的一大堆汇集到了这句话上：</p>
<p>“一跃而成为新兴力量的国家，仍然是几千年前就已被吸收进旧有的以粮食生产为基础的最高权力中心的那些国家，要不就是由来自这些中心的民族重新殖民的那些国家。……<strong>世界上两个最早的粮食生产中心——新月沃地和中国仍然支配着现代世界，或者是通过它们的一脉相承的国家(现代中国)，或者是通过位于很早就受到这两个中心影响的邻近地区内的一些国家(日本、朝鲜、马来西亚和欧洲)，或者是通过由它们的海外移民重新殖民或统治的那些国家(美国、澳大利亚、巴西)。</strong>撒哈拉沙漠以南的非洲人、澳大利亚土著和美洲印第安人支配世界的前景仍然显得黯淡无光。公元前8000年时的历史进程之手仍然在紧紧抓住我们。”</p>
<p>看完整本书有种意犹未尽的感觉，整本书很有意思，不过也有瑕疵：作者虽然知识面广，但书中有太多的推测和感觉，即使是作为社科来看也有些潦草，但整体上观点新颖，角度独特，非常耳目一新。</p>
<p>最后我联想到文明6的随机出生点，感觉有种悲哀感，在文明6中当出生点比其他人差很多时，自己完全无能为力，只有出生点资源接近的文明才能打的有来有回。人生是否如此呢？问题似乎在于我们如何定义我们人生所拥有的资源，这本书中也讲到了社科所面临的问题就是对未来预测的缺乏，这也是物理学等理科鄙视社科的原因：只能分析过去，打马后炮，无法准确预测未来，但物理定律可以。所以当一个被认为出生点不好的人成功时，社科会修改影响因素的范围，强行解释，甚至从结构和位置上分析。倘若如此，某些时候某些领域成功的人必是那些所谓处于不利的位置和结构的人了，即：祸兮福之所倚 福兮祸之所伏！</p>
]]></content>
      <categories>
        <category>读后感</category>
      </categories>
  </entry>
  <entry>
    <title>冯诺依曼传</title>
    <url>/2024/09/18/%E8%AF%BB%E5%90%8E%E6%84%9F/%E4%BC%A0%E8%AE%B0/%E5%86%AF%E8%AF%BA%E4%BC%8A%E6%9B%BC%E4%BC%A0%E8%AE%B0/</url>
    <content><![CDATA[<p>​        从中发现一个细节：冯诺依曼对冯诺依曼架构的灵感来源最初来源于蒸汽时代的纺织机。当时的一种改进型的纺织机能够保存要纺织的图案的模板，要织哪个图案，就用对应的模板，这是最初计算和存储分离的雏形。原来伟大的技术最开始可能来源于并不起眼的东西，只有博览群书，才能有不知从哪冒出来的灵感。马斯克，巴菲特，查理芒格都是被称为“书虫”的人。</p>
<p>​        他个人从小的经历是经典的犹太家庭的经历。冯·诺依曼的父亲麦克斯是个典型的犹太人，勤奋、机智和善于经营，年轻时就已经是布达佩斯的银行家，教育子女方面他有卓越的才能，冯·诺依曼的母亲贤慧温顺，受过良好教育。一个生动的例子是一家人用餐方式很特别，无论是午饭还是晚饭，全家人一边用餐一边开研讨会，每个家庭成员都要提出特别主题供大家分析讨论，气氛活跃。冯·诺依曼的餐桌经常高朋满座，类似现在的商业午餐。小冯·诺依曼在这种环境之下，从小就进行各种阅读然后在讨论会上进行展示。六岁时就能用希腊语同父亲互相开玩笑，八岁时掌握微积分，十岁时读完了一部四十八卷的世界史，并可以对当前发生的事件和历史上某个事件做出对比，十二岁读懂领会了《函数论》要义。</p>
<p>​        十八岁的冯•诺伊曼同时在三所大学注册：在苏黎士联邦理工学院学习化学工程，每晚完成柏林大学数学专业的作业，在每个学期末回布达佩斯大学参加他从没上过课的数学考试。二十二岁那年他不但从苏黎士联邦理工拿到化学工程学位，还通过了当时大数学家希尔伯特的数学博士答辩。普林斯顿高等研究院刚成立时，三十岁的冯•诺伊曼教授和五十多岁的物理学家爱因斯坦、数学家维布伦、数学家亚历山大一起成了高等研究院最初任命的四位教授。</p>
]]></content>
      <categories>
        <category>读后感</category>
      </categories>
  </entry>
  <entry>
    <title>富兰克林传</title>
    <url>/2024/11/20/%E8%AF%BB%E5%90%8E%E6%84%9F/%E4%BC%A0%E8%AE%B0/%E5%AF%8C%E5%85%B0%E5%85%8B%E6%9E%97%E4%BC%A0/</url>
    <content><![CDATA[<p>​        我在初中时便接触了苏格拉底辩论法。但却没有坚持使用。</p>
<p>道德完善计划，富兰克林理想的13项美德 </p>
<p>1、 节制：食不过饱，饮不过量。 </p>
<p>2、 沉默：言则于人于己有益，不做无益闲聊。 </p>
<p>3、 有序：一切物品都应有序放置，每件事情都应按时完成。</p>
<p>4、 意志坚定：事当做必做，绝不半途而废。 </p>
<p>5、 节俭：所费钱财必须于人于己有利（绝不浪费） </p>
<p>6、 勤奋：不虚度光阴，每时每刻都做有用的事，摒弃不必要的行为。 </p>
<p>7、 真诚：绝不欺骗伤害他人，思想纯洁公正，言之有据。 </p>
<p>8、 正直：不冤枉伤害他人，不忘记自己造福他人的责任 </p>
<p>9、 中庸：不走极端，如果受到应有的伤害，不要恼怒。 </p>
<p>10、 清洁：保持身体、衣服和住所的整洁干净。 </p>
<p>11、 平静：心如止水，不为琐事、庸事或难以避免之事所扰。 </p>
<p>12、 贞洁：克制欲望，除非为了健康或生养后代，以免头脑愚钝、身体虚弱，或损害自己和他人的安宁和名誉。 </p>
<p>13、 谦逊：效仿耶稣和苏格拉底</p>
]]></content>
      <categories>
        <category>读后感</category>
      </categories>
  </entry>
  <entry>
    <title>史蒂夫.乔布斯传</title>
    <url>/2024/09/19/%E8%AF%BB%E5%90%8E%E6%84%9F/%E4%BC%A0%E8%AE%B0/%E5%8F%B2%E8%92%82%E5%A4%AB.%E4%B9%94%E5%B8%83%E6%96%AF%E4%BC%A0/</url>
    <content><![CDATA[<p>苦行和极简将会让人更加敏锐。</p>
<p>1.不空等</p>
<p>乔布斯年轻时，他要是想要某样工具来造点什么东西的时候，他会直接去找源头要。</p>
<p>他回忆起在12岁的时候，他想要造一个计频器，于是直接在电话簿里找到了HP的创始人Bill Hewlett，找他要了那些零件。</p>
<p>2.打造自己的现实</p>
<p>乔布斯很早就懂得，要是不喜欢生活中或世界里的某样东西，就改变它们，要么通过行动，要么通过纯粹的意志力量。</p>
<p>Hoffman后来叹道，“现实扭曲力场有鞭策的作用，但接着现实会反击。”——Joanna Hoffman是苹果早期Macintosh团队成员之一。</p>
<p>“我不想当父亲，所以我就不是。”乔布斯后来说。声音里透着一丝懊悔。</p>
<p>3.控制能控制的一切</p>
<p>在某种程度上，乔布斯是个嬉皮士，但和上个世纪60、70年代谈情说爱的自由精神不同，他是个注重细节的控制狂。</p>
<p>他要控制他的环境，把产品看成是他自身的一种延伸。</p>
<p>4.承认自己的错误</p>
<p>乔布斯有时很严厉甚至不近人情，这点在他和他第一个女儿之间表现得最为典型。随着年纪越来越大，他开始面对死亡，也越来越愿意承认自己的错误。</p>
<p>“我做了许多我并不自豪的事情，比如在23岁时让我的女朋友怀上了孩子，处理方式也十分不妥。”</p>
<p>5.了解自己</p>
<p>尽管并不总是清楚旁人是如何看待自己的外貌举止，乔布斯对自己过人的头脑却有着清醒的认识。</p>
<p>他困惑地发现：他比父母还要聪明。</p>
<p>6.给不可思议留一扇门</p>
<p>乔布斯是个探索者，一生都在追求精神上的启迪以及身体的净化。他并不特别信仰宗教，但也不否存在人类认识之外的事物。</p>
<p>“我想，不同的宗教就像是不同的门，通往的是同一个房子。我有时想，房子是存在的，有时又不这么想。这真是个伟大的谜。”</p>
<p>7.别退缩</p>
<p>乔布斯的暴躁情绪和时不时的过激反应都是出了名的。在产品研发上，他的评价非黑即白，不是极佳就是狗屁。</p>
<p>“他为人既开明又残酷，”她回忆说，“真是奇怪的组合。”——Chrisann Brennan，乔布斯的前女友</p>
<p>8.被出色的人包围</p>
<p>不管他承不承认，乔布斯不是什么都会的。没错，他可以对每个产品每个广告活动施加巨大的影响，但他也知道，世界有些人的技能是他无法企及的。乔布斯 早期和Steve Wozniak的搭档就充分说明了这一点。和Wozniak搭档而获得了早期的成功，给乔布斯未来和别人的通力协作提供了模板。</p>
<p>两个月后他准备要测试了。“我在键盘上敲了几个字母，我被惊呆了!它们在屏幕上显示了出来。”那是1975年6月29日，是个人电脑的里程碑。“这是历史上的第一次，”Wozniak后来说，“人人都在自己电脑的键盘上敲下一个字母，看着它在眼前的屏幕上显示出来。”</p>
<p>9.打造一个A级团队</p>
<p>通常情况下，公司和经理会满足于水平一般的员工。而乔布斯重视人才，并认定在一家全是A级员工的公司里，任何矛盾摩擦都可以被出色的成果所抵消。他可能是正确的。</p>
<p>“生活里的大多数东西，最好的和平庸的之间约有30%的差距。最好的航班、最好的膳食，都可能比平庸的要好上30%。在我 眼里，和水平一般的工程师相比，Wozniak要好上50倍。他光用脑子想就能开会。Mac团队就是打造A级团队的一个尝试。人们说他们无法和睦相处，说 他们会相互憎恨，但我发现A级员工喜欢和A级员工共事，他们压根就不想和C级的人共事。”</p>
<p>“这么些年来，我懂得了，要是你有非常优秀的员工，你根本不需要像照看婴儿般看着他们，”乔布斯后来解释，“期待他们有优秀的成果，你就能让他们做出优秀的成果出来。”</p>
<p>10.做自己</p>
<p>乔布斯经常忙于做自己，以致于忽略了别人是如何看待他的，特别是在他那早期当嬉皮士的日子里。</p>
<p>“开会时我们没法不看他那脏兮兮的脚。有时候，为了释放压力，他还会在马桶里把双脚浸湿，这一举动可没减轻他同事的压力。”——Mike Markkula，苹果首任主席</p>
<p>11.富有说服力</p>
<p>早期的乔布斯要是在旁边的话，气味的确是会有点难闻，就是这样的乔布斯把自己训练得能长时间不眨眼地盯着别人看，还发现了用这招可以说服别人做不可能的事情。</p>
<p>“如果它能够救人的命，你能想办法把启动时间减少10秒吗?”他问。Kenyon说有这个可能。乔布斯走到白板前，说，“假如有500万人在使用Mac，而每天需要额外的10秒来启动，加起来每年就有近3亿个小时，这就相当于每年至少救了100条命。”</p>
<p>12.告诉别人怎么做</p>
<p>乔布斯称不上是真正的程序员或者技术工程师，更无法和微软的比尔盖茨相提并论了，但是，他对技术和设计有着一种直觉的理解，这最终改变了世人对电脑的期待，更改变了消费电子行业。</p>
<p>“老实说，我们原来并不知道‘友好’对电脑意味着什么，是乔布斯告诉了我们。”——Terry Oyama，早期Macintosh设计团队的成员。</p>
<p>13.相信你的直觉</p>
<p>我在自己的职业生涯里，凭直觉不只一次抓住了机会。而乔布斯对自己的品味有着深刻而恒久的信仰，深信要是自己喜欢些什么，公众也同样会喜欢。而他几乎总是对的。</p>
<p>“贝尔在发明电话前有做过任何市场调研吗?”</p>
<p>14.敢于冒险</p>
<p>在他整个职业生涯里，乔布斯抓住了多次机会，首先是成立了苹果，然后出走，直到1997年再回来。在一个大多数公司都在想方设法进行多样化经营的年 代，乔布斯领导下的苹果却反其道而行之，削减业务，精简产品，专注在相对较少的领域上面。如果他认定某样东西将来会获得成功，他会改变苹果整艘船(或至少 某些方面)的航向，朝一个方向进发。</p>
<p>乔布斯的管理哲学之一就是，要不时地抛抛骰子，把公司赌在某个新的想法或科技上面。</p>
<p>“我有这个疯狂的想法：我们可以通过iPod的广告影响来卖出更多的Mac。此外，iPod还可以把苹果定位成创新的、年轻的公司。所以我把 7500万的广告费用拨给iPod，哪怕这个产品按比例还分不到1%。这意味着我们完全统治了音乐播放器市场。我们比别人多投入了一百倍。”</p>
<p>15.用优秀延续优秀</p>
<p>无论是产品还是电影，乔布斯总是力图要创造优秀的后续产品/续集。在职业生涯的早期他做得并不成功(比如Lisa电脑)，但他在皮克斯和苹果都证明了自己能够做到。</p>
<p>“在商业上有个经典的东西，就是‘第二款产品症状’。”乔布斯后来说。“背后的原因在于你并不了解你第一款产品成功的原因是什么。”</p>
<p>16.做艰难的决定</p>
<p>优秀的管理者和领导都愿意努力工作，也经常做不受欢迎的决定。乔布斯当然不怎么在乎别人喜不喜欢他，因此，做艰难的决定的时候，会更加轻松。</p>
<p>他做的最明显的一个决定是要彻底把Newton终止掉——它是世界上第一款个人数字助理，拥有还不错的手写识别系统。</p>
<p>17.演讲演示(presentation)意义重大</p>
<p>乔布斯痛恨PPT演示，但或许相信讲究的产品展示至关重要。</p>
<p>“包装可以是个剧场，它可以创造一个故事。”——Jony Ive，苹果设计师</p>
<p>18.想办法平衡你的火爆脾气</p>
<p>不知乔布斯是否真的成熟过，但他的确懂得了在他和其它苹果人之间存在缓冲有一定的用处。</p>
<p>在一家CEO容易暴躁大怒的公司里面，Cook用冷静的头脑、舒缓的口音、安静的凝视，掌握着局面。</p>
<p>19.为今天而活</p>
<p>就算乔布斯癌症缠身，苦苦挣扎，他也很少慢下脚步。这个疾病反而帮他集中了精力，用来追求他最宏大的一些梦想。</p>
<p>“‘记住你即将死去’是我一生中遇到的最重要的箴言，它帮我做出了生命中的重要决定。”</p>
<p>“记住你即将死去”是我知道的最好的办法，能帮你躲开‘认为自己有什么可失去’这个陷阱。你赤裸裸的身无一物，还有什么理由不去追随你的心。”</p>
<p>20.分享智慧</p>
<p>乔布斯不是个乐善好施的人。他对产品和成功充满激情，但直到病入膏肓后，他才开始伸出手来，和科技界的人分享智慧。</p>
<p>“我也会继续指导像Mark Zuckerberg那样的人，我剩下的时间里就会这样做。我可以帮助下一代记住伟大公司的传承并学会继续这个传统。硅谷一直对我支持有加，我应该尽我所能来回报它。”</p>
]]></content>
      <categories>
        <category>读后感</category>
      </categories>
  </entry>
  <entry>
    <title>李光耀观天下</title>
    <url>/2025/09/01/%E8%AF%BB%E5%90%8E%E6%84%9F/%E4%BC%A0%E8%AE%B0/%E6%9D%8E%E5%85%89%E8%80%80%E8%A7%82%E5%A4%A9%E4%B8%8B/</url>
    <content><![CDATA[<p>李光耀对世界各地的政治都有深入的理解，这种理解需要熟知当地的历史，文化，宗教，语言等等方面才能拥有。他本人实际上是一个本科数学专业的高材生，但是为了家乡而转行。我不知道他读过多少书，见过多少人，去过多少地方，但很明显非常多，他的见闻来源渠道丰富，且孜孜不倦。有一种信息輸入的方式是刻意控制自己只接受某些方面的輸入，这样似乎可以提高信息的利用率，还有一种是尽可能扩大自己的輸入来源和渠道但不偏信任何一种而是综合判断，很明显后者有优势，因为如果你的輸入渠道不够丰富你很可能无法判断哪些是好的輸入渠道，万一走偏了可以纠正过来，但第一种如果没走偏信息利用率非常高，如果走偏了信息全部报废，属于是高风险高收益的赌博，赌单一信息来源的正确性。实际在运用中可以综合使用这两种，首先评估信息来源的正确性，对于高正确性的来源可以使用第一种比如超过200年的经典书籍，理论。对于新兴的产业，技术，理论则必须扩大信息源，多听不同人的意见，多看不同理论的书。</p>
<p>他对于中国的预判相当准确，在80年代便准确预判了40年后会发生的许多事，其中人口问题是他面对新加坡也无能为力的，他认为原因在于女性的受教育程度提高，拥有了独立的经济和社会地位，但女性作为独立个体在现代社会理应享有享受生活的权利，所以人口问题是无解的。</p>
]]></content>
      <categories>
        <category>读后感</category>
      </categories>
  </entry>
  <entry>
    <title>硅谷之火</title>
    <url>/2024/09/24/%E8%AF%BB%E5%90%8E%E6%84%9F/%E4%BC%A0%E8%AE%B0/%E7%A1%85%E8%B0%B7%E4%B9%8B%E7%81%AB/</url>
    <content><![CDATA[<p>​        土质计算机俱乐部的人们想把计算机变成像电子学和一样流行的东西。直到现在，电子学也不算流行吧，起码在中国。</p>
<p>​        沃兹制作机器，马尔库拉有商业思想，斯科蒂管理商店，可是留有胡志明式胡须的莽撞小伙子却是推动力。创业需要的领域知识极多，必须要不同领域的人合作才行，且需要有一个执行力强的人做”坏人”。</p>
<p>​        许多计算机极客动不动就是连续2周，连续1个月每天工作10几个小时，工作到凌晨2点，12点起直接吃午饭再工作一天。</p>
<p>这本书中极多的人并没有遵循通常的发展轨迹来规划学业和职业，好像按正常路线走的人才是少数。可能比尔盖茨除外，他的关系太硬了，这么晚入场还是统治了市场。</p>
<p>还有这群人虽然和真正的大公司无法相比，但他们也基本人均家里有自家车库，有独院，可以在车库组装各种电子器械，很多人拥有喜欢捣鼓电子元件的父亲。</p>
]]></content>
      <categories>
        <category>读后感</category>
      </categories>
  </entry>
  <entry>
    <title>西行漫记</title>
    <url>/2024/09/14/%E8%AF%BB%E5%90%8E%E6%84%9F/%E4%BC%A0%E8%AE%B0/%E8%A5%BF%E8%A1%8C%E6%BC%AB%E8%AE%B0/</url>
    <content><![CDATA[<p>1.在对未来未知的时候，能够相信自己宏观的判断并依此做事是非常难得的</p>
<p>2.不要因为尊敬父母，爱父母而去做父母让你去做的事，不去做父母不让你做的事；也不要因为讨厌父母，恨父母而去做父母不让你去做的事，不去做父母让你做的事；抛开自己主观的态度和情绪后思考，去做自己认为需要做的事，不去做自己认为不需要做的事。要有只有自己掌控自己的意识。</p>
<p>总结了太祖年轻时的活动：独立思考，大量阅读，强身健体，以才交友，大量交际，同时志怀天下，接触当时最新的思想，不以求田问舍为业，敢于实践，又会写作，会演讲，有组织能力。</p>
]]></content>
      <categories>
        <category>读后感</category>
      </categories>
  </entry>
  <entry>
    <title>马斯克传</title>
    <url>/2024/09/18/%E8%AF%BB%E5%90%8E%E6%84%9F/%E4%BC%A0%E8%AE%B0/%E9%A9%AC%E6%96%AF%E5%85%8B%E4%BC%A0/</url>
    <content><![CDATA[<p>这段描述马斯克小时候的场景：</p>
<p>​        智力发育迟缓。”他的一位老师解释说，他在大部分时间都处于恍饱状态听不进去别人说的话。“他一直看着窗外，我说你要注意听讲，他说:“叶现在变成棕色的子。”埃罗尔说埃隆说得对，树叶就是变棕色了。<br>​        当父母同意对埃隆进行听力测试时，僵局终于被打破了—好像这就是问题的症结所在。埃隆说:”他们认为是我耳朵的问题，所以把我的腺样体拿掉了。”学校的负责人不再纠缠于他的注意力问题，但这没有改变他在思考问题时置身事外、无视外界信息的倾向。“从小时候开始，如果我要思考一些困难的问题，那么我所有的感官系统都会关闭。”埃隆说,“我看不到，也听不到任何东西。我在用大脑进行计算，而不是接收外界的信息。”班上其他孩子会跳起来，在他面前挥舞手臂，看看他能不能注意到他们，结果没有。梅耶说:“当他眼神放空时，最好不要试图干扰他。”<br>​        除此之外，他不愿意保持涵养地忍受那些他眼中的“傻瓜”，这让他的社交问题变得更加复杂。</p>
<p>让我想到了初中时被认为像一个傻瓜似的样子，反应迟钝，不理解他人说的话外音。我认为是自己的问题，然后开始模仿他人理解他人说话时的方式。</p>
<p>当我看到马斯克提到大学时，不想为那些商科的人打工时，我心里咯噔一下，立马就知道，这个时间点之后的信息没用了。因为按发展心理学的划分，这个表述已经足以反映出其“自我同一性”已经建立起来了。对比国内，同一阶段的大学生还困扰于“我要做什么”，还处在一个意义缺失的“空心病”状态。所以，时间还要往前追溯，去看马斯克是什么时候开始有这种主体性的。</p>
<p>（我为什么说后面的信息没用了？是因为后面的创业，建立公司，只是在这个心理原型的基础上不断地进行现实具现，本质上属于“量变”。而对读者，对我，有意义的地方，是去观察整个历程中的“质变”点。按这个标准，我私人有一个看法，即别看马斯克后面的事业做得那么成功，其自我发展、内在成长层面实质是停滞的。关于这一点，书中马斯克自己是有觉察的。马斯克本人有一种特殊的人格魅力，但距离我们所想象的，能够带领人类进军宇宙的“领袖”形象，中间还欠缺了这部分人格整合）</p>
<p>结果一追溯就追溯到大概10来岁左右，跟父亲生活的那一段时间。我这里直接给出简要结论：</p>
<p>1、对父母的认同。马斯克父母的搭配很有意思，父亲我推测疑似NPD，能够编织出一套自己信以为真但实际不存在的现实，这在蛊惑、折服他人方面非常好用。而母亲则是那种个性坚强、百折不挠，非常坚韧的女性，这种双重的认同实际产生了一种奇妙的化学反应，使马斯克叠加了务实与异想天开两种特质，于是就看着这个人怎么看怎么不靠谱但又偏偏能把事做成。</p>
<p>2、可供玩耍的外部环境。书中提到当时年幼的马斯克决定跟父亲一起住是一个让他深感后悔的决定，其实这是不公允的，马斯克并没有意识到父亲其实是带他走到了外部世界，他拥有一个或许拙劣，却确实一定程度“在位”的父亲，而不是像很多国人，父亲是严重“缺位”的。（虽然这并不是他父亲有意识的作为）所以小马斯克得以在一个“有父亲”的外部环境中，带着好奇去探索和冒险。这种与环境的互动为其奠定了遇事敢作敢为的体验基础。相较而言，国人小孩被关在家里、学校里、辅导班里，缺乏这种真实的环境互动，日后进入社会，就很会像动物园里的动物直接被放归野外那样的无措。</p>
<p>3、可以一起玩耍的同伴。以前的小孩，因为都是家族式聚居，所以兄弟姐妹多，小孩就是在这个聚众玩耍的过程中，自发习得了一般的社交秩序和社会交往的方式，完成了初步的社会化。这并不是说，小孩就有了熟练的社交手段，而是说小孩会消除掉对社交的陌生感，所以马斯克虽然不是个社交王者，虽然不通人情，有时候对人刻板冷漠，但这跟一般意义上讲的社恐或者反社会是完全不同的概念。马斯克在现实生活中，甚至在很小的时候，对如何调用资源就非常熟练，比如会非常坚持地向他父亲一遍又一遍重复提自己的要求。比如会主动要求旁听自己感兴趣的会议。而国内很多工作多年的人，让其向陌生人，向权威简单的求助都可能存在心理障碍。</p>
<p>4、关键资源。命运很多时候是具有随机性的，有时候会自带限制性。比如余华老师小时候也是放养，但余华能获得的资源就只有各种书，还是没得选那种，最后就走上了文学道路。马斯克当时所在的场景，恰好有各种手工原件，所以他动手能力这方面的那个自我，就得以孕育、壮大了起来。</p>
<p>这几点可以启发一个人去思考自己，如何被塑造，被影响，去思考从何处来的问题。关于马斯克的火星移民，我仍然有一个私人的理解，即他所追求的要解决的这种巨大的理想与现实的冲突，其实是隐喻弱小的童年自己，与强大的外部大他者的冲突。从地球的离开隐喻了从现实，从当下，从年幼的无助中逃离，去到一个更理想的地方，是一种象征性的“弑父”。关于这一点，书中有两处隐秘的细节，一是撑不住的时候非理性的想见父亲，二是给父亲买房子希望父亲住附近。带着心理学视角去看，有些不起眼的部分就一目了然。</p>
<p>回到最前面提到的，触动我的部分，也是后来使我花了比读书更多时间思考的东西，马云是马斯克吗？某宝可以类比亚马逊吗？中国的科技公司跟美国的，都叫科技公司，是同质的吗？有些东西，一细想，会止不住，会一个问题接一个问题。这是一方面。另一方面，生活就是不会自然而然的，如果不做点什么，那真的就是不会剩下什么。我看马斯克，看遍了全书，看到了各种痛苦，就是看不到一点点的迷茫。迷茫的人都会有一个共同的母题，就是“责任剥夺”的问题。</p>
<p>中国人在什么时候不迷茫？读书的时候。因为“你只需要好好读书”。所以，一个个体的，个性化的生命责任，在那个时期，全部都没了，被安了个好好读书作为统一的责任。但这个责任，它是生命本身的责任吗？它只是实现责任的工具罢了。那么读书时期一过，阅后即焚了，原先的好好读书没有了，那人要干什么呢？对吧，迷茫了。迷茫就是这么来的。</p>
<p>那么解决方式也很简单。当时是安了一个“好好读书”的责任，现在再找一个“好好工作”不就可以了？还有“好好结婚生子”“好好养老”……同样的配方，熟悉的味道。</p>
<p>所以我们会看到，东亚不同人的简历永远这么整齐划一，对吧，一种秩序的美感。而西方的往往就五花八门。这本传记里提到的各路人物，那履历更是花里胡哨，充满了野性的潦草。</p>
<p>生活，不是生出来就不管了，是要正儿八经去活的。是什么让人陷入按部就班呢？是什么抑制了人的生命力，使人找不见责任，使人不敢去承担而只是推脱，不敢去面对而只是逃避，不敢于认真而只能糊涂，不敢于选择而只能放任，是什么呢？为什么呢？</p>
<p>Paypal共同创始人彼得·蒂尔表示，“马斯克是为了冒险而冒险，他似乎享受其中，有时甚至是上瘾。”对于马斯克这样的人，仅仅生存并不能让他们满足，他们需要时时刻刻感受到自己真切地活着，而风险与危机是生命最好的兴奋剂，它们能调动一个人全部的身心资源，让人无比专注，免于无聊无趣，甚至会忘记痛苦和创伤的过去。更重要的是，人往往是在这样的情况下才能获得对自身力量的最大肯定。</p>
<p>无论是早年父亲对他的精神虐待，还是南非混乱的成长环境都让马斯克对痛苦与危险习以为常，而见识过人生的这一面就很难再相信平静与安全是常态，它们更像是战斗的间隙。这种经历让他养成了一种“四面受敌”的心态（siege mentality），也让他长期怀有一种末日焦虑。无论在商业中还是政治上，他往往能觉察到即将出现的重大威胁，当然这也成了他的动力来源，就像雄心勃勃的战士找到了自己的用武之地。后来，当他听说推特内部推崇给员工“心理安全感”时，他感到很可笑并本能地加以反对。他想打造一个争强好胜、斗志昂扬的氛围，狂热的战士们应该枕戈待旦，而不是享受安逸。正如热力学第二定律所指出的，秩序是暂时的，失序是必然的，而真正的安全感来自比危险更快一步。</p>
]]></content>
      <categories>
        <category>读后感</category>
      </categories>
  </entry>
  <entry>
    <title>决策的艺术</title>
    <url>/2025/01/14/%E8%AF%BB%E5%90%8E%E6%84%9F/%E7%94%9F%E6%B4%BB%E4%B9%A0%E6%83%AF/%E5%86%B3%E7%AD%96%E7%9A%84%E8%89%BA%E6%9C%AF/</url>
    <content><![CDATA[<p>高效的决策流程的6条标准：</p>
<ul>
<li>它聚焦于重要的方面</li>
<li>它合乎逻辑且前后连贯</li>
<li>它承认决策中存在主观和客观的因素，并且将分析与直觉思考综合起来</li>
<li>它只需要解决某个特定困境时所必需的信息和分析，无须更多</li>
<li>它鼓励和指导收集相关的信息和可取的意见</li>
<li>它简明，可行，易于运用并且灵活</li>
</ul>
<p>最佳的决策方法是主动作为。最糟糕的方法就是消极等待，错失良机。</p>
<p>精明选择的8个要素：</p>
<ol>
<li>问题</li>
<li>目标</li>
<li>备选方案</li>
<li>结果</li>
<li>取舍</li>
<li>不确定性</li>
<li>风险承受力</li>
<li>相关联的决策</li>
</ol>
<p>1.问题：着力解决正确的决策问题</p>
<p>2.目标:详细说明你的目标：你最想得到的东西，你的兴趣，价值观，担忧，恐惧，向往。</p>
<p>3.备选方案：提出创造性的备选方案</p>
<p>4.结果：理解决策的结果</p>
<p>5.取舍：权衡各方面的利弊。</p>
<p>6.不确定性：澄清不确定性。</p>
<p>7.风险承受力</p>
<p>8.相关联的决策</p>
]]></content>
      <categories>
        <category>读后感</category>
      </categories>
  </entry>
  <entry>
    <title>游戏设计艺术</title>
    <url>/2025/04/16/%E8%AF%BB%E5%90%8E%E6%84%9F/%E5%B7%A5%E5%85%B7%E4%B9%A6/%E6%B8%B8%E6%88%8F%E7%9A%84%E8%89%BA%E6%9C%AF/</url>
    <content><![CDATA[<p>游戏的本质是传递体验。首先自己得有一个独特的体验，而自己要有独特的体验，首先得在日常生活中注意到自己的体验，也就是自我觉察，刻意观察自己的状态；然而观察本身会破坏体验的过程，就像海森堡原理（观察这个行为会破坏被观察的对象的状态）。所以只能事后回忆。在回忆体验时，需要用尽可能清晰的语音准确的描述体验，而不是模糊或混沌的感觉。这样我们才能问自己：</p>
<p>我想要让玩家获得怎样的体验？</p>
<p>这种体验的本质是什么？</p>
<p>我的游戏如何抓住这种本质？</p>
]]></content>
      <categories>
        <category>读后感</category>
      </categories>
  </entry>
  <entry>
    <title>反脆弱</title>
    <url>/2025/10/01/%E8%AF%BB%E5%90%8E%E6%84%9F/%E7%94%9F%E6%B4%BB%E4%B9%A0%E6%83%AF/%E5%8F%8D%E8%84%86%E5%BC%B1/</url>
    <content><![CDATA[<p>世界本质上是不可预测的（“黑天鹅”事件频发），传统的“稳健”或“强韧”系统（即能够抵抗冲击、保持原状）已经不够用了。真正强大的系统应该具备 <strong>“反脆弱性”</strong>。</p>
<p><strong>反脆弱（Antifragile）</strong> 是塔勒布自创的概念，它超越了“坚韧”或“ robust ”（能在冲击中保持不变），指的是<strong>那些能从波动、压力、混乱、不确定性和挫折中学习、调整、进化，并因此而变得更强大、更优秀的事物</strong>。</p>
<p><strong>一个简单的比喻：</strong></p>
<ul>
<li><strong>脆弱（Fragile）</strong>： like 一个玻璃杯，掉到地上会摔碎。</li>
<li><strong>强韧/坚韧（Robust）</strong>： like 一个塑料杯，掉到地上不会坏，但也不会变得更好。</li>
<li><strong>反脆弱（Antifragile）</strong>： like 九头蛇（Hydra），砍掉它的一个头，它会长出两个头。<strong>或者像我们的肌肉组织，通过承受压力（锻炼）而变得更强壮。</strong></li>
</ul>
<p>因此，全书的主旨是：<strong>我们不应该试图预测和防止所有冲击（这不可能），而应该致力于构建个人、社会、经济、政治等各方面的“反脆弱性”，从而在一个我们无法理解的世界里更好地生存和发展。</strong></p>
<p>通常的系统会因为存在风险而变得脆弱和易损，而反脆弱是指主动接受更多风险并从中获益的能力。这种能力将错误，问题当做成长的途径，所以如果没有问题，反而不会成长，这和肌肉，人生似乎也有相通之处。</p>
]]></content>
      <categories>
        <category>读后感</category>
      </categories>
  </entry>
  <entry>
    <title>如何阅读一本书</title>
    <url>/2024/09/05/%E8%AF%BB%E5%90%8E%E6%84%9F/%E7%94%9F%E6%B4%BB%E4%B9%A0%E6%83%AF/%E5%A6%82%E4%BD%95%E9%98%85%E8%AF%BB%E4%B8%80%E6%9C%AC%E4%B9%A6/</url>
    <content><![CDATA[<p>这本书读起来略显陈闷、稍微费力，有点像在读教科书或工具书，但整体来说很不错。这是一本1940年初版的老书，国内于2004年出版后已经24次印刷，且长期占据当当网社科类图书销售排名第1位，豆瓣网图书评分也长期据高不下。</p>
<p>作者在书中将阅读的目的分为简单娱乐、获得资讯和增进理解三种。首先，娱乐性的阅读最不费功夫，对阅读者的要求也最低，如读通俗小说、花边新闻等；其次，为了获得资讯或知识而读书看报，即读能读懂与作者理解力在一个层次的东西，这都不在本书讨论之列。本书所讨论的是为了增进理解的阅读，也就是阅读对象超越了阅读者的现有水平，通过阅读可间接地提升阅读者的理解和思考能力的书。这是有思维的多种运作方式参与的行为，有利于个人心智的发展和提升。</p>
<p>阅读的层次</p>
<p>一、 基础阅读（四个阶段）<br>1、 阅读准备阶段（6、7岁，学龄前）<br>2、 孩子会学习读一些简单的读物，看图识字（一年级）<br>3、 字汇的增长及对课文的运用（四年级）<br>4、 精炼与增进前面所学的技巧（小学毕业，青少年）</p>
<p>二、检视阅读<br>1、有系统地略读或读<br> 先看书名页，然后如果有序就先看序<br> 研究目录页<br> 如果书中附有索引，也要检阅一下<br> 读一下出版者的介绍<br> 挑几个看来跟主题息息相关的篇章来看<br> 把书打开来，东翻翻西翻翻，念个一两段，有时候连续读几页，但不要太多</p>
<p>2、粗浅的阅读<br>头一次面对一本难读的书的时候，从头到尾先读完一遍，碰到不懂的地方不要停下来查询或思索。</p>
<p>三、分析阅读（敲黑板处）<br>1、第一个阶段（四个规则，找出谈什么）<br> 依照书本的种类与主题作分类<br> 用最简短的句子说出整本书在谈些什么（找出主题或重点）<br> 按照顺序与关系，列出全书的重要部分，将全书的纲要拟出来之后，再将各个部分的纲要也一一列出<br> 找出作者在问的问题，或作者想要解决的问题</p>
<p>2、第二个阶段（四个规则，诠释内容）<br> 诠释作者使用的关键字，与作者达成共识<br> 从最重要的句子中抓出作者的重要主旨<br> 找出作者的论述，重新架构这些论述的前因后果，以明白作者的主张<br> 确定作者已经解决了哪些问题，还有哪些是未解决的。在未解决的问题中，确定哪些是作者认为自己无法解决的问题</p>
<p>3、第三个阶段（评论一本书）<br> 除非你已经完成大纲架构，也能诠释整本书了，否则不要轻易批评<br> 不要争强好胜，非辩到底不可<br> 在说出评论之前，你要能证明自己区别得出真正的知识与个人观点的不同</p>
<p>番外篇—辅助阅读（也称外在阅读，借助其他一些书籍来阅读一本书）<br> 相关经验<br> 其他的书（按照时间顺序来读）<br> 导论与摘要（除非你看完一本书，否则不要看某个人的导读）<br> 工具书<br>—-字典：关于字的书<br>—-百科全书：关于事实的书</p>
<p>四、主题阅读（五个步骤）<br>1、找出相关的章节<br>在主题阅读中，你及你关心的主题才是基本的重点，而不是你阅读的书。<br>2、带引作者与你达成共识<br>3、理清问题<br>4、界定议题<br>5、分析讨论（面面俱到，而自己并不预设立场）</p>
<p>阅读不同读物的方法</p>
<p>一、 实用型的书<br>1、 作者的目的是什么？<br>2、 他建议用什么方法达到这个目的？<br>3、 内容真实吗？<br>4、 这本书与我何干？<br>赞同一本实用型的书，却确实需要你采取行动。</p>
<p>二、 想象文学<br>想象文学是在阐述一个经验本身。不要抗拒想象文学带给你的影响力。不要去找共识、主旨或论述，我们要从自己的经验中思考。<br>1、 你必须将想象文学作品分类；<br>2、 你要能抓住整本书的大意，简要地说明剧情；<br>3、 你不仅要将整本书简化为大意，还要能发现整本书各个部分是如何架构起来的。</p>
<p>三、 故事、戏剧与诗<br>1、 故事书：快读，并且全心全意地读。让角色进入你的心灵之中。小说能满足我们潜意识或意识中许多的需要，它触及潜意识的层面。<br>2、 史诗：要求你集中注意力，全心参与并运用想象力。<br>荷马的《伊利亚特》与《奥德赛》<br>维吉尔的《埃涅阿斯纪》<br>但丁的《神曲》<br>弥尔顿的《失乐园》<br>《圣经》<br>3、 戏剧：如果你没有将剧本搬上心灵的舞台演出过，或许你还不算是读过剧本了。把<br>剧本大声地读书来。<br>4、 抒情诗：不论你觉得自己懂不懂，都要一口气读完，不要停。重读一遍，大声读出<br>来。<br>任何人在任何时间，只要处于孤独又敏感的状态，都可以创造出诗句来。</p>
<p>四、 历史书、传记与自传、当前事件及文摘<br>1、历史书：历史比较接近小说，而非科学，两个要点：<br> 对你感兴趣的事件或时期，尽可能阅读一种以上的历史书；<br> 阅读历史时，不只要关心在过去某个时间、地点真正发生了什么事，还要读懂在任何时空之中，尤其是现在，人们为什么会有如此这般行动的原因。<br>2、传记（定案本，一生，不能用来写活着的人）：用读历史的方法来读。<br>3、自传（授权本，继承人或重要的朋友写）：不能像读一般的历史书一样，读者必须了<br>作者可能会有偏见。<br>4、 当前的事情：是谁在写这篇报告；读者要擦亮眼睛。<br>5、 文摘：浓缩的唯一功能就是激励我们去阅读原著。</p>
<p>五、 科学与数学（专家写给专家看的东西）<br>1、 科学基本上是归纳法，为了了解科学中的归纳法的论点，你就必须了解科学家引以为理论基础的证据，做实验，亲身体验。<br>2、 数学其实是一种语言，你的责任不是成为这个主题的专家，而是要去了解相关的问题。<br>3、 科普书，为广泛的大众而写。</p>
<p>六、 哲学书、神学、经书<br>1、 哲学<br> 哲学来自怀疑，哲学就是一种思考，别无他物；<br> 孩子是天生的发问者，最伟大的哲学家所提出来的深刻问题，正是孩子们所提出来的问题；<br> 阅读哲学的提示：最重要的就是要发现问题，或是找到书中想要回答的问题；<br> 哲学问题的最大特色就在每个人必须为自己回答这些问题。<br>2、 神学（自然神学和教义神学）<br>接受首要原则是成立的，然后用阅读任何一本好的论说性作品都该有的精神来阅读。<br>3、 经书：虔诚地读<br>犹太人：《旧约》<br>基督徒：《新约》<br>回教徒：《古兰经》</p>
<p>七、 社会科学（种族问题，、犯罪、执法、贫穷、教育、福利、战争与和平等）<br>主要着眼点在一个特殊的事件或问题上，而非一个特殊的作者或一本书。<br>容易处：取材自读者所熟悉的经验<br>论说的方式也经常是叙述式<br>困难处：投入看法，术语难懂。</p>
<p>如何做一个自我要求的读者</p>
<p>一、一个阅读者要提出的四个基本问题（论说性或非小说类）<br>1、整体来说，这本书到底在谈些什么？<br>2、作者细部说了什么，怎么说的？<br>3、这本书说得有道理吗？是全部有道理，还是部分有道理？<br>4、这本书跟你有什么关系？</p>
<p>二、如何做笔记<br>1、 画底线；<br>2、 在画底线的栏外再加画一道线；<br>3、 在空白处做星号或其他符号 ；<br>4、 在空白处编号；<br>5、 再空白处记下其他的页码；<br>6、 将关键字或句子圈出来；<br>7、 在书页的空白处做笔记。</p>
<p>阅读与心智的成长<br>1、 阅读超越你头脑的书，只有那样的书能帮助你的思想增长；<br>2、 一本好书能教你了解这个世界以及你自己，还更懂得生命，你变得更有智慧；<br>3、 伟大的经典就是在帮助你把这些问题想的更清楚一点儿，因为这些书的作者都是比一般人思想更深刻的人；<br>4、 好的阅读，也就是主动的阅读，不只是对阅读本身有用，也不只是对我们的工作或事业有帮助，更能帮助我们的心智保持活力与成长。</p>
<p>书 摘<br>• 现代的媒体正以压倒性的泛滥资讯阻碍了我们的理解力。<br>• 弗兰西斯.培根曾经说过：“有些书可以浅尝即止，有些书是要生吞活剥，只有少数的书是要咀嚼与消化的”。<br>• 无限制的受教育机会是一个社会能提供给人民最有价值的服务。<br>• 在阅读的时候，让自己昏昏入睡比保持清醒要容易得多。<br>• 科学家会从他特殊经验的结果作举证，哲学家却会以人类的共通例证。<br>• 事实上，一本书之所以能给你带来新的洞察力或启发，就是因为其中有一些你不能一读即懂的字句。<br>• 如果你对一篇文章连一个问题也提不出来，那么你就不可能期望一本书能给你一些你原本就没有的视野。<br>• “用你自己的话来说”，是测验你懂不懂一个句子的主旨的最佳方法。<br>• 只靠可能会下的雨滴，青草是不会滋长的；或者，只靠可能有的储蓄，一个人的存款账目是不会增加的。<br>• 当你的情绪很强烈时，你可能会认为自己很有道理。<br>• 一个读的很广泛，却读不精的人，与其值得赞美，不如值得同情。<br>• 我们都是经由感官与想象来体验事情，我们都是运用判断与推论，也就是理智，才能理解事情。<br>• 我们阅读小说时，我们想要的是一个故事，这个故事只要确实可能在小说家笔下所创造，再经过我们内心重新创造的世界中发生，就够了。<br>• 对于小说，我们不该反对或赞成，而是喜欢与不喜欢。<br>• 在伟大的作品中，世界多多少少是美好的。只要有可能，我们希望经常住在哪个故事的世界里。<br>这本很难读的书终于啃完了，死磕了自己就是为了以后看书效率更高些，收获更多些，结合我们的读书沙龙，让孩子们收益更多些。书是合上了，但具体运用这些实用的技巧去实践，那才是最重要的事情，后续的事情才刚刚开始。</p>
]]></content>
      <categories>
        <category>读后感</category>
      </categories>
  </entry>
  <entry>
    <title>微习惯</title>
    <url>/2024/09/02/%E8%AF%BB%E5%90%8E%E6%84%9F/%E7%94%9F%E6%B4%BB%E4%B9%A0%E6%83%AF/%E5%BE%AE%E4%B9%A0%E6%83%AF/</url>
    <content><![CDATA[<h2 id="微习惯是什么？"><a href="#微习惯是什么？" class="headerlink" title="微习惯是什么？"></a>微习惯是什么？</h2><p>如果你想培养一个新习惯，微习惯基本上就是它经过大幅缩减的版本。比如：</p>
<ul>
<li>计划每天做俯卧撑100个，那就把目标定为每天做1个俯卧撑。</li>
<li>“每天写3000字”缩减成每天写50字</li>
<li>把“始终保持积极思考”缩减成每天想两件好事</li>
<li>……</li>
</ul>
<p>有人可能会说，1个俯卧撑，开玩笑吧，这样太简单了吧！？</p>
<p>确实1个俯卧撑非常简单，几乎每个人都能轻易做到，正是因为简单，所以我们几乎不需要花费意志力就可以完成这项目标。这就是微习惯的关键所在，只要目标足够小，就不会失败。</p>
<p>当然，又有人会问：“好吧，我暂且相信你的说法，每天的目标是1个俯卧撑，并且我也能坚持下去，做1个俯卧撑确实很容易，可又有什么用？”</p>
<p>那么微习惯是否有效呢？</p>
<h2 id="微习惯为什么有效"><a href="#微习惯为什么有效" class="headerlink" title="微习惯为什么有效"></a>微习惯为什么有效</h2><p>微习惯通过构建正反馈循环来让人对习惯“上瘾”。人总是倾向于做自己有能力完成的事而不是没能力完成的事；人总是倾向于做曾经做过之后发现自己完成的量比计划的量多的事，而不是做曾经做过之后发现自己完成的量比计划的量少的事；</p>
<p>大脑是注重效率的，因而更偏爱执行潜意识的活动，因为并不需要消耗能量进行过多思考。当我们下意识地养成习惯，久而久之，付出极少的努力就能做正确的事情。</p>
<h2 id="聪明的管理者与愚蠢的重复者"><a href="#聪明的管理者与愚蠢的重复者" class="headerlink" title="聪明的管理者与愚蠢的重复者"></a>聪明的管理者与愚蠢的重复者</h2><p>本章讲述了习惯改变中的两个关键工具——前额皮层和基底神经节。它们分别负责执行决策和进行自动行为模式识别。前额皮层的管理功能相当活跃，反应灵敏，但同时也消耗了大量的精力和意志力；基底神经节的自动功能不仅强大，而且效率高，能节省精力，无须持续监督就能处理各种任务。</p>
<p>它们每一部分都有令人难以置信的重要性。作者很严谨地举了两个研究实验，对比论证了这两部分缺失产生的恶劣影响，以此证明它们对习惯养成的重要性。</p>
<p>基底神经层不像前额皮层那样“聪明”，但可以高效地重复，节省精力；而前额皮层能意识到人类特有的高层次目标，一旦你学会巧妙运用它，将带来意想不到的效果。</p>
<p>因此，我们应该尽可能缩减我们做我们想要完成的事情的步骤，将其自动化，让它很容易被触发，触发后很容易完成，完成后立刻得到反馈，并得到下一次触发的条件。</p>
<p>如果我们探寻一下互联网公司的产品是如何开发的，我们就会明白这一点，那些让人上瘾的app在开发时，用户做的每一个动作都被模拟并被思考和争论如何才能让用户：</p>
<p>更快的看到视频：点开app立马就是推荐页，推荐页直接就是视频（让它很容易被触发）</p>
<p>更快的看完视频：视频直接自动播放（触发后很容易完成）</p>
<p>更快的让人理解视频：超短视频让人立马明白视频的内容和意义，不需要太多思考（完成后立刻得到反馈）</p>
<p>更快的看到下一个视频：手指划一下就可以立马切换到下一个视频，甚至当前视频播放完会自动切到下一个视频并自动开始播放（并立马得到下一次触发的条件）</p>
<p>整个过程仿佛软件开发者认为使用app的人是一个残疾人或者是星际飞船中躺在椅子上的300斤的大胖子，用户只需要睁开眼睛盯着屏幕就够了。</p>
<p>我们在构建自己想要的习惯时便可以借鉴这套成熟的方法，将习惯尽可能自动化，通过基底神经层完成它而不是前额皮层。</p>
<p>另一个例子便是有一个说法，人每天能够主动做出的选择数量不超过10个，当我们一次又一次需要为我们要做的事主动选择时，我们的意志力就在不断被消耗，最终我们感到筋疲力尽，于是我们转向我们不需要主动思考便可以完成的事：比如刷短视频，打自己很熟悉的游戏等等。</p>
<h2 id="微习惯的八大原则"><a href="#微习惯的八大原则" class="headerlink" title="微习惯的八大原则"></a>微习惯的八大原则</h2><p>1.绝不要自欺欺人</p>
<p>虽然一开始我们制定了微目标，但是在执行的过程中总是不自觉地会“作弊”，抬高自己的目标。其实，大可不必这样太高自己的期望值。期望值第一些，我们渴望完成的就多一些。我们可以随时超越微目标，但要让额外的奖励来激励自己，而不是一开始定下的目标。</p>
<p>2.满意每一个进步</p>
<p>李小龙说：“要满意，但别满足。”</p>
<p>微习惯是一种重视开始的生活哲理，一种认为行动优于动力的生活哲理，一种相信将每一小步积累起来便能让量变转为质变的生活哲理。</p>
<p>我们要对自己完成微目标表示满意，但不能止步于此，而是不满足与现状，用成就感激发自己超额完成的热情。</p>
<p>3.经常回报自己，尤其在完成微习惯之后</p>
<p>一个完美的行为会在现在给你回报，也会在今后持续给你回报。我们在培养习惯的初期总是艰难的，成果也十分有限，因而我们要在完成任务后给自己一些奖励，鼓舞自己继续坚持。</p>
<p>4.保持头脑清醒</p>
<p>一开始，由于新奇感我们或许会觉得完成那个行为很有趣，久而久之，就会感觉乏味、无聊。然而，胜利者和失败者的区别就在于当事情变得单调而无聊时，失败者会放弃，胜利者不会。</p>
<p>习惯的建立需要稳定，因而我们要时刻保持清醒的头脑，不受情绪左右。</p>
<p>5.感到强烈抵触时，后退并缩小目标</p>
<p>我们的意志力是有限的，如果强行突破自己的能力范围，可能会导致崩溃和受伤的结局。因此，当我们的抵触情绪很强是，不妨缩小自己的目标，直至抵触感最小为止。</p>
<p>这并不丢人。因为每一个重大成就都是由非常微小的步骤组成的，而一次完成一个步骤并不是弱小，是精准的表现。你的微目标成了内心永恒的火花，永不熄灭。</p>
<p>6.提醒自己这件事很轻松</p>
<p>就像戒烟一样，如果你一开始就对自己说：“戒烟很难。”你可能还没开始就放弃了。然而，如果你一直暗示自己：“戒烟很容易。戒烟很容易。戒烟很容易。”或许它真的就没有那么难了。</p>
<p>7.绝不要小看微步骤</p>
<p>每一个有机体都是由微小的细胞组成，每一个大工程也都是由无数小步骤组成。采用微步骤能帮助我们一步步实现自己的目标，所以千万不要小看它哟。</p>
<p>8.用多余的精力完成任务，而不是制定更大目标</p>
<p>罗马不是一天建成的，我们也不可能在短时间内完成自己的大目标。目标渺小、结果丰硕的状态比反过来好多了。</p>
]]></content>
      <categories>
        <category>读后感</category>
      </categories>
  </entry>
  <entry>
    <title>心流</title>
    <url>/2024/09/18/%E8%AF%BB%E5%90%8E%E6%84%9F/%E7%94%9F%E6%B4%BB%E4%B9%A0%E6%83%AF/%E5%BF%83%E6%B5%81/</url>
    <content><![CDATA[<p>​        从社会制约下解放自我，最重要的步骤就是时时刻刻发掘每一事件中的回馈。如果我们学会在不断向前推进的体验中找到快乐与意义，社会制约的重担就会从肩上自动滑落。</p>
<p>越来越完美的自我控制，产生一种痛快的感觉。你不断逼身体发挥所有的极限，直到全身隐隐作痛；然后你会满怀敬畏地回顾自我，回顾你所做的一切，那种佩服的感觉简直无法形容。它带给你一种狂喜，一种自我满足。只要在这种战役中战胜过自己，人生其他战场的挑战，也就变得容易多了。</p>
<p>——这点感触颇深。开始的一部是很费力气的，学习某个新知识或者技能的过程。从一点点懵懂开始，到达一定了解发现其实自己似乎绕了一个大圈子，不过这些都无所谓，如果保留好努力的时间记录，就能感动一种狂喜。就像迈台阶那样，到达一层感到一种极大的满足感和成就感。这大概是物质所不能给予的。而且在此之后，会对自己充满自信，再次尝试新事物的时候也不再恐惧。</p>
<p>享乐无须耗费精神能量，但乐趣必须运用高度的注意力。换言之，享乐可以不花力气，只要大脑特定中枢受到电击或药物的刺激，就能产生享受的快感；但是打网球、看书、谈话，若不全神贯注，就会觉得索然无味，毫无乐趣可言。</p>
<p>​        乐趣的出现主要有八项元素。一般人回想最积极的体验时，至少都会提及这些元素中的一项，或是全部。首先，这种体验出现在我们面临一份可完成的工作时。其次，我们必须能够全神贯注于这件事情。第三和第四，这项任务有明确的目标和即时的反馈。第五，我们能深入而毫不牵强地投入到行动之中，日常生活的忧虑和沮丧都因此一扫而空。第六，充满乐趣的体验使人觉得能自由控制自己的行动。第七，进入“忘我”状态，但心流体验告一段落后，自我感觉又会变得强烈。最后，时间感会改变—几小时犹如几分钟，几分钟也可能变得像几小时那么漫长。这些元素结合成一种深刻的愉悦感，带来无比的报偿，并扩展成极大的能量，仅是感觉它的存在就已值回“票价”了。</p>
<p>​        这里想起了游戏改变世界这本书介绍的一个观点：游戏如何让我们产生心流，让我们不能自拔。书中也提及了可以将这些应用于工作生活。感觉上，游戏做的最好的就是及时反馈和适时升级的难度。工作生活对于我们的努力给予了太少的关注，经常忙了很多只能得到些许反馈，而且不够及时。如何在兴趣中设定好目标反馈，才是能够持续下去的关键。</p>
<p>​        最优体验的一大特色在于它本身就是目标。即使最初怀有其他目的，但到头来活动本身就已带来足够的报酬。</p>
<p>​        “自成目标”指的是做一件事不追求未来的报酬，做这件事本身就是最大的回馈。</p>
<p>​        我们在研究中发现，所有心流活动，不论涉及竞争、投机还是其他形式的体验，都有一个共同点：它带来一种新发现、一种创造感，把当事人带入新的现实。它促使一个人有更好的表现，使意识到达过去连做梦也想不到的境界。简单地说，它把自我变得更复杂，自我因而成长，这就是心流活动的关键。</p>
<p>​        不论多么简单的体能活动，只要能产生心流，就令人觉得乐趣无穷。基本步骤包括：（1）确立一个总目标，并尽可能包含多个实际可行的子目标；（2）找出评估目标进度的方法；（3）保持精神集中于所做的事情上，并且对活动涉及的挑战进行越来越精细的区分；（4）培养随机应变所需的技巧；（5）在活动变得令人厌倦时，随时提高挑战的难度。</p>
]]></content>
      <categories>
        <category>读后感</category>
      </categories>
  </entry>
  <entry>
    <title>思考致富</title>
    <url>/2024/09/05/%E8%AF%BB%E5%90%8E%E6%84%9F/%E7%94%9F%E6%B4%BB%E4%B9%A0%E6%83%AF/%E6%80%9D%E8%80%83%E8%87%B4%E5%AF%8C/</url>
    <content><![CDATA[<h2 id="把欲望变成财富的6个步骤："><a href="#把欲望变成财富的6个步骤：" class="headerlink" title="把欲望变成财富的6个步骤："></a>把欲望变成财富的6个步骤：</h2><p>　　1）心里确定真正所企求的财富数量目标，数目一定要明确<br>　　2）为了达到你所乞求的目标，你确定自己有决心付出些什么代价<br>　　3）确定一个具体日期，你决心何时拥有你所乞求的目标<br>　　4）拟定一个实现你欲望的明确计划，并且不论你是否已有准备，要立即开始将计划付诸行动<br>　　5）将你要得到的财富的数量目标、达到目标的期限以及为达到目标所愿付出的代价，以及如何取得这些财富的行动计划等，都简明扼要地写下来。并写一份督促自己的誓词类的声明。<br>　　6）每天把这份声明大声地读两边，一遍在晚上入睡前，一遍在早晨起床后。在你读这份声明时，你要想象到、感觉到自己已经拥有了这笔财富。</p>
<p>　　将人生目标定得很高，以及追求财富与幸福所需要的努力，绝不会比接受悲惨与贫穷所需要的努力来得更多。</p>
<p>　　对你潜意识的心智，反复而肯定地下达命令，这是促使信心自动发展的唯一途径。</p>
<h2 id="获得自信的5个步骤："><a href="#获得自信的5个步骤：" class="headerlink" title="获得自信的5个步骤："></a>获得自信的5个步骤：</h2><p>　　1）我知道我有能力达到一生中我所确定的主要目标，所以我要求自己坚持下去，继续努力，向达到目标之路前进。我现在就保证一定采取这样的行动。<br>　　2）我确知我心里的支配性思想，终究会自行表现出来，变成实际的行动，并逐渐化成有形物质的事实。因此我决定每天集中思想30分钟，思考我决意要做什么样的人，从而在我心目中创造一个清晰的精神形象。<br>　　3）我知道，依靠自我暗示的原则，我心目中所一再坚持的任何欲望，最终必定会有办法使其实现。因此，我决意每天用10分钟的时间来培养自信心。<br>　　4）我已清楚地写下一篇声明，记录了我一生中所确定的主要目标。我绝不停止努力，直到成功。<br>　　5）我充分认识到财富与地位都不可能持久，除非它们建立在真理与正义之上，因此我绝不从事对别人不利的任何行为。我要发挥自己的吸引力，来争取别人的合作；我要以我自己乐于为别人服务的精神，来吸引其他人替我服务。</p>
<p>　　你所依靠的知识来源：<br>　　1）本人的经验和教育<br>　　2）与别人（智囊团）合作可能得到的经验和教育<br>　　3）学校（以多种方式进入其中学习）<br>　　4）公共图书馆（从书籍上可以学到各种完备的只是）<br>　　5）专业训练课程</p>
<p>　　想做好一件事情永远不能嫌麻烦！</p>
<p>　　想象力的功用有2种表现形态。其一是综合想象力，其二为创造想象力。</p>
<h2 id="成为领导的条件："><a href="#成为领导的条件：" class="headerlink" title="成为领导的条件："></a>成为领导的条件：</h2><p>　　1）在对自己的职业具有深刻认识的基础上，满怀自信和勇气（没有一位追随者愿意被一为缺乏勇自信与勇气的领袖所支配，这种领袖不可能长期支配聪明的追随者）。<br>　　2）自制（不能控制自己的人，是没有能力控制别人的。自制是为追随者树立领袖榜样，以引起追随者的效仿）<br>　　3）正义感（如果一位领袖没有公平与正义感，就不可能只会追随者，并保持追随者对他的尊敬）<br>　　4）迅速的决策（做决策式犹豫不决的人，表示他对自己缺乏信心，因此不可能成功地领导别人）<br>　　5）明确的计划（没有明确的计划，就好比没有舵的船，迟早要撞上礁石的）<br>　　6）加倍工作（这是领导必须付出的代价）<br>　　7）迷人个个性（领袖需要被人尊敬，因而他必须具备迷人的品性）<br>　　8）同情与谅解（领袖必须了解下属及其他人所面临的问题）<br>　　9）精通专业<br>　　10）愿意承担全部责任<br>　　11）合作原则（领导需要权力，而权力需要合作）</p>
<h2 id="领导失败的10大原因："><a href="#领导失败的10大原因：" class="headerlink" title="领导失败的10大原因："></a>领导失败的10大原因：</h2><p>　　1）没有把握全局的能力<br>　　2）不愿意做低级的事情<br>　　3）言而不行<br>　　4）怕部属有优异的表现<br>　　5）没有想象力<br>　　6）自私<br>　　7）放纵无度<br>　　8）不忠<br>　　9）过于强调权威<br>　　10）强调头衔</p>
<h2 id="失败的31种原因："><a href="#失败的31种原因：" class="headerlink" title="失败的31种原因："></a>失败的31种原因：</h2><p>　　1）不利的遗传背景<br>　　2）缺乏明确的人生目标<br>　　3）缺乏志向与抱负<br>　　4）缺乏足够的教育<br>　　5）缺乏自律<br>　　6）健康不佳<br>　　7）童年时代不良环境影响<br>　　8）拖沓<br>　　9）缺乏百折不挠的精神<br>　　10）消极的个性<br>　　11）对性冲动缺乏控制<br>　　12）不能控制不良欲望<br>　　13）缺乏迅速的决断力<br>　　14）具有6种基本恐惧中的一种或几种（贫穷、被批评、生病、失去爱、年老、死亡）<br>　　15）选错结婚的对象<br>　　16）过分小心谨慎<br>　　17）选择了错误的事业伙伴<br>　　18）迷信和偏见<br>　　19）选错职业<br>　　20）未能专心致志<br>　　21）花钱没有节制<br>　　22）缺乏热情<br>　　23）偏执<br>　　24）没有节制<br>　　25）没有与别人合作的能力<br>　　26）拥有不是靠自己努力而得到的权力<br>　　27）蓄意欺骗<br>　　28）自大的虚荣<br>　　29）以猜测代替思考<br>　　30）缺乏资本<br>　　31）没有意识到自己以前失败的原因（对于个人来说，失败的原因总是相似的，我们经常在一个错误里陷入不可自拔）</p>
<h2 id="培养毅力的4个步骤："><a href="#培养毅力的4个步骤：" class="headerlink" title="培养毅力的4个步骤："></a>培养毅力的4个步骤：</h2><p>1.有一个明确的目的，要用实现这一目的的强烈欲望来支持它。</p>
<p>2.有一个明确的计划，用实际行动逐步体现出来。</p>
<p>3.不受消极懈怠思想的影响，包括亲人、朋友和熟人的消极思想。</p>
<p>4.结交一个或多个能鼓励你贯彻执行计划和意愿的人。</p>
<h2 id="性征对成功的影响"><a href="#性征对成功的影响" class="headerlink" title="性征对成功的影响"></a>性征对成功的影响</h2><p>性表达的欲望会使大脑兴奋，性表达的欲望是天然天生的，我们不能想掩盖就掩盖，想隐藏就隐藏。我们必须要有途径来宣泄，把自己的性欲转化为个人的魅力。</p>
<p>内容有点拔的过高导致显的比较鸡汤了。基本就是在说自我验证效应。</p>
]]></content>
      <categories>
        <category>读后感</category>
      </categories>
  </entry>
  <entry>
    <title>掌控习惯</title>
    <url>/2024/09/04/%E8%AF%BB%E5%90%8E%E6%84%9F/%E7%94%9F%E6%B4%BB%E4%B9%A0%E6%83%AF/%E6%8E%8C%E6%8E%A7%E4%B9%A0%E6%83%AF/</url>
    <content><![CDATA[<p>​        书在开头，便给出了如何养成好习惯的答案：忘记目标，专注于体系。  我基本上是被这个概念所吸引住了，也是基于此才鼓励自己坚持下去读完，此类概念和想法都在强调一个人本身内在的世界，强调一种秩序感，这种秩序仅仅是一种形式上的，并不直接对应某些规范，它最大的特征便是游离于现实规范之外，无限地逼近某些真相。  实际上，我是突然意识到习惯的重要性，因为我发觉自主的意识和情绪并不能直接地导向一个好的想要的结果，这可能跟人性的弱点有关。借用萨特对自由的观点，人类不仅仅是自由的，而且注定是自由的，个体构建了自己和自己的世界，也因此为此负责，然而这个“自己的世界”真正如我意的部分太少，难道是我主动地选择了痛苦？显然我并不没有搞清楚，我的内在想法、欲望、情感到底如何影响着我的行为，那么答案在哪呢？我不敢说这本书是金科玉律，但是读完，我还是有了一些收获。  </p>
<p>​        书的前面部分主要阐述，习惯的重要性。这个概念看起来真的是很鸡汤，但是仔细想一想，习惯的重要性确实被忽视了，一般强调的比较多的是一个人的信念多么强大，认知多么深刻，以及一种天生的基因已经决定的特质。所以要想真正说服一个人，让他完完全全认可习惯的重要性是不容易的，恰恰就是这里，作者打动了我，他认为，习惯塑造了你的身份，反之“你所自认为的”身份也塑造了你的习惯。  我们先看一般的观点：首先得养成一个好的习惯，然后通过这样一种方式便能更为轻松地实现我们想要的目标；如果要进一层的话，那便是一个有好习惯的人，他所想要实现的目标会比较容易达成的。但实际上我们会发现，人们并不是很在意如何轻松地实现目标，甚至在实现目标的路上，有个好习惯根本无关紧要，所以习惯的重要性就无足挂齿了，反而刻意地强调习惯成了一种自我的约束，而在交出自由这件事上，很少有人会让步。 不过，就自由这个话题，一个人真的有多少自由吗？或者说，他在多大程度上能实现“自由地活”？  再回到作者给出的观点，他将“习惯”和“身份”绑在了一起，这两个概念互为因果，既强调了“习惯”的重要性，又给出了如何养成“习惯”的关键钥匙。  首先要把“身份”这个概念抬上前所未有的高度，换句话说，你目标的达成仅仅只是浅层次的追求，而更彻底的“自我实现”是身份的转变；人的一生可以有很多目标，但是一个一以贯之的内在的身份是无可替代的精神支柱，这个“身份”可以是抽象的概念，比如自律的人、一直在自我思考的人、趣味不一般的人、甚至一个游离于主流社会的人等等；也可以是具体的代指，比如优秀的医生、强健的运动员、还有笔耕不辍的写作者等等；这些身份不是唯一的，也不是固定的，但在某个阶段必须是确定的。 当你的内心认可且选择了某个身份，你就能够不断培养基于自己身份的习惯，如何养成习惯的问题解决了；而习惯反过来不断地塑造着你的身份，习惯的重要性的问题也解决了。 从本质上来说，培养基于自己身份的习惯，最根本点便是我们希望成为什么样的人，而这个命题，我想没有人会否认它的重要性和意义所在吧？  那这里的“身份”又和开头所说的“体系”有什么关系呢？作者说，体系是有一整套信念和假设塑造的，即是隐藏在习惯背后的身份，所以说是一个意思，类似的说法还有很多，比如看待自己的方式、比如支配自己行为的潜在信念，但显然“身份”要直接且简洁一点。 </p>
<p>​         作者后文用来大量的说理来论证上述内容。  比如“你的行为通常反映了你的身份。你的所作所为表明你相信——无论是有意识的还是无意识的——自己是哪种类型的人。研究表明，一旦一个人完全认同自己身份的某个特定方面，他就更有可能如此这般地行事。例如，那些自认为“选民一族”的人可能会比那些声称自己只是想“投票而已”的人，更积极地去投票。类似地，将健身融入自己身份的人不需要说服自己去定期锻炼。这事做起来很容易。毕竟，当你的行为和身份完全一致时，你所追求的不再是行为上的改变。你的一举一动无非体现着你自以为从属的那类人该有的举动。”。  再比如“更确切地说，你的习惯是体现你身份的方式。如果你每天都铺床，你体现着一个有条理的人的身份；如果你每天都写作，你体现着一个有创造力的人的身份；如果你每天都训练，你体现着运动员的身份。一种行为重复的次数越多，与之相关的身份就越是得以强化。事实上，“身份”这个词最初来源于拉丁语单词“essentitas”，意思是存在，以及“identidem”，意思是反复。你的身份实际上就是你的“反复存在”。” “不管你现在的身份是什么，你相信它存在的理由只是你有证据。你对一个信念拥有的证据越多，你就越坚信它。” 以上这两段，一个是身份带来习惯，一个是习惯体现身份。 还有一些写的不错的地方，我再次也一并摘录，附上我当时写的想法。  “你越是以自己身份的某一方面为傲，你就越有动力保持与之相关的习惯。如果你以自己的一头秀发为傲，你就会养成各种习惯去呵护和保养它；如果你以自己发达的肱二头肌为傲，你会确保自己永远不会放过锻炼上身的机会；如果你以自己织的围巾为傲，你会更有可能每周抽出几个小时用于编织。一旦涉及你的自豪感，你就会尽心尽力地保持你的习惯。”（这一段也是在说身份带来习惯）  </p>
<p>​        说实话，作者这个想法与概念，真的非常激励人，吸引人，让人感到振奋不已。他牢牢把握了“一个人”非常核心的存在的根基——身份问题；且巧妙地把这个最容易被人忽视但其实非常重要的概念运用到积极心理学当中。人的行为从潜意识层面都是与他的身份紧密结合的，也正是基于对自己身份的认知，才组成了一个人从前往后，从生到死的所有行为。同时，对于大多数人来说，身份已经固定了，打工者、医生、教师、孩子、学生、妻子、底层、屌丝、富二代；你会发现，这些身份认知几乎没有完完全全是个人主动寻求的，而且成了一个枷锁，一个符号，一个束缚人的标签，再加上身份认知对人的影响是巨大，由此，我们可以看见普通人的一生就此被牢牢锁定。然而，一般意义上的身份的改变是很难的，所以，我们得从认识上做出尝试，我是学生，但同时我是一个自律的人；我是工人，但同时我还是一个有梦想的人；我是上班族，但同时，我还是一个追求自由的人；“自律的人“、“有梦想的人”、“追求自由的人”这些身份是否真的能导向我们想要的结果不重要，重要的是我所有的行为都和这个“身份”融入一体，那么这样一个方法论的提出与实践的目的，便达到了。 </p>
<p>​        还有一段作者从另外一个角度叙述了习惯的重要性，我觉得还蛮有道理的，他说“习惯的形成非常有用，因为心理意识是大脑的瓶颈。一心不能二用。因此，大脑总是努力确保你集中注意力，关注当下最根本的问题。只要有可能，头脑会有意识地把一些任务交给无意识去自动完成。这正是习惯形成时会发生的情况。习惯减轻了认知负荷，释放了心智能力，从而让你可以将注意力分配给其他任务。  如果你总是被迫做简单的决定，诸如我该什么时候去健身、我去哪里写文章比较好、我该什么时候付账单，等等，那么你自由支配的时间相应地就会减少。只有让生活的基本要素变得更容易，你才能创造自由思考和创造力所需的精神空间。现在养成习惯会让你在未来做更多你想做的事情。” </p>
<p>​          习惯的重要性已经叙述完，然后到了最重要的部分，如何掌控习惯呢？ 作者给出了四个关键词： 提示、渴求、反应和奖励  记住上面这四个关键词，分别对应： 我怎样才能让它显而易见？ 我怎样才能让它有吸引力？ 我怎样才能让它简便易行？ 我怎样才能让它令人愉悦？ 我们先说提示（我怎样才能让它显而易见？） </p>
<p>1、    意识到自己在做什么，保持警觉，打破无意识的状态，用习惯积分卡或者大声说出来，详细且具体，这样尤其可以帮助我们改掉坏习惯；</p>
<p>2、    制定具体的计划，包括明确的细节，何时、何地、何种情况下（何时、何地就是一个提示）； </p>
<p>3、    习惯叠加，将新习惯与已有习惯绑在一起，比如我每天早上都会在7点半吃早饭，那么吃完早饭后30分钟用来阅读（吃完早饭就会提示我该阅读了），同时要注意“具体”；</p>
<p> 4、    注意环境的重要性，什么地方做什么事，不要轻易改变固定的节奏，比如<strong>坐在办公室就得开始摸鱼</strong>，刻意营造界限；尤其是手机，即使在同一个手机上，也把学习、工作、娱乐有意识地分开。 </p>
<p>5、    刻意避免“调动自己的自制力”,不要“时常考验自己的意志力”，不要把自己置身在“容易得到坏习惯提示的环境”中。 第二点是渴求（我怎样才能让它有吸引力？） </p>
<p>1、    将需要养成的习惯和让自己开心的事绑在一起； </p>
<p>2、    注意模仿和向这些人学习：亲近的人、多数人、权威； 加入一种文化，在这种文化当中，你所期望的行为被认定是正常行为； 这里需要补充：没有什么比群体归属感更能维持一个人做事的动力，但是这个群体归属感是很难形成的，包括上面提到的向人学习，在我身上基本上已经丧失了这样一个能力。换句话说，为什么我在其他人身上很难再去获得一种“能量”？ 此处作者举了一个非常有意思的例子，人类在一个群体当中，常常被要求服从集体规范，每个群体都会对其成员施加巨大压力，个人就会选择听从安排和规定，“被集体接受”。 </p>
<p>3、    “你认为自己正在戒除某种东西，但其实你并没有戒除任何东西，因为香烟对你毫无益处。”理解这句话：让坏习惯缺乏吸引力。 这里需要关注人的潜在动机：节省精力、获取食物和水、寻找伴侣并传宗接代、与他人建立联系、赢得社会认可、减少不确定性、获取地位和声望。 我得把，与他人建立联系、减少不确定性、获取地位和声望，三者放在重要位置。 “当你大吃大喝、点上一支烟或浏览社交媒体时，你真正想要的不是薯片、香烟或一大把点赞，而是想要体验这些异乎寻常的感觉。”什么感觉？缓解焦虑、与他人建立联系、赢得社会认可等等。 所以得重塑你的大脑，让自己享受高难度的习惯。由我不得不去做，变成“我想去做，因为我能从中获得满足感、成就感等”，（我觉得这里还得好好思考思考，思考我所做的事对我产生的影响，可以简单地解释为延迟满足，但是是不是也能从当下的角度去看呢？比如缓解了焦虑，比如获得了知识，比如提升了自己学习的能力，比如获得了自己能改变自己证据，我记得这些积极的心理暗示都是很有必要的，也是极其重要的。） </p>
<p>4、    这一点我觉得挺难的，作者的意思是自己创设一种激励仪式，想一些做了就开心的事，然后把这种事和要养成的习惯一起做，这样本来枯燥的习惯也“让人感到开心了”。那我每次学习之前都泡杯咖啡？是这个意思？ 第三是反应（我怎样才能让它简便易行？） </p>
<p>1、    如果你想培养一种习惯，关键是从重复开始，无须力求完美。 </p>
<p>2、    让要做的事变得简单（这个我觉得很重要，针对具体的事，要具体地琢磨，比如创造好的环境啊啊，比如找到好的方法啊等等） </p>
<p>3、    先从“两分钟”开始，先标准化，再优化。可以尝试着，让开始阶段“仪式化”，一种程序的开始阶段越是仪式化，你就越有可能实现注意力高度集中。不要轻视每时每刻的选择，可能会导致卓有成效或者一事无成的一天。 </p>
<p>4、    让好习惯不可避免，坏习惯难以养成；主要是建立承诺机制，即当下做一个抉择，直接导致你不得不做出某种行为。这里作者举的例子就比较极端了，我理解了一下，避免玩手机的坏习惯，就直接把手机砸了；不写完就不睡觉；再有就是利用科技带来的自动化帮助自己养成好习惯，就像keep每天打卡，就像微信读书的阅读时间。 那么我直接跟人承诺，我今天，这个月，今年要干嘛干嘛，有用吗？为什么又没用呢？ 最后是奖励（我怎样才能让它令人愉悦？） </p>
<p>1、    寻找即时满足感；要有成就感。 这一点作者说了一些道理，主要是强调会延迟满足的人才与众不同，习惯本身就是良好习惯的回报。我觉得能接受强化这俩观点就行了，尤其是对身份的认可，这一点基本上对应了开篇最核心的观点：身份带来习惯；具体的话，无非自己给习惯制造即时奖励，让好习惯的收获更加“可见”，我觉得可以理解成微信读书的阅读时间。 </p>
<p>2、    记录自己的习惯，可视化，量化等等 </p>
<p>3、    绝不错过两次，即使后面补救并不完美，但绝对不能干脆不做；否则你前面10天的努力，1天就会功亏一篑。要有“做得不好，但是也要坚持”的信念，习惯的结果是复利，而复利的首要规则：除非万不得已，否则永远不要打断它。100元起步，50%的收益可以变成150，但是接下来只要亏损33%就直接回到了100。 </p>
<p> 4、    找个鞭子鞭策你。 </p>
]]></content>
      <categories>
        <category>读后感</category>
      </categories>
  </entry>
  <entry>
    <title>精力管理</title>
    <url>/2024/10/10/%E8%AF%BB%E5%90%8E%E6%84%9F/%E7%94%9F%E6%B4%BB%E4%B9%A0%E6%83%AF/%E7%B2%BE%E5%8A%9B%E7%AE%A1%E7%90%86/</url>
    <content><![CDATA[<p>​        为什么管理精力比管理时间更接近现实？</p>
<p>​        精力就像银行账户，在我们取完精力之后，需要挣回来，否则就会导致赤字。有时候，我们会感到身体虚弱，脑袋沉重，内心失落，迷茫，那是我们处于精力赤字状态。在这种状态下，时间管理得再恰当，工作效率都无法得到提升。我们虽然可以在短期内保持赤字的状态，比方在一周内突击一些考试或者一个项目。但从长远来看，这种赤字并不利于我们的身心健康。</p>
<p>​        大脑的重量占体重的2%，而消耗的氧气量，即能量占身体总耗氧量的25%。因此即使是脑力劳动，锻炼也是非常有帮助的。</p>
<ol>
<li><p>精力管理的核心思想：时间管理已经不再是可行的解决方案，管理精力，而非时间，才是高效（High Performance）、健康（health）、与快乐（Happiness）的根源。</p>
</li>
<li><p>精力管理四原则：<br>（1） 精力金字塔：从低到高四层——身体的、情感的、思想的、精神的<br>（2） 钟摆式运动：周期性地消耗和恢复精力<br>（3） 突破舒适区：让人感到不适的任何形式都有可能增加其精力储备。<br>（4） 习惯成自然：工作和生活中任何一个高效率的部分都是习惯使然。</p>
</li>
<li><p>人们的精力有4种来源：身体的、情感的、思想的、精神的。四种精力资源需要 消耗和储备之间取得平衡才能保持不会枯竭。</p>
</li>
<li><p>我们中的大部分人都在全力以赴，当要求超过我们的能力时，我们开始作出权宜的选择，这样的选择让我们度过了日日夜夜，时间一长编遗患无穷。</p>
</li>
<li><p>精力是我们生活各个方面的共同特性。<br>（1） 体能储备力（即身体上的承受）按数量来衡量（从低到高）<br>（2） 情感承受力（即情感上的精力储备）按质量来衡量（从消极到积极）</p>
</li>
<li><p>积极的精力仪式用于管理精力的非常具体的管理。<br>“仪式”（ritual）是一种仔细界定的、非常有条理的行为。意志和纪律需要迫使你自己行事，与此不同的是仪式吸引你行事。仪式的力量在于，它确保我们在不是绝对必要的地方，耗费尽可能少的有意识的精力，从而能以创造的、充实的方式战略性的集中现有的精力。</p>
</li>
<li><p>习惯提高效率的例子<br>（1） 吃的健康，因为你已经就你买的事物和你自饭店愿意点什么形成了习惯；<br>（2） 身体健康，因为你定期锻炼；<br>（3） 销售工作成功，因为你习惯了对打电话有准备，以及在遭到回绝的时候自我激励以保持积极的心态。</p>
</li>
<li><p>全方位投入（full engagement）的前提：在体能上精力充沛，在感情上互相联系，在思想上集中，在精神上和超越我们眼前私利的目的保持一致。</p>
</li>
<li><p>持久转变的三部曲：目的——现实——行动<br>（1） 第一步：确定目的（Define Purpose）如何按照何自己最坚定的价值观相一致的方式支配精力。<br>（2） 第二步：面对现实（Face the Truth）我们经常低估自己生活中有破坏性和最令人不快的现实。没有诚实地承认我们吃了多少东西，喝了多少酒，为处理和老板同事、配偶以及子女的关系投入了多少精力。<br>（3） 第三步：采取行动（Take Action）来弥补差距</p>
</li>
<li><p>运动员为了有效管理精力而严格照例行事，包括了生活中的方方面面：饮食和睡眠、锻炼和休息、调动适当的情感，在思想上做好准备并保持注意力集中，以及定期把这些和他们制定的目标联系起来。<br>你必须成为一名公司运动员（corporate athlete）优异表现的挑战在于，在各个方面更有效地管理精力以实现目标。</p>
</li>
<li><p>一般经常出现的五个效能障碍：精力不济、没有耐心、消极、人际关系缺乏深度、缺少热情。</p>
</li>
<li><p>过多的消耗精力却没有足够的恢复最终会导致精力衰竭——过度使用导致损耗。<br>过多的恢复而没有足够的压力最终会导致退化和虚弱——不充分使用导致损耗。<br>情感的深度和恢复力取决于积极地与别人以及我们自己的情感相联系。没有不断的智力挑战，思想的敏锐度就会消失。</p>
</li>
<li><p>在人类的人为文明和人类大脑与身体真正的构造之间，存在基本冲突。我们的身体原来用来白天狩猎，晚上睡觉，一天下来行走不超过几十英里。现在我们全天候地工作和娱乐，在全世界行走，做生死抉择。</p>
</li>
<li><p>我们生活和休息的时间是同日夜节奏（circadian rhythms）联系在一起的，我们醒着的时候，也有一种同样的90到120分钟的周期——短日节奏（ultrdian rhythms）</p>
</li>
<li><p>身体能量源自氧和葡萄糖的互相作用。按照实际情况，我们精力储备的多少取决于我们呼吸的模式、我们吃的事物、以及何时进食、睡眠的时间和质量、健康水平。<br>呼吸是非常有力的自我调节工具，一种打起精神和彻底放松的方式。</p>
</li>
<li><p>吃的讲究：<br>（1）早饭要吃血糖指数低的食物，血糖指数衡量的是糖从具体食物中释放到血液中的速度，缓释可以提供更稳定的能量来源。<br>（2）每天五~六顿低热量高营养的饭能确保精力的稳定再供给。<br>（3）保持高效能不仅依赖于定期进餐，还依赖于每餐只吃两三个小时提供能量的食物。<br>（4）喝水时补充体力的重要来源，和饥饿不同，渴并不是表示需求的准确晴雨表，当我们觉得渴的时候，我们已经脱水很久了。</p>
</li>
<li><p>在没有任何人为干扰的情况下，我们的精力储备在一天之中不同的时间像潮水一样自然涨落。在下午三四点钟，我们的短日节奏和生理周期达到最低阶段，称之为“强度极限”——我们大多数人在一天中感到最疲劳的时候。</p>
</li>
<li><p>持续效能的关键因素之一：在工作中至少有一个好朋友，一种非常稳定的关系的脉动涉及到的在奉献和索取之间，在说和听之间，在评价另外一个人和感受同样被评价之间周期性的移动。</p>
</li>
<li><p>面对现实让精力得到解放，回避现实会消耗大量的精力，在最基本的层面上，我们为了保护我们的自尊而欺骗自己。有些事情太难以容忍，以致无法立即接受。像悲伤这种情感最好的方式是波浪式消除。</p>
</li>
</ol>
]]></content>
      <categories>
        <category>读后感</category>
      </categories>
  </entry>
  <entry>
    <title>自卑与超越</title>
    <url>/2024/09/26/%E8%AF%BB%E5%90%8E%E6%84%9F/%E7%94%9F%E6%B4%BB%E4%B9%A0%E6%83%AF/%E8%87%AA%E5%8D%91%E4%B8%8E%E8%B6%85%E8%B6%8A/</url>
    <content><![CDATA[<p>​        <strong>1 不管是自卑还是其他心理问题，都是因为眼界太窄心太小，过于沉溺在自己的情绪里。转移注意力，努力工作赚钱，培养兴趣爱好，建立深度关系，融入社会，勇敢的解决问题，能治一切心理病。（如果陷的比较深，能找个人时常鼓励你，关键时候推你一把，就更好了）</strong></p>
<p>​        <strong>2 不开心是你的大脑中病毒了（不合理的固化思维），不是你人有问题，检测一下（情绪自察），清清病毒就好了（自我暗示，俗称阿q精神）。</strong></p>
<p>​        <strong>3 别矫情，只要你能正常工作，生活能自理，就没啥大问题，努力提升自己不比瞎想强？</strong></p>
<p><strong>1 有心理问题，是因为没学会与人合作、没勇气解决问题。</strong></p>
<p>人生就是与人合作，解决问题的过程。</p>
<p>人生意义在于与人合作、解决问题，失败者的共同点是欠缺合作能力。</p>
<p>治疗心理问题，要培养与人合作的勇气。（1.3,1.6，2.3）</p>
<p>人类的所有问题都能分成三类：职业、交际和两性。（1.2）</p>
<p><strong>2 决定人生的不是过去，是我们对过去的看法。</strong></p>
<p>对人生起决定作用的不是生活经验，是我们赋予经验的认知和意义。</p>
<p>个体心理学摒弃了决定论，认为童年不能决定人生。 </p>
<p>身体残缺、被过度娇惯和被人忽视的儿童是最容易形成错误思维模式，产生心理问题，甚至走上犯罪道路。</p>
<p>但在他人帮助下，认识到思维误区，就能纠正错误的思维模式。（1.4）</p>
<p><strong>3 适当的自卑感是正常的，有害的是自卑情结。</strong></p>
<p>上面两点引申到自卑：每个人都有不同程度的自卑感，因为我们都想让自己更优秀。如果我们够勇敢，通过与人合作，直接解决问题，就能逐渐摆脱自卑感，没有人能一生被自卑感折磨。</p>
<p>有的人缺乏合作意识，导致行为受限，解决问题的方式停留在很低的水平上，他们所面临的困难比其他人会更大。他们把真正需要解决的问题搁置一旁，在不切实际的幻象中寻找安慰，久而久之，会形成自卑情结，对人生产生怀疑。（3.1,3.2,3.3）</p>
<p>引申到其他：</p>
<p>婚姻是一种特定的合作方式，夫妻是平等的伙伴关系，父母要平等合作，还要教会孩子合作。（第6/12章）</p>
<p>学校要注意培养学生的合作精神，注意不同类型的问题学生的思维误区。培养学生兴趣，开发潜能。（第7章）</p>
<p>梦和早期记忆可以帮我们找出一个人为什么出现合作问题。（第4/5章）</p>
<p>青春期的孩子出现问题根源在于合作意识缺乏，要正确引导他走出误区。（第8章）</p>
]]></content>
      <categories>
        <category>读后感</category>
      </categories>
  </entry>
  <entry>
    <title>穷查理宝典</title>
    <url>/2024/09/05/%E8%AF%BB%E5%90%8E%E6%84%9F/%E7%BB%8F%E6%B5%8E%E9%87%91%E8%9E%8D/%E6%8A%95%E8%B5%84%E8%A6%81%E4%B9%89/</url>
    <content><![CDATA[<p>芒格进行商业分析和评估的“多元思维模型” “你必须知道重要学科的重要理论，并经常使用它们——要全部都用上，而不是只用几种。大多数人都只使用学过的一个学科的思维模型，比如说经济学，试图用一种方法来解决所有问题。你知道谚语是怎么说的：‘在手里拿着铁锤的人看来，世界就像一颗钉子。’这是处理问题的一种笨办法。”</p>
<p>首先要掌握的是数学。很明显，你必须能够处理数字和数量问题，也就是基本的数学问题。 除了复利原理之外，一个非常有用的思维模型是基本的排列组合原理。在我年轻的时候，高中二年级就会学到这些。目前在比较好的私立学校，我想应该八年级左右就开始学了吧。 “决策树理论”。他们所做的只是把高中代数拿过来，用它来解决现实生活中的问题。那些学生很喜欢这门课程。</p>
<p>他们为高中代数能够在生活中发挥作用而感到惊奇。 哪些思维模型最可靠呢？答案很明显，那些来自硬科学和工程学的思维模型是地球上最可靠的思维模型。而工程学的质量控制理论——至少对你我这样的非专业工程师来说也是很重要的核心部分——其基础恰好是<strong>费马和帕斯卡的基础数学理论</strong>。 当然，工程学里面的后备系统是一种非常有用的思想，断裂点理论也是一种非常强大的思维模型。物理学里面的临界质量概念是一种非常强大的思维模型。 </p>
<p>我认为第二种可靠的思维模型来自生物学/生理学，因为我们大家毕竟在基因构造方面都是相同的。 接下来当然就是心理学啦，它更加复杂。但如果你想拥有任何普世的智慧，心理学是太过重要了。 心理学的基础部分——我称之为误判心理学——是极其重要的知识。它包括了大约20个小原则。 我现在使用一种双轨分析。 从个人的角度来讲，我已经养成了使用一种双轨分析的习惯。首</p>
<p>先，理性地看，哪些因素真正控制了涉及的利益？其次，当大脑处于潜意识状态时，会自动形成哪些潜意识因素——这些潜意识因素总的来讲有用但（在具体情况下）却又常常失灵？ 接下来我们要谈到的是另外一种不那么可靠的人类智慧——微观经济学。我发现把自由的市场经济——或者部分自由的市场经济——当做某种生态系统是很有用的思维方式。</p>
<p>年轻人在工作中应该追求什么？ 我有三个基本原则。同时满足这三个原则几乎是不可能的，但你应该努力去尝试： ·<strong>别兜售你自己不会购买的东西。 ·别为你不尊敬和钦佩的人工作。 ·只跟你喜欢的人同事。</strong> 你对年轻人有什么人生建议吗？ 每天起床的时候，争取变得比你从前更聪明一点。认真地、出色地完成你的任务。慢慢地，你会有所进步，但这种进步不一定很快。但你这样能够为快速进步打好基础……每天慢慢向前挪一点。到最后——如果你足够长寿的话——像大多数人那样，你将会得到你应得的东西。 人生在不同阶段会遇到不同的难题，非常棘手的难题。我认为有三点有助于应付这些困难： ·期望别太高。 ·拥有幽默感。 ·让自己置身于朋友和家人的爱之中。 最重要的是，要适应生活的变化。</p>
<p>嫉妒、怨憎、仇恨和自怜都是灾难性的思想状态。过度自怜可以让人近乎偏执，偏执是 最难逆转的东西之一，你们不要陷入自怜的情绪中。</p>
<p>只摘抄了一小部分，整本书非常松散，像是人生格言的合集，全是论点缺乏论据，只能说有点用，但不多。</p>
]]></content>
      <categories>
        <category>读后感</category>
      </categories>
  </entry>
  <entry>
    <title>轻松主义</title>
    <url>/2024/09/04/%E8%AF%BB%E5%90%8E%E6%84%9F/%E7%94%9F%E6%B4%BB%E4%B9%A0%E6%83%AF/%E8%BD%BB%E6%9D%BE%E4%B8%BB%E4%B9%89/</url>
    <content><![CDATA[<p>​        书的开篇讲述了一位社会精英人士的故事，他从乔治城大学毕业后又到哈佛商学院深造，毕业后入职了一家顶级金融机构。他每周工作长达80小时，假日无休，因为在他接受的教育理念中，努力工作才是获得成功的关键。</p>
<p>​        在这样争分夺秒的节奏中，时间到了2008年，他所在的公司破产了，他持有的股票下跌了97%！曾经所有的紧张熬夜、离家奔波，全都变得毫无价值。更要命的是，他的身体也出现了问题。此时他才突然意识到，“更加努力”或许并不能让人更成功。</p>
<p>​        作者根据自己丰富的工作经历，在书中为我们描述了很多由于努力过头反而失败的案例，这令我想起了自己的日常生活。年届不惑之后，身边几乎每年都有人因为在事业快车道上超负荷奔跑而使健康出了问题，甚至酿成悲剧。人的一生面临着大大小小的选择，是这些选择造就了人的命运。是过把瘾就死，还是更长久地存在于这个美丽的世界？这个选择不可谓不重大。</p>
<p>​        针对这个宏大的选择题，作者最终提出的治愈方案是：放轻松。《轻松主义》这本书为我们展示了用轻松状态、轻松行动获得轻松成果的5种杠杆。在轻松成果部分，作者指出“读书是世界上回报率最高的活动之一”，至于读什么样的书，他提到了“林迪效应”（LindyEffect），也就是一本书存世越久，它在未来留存的可能性就越高。所以，应该先读那些存世已久的经典作品。</p>
<p>​        在给自己的待办事务安排优先级时，思考事情被完成后所产生的效应，如果效应是长远的，可以进一步促进其他事务的完成的，那就是有复利效应的事务。我们应该优先完成有优先效应的事务，比如读书（改变人的思考方式），锻炼（提高人的身体素质进而提高工作表现，学习效率等等），学习更高效的工作学习技能（长期提高工作学习效率），</p>
<p>​        作者主张发挥5种杠杆的力量，把产生线性成果的行为转变为产生复利成果的行为，由此，只要付出一次努力，就能一次又一次地轻松获得收益。不错，一旦“努力”超过一个临界点，更多的成本投入很难推动更多的边际产出，甚至可能反噬已有的成果。</p>
<p>​        人们感到不轻松通常源于自视过高或预期过高，因此，有人总结了“人生三部曲”——成年之后发现父母是普通人，中年之后发现自己是普通人，老年之后发现孩子也是普通人。人的一生应该先尽力而为，努力探索能力边界，让自己配得上想要的生活，接下来就应该顺其自然，因为说到底绝大多数的我们都是普通人。</p>
<p>​        回顾历史，能够穿越周期取得15%复利回报的人已经可以称得上是“世界顶尖投资家”，屹立投资界巅峰的巴菲特，在这个数字上的表现也不过是20%而已。看看巴菲特和芒格二人加一起近200岁的年纪，再想想毛泽东所写的“自信人生二百年，会当水击三千里”，就会释然：一切要从学会放轻松做起，因为这样才可能一直健康活着，才可能享受既赚钱又赚命的双重复利。</p>
]]></content>
      <categories>
        <category>读后感</category>
      </categories>
  </entry>
  <entry>
    <title>就业利息和货币通论</title>
    <url>/2025/08/19/%E8%AF%BB%E5%90%8E%E6%84%9F/%E7%BB%8F%E6%B5%8E%E9%87%91%E8%9E%8D/%E5%B0%B1%E4%B8%9A%E5%88%A9%E6%81%AF%E5%92%8C%E8%B4%A7%E5%B8%81%E9%80%9A%E8%AE%BA/</url>
    <content><![CDATA[<p>最近读凯恩斯的通论，真是大开眼界。</p>
<p>  据说，凯恩斯是一个伟大的经济学家，一般人很难理解他的思想。当凯恩斯主义政策出现恶果的时候，总是有人辩护说，这其实是偏离凯恩斯主义的结果。有一个故事说，凯恩斯某次参加一个讨论会，事后说：在座的只有我一个人不是凯恩斯主义者。无独有偶，也曾流传这么一个说法，说马克思曾经喟叹：我自己并不是马克思主义者。</p>
<p>  我以前了解凯恩斯，不是通过原著，而是通过凯恩斯的信徒的转述。我相信他们真实地传达了凯恩斯的思想。但是读了《就业、利息与货币通论》之后，我不得不说，我对凯恩斯的确存在很大的误解。凯恩斯和今天的新凯恩斯主义者的确存在巨大的区别。</p>
<p>一、投资越没用越好</p>
<p>  凯恩斯说：</p>
<p>​    有一件奇怪的事情值得一提。对上述的一些困难，人们头脑中似乎只有在诸如道路建设、住宅建设等公共投资的场合才会意识到，通常被用来反对政府投资以便提高就业量的理由是它会给将来造成困难。人们不禁要问：“当你为将来数量不变的人口建造出他们所需要的一切住宅、道路、市政厅、高压电网、供水设备等等之后，你还将做什么呢？”不过一般人却不大容易理解，私人投资或私人从事产业的扩展也会遇到同样的困难。（《就业、利息与货币通论》第83页，宋韵声译，华夏出版社，2005年1月第一版）</p>
<p>  凯恩斯对这种投资饱和的“困境”甚感担忧。他认为这会严重影响就业。他对提高就业提出的建议是：</p>
<p>​    如果我们的政治家们由于受到古典经济学派经济学的影响太大，想不出更好的办法，那么建造金字塔、地震、甚至战争都可以起着增加财富的作用。（《就业、利息与货币通论》第99页，宋韵声译，华夏出版社，2005年1月第一版）</p>
<p>   为什么金字塔是一种好办法呢？凯恩斯说：</p>
<p>​    古代的埃及，具有双重的幸运，这无疑完全归功于如同神话一般的财富，它是人们从事两种活动的结果（建造金字塔和寻找贵重的金属），又由于这两种活动的成果能不以被消费的形式来满足人们的需要，所以它们不会由于数量多少而降低其效用。中世纪人们则修建教堂和做道场。对于死者来说，两座金字塔、两次道场带来的利益将两倍于一座金字塔和一次道场。然而，在伦敦和约克郡之间修建的两条铁路都不是这样。（《就业、利息与货币通论》第100页，宋韵声译，华夏出版社，2005年1月第一版）</p>
<p>  <strong>在凯恩斯的理论体系里，投资越没用越好。一旦投资有用，收益递减规律就会抑制投资</strong>。</p>
<p> 今天的新凯恩斯主义者与此区别很大。虽然他们赞同政府刺激经济，但他们也表达了对政府投资的低效和浪费的担忧。他们只是玩笑般地提到凯恩斯的“挖坑再填上 ”理论，没人真的主张政府这么干。他们认为，政府还是应该从事一些多少有点用处的投资。很显然，他们偏离了凯恩斯的原意。我怀疑他们中的很多人跟我一样，并没有读过原著。</p>
<p>   投资，只有能带来收益，才能促进经济发展。没有收益的投资不叫投资，叫浪费。如果政府把本来该被民营企业建造工厂的资源，用于建造金字塔，政府也会雇佣很多工人。在短期看，建造金字塔和建造工厂带来的繁荣程度是一样的，这也恰恰是畸形繁荣期人们发现不了问题的原因。但是，真正的区别在建成之后。金字塔建成之后，没有任何新财富产生，而工厂建成之后，却会源源不断地创造新财富，为新的投资提供条件。凯恩斯的目光被金字塔挡住了，没能看到塔后的东西。</p>
<p>  甚至，政府投资可以显得比正常投资更繁荣。因为，有很多资源正在生产之中，而其它的配套资源尚未完备，于是工厂暂时还不到修建的时候。这时候，如果政府把这些待用的资源用于建造金字塔，短期看，“资源闲置”确实被消灭了，社会也显得更繁荣。这也就是当前的刺激政策所起的作用。但是它是以牺牲真正的繁荣为代价的。</p>
<p>二、对名义利率痴迷</p>
<p>  凯恩斯也了解奥地利学派的一些概念。如，资本品、消费品、迂回生产等。凯恩斯认为，有必要采用效率较低的迂回生产结构，目的是保障就业。除此之外，凯恩斯对奥地利学派似乎所知甚少。在他的经济周期部分，他没有提到奥地利学派的经济周期理论。他只有一次提到米塞斯、哈耶克，用的是嘲讽的口吻。他说：</p>
<p>​    米塞斯教授有一个奇特的理论，我认为，已为哈耶克教授和罗宾斯教授所采纳。（《就业、利息与货币通论》第149页，宋韵声译，华夏出版社，2005年1月第一版）</p>
<p>  凯恩斯强调消费对投资的刺激，反对“过度”储蓄。他没有意识到，人们储蓄实际是降低了投资成本，同样是刺激投资的，这也正是人类文明发展的坚实基础。只有通过储蓄降低投资成本，才能提高效率，才能持续不断地投资，而通过扩大消费刺激的投资，将很快被消耗光。</p>
<p> 但是凯恩斯也是矛盾的。他并不是反对降低投资成本，只是他没有理解储蓄对投资的意义，没有理解自然利率和名义利率的区别。自然利率是对人们真实的储蓄比例的反映，名义利率则是改变货币的名义使用成本，其隐性成本由他人承担。凯恩斯主张降低名义利率来降低投资成本、刺激投资。他说：</p>
<p>​    由此可见，经济繁荣的补救办法，不是较高的利息率，而是较低的利息率。因为低利息率或许还能将繁荣持续下去。对经济周期的正确补救办法，不是要取消经济繁荣，使我们永远处于半衰退状态，而是要取消经济衰退，使我们永远处于接近繁荣的状态之中。（《就业、利息与货币通论》第247页，宋韵声译，华夏出版社，2005年1月第一版）</p>
<p>  凯恩斯没有理解，降低名义利率并没有增加任何真实资源，人们对真实资源的储蓄还是没变。但是降低名义利率却虚构出“成本降低”的假象，正是这一假象造成了大量错误投资出现。降低名义利率，其实是给错误投资以机会，同时却剥夺正确投资的机会。这不会带来永远的繁荣，只会带来巨大的灾难。</p>
<p>   由于凯恩斯对货币的名义利率如此痴迷，他赞同重商主义，要为重商主义翻案。他认为，重商主义鼓吹的贸易顺差，让国内货币增多，于是利率降低——投资成本降低——刺激投资——经济繁荣。他没有意识到，重商主义导致货币增多，虽然名义利率降低，但却让真实资源更多流出本国，价格上升，真实投资成本其实反倒上升了。中国的情况恰好说明了这一点。伴随2.4万亿外汇储备的，是惊人的资产泡沫。罗斯巴德说，凯恩斯主义者无法同时思考两个方面以上的问题，正此之谓。</p>
<p>（顺便说一下，凯恩斯非常赞同“储藏货币”有害论，只是他更进一步。一般的人认为，物价下跌将导致储藏货币愈演愈烈，而凯恩斯则认为，哪怕不是愈演愈烈，只是小小的储藏，也是很有害的。里德说物价下跌有害论者是凯恩斯主义者，很有道理。他们之间的确是知音。）</p>
<p>   今天的新凯恩斯主义者，很少有人会反对自由贸易、赞同重商主义吧？虽然他们很多时候对自由贸易并不太理解。</p>
<p>三、凯恩斯也愤怒</p>
<p>   凯恩斯非常推崇一位“先知”，这个“先知”叫格塞尔。格塞尔的信徒经常寄书给凯恩斯。格塞尔写过一本书，叫《经由自由土地和自由货币达到的自然经济秩序》，凯恩斯对这本书很赞赏。这个书名是不是很奥派？莫非凯恩斯也赞同奥派的核心观点？且慢！</p>
<p>  格塞尔的“自由货币”，是指通过加印货币，使货币不再受利率的桎梏，最好是让利率降到零（凯恩斯说费雪对这个方案也深表赞许）。格塞尔的“自由土地”，是指土地国有化。至于格塞尔的“自然经济秩序”，我就不知是个什么东西了。</p>
<p>  在《通论》中，凯恩斯多处表达了对马克思主义的同情，和对“自由放任”的鄙视。马克思指出了资本主义“有效需求不足”，并且也反对“自由放任”。虽然和“自由放任”如此对立，但凯恩斯和奥派，有一些有趣的、表面上相似的地方。</p>
<p>  比如，奥派主张恢复古老的智慧，奥派所指的古老的智慧是重视储蓄之类的。凯恩斯也主张恢复古老的智慧，他的古老的智慧是重商主义之类的。</p>
<p>  又比如，奥派对凯恩斯式的理论很愤怒，认为这是为政府权力张目，而由于凯恩斯的理论有利于官员的利益，所以得到了政府的支持。凯恩斯对“自由放任”同样很愤怒。他攻击李嘉图的学说，因为李嘉图反对“有效需求不足”。他说：</p>
<p>​    它还为资本家的自由企业辩护，因此又得到了当权者身后在社会上占有支配地位人士的支持。（《就业、利息与货币通论》第26页，宋韵声译，华夏出版社，2005年1月第一版）</p>
<p>  不知道如果今天的新凯恩斯主义者认真读一下凯恩斯的原著，还有多少人会相信他。我相信其中有很大一部分人其实只是盲目地为自己找了这面旗帜，只因凯恩斯的观点和他们部分相似。另一方面，我也相信，也会有很多人读了凯恩斯的原著之后会变得更激进，没准也会赞同“越浪费越好”、赞同零利率、反对自由贸易……还好，真正读原著的人并不多。</p>
<p>  我的确见过有人读完《通论》，却仍然是凯恩斯主义者。我现在才知道他付出了多大的艰辛。</p>
]]></content>
      <categories>
        <category>读后感</category>
      </categories>
  </entry>
  <entry>
    <title>漫步华尔街</title>
    <url>/2025/10/01/%E8%AF%BB%E5%90%8E%E6%84%9F/%E7%BB%8F%E6%B5%8E%E9%87%91%E8%9E%8D/%E6%BC%AB%E6%AD%A5%E5%8D%8E%E5%B0%94%E8%A1%97/</url>
    <content><![CDATA[<p>漫步华尔街中最主要的观点有“最优投资策略与年龄有关”，其核心思想是：一个人的投资组合（即持有的股票、债券、现金等资产的比例）应根据其生命周期的不同阶段进行动态调整，以匹配其随时间变化的“风险承受能力”和“财务目标”。</p>
<p>这绝不是一句空话，而是基于两个至关重要的基本原理：</p>
<p>风险承受能力与投资期限（Time Horizon）密切相关：年轻人拥有更长的投资期限（距离退休还有几十年），这意味着他们有足够的时间来从市场的短期波动和暴跌中恢复过来。因此，他们可以承受更高的风险（即投资组合中股票占比更高），以追求更高的长期回报。而年长者投资期限短，无法承受巨大的短期损失，因为可能没有足够的时间在本金大幅缩水后恢复过来。</p>
<p>人力资本（Human Capital）的转化：年轻时，你的主要资产是你未来工作收入的现值，即“人力资本”。这份收入相对稳定（像债券一样提供持续现金流）。因此，你可以将你的金融资本（即你的储蓄和投资）更多地配置于高风险高回报的资产（如股票）来平衡。随着年龄增长，你的人力资本逐渐被“消耗”并转化为金融资本。当你退休时，人力资本降为零，你的生活完全依赖于金融资本。此时，金融资本本身必须变得像你年轻时的工资一样可靠，因此需要降低其风险。</p>
<p>下面，我们分阶段详细说明这个策略是如何与年龄挂钩的：</p>
<p>不同年龄阶段的最优投资策略<br>马尔基尔在书中给出了一个经典的、简单易行的资产配置指南，即 “100/120减去你的年龄”法则。</p>
<p>公式：投资于股票的比例 = (100或120) - 你的年龄</p>
<p>剩余部分：投资于债券和现金等更安全的资产。</p>
<p>还有谈论了股市的常见的知识，退休金策略等等，作为股市/金融入门读物很好，可以知道一些粗略的基本的道理。</p>
]]></content>
      <categories>
        <category>读后感</category>
      </categories>
  </entry>
  <entry>
    <title>穷查理宝典</title>
    <url>/2024/09/05/%E8%AF%BB%E5%90%8E%E6%84%9F/%E7%BB%8F%E6%B5%8E%E9%87%91%E8%9E%8D/%E7%A9%B7%E6%9F%A5%E7%90%86%E5%AE%9D%E5%85%B8/</url>
    <content><![CDATA[<p>芒格进行商业分析和评估的“多元思维模型” “你必须知道重要学科的重要理论，并经常使用它们——要全部都用上，而不是只用几种。大多数人都只使用学过的一个学科的思维模型，比如说经济学，试图用一种方法来解决所有问题。你知道谚语是怎么说的：‘在手里拿着铁锤的人看来，世界就像一颗钉子。’这是处理问题的一种笨办法。”</p>
<p>首先要掌握的是数学。很明显，你必须能够处理数字和数量问题，也就是基本的数学问题。 除了复利原理之外，一个非常有用的思维模型是基本的排列组合原理。在我年轻的时候，高中二年级就会学到这些。目前在比较好的私立学校，我想应该八年级左右就开始学了吧。 “决策树理论”。他们所做的只是把高中代数拿过来，用它来解决现实生活中的问题。那些学生很喜欢这门课程。</p>
<p>他们为高中代数能够在生活中发挥作用而感到惊奇。 哪些思维模型最可靠呢？答案很明显，那些来自硬科学和工程学的思维模型是地球上最可靠的思维模型。而工程学的质量控制理论——至少对你我这样的非专业工程师来说也是很重要的核心部分——其基础恰好是<strong>费马和帕斯卡的基础数学理论</strong>。 当然，工程学里面的后备系统是一种非常有用的思想，断裂点理论也是一种非常强大的思维模型。物理学里面的临界质量概念是一种非常强大的思维模型。 </p>
<p>我认为第二种可靠的思维模型来自生物学/生理学，因为我们大家毕竟在基因构造方面都是相同的。 接下来当然就是心理学啦，它更加复杂。但如果你想拥有任何普世的智慧，心理学是太过重要了。 心理学的基础部分——我称之为误判心理学——是极其重要的知识。它包括了大约20个小原则。 我现在使用一种双轨分析。 从个人的角度来讲，我已经养成了使用一种双轨分析的习惯。首</p>
<p>先，理性地看，哪些因素真正控制了涉及的利益？其次，当大脑处于潜意识状态时，会自动形成哪些潜意识因素——这些潜意识因素总的来讲有用但（在具体情况下）却又常常失灵？ 接下来我们要谈到的是另外一种不那么可靠的人类智慧——微观经济学。我发现把自由的市场经济——或者部分自由的市场经济——当做某种生态系统是很有用的思维方式。</p>
<p>年轻人在工作中应该追求什么？ 我有三个基本原则。同时满足这三个原则几乎是不可能的，但你应该努力去尝试： ·<strong>别兜售你自己不会购买的东西。 ·别为你不尊敬和钦佩的人工作。 ·只跟你喜欢的人同事。</strong> 你对年轻人有什么人生建议吗？ 每天起床的时候，争取变得比你从前更聪明一点。认真地、出色地完成你的任务。慢慢地，你会有所进步，但这种进步不一定很快。但你这样能够为快速进步打好基础……每天慢慢向前挪一点。到最后——如果你足够长寿的话——像大多数人那样，你将会得到你应得的东西。 人生在不同阶段会遇到不同的难题，非常棘手的难题。我认为有三点有助于应付这些困难： ·期望别太高。 ·拥有幽默感。 ·让自己置身于朋友和家人的爱之中。 最重要的是，要适应生活的变化。</p>
<p>嫉妒、怨憎、仇恨和自怜都是灾难性的思想状态。过度自怜可以让人近乎偏执，偏执是 最难逆转的东西之一，你们不要陷入自怜的情绪中。</p>
<p>只摘抄了一小部分，整本书非常松散，像是人生格言的合集，全是论点缺乏论据，只能说有点用，但不多。</p>
]]></content>
      <categories>
        <category>读后感</category>
      </categories>
  </entry>
  <entry>
    <title>穷爸爸富爸爸</title>
    <url>/2024/09/04/%E8%AF%BB%E5%90%8E%E6%84%9F/%E7%BB%8F%E6%B5%8E%E9%87%91%E8%9E%8D/%E7%A9%B7%E7%88%B8%E7%88%B8%E5%AF%8C%E7%88%B8%E7%88%B8/</url>
    <content><![CDATA[<p><strong>“大多数人都希望有一份工资收入，因为他们都有恐惧和贪婪之心。一开始，没钱的恐惧会促使他们努力工作，得到报酬后，贪婪或欲望又让他们想拥有所有用钱能买到的好东西。于是就形成了一种模式。”</strong> 富爸爸把这种模式称为“老鼠赛跑” ，即人们为金钱而工作，每月的支出主要靠工资来维持，没有属于自己的资产，或者虽有资产但带来的收入还不足以维持家庭的花费，所以只能在“老鼠赛跑”之中求生存。 不得不说，这个观点一针见血，随着享乐主义盛行，越来越多的人们享受着及时行乐所带来的快乐和满足，我们为了钱而工作，然而我们的最终目的却是花掉所有工作所赚来的钱。</p>
<p><strong>一 富人不为钱工作</strong></p>
<p>每个人都有可以被击中的弱点，也知道每个人都有一种强大、坚定、无法用金钱收买的精神。问题在于哪一部分更强大。大多数人都希望有一份工资收入，之所以会这样是因为他们有恐惧和贪婪之心，工作是面对长期问题的一种暂时的解决办法，带来暂时的安全感，让人们感觉自己好像处于一个安静的环境。</p>
<p>有些人明明不喜欢当下的工作，却依然每天兢兢业业加班，一边抱怨一边继续埋头苦干，只为了那一个月的固定薪资，不反思也不转向。也有些人明明囊中羞涩，却省吃俭用去购买奢侈品，花几个月的工资买一个包包，然后宝贝一样的连过安检机和碰到一些雨都心疼的要命，只为了一时的消费享受和虚荣，慢慢的便会陷入穷人思维。不是富二代的人，恐怕大家都会经历一段灰暗不为人知的日子，但是他们懂得把钱节省下来，用于投资理财，让钱为自己服务，而不是每天像骡子一样只管低头前行，完全不顾时代的发展。</p>
<p><strong>二 去学习财务知识</strong></p>
<p>知识才能解决问题并创造财富，不是凭财务知识挣来的钱很快就会消失。规则之一便是你必须明白资产和负债的区别， 并且尽可能地购买资产。富人获得资产，而穷人和中产阶级获得债务，只不过他们以为那些就是资产。</p>
<p>如果你想富有，你必须读懂并理解数字，而这个需要你有足够的财务基础和知识储备，<strong>资产就是能把钱放进你口袋里的东西，负债是把钱从你口袋里取走的东西。</strong></p>
<p>想起前段时间看的某篇文章提及《富爸爸穷爸爸》一书作者罗伯特清崎破产一事，本以为这会是一篇反对富爸爸逻辑的文章，怎知读到最后却发现，作者所要阐述的却是清崎名下诸多公司中的其中一家宣布破产，无非也是为了最终保护自己个人的资产，从而又证实了富爸爸理论中的观点：如果你想成为富人，就要去做一名企业所有者和投资者。</p>
<p><strong>三 关注自己的事业</strong></p>
<p>富爸爸认为<strong>富人关心的焦点是资产而其他人关心的是收入。只有你把额外的收入用来购买可产生收入的资产，你才能获得真正的财务安全。</strong>现如今，有如此多的年轻人早早地背上了各种房贷车贷，这导致了他们不得不为钱而工作，每天关心自己的收入。这些人有没有想过一个问题——当你努力工作了三十年之后，还清了各种贷款之后，你的青春还剩下了什么？你在你的黄金时间里，除了拼命工作外几乎一无所获。于是你寄希望于下一代，可当下一代长大之后，你的房子已经老旧，他们不得不重蹈你的覆辙，继续为房贷车贷而工作。这很残酷，但这就是现实。 因此富爸爸认为，<strong>我们应该改变一下顺序，先关注自己的事业，在工作的同时，控制自己的欲望，买入一些资产，而不是负债。</strong>简单来说，资产就是能给你带来被动收入的东西 ，而负债则相反。富人与穷人一个重要的区别就是：富人最后才买奢侈品，而穷人和中产阶级会先买下诸如大房子、珠宝、皮衣、宝石、游艇等奢侈品。</p>
<p>你的工作和你的事业之间存在着巨大的区别。对成年人而言，把支出维持在低水平，减少借款和勤劳地工作会帮你打下一个稳固的资产基础。真正的资产可以分为下列几类：</p>
<p>1.不需我到场就可以正常运作的业务。我拥有它们，但由别人经营和管理。如果我必须在那儿工作，那它就不是我的事业而是我的职业了；</p>
<p>2.股票；</p>
<p>3.债券；</p>
<p>4.共同基金；</p>
<p>5.产生收入的房地产；</p>
<p>6.票据（借据） ；</p>
<p>7.专利权如音乐、手稿、专利；</p>
<p>8.任何其他有价值、 可产生收入或可能增值并且有很好的流通市场的东西。</p>
<p><strong>真正的奢侈品是对投资和积累真正资产的奖励。</strong>这点跟前面一二点都关联，是给我印象比较深刻的一点，你学习什么，就会成为什么，从现在起，开始关注自己的事业，保持自律和高度的学习能力，让自己紧跟这个时代，可能你的事业在这个准备的某个时间节点中就出现了。</p>
]]></content>
      <categories>
        <category>读后感</category>
      </categories>
  </entry>
  <entry>
    <title>双性化理论</title>
    <url>/2025/12/24/%E6%9D%82%E8%B0%88/%E5%8F%8C%E6%80%A7%E5%8C%96%E7%90%86%E8%AE%BA/</url>
    <content><![CDATA[<p>所谓双性化，就是指一个人兼有男性化与女性化的气质。双性化者并非变态，相反众多研究表明，双性化者兼有男性和女性较为优良的品质，往往具有更强的社会适应能力。</p>
<p>如果一个男人展现的仅仅只是她的男性气质，那么他的女性气质就会始终遗留在无意识中而保持其原始未开化的面貌，这就使他的无意识有一种软弱、敏感的气质。自以为这样，所以那些表面上最富男子气的人，内心却往往十分的软弱和柔顺。而那些在日常生活中过多地展示其女性气质的女人，在无意识深处却十分顽强和任性，具有男人通常在其外显行为中表现出来的气质。</p>
<p>男性气质多表现薇独立、勇敢、自信而且具有支配感和成就感，喜欢竞争性强的活动。女性气质多表现为温和、敏感、被动、缺乏自信和果断精神。</p>
<p>大部分研究都认为，双性化的个体具有较高的自尊、较少的心理疾病、较好的社会适应能力，而且双性化的人比其他类型的人更受欢迎。一项研究显示，双性化的儿童和成人拥有更高水平的自尊，而且在多样化的情境下适应性更强(Taylor &amp; Hall，1982)。另一项研究指出，双性化个体更易与异性建立起亲密关系，可能是由于他们同时具有女性和男性积极的特质，能更好地理解、接受彼此间的差异(Ganong &amp; Coleman，1985)。也有研究揭示，具有积极的双性化特征的人在心理上更健康，感到更快乐，幸福感更强(Woodhill &amp; Samuels，2003)。<br>我国研究者余小芳(2004)采用问卷调查与内隐联想测验相结合的研究方法，探讨性别角色与心理健康、社会适应的关系。结果发现，双性化类型对男女正性词加工都较好，男性化类型和女性化类型分别只对男性正性词和女性正性词加工较好，而未分化类型对两种词加工都较慢；四种性别角色在心理健康和社会适应性方面都存在显著差异，双性化类型的学生心理健康水平最高和社会适应性最好，是最佳的性别角色模式。<br>马锦华(2001)在对大学生双性化人格模式与心理健康关系的研究中发现，双性化个体具有比较高的心理健康水平，女性化、未分化个体表现为自信程度偏低，缺乏安全感，从理论上讲，其心理健康水平偏低。余小芳(2004)的研究也发现，双性化类型的学生不管在心理健康方面，还是在社会适应性方面，都优于男性化类型、女性化类型与未分化类型的学生，这说明双性化类型是最理想的性别角色模式。同时，该研究还指出，未分化类型是最不理想的性别角色，女性化类型在心理健康与社会适应性方面也较低，男性化类型在这两方面上都不错，仅次于双性化类型。</p>
<p>拓展阅读</p>
<p>性别角色量表</p>
<p>美国心理学家贝姆(Bem)于1974年发表了性别角色量表(Bem Sex Role Inventory，BSRI)，这是第一个用来测量相互独立的性别角色的测验工具。<br>表2-4一共有60个描述性词语。请你根据自身的情况，逐条以从“1”到“7”的尺度给自己打分，其中，“1”代表“从不”或“几乎不符合”，“7”代表“总是”或“完全符合”。</p>
<p>表2-4 性别角色量表</p>
<p>1.自我信赖  </p>
<p>  21.可信赖的  </p>
<p>  41.温和的  </p>
<p>  2.柔顺  </p>
<p>  22.善于分析的  </p>
<p>  42.庄严的  </p>
<p>  3.乐于助人  </p>
<p>  23.表示同情的  </p>
<p>  43.愿意表明立场的  </p>
<p>  4.维护自己的信念  </p>
<p>  24.嫉妒的  </p>
<p>  44.温柔  </p>
<p>  5.快活的  </p>
<p>  25.具有领导能力的  </p>
<p>  45.友好的  </p>
<p>  6.忧郁的  </p>
<p>  26.对他人的需求敏感  </p>
<p>  46.具有侵犯性  </p>
<p>  7.独立的  </p>
<p>  27.诚实的  </p>
<p>  47.轻信的  </p>
<p>  8.害羞的  </p>
<p>  28.乐于冒险  </p>
<p>  48.无能的  </p>
<p>  9.诚心诚意  </p>
<p>  29.有理解力的  </p>
<p>  49.像个领导  </p>
<p>  10.活跃的  </p>
<p>  30.守口如瓶  </p>
<p>  50.幼稚的  </p>
<p>  11.情意绵绵  </p>
<p>  31.易于做出决策的  </p>
<p>  51.适应性强的  </p>
<p>  12.夸耀的  </p>
<p>  32.有同情心的  </p>
<p>  52.个人主义的  </p>
<p>  13.武断的  </p>
<p>  33.忠厚老实  </p>
<p>  53.不讲粗俗的话  </p>
<p>  14.值得赞赏的  </p>
<p>  34.自足的  </p>
<p>  54.冷漠无情  </p>
<p>  15.幸福的  </p>
<p>  35.乐于安抚受伤的感情  </p>
<p>  55.具有竞争意识的  </p>
<p>  16.个性坚强的  </p>
<p>  36.自高自大  </p>
<p>  56.热爱孩子的  </p>
<p>  17.忠诚的  </p>
<p>  37.有支配力的  </p>
<p>  57.老练得体的  </p>
<p>  18.不可捉摸的  </p>
<p>  38.谈吐柔和的  </p>
<p>  58.雄心勃勃  </p>
<p>  19.强劲有力的  </p>
<p>  39.值得喜欢的  </p>
<p>  59.温文尔雅  </p>
<p>  20.女性的  </p>
<p>  40.男性的  </p>
<p>  60.保守  </p>
<p>计分方法：男性化得分为1，4，7，13，16，19，22，25，28，31，43，46，55，58项目总分除以14；女性化得分为11，14，17，23，26，29，32，35，41，44，56，59项目总分除以12。如果男性化得分和女性化得分都高于4分的话就是双性化；如果只有男性化得分高于4分就是男性化，只有女性化得分高于4分就是女性化；如果两个都低于4分就是未分化。</p>
]]></content>
      <categories>
        <category>杂谈</category>
      </categories>
  </entry>
  <entry>
    <title>婚姻如何选择</title>
    <url>/2025/12/20/%E6%9D%82%E8%B0%88/%E5%A9%9A%E5%A7%BB%E5%A6%82%E4%BD%95%E9%80%89%E6%8B%A9/</url>
    <content><![CDATA[<p>我一生都在学习如何避免愚蠢。在投资上，我们通过逆向思维获得了巨大的成功—不去苦苦追寻如何变得伟大，而是孜孜不倦地研究如何保证变得痛苦、失败和破产。那么，让我们把同样的逻辑应用到“如何通过选择一个伴侣来确保你的人生充满摩擦、停滞并最终走向遗憾的平庸”呢?很简单:找一个对你的缺点无限包容,但从不挑战你进步的人;你们要共同建造一个温暖的、密不透风的“回声室”，里面只有彼此的附和与安慰;优先考虑外表吸引力或短暂的情绪价值，胜过内在的品格与智慧—毕竟，未来几十年的风风雨雨，一张漂亮的脸蛋和几句甜言蜜语足以抵挡;最重要的一点，确保你的伴侣在关键维度上—无论是见识、品格还是韧性—都不如你，这样你才能永远享受居高临下的安全感，永远不必面对被对方映照出的自身的渺小。<br>    听起来很荒谬，对吗?但这就是绝大多数人在无意中遵循的剧本。他们害怕一个更优秀的伴侣—那种优秀会成为一种持续的压力，迫使你离开舒适区，迫使你承认自己的不足，迫使你成长。人们内心深处抗拒这种压力，于是选择了那条更容易的路:向下兼容。这无疑是人生规划中最隐蔽、代价最高昂的陷阱之一。<br>    现在，让我换个方式，用我们更熟悉的投资语言来谈谈婚姻。你们都知道，我们一直在寻找具有宽阔“护城河”的企业。那么，一个人—一个你将要与之共度一生的伙伴，他的“护城河”是什么?是转瞬即逝的青春容貌吗?是迎合你所有喜好的顺从性吗?不，真正的护城河是他的品格根基，是他在逆境中展现的韧性，是他的学习能力和知识好奇心，是他看待世界时所运用的理性框架。这些特质不会随着时间贬值，反而会像陈年的美酒，愈久弥醇。<br>我曾说过，要得到你想要的某样东西，最可靠的办法是让你自己配得上它。这在婚姻领域是绝对的真理。指望找到一个品格高尚、智慧超群的伴侣，而你自己却停留在肤浅、易怒和懒惰的层面，这概率不会比你在大街上捡到一张没记名的百万美元支票高多少。你必须先开始锻造自己，成为一个更好的“资产”，才能吸引并留住另一个优质的资产。优质资产会相互吸引并形成协同效应，产生 1+1&gt;10 的复利结果。</p>
<p>让我告诉你们一个秘密:我年轻时也并非像现在这样思考，我也曾犯过几乎所有年轻人都会犯的错误—看重一些表面的、短暂的特质。是生活、是教训、是无数次头撞南墙的痛苦，让我逐渐看清了什么才是真正重要的。<br>    南希，我的妻子，她拥有的是一种我称之为“定锚”般的智慧。在我因为市场的疯狂而可能偏离航向时，她能用一个问题、一个观察，让我瞬间清醒。她不是我的附和者，她是我思想的磨刀石，有时甚至是我的“现实检验官”。这引出了另一个关键概念—Lollapalooza效应:多个心理倾向同时发力，指向同一个结果，形成巨大的合力。一个糟糕的伴侣可以同时激发你的贪婪(对舒适的无度索取)、恐惧(害怕失去所谓的安全感)、妒(无休止的比较)、自恋(认为自己的不幸都是对方造成的)……这些心理倾向汇聚在一起，足以摧毁你人生其他所有领域的努力。反过来，一个优秀的伴侣则会激发你的责任感(想要配得上他)、勇气(面对挑战)、理性(共同解决问题)和耐心(经营长期关系)。这正如正负两种 Lollapalooza效应，将把你的人生带往截然不同的方向。<br>    你们想想看:你的伴侣，是你每天都要面对的最重要的“环境”。这个环境是滋养你的，还是消耗你的?他是在你认知飞轮启动时为你加速，还是在你想启动时不断给你施加摩擦力?我见过太多才华横溢的人，被一段消耗型的关系慢慢拖垮—他们的能量和注意力被家庭内部的纷争无尽地汲取，最终在事业和人生成就上远未达到他们本应达到的高度。这无疑是最大的悲剧之-不是死于明确的攻击，而是死于缓慢的窒息。<br>    所以，当我建议“找一个比你优秀的伴侣”时，我指的并非世俗意义上的学历、职位和财富。我指的是，在那些构成幸福与成功基石的根本品质上，对方比你更强大。比如，他可能比你更富有同理心，能化解你因固执带来的冲突;他可能比你更坚韧，在你想要放弃时能稳住船舵;他可能比你更通透，能一眼看穿你自我欺骗的把戏。这些品质，才是婚姻这家“最佳合伙企业”最核心的资本。<br>    我知道，承认自己的伴侣在某些方面比自己优秀，对很多人的自尊心来说是一种挑战。这需要一种近乎反本能的自知之明和谦逊。但正是这种谦逊，才是智慧的开端。当你承认并欣赏对方的优秀时，你实际上为自己打开了一扇永不关闭的学习之门—你的伴侣成了你身边最近、最值得信赖的人生教练。这难道不是世界上性价比最高、最持续有效的自我提升策略吗?我一生中最愚蠢的决定之一，就是在一些商业决策上过于自信地拒绝听取更懂行的人的意见—其中也包括南希的意见。事实证明，几乎每一次当我选择忽视那些逆耳忠言时，我都付出了代价。婚姻也是如此。那些拒绝被伴侣的优秀所影响、所塑造的人，实际上是在主动关闭一扇通往更好版本自己的大门。他们把自己的骄傲凌驾于自己的成长之上。<br>    把人生看做一个系统，一个优秀的伴侣，是这个系统中最强大的正反馈回路:它让你变得更理性、更善良、更坚韧;而这些提升后的品质，又会反过来让你更好地经营这段关系，让它产生更多的幸福和价值。这个正向循环一旦启动，其带来的复利增长丝毫不亚于你在资本市场找到了一家伟大的公司并长期持有。它渗透到你生命的每一个角落—你的健康、你的事业、你的友谊，以及你如何看待这个世界。<br>当然，寻找一个优秀的伴侣并与之共同生活，并不意味着没有摩擦。恰恰相反，正是因为你们都在思考、都有强大的内核，摩擦才会产生。但关键在于，你们如何看待和处理这些摩擦:是把它们视为需要消灭的麻烦，还是视为磨砺彼此思想、加深相互理解的契机?智慧的伴侣懂得将摩擦转化为火花，照亮此前未被察觉的黑暗角落;而愚蠢的伴侣则只会让摩擦引发火灾，烧毁一切这需要双方都具备一种罕见的品质—理性沟通的能力。不是情绪化的指责，不是冷战式的回避，而是像两个优秀的科学家面对一个共同的难题:“我们如何能更好地理解彼此，让这个系统运行得更顺畅?”这本身就是一个持续学习、持续优化的过程。婚姻是这个世界上为期最长、最需要动脑筋的实践项目。<br>    现在，让我们把视角拉得更广一些。你选择的伴侣不仅影响你，还将深刻影响你的下一代。他或她将是你的孩子们最初也是最重要的老师。他的思维方式、价值判断、情绪反应模式，会像基因一样烙印在孩子的成长轨迹中。你是在为孩子选择一个终身的导师。从这个角度看，选择伴侣的决策，其重要性又提升了几个数量级。你不仅仅是在为自己的幸福投资，你是在为家族的命运下注。<br>我知道，在这个强调即时满足、追求感官刺激的时代谈论品格、理性和长期价值，听起来多么不合时宜-就像是在摇滚音乐会上演奏莫扎特。人们想要的是“感觉良好”，而不是“变得更好”。但让我坦率地告诉你们:所有“感觉良好”却背离了基本规律的选择，最终都会连本带利地收回代价。婚姻市场在长周期里是无比有效的，它最终会奖励那些选择了真正优质资产并长期持有的人，而惩罚那些做了愚蠢交易的人。</p>
<p>所以，年轻的男士们、女士们，当你们面对这个人生最重要的决定时，请暂时关闭掉那些荷尔蒙的噪音，屏蔽掉社会肤浅的舆论，拿出你们研究一只股票十分之一的认真劲，运用你们的理性思维，去评估你面前这个潜在的“人生合伙人”。问自己一些尖锐的问题:他的“护城河”是什么?50年后，当青春不再，是什么在支撑我们的关系?他是一个能让我变得更好的人吗?我是否发自内心地欣赏他，并渴望成为像他那样的人?<br>    我并不是说你要找到一个完美的圣人—世界上不存在完美的企业，也不存在完美的人。我们都在努力变得不那么愚蠢。关键是，你们是否走在同一条向上的道路上?是否愿意互相扶持?本质上，这是一种基于价值的联合，以期产生“1+1&gt;2”的协同效应。<br>在我漫长的一生中，我目睹了无数的潮起潮落，也见证了各种各样的人生结局。我可以毫不犹豫地告诉你们:那些在晚年依然享有深厚情感纽带和智力共鸣的伴侣,才是真正的人生赢家。他们的财富远不止于银行账户里的数字，而在于他们共同构建的那个无法被剥夺的、丰富的内心世界。那才是真正的财富。<br>    所以，如果我的智慧只能浓缩成一句关于婚姻的建议那么就是:勇敢地去寻找那个在某些重要方面比你优秀、并能促使你变得更好的人。然后，用你一生的努力去配得上这份幸运，去经营这份最宝贵的资产。这比任何一项投资都更值得你倾注心血。这或许是我能留给你们的最接近幸福密码的东西了。它听起来简单，实践起来却需要巨大的勇气和一生的坚持。但相信我，它的回报将超越你最大胆的想象。<br>现在轮到你们去思考，去行动了。我祝福你们都能找到属于自己的那份优质资产，并与之书写一段非凡的人生传记。</p>
]]></content>
      <categories>
        <category>杂谈</category>
      </categories>
  </entry>
  <entry>
    <title>筚路维艰</title>
    <url>/2025/12/24/%E6%9D%82%E8%B0%88/%E7%AD%9A%E8%B7%AF%E7%BB%B4%E8%89%B0/</url>
    <content><![CDATA[<p>读了这段从建国到改开的许多细节的介绍后，对所谓左右问题有了更清晰的认识。从根本上说，右派的路线既是出于私心，也是出于左派路线的失败而转向。好和坏并不是水火不容，而是可以同时存在的，不仅可以同时存在在一个人上，还可以同时存在在一件事上。于私，老干部派有私心，而来福大酒店没有，可以说问心无愧；但于公，来福大酒店缺乏政治经验和政治智慧，对经济建设，制度建设，外交，军事等更是一窍不通，空有热情而没有手段；教员几次对于黄轩的表现非常失望，但又几次支持他，这引起了老干部派的不满。教员对于老干部派有私心不满，但又不得不依靠他们；对来福大酒店寄予厚望，但对他们的表现又非常失望。最终教员对于设计师的支持是因为他在外交，军事，经济建设，制度建设等都有建树。他是中苏论战的主力，在西南局的经济和制度建设也都不错，更不用说军事了。</p>
<p>教员早期曾支持包产到户，而且非常清楚集体公社的弊端和包产到户的优势；对于陈云，刘等人的见解也表示认同。但在后续国际形势的变化和国内政治风向的变化的共同影响下改变了方向，认为这股风有经济反过来影响政治的趋势，所以开始与老干部派产生矛盾。</p>
]]></content>
      <categories>
        <category>杂谈</category>
      </categories>
  </entry>
  <entry>
    <title>SpringBoot3生产K8s部署</title>
    <url>/2025/12/23/%E8%AE%A1%E7%AE%97%E6%9C%BA/SpringBoot3%E7%94%9F%E4%BA%A7K8s%E9%83%A8%E7%BD%B2/</url>
    <content><![CDATA[<h1 id="SpringBoot-3-生产-K8s-部署手册"><a href="#SpringBoot-3-生产-K8s-部署手册" class="headerlink" title="SpringBoot 3 生产 K8s 部署手册"></a>SpringBoot 3 生产 K8s 部署手册</h1><h2 id="1-Jenkins-全局工具配置"><a href="#1-Jenkins-全局工具配置" class="headerlink" title="1. Jenkins 全局工具配置"></a>1. Jenkins 全局工具配置</h2><div class="table-container">
<table>
<thead>
<tr>
<th>工具</th>
<th>版本</th>
<th>安装方式</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>JDK</td>
<td>17</td>
<td>自动安装</td>
<td>命名 <code>jdk17</code></td>
</tr>
<tr>
<td>Maven</td>
<td>3.9.5</td>
<td>自动安装</td>
<td>命名 <code>maven3.9.5</code></td>
</tr>
</tbody>
</table>
</div>
<p><strong>路径</strong>：<br>Manage Jenkins → Global Tool Configuration → 分别新增 JDK &amp; Maven，<strong>Name 必须与 pipeline 中 tools 块保持一致</strong>。</p>
<hr>
<h2 id="2-基础镜像准备（openjdk-17-slim）"><a href="#2-基础镜像准备（openjdk-17-slim）" class="headerlink" title="2. 基础镜像准备（openjdk:17-slim）"></a>2. 基础镜像准备（openjdk:17-slim）</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 1. 拉取官方镜像</span></span><br><span class="line">docker pull openjdk:17-slim</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 重打 tag（指向私有 Harbor）</span></span><br><span class="line">docker tag openjdk:17-slim 172.31.10.118/library/openjdk:17-slim</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 登录并推送</span></span><br><span class="line">docker login 172.31.10.118 -u admin -p Harbor12345</span><br><span class="line">docker push 172.31.10.118/library/openjdk:17-slim</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="3-Jenkins-流水线（完整-Jenkinsfile）"><a href="#3-Jenkins-流水线（完整-Jenkinsfile）" class="headerlink" title="3. Jenkins 流水线（完整 Jenkinsfile）"></a>3. Jenkins 流水线（完整 <code>Jenkinsfile</code>）</h2><figure class="highlight groovy"><table><tr><td class="code"><pre><span class="line">pipeline &#123;</span><br><span class="line">    agent any</span><br><span class="line"></span><br><span class="line">    tools &#123;</span><br><span class="line">        jdk <span class="string">&#x27;jdk17&#x27;</span></span><br><span class="line">        maven <span class="string">&#x27;maven3.9.5&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    environment &#123;</span><br><span class="line">        docker_directory = <span class="string">&#x27;docker&#x27;</span></span><br><span class="line">        serverport       = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    stages &#123;</span><br><span class="line">        stage(<span class="string">&#x27;SCM&#x27;</span>) &#123;</span><br><span class="line">            steps &#123;</span><br><span class="line">                checkout([<span class="attr">$class:</span> <span class="string">&#x27;GitSCM&#x27;</span>,</span><br><span class="line">                          <span class="symbol">branches:</span> [[<span class="attr">name:</span> <span class="string">&#x27;$&#123;branch&#125;&#x27;</span>]],</span><br><span class="line">                          <span class="symbol">doGenerateSubmoduleConfigurations:</span> <span class="literal">false</span>,</span><br><span class="line">                          <span class="symbol">extensions:</span> [],</span><br><span class="line">                          <span class="symbol">submoduleCfg:</span> [],</span><br><span class="line">                          <span class="symbol">userRemoteConfigs:</span> [[<span class="attr">credentialsId:</span> <span class="string">&#x27;xjcares_git&#x27;</span>,</span><br><span class="line">                                               <span class="symbol">url:</span> <span class="string">&#x27;http://172.31.70.132:33788/xjcares/xjkygpt.git&#x27;</span>]]])</span><br><span class="line">                sh <span class="string">&#x27;echo &quot;nodefinished:&lt;$(date +\&#x27;%Y-%m-%d %H:%M:%S\&#x27;)&gt;&quot;&#x27;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        stage(<span class="string">&#x27;Build core&#x27;</span>) &#123;</span><br><span class="line">            steps &#123;</span><br><span class="line">                sh <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">                cd core-paas-component</span></span><br><span class="line"><span class="string">                mvn clean deploy -Dmaven.test.skip=true -U</span></span><br><span class="line"><span class="string">                &#x27;&#x27;&#x27;</span></span><br><span class="line">                sh <span class="string">&#x27;echo &quot;nodefinished:&lt;$(date +\&#x27;%Y-%m-%d %H:%M:%S\&#x27;)&gt;&quot;&#x27;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        stage(<span class="string">&#x27;Build&#x27;</span>) &#123;</span><br><span class="line">            steps &#123;</span><br><span class="line">                sh <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">                cd $&#123;module&#125;</span></span><br><span class="line"><span class="string">                mvn clean package -Dmaven.test.skip=true -U</span></span><br><span class="line"><span class="string">                &#x27;&#x27;&#x27;</span></span><br><span class="line">                sh <span class="string">&#x27;echo &quot;nodefinished:&lt;$(date +\&#x27;%Y-%m-%d %H:%M:%S\&#x27;)&gt;&quot;&#x27;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        stage(<span class="string">&#x27;Build &amp; Push Image&#x27;</span>) &#123;</span><br><span class="line">            steps &#123;</span><br><span class="line">                sh <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">                docker login -u admin -p Harbor12345 172.31.10.118</span></span><br><span class="line"><span class="string">                cd $&#123;module&#125;/target</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">                BUILD_TAG=$(date +%Y%m%d-%H%M%S)-$&#123;BUILD_NUMBER&#125;</span></span><br><span class="line"><span class="string">                REPOSITORY=172.31.10.118/xjcares/$&#123;module&#125;:$&#123;BUILD_TAG&#125;</span></span><br><span class="line"><span class="string">                JAR_FILE=$(ls *.jar | head -n 1)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">                cat &gt; Dockerfile &lt;&lt;EOF</span></span><br><span class="line"><span class="string">FROM 172.31.10.118/library/openjdk:17-slim</span></span><br><span class="line"><span class="string">ENV TZ=PRC</span></span><br><span class="line"><span class="string">RUN ln -snf /usr/share/zoneinfo/\$TZ /etc/localtime &amp;&amp; echo \$TZ &gt; /etc/timezone</span></span><br><span class="line"><span class="string">ADD $&#123;JAR_FILE&#125; /$&#123;module&#125;.jar</span></span><br><span class="line"><span class="string">ENTRYPOINT [&quot;java&quot;,&quot;-jar&quot;,&quot;-Xms$&#123;memory&#125;&quot;,&quot;-Xmx$&#123;memory&#125;&quot;,&quot;-Denv=pro&quot;,&quot;/$&#123;module&#125;.jar&quot;,&quot;--spring.profiles.active=prod&quot;]</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">                docker build -t $REPOSITORY .</span></span><br><span class="line"><span class="string">                docker push $REPOSITORY</span></span><br><span class="line"><span class="string">                echo &quot;$REPOSITORY&quot; &gt; ../../IMAGE_TAG.txt</span></span><br><span class="line"><span class="string">                docker logout 172.31.10.118</span></span><br><span class="line"><span class="string">                docker rmi $REPOSITORY</span></span><br><span class="line"><span class="string">                &#x27;&#x27;&#x27;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        stage(<span class="string">&#x27;Deploy to K8s&#x27;</span>) &#123;</span><br><span class="line">            steps &#123;</span><br><span class="line">                kubeconfig(<span class="attr">caCertificate:</span> <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">                           <span class="symbol">credentialsId:</span> <span class="string">&#x27;snowlotus-kubeconfig&#x27;</span>,</span><br><span class="line">                           <span class="symbol">serverUrl:</span> <span class="string">&#x27;&#x27;</span>) &#123;</span><br><span class="line">                    sh <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">                    cd $&#123;module&#125;/target/classes</span></span><br><span class="line"><span class="string">                    prop_value=$(grep -w ^server.port application.properties | cut -d= -f2)</span></span><br><span class="line"><span class="string">                    cd ../../..</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">                    NEW_IMAGE_TAG=$(cat IMAGE_TAG.txt)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">                    sed -i &quot;s|IMAGE_PLACEHOLDER|$&#123;NEW_IMAGE_TAG&#125;|g&quot; podTemplate.yaml</span></span><br><span class="line"><span class="string">                    sed -i &quot;s|PODNAME|$&#123;module&#125;|g&quot;           podTemplate.yaml</span></span><br><span class="line"><span class="string">                    sed -i &quot;s|PORT|$&#123;prop_value&#125;|g&quot;          podTemplate.yaml</span></span><br><span class="line"><span class="string">                    sed -i &quot;s|INSTANCENUM|$&#123;instanceNum&#125;|g&quot;  podTemplate.yaml</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">                    kubectl delete -f podTemplate.yaml --ignore-not-found=true</span></span><br><span class="line"><span class="string">                    kubectl apply  -f podTemplate.yaml</span></span><br><span class="line"><span class="string">                    &#x27;&#x27;&#x27;</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    post &#123;</span><br><span class="line">        always &#123;</span><br><span class="line">            cleanWs()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="4-SpringBoot-2-→-3"><a href="#4-SpringBoot-2-→-3" class="headerlink" title="4. SpringBoot 2 → 3"></a>4. SpringBoot 2 → 3</h2>]]></content>
      <categories>
        <category>计算机</category>
      </categories>
  </entry>
</search>
